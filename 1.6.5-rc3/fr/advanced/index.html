
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation of BunkerWeb, the open source and next generation WAF.">
      
      
      
        <link rel="canonical" href="https://docs.bunkerweb.io/latest/fr/advanced/">
      
      
        <link rel="prev" href="../features/">
      
      
        <link rel="next" href="../web-ui/">
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Utilisations avancées - Documentation BunkerWeb</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
    <script async
            defer
            data-domain="docs.bunkerweb.io"
            src="https://data.bunkerity.com/js/script.js"></script>

    <script defer>
      window.addEventListener('DOMContentLoaded', (e) => {

        const customHeaders = document.querySelectorAll('[data-custom-header]')
        customHeaders.forEach(header => {
          const getHeaders = document.querySelectorAll(`#${header.getAttribute('id')}`);
          getHeaders.forEach(el => {

            if(!el.hasAttribute('data-custom-header')) el.remove()
        })})
      })
    </script>

    <script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script>

    <script defer>
  // Lazy load images and embed youtube videos
  window.addEventListener("load", () => {
    document.querySelectorAll("[data-src]").forEach((el) => {
      el.setAttribute("src", el.getAttribute("data-src"));
    });
  });
  // Add missing label
  try {
    document
      .querySelector('div.md-search[data-md-component="search"][role="dialog"]')
      .setAttribute("aria-label", "Search in documentation");
  } catch (err) {}
    </script>

    <script defer>
      window.addEventListener('DOMContentLoaded', () => {
        const bannerEl = document.querySelector('aside.md-banner');
        let defaultContent = [{ "content" : '<p>Get the most of BunkerWeb by upgrading to the PRO version. Click <a style="text-decoration:underline; color :  white;" href="https://panel.bunkerweb.io/store/bunkerweb-pro?utm_campaign=self&utm_source=doc">here</a> and use the <strong>freetrial</strong> promo code to get started.</p>'},
        { "content" : '<p>Need premium support or tailored consulting around BunkerWeb ? Check out our <a style="text-decoration:underline; color :  white;" href="https://panel.bunkerweb.io/?utm_campaign=self&utm_source=doc#services">professional services</a>.</p>'},
        { "content" : '<p>Be part of the Bunker community by joining the <a style="text-decoration:underline; color: white;" href="https://discord.bunkerweb.io">Discord chat</a> and following us on <a style="text-decoration:underline; color: white;" href="https://www.linkedin.com/company/bunkerity/">LinkedIn</a>.</p>'}
        ]

      function setBannerStyle() {
        const bannerItem = bannerEl.querySelector('.md-banner__inner');
        bannerEl.style.backgroundColor = "#2eac68";
        bannerItem.style.textAlign = "center";
        bannerItem.style.transition = "all 0.5s ease-out";
      }

      function setDefault() {
        const bannerItem = bannerEl.querySelector('.md-banner__inner');
        const clone = bannerItem.cloneNode(true);
        clone.innerHTML = defaultContent[0]["content"];
        bannerEl.replaceChild(clone, bannerItem);
      }

      function startBannerLoop() {
        const switchDelay = 7000;
        let i = 0;

        setInterval(() => {
          // Update or reset index
          if(i + 1 === defaultContent.length) {
            i = 0;
          } else {
            i++;
          }

          // Prepare data with next el with opacity 0 too
          const currItem = bannerEl.querySelector('.md-banner__inner');
          currItem.style.opacity = 0;
          const clone = currItem.cloneNode(true);
          clone.innerHTML = defaultContent[i]["content"];
          setTimeout(() => {
            bannerEl.replaceChild(clone, currItem);
            setTimeout(() => {
              const newItem = bannerEl.querySelector('.md-banner__inner');
              newItem.style.opacity = 1;
            }, 20);
          }, 600);

        }, switchDelay);
      }

      function runBanner() {
        startBannerLoop();
        // Try to get dynamic content
        // Else keep static ones
        // fetch("https://www.bunkerweb.io/api/bw-ui-news")
        // .then((res) => {
        //   return res.json();
        // })
        // .then((res) => {
        //   defaultContent = res.data[0].data;
        //   startBannerLoop();
        // })
        // .catch((e) => {
        //   startBannerLoop();
        // });
      }

        setBannerStyle();
        setDefault();
        runBanner()

      })
    </script>

    
      
    
    
      <link rel="stylesheet" href="../../css/print-site.css">
    
      <link rel="stylesheet" href="../../css/print-site-material.css">
    
      <link rel="stylesheet" href="../../css/print-site.css">
    
      <link rel="stylesheet" href="../../css/print-site-material.css">
    
      <link rel="stylesheet" href="../../assets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Utilisations avancées - Documentation BunkerWeb" >
      
        <meta  property="og:description"  content="Documentation of BunkerWeb, the open source and next generation WAF." >
      
        <meta  property="og:image"  content="https://docs.bunkerweb.io/latest/assets/images/social/fr/advanced.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://docs.bunkerweb.io/latest/fr/advanced/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Utilisations avancées - Documentation BunkerWeb" >
      
        <meta  name="twitter:description"  content="Documentation of BunkerWeb, the open source and next generation WAF." >
      
        <meta  name="twitter:image"  content="https://docs.bunkerweb.io/latest/assets/images/social/fr/advanced.png" >
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#utilisations-avancees" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
    📢 Looking for BunkerWeb PRO version, technical support or tailored services ? Visit the
    <a href="https://panel.bunkerweb.io/?utm_campaign=self&utm_source=doc"
       style="color: #3f6ec6;
              text-decoration: underline">BunkerWeb Panel</a>
    for more information on our enterprise offers.

          </div>
          
        </aside>
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
    You're not viewing the
    documentation of the latest version.
    <a href="../../..">
        <strong>Click here to view latest.</strong>
    </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href="../" title="Documentation BunkerWeb" class="md-header__button md-logo" aria-label="Documentation BunkerWeb" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation BunkerWeb
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Utilisations avancées
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Sélectionner la langue">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../advanced/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="fr" class="md-select__link">
              Français
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../de/advanced/" hreflang="de" class="md-select__link">
              Deutsch
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../es/advanced/" hreflang="es" class="md-select__link">
              Español
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/bunkerity/bunkerweb" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Onglets" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link">
        
  
  
    
  
  Introduction

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../concepts/" class="md-tabs__link">
        
  
  
    
  
  Concepts

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../integrations/" class="md-tabs__link">
        
  
  
    
  
  Intégrations

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../quickstart-guide/" class="md-tabs__link">
        
  
  
    
  
  Guide de démarrage rapide

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../features/" class="md-tabs__link">
        
  
  
    
  
  Fonctionnalités

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  Utilisations avancées

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../web-ui/" class="md-tabs__link">
        
  
  
    
  
  Interface Web

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../upgrading/" class="md-tabs__link">
        
  
  
    
  
  Mise à niveau

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../troubleshooting/" class="md-tabs__link">
        
  
  
    
  
  Dépannage

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../plugins/" class="md-tabs__link">
        
  
  
    
  
  Plugins

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../professional-services/" class="md-tabs__link">
        
  
  
    
  
  Services professionnels

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../about/" class="md-tabs__link">
        
  
  
    
  
  À propos

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../" title="Documentation BunkerWeb" class="md-nav__button md-logo" aria-label="Documentation BunkerWeb" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Documentation BunkerWeb
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bunkerity/bunkerweb" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intégrations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guide de démarrage rapide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fonctionnalités
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Utilisations avancées
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Utilisations avancées
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cas-dutilisation" class="md-nav__link">
    <span class="md-ellipsis">
      Cas d'utilisation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cas d&#39;utilisation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#derriere-lequilibreur-de-charge-ou-le-proxy-inverse" class="md-nav__link">
    <span class="md-ellipsis">
      Derrière l'équilibreur de charge ou le proxy inverse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utilisation-de-mecanismes-de-resolution-dns-personnalises" class="md-nav__link">
    <span class="md-ellipsis">
      Utilisation de mécanismes de résolution DNS personnalisés
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utilisation de mécanismes de résolution DNS personnalisés">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#utilisation-de-systemd-resolved" class="md-nav__link">
    <span class="md-ellipsis">
      Utilisation de systemd-resolved
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utilisation-de-dnsmasq" class="md-nav__link">
    <span class="md-ellipsis">
      Utilisation de dnsmasq
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configurations-personnalisees" class="md-nav__link">
    <span class="md-ellipsis">
      Configurations personnalisées
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-de-nombreux-services-en-production" class="md-nav__link">
    <span class="md-ellipsis">
      Exécution de nombreux services en production
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exécution de nombreux services en production">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crs-mondial" class="md-nav__link">
    <span class="md-ellipsis">
      CRS mondial
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ajuster-max_allowed_packet-pour-mariadbmysql" class="md-nav__link">
    <span class="md-ellipsis">
      Ajuster max_allowed_packet pour MariaDB/MySQL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persistance-des-interdictions-et-des-signalements" class="md-nav__link">
    <span class="md-ellipsis">
      Persistance des interdictions et des signalements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proteger-les-applications-udptcp" class="md-nav__link">
    <span class="md-ellipsis">
      Protéger les applications UDP/TCP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-php" class="md-nav__link">
    <span class="md-ellipsis">
      Le PHP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv6" class="md-nav__link">
    <span class="md-ellipsis">
      IPv6
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reglage-de-la-securite" class="md-nav__link">
    <span class="md-ellipsis">
      Réglage de la sécurité
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-de-la-console-crowdsec" class="md-nav__link">
    <span class="md-ellipsis">
      Intégration de la console CrowdSec
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#surveillance-et-rapports" class="md-nav__link">
    <span class="md-ellipsis">
      Surveillance et rapports
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Surveillance et rapports">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#monitoring-pro" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring (PRO)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prometheus-exporter-pro" class="md-nav__link">
    <span class="md-ellipsis">
      Prometheus exporter (PRO)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reporting-pro" class="md-nav__link">
    <span class="md-ellipsis">
      Reporting (PRO)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sauvegarde-et-restauration" class="md-nav__link">
    <span class="md-ellipsis">
      Sauvegarde et restauration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sauvegarde et restauration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backup-s3-pro" class="md-nav__link">
    <span class="md-ellipsis">
      Backup S3 (PRO)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backup S3 (PRO)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sauvegarde-manuelle" class="md-nav__link">
    <span class="md-ellipsis">
      Sauvegarde manuelle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restauration-manuelle" class="md-nav__link">
    <span class="md-ellipsis">
      Restauration manuelle
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migration-pro" class="md-nav__link">
    <span class="md-ellipsis">
      Migration (PRO)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Migration (PRO)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creer-un-fichier-de-migration" class="md-nav__link">
    <span class="md-ellipsis">
      Créer un fichier de migration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initialiser-une-migration" class="md-nav__link">
    <span class="md-ellipsis">
      Initialiser une migration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anti-ddos-pro" class="md-nav__link">
    <span class="md-ellipsis">
      Anti DDoS (PRO)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Anti DDoS (PRO)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fonctionnalites" class="md-nav__link">
    <span class="md-ellipsis">
      Fonctionnalités
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bonnes-pratiques" class="md-nav__link">
    <span class="md-ellipsis">
      Bonnes pratiques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gestionnaire-dutilisateurs-pro" class="md-nav__link">
    <span class="md-ellipsis">
      Gestionnaire d'utilisateurs (PRO)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Gestionnaire d&#39;utilisateurs (PRO)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fonctionnalites_1" class="md-nav__link">
    <span class="md-ellipsis">
      Fonctionnalités
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../web-ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Interface Web
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../upgrading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mise à niveau
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dépannage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plugins
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../professional-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Services professionnels
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    À propos
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="utilisations-avancees">Utilisations avancées</h1>
<p>De nombreux exemples de cas d'utilisation concrets sont disponibles dans le dossier <a href="https://github.com/bunkerity/bunkerweb/tree/v1.6.5-rc1/examples">examples</a> du dépôt GitHub.</p>
<p>Nous fournissons également de nombreux modèles standard, tels que des fichiers YAML pour diverses intégrations et types de bases de données. Ceux-ci sont disponibles dans le dossier <a href="https://github.com/bunkerity/bunkerweb/tree/v1.6.5-rc1/misc/integrations">misc/integrations</a>.</p>
<p>Cette section se concentre uniquement sur les utilisations avancées et le réglage de la sécurité, consultez la <a href="../features/">section fonctionnalités</a> de la documentation pour voir tous les paramètres disponibles.</p>
<h2 id="cas-dutilisation">Cas d'utilisation</h2>
<div class="admonition tip">
<p class="admonition-title">Tester</p>
<p>Pour effectuer des tests rapides lorsque le mode multisite est activé (et si vous n'avez pas les bonnes entrées DNS configurées pour les domaines), vous pouvez utiliser curl avec l'en-tête HTTP Host de votre choix :
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Host: app1.example.com&quot;</span><span class="w"> </span>http://ip-or-fqdn-of-server
</code></pre></div></p>
<p>Si vous utilisez HTTPS, vous devrez configurer le SNI :
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Host: app1.example.com&quot;</span><span class="w"> </span>--resolve<span class="w"> </span>example.com:443:ip-of-server<span class="w"> </span>https://example.com
</code></pre></div></p>
</div>
<h3 id="derriere-lequilibreur-de-charge-ou-le-proxy-inverse">Derrière l'équilibreur de charge ou le proxy inverse</h3>
<div class="admonition info">
<p class="admonition-title">Real IP</p>
<p>Lorsque BunkerWeb se trouve lui‑même derrière un équilibreur de charge ou un proxy inverse, vous devez le configurer afin qu'il puisse récupérer la véritable adresse IP des clients. <strong>Si vous ne le faites pas, les fonctionnalités de sécurité bloqueront l'adresse IP de l'équilibreur de charge ou du proxy inverse au lieu de celle du client.</strong></p>
</div>
<p>BunkerWeb prend en fait en charge deux méthodes pour récupérer l'adresse IP réelle du client :</p>
<ul>
<li>À l'aide de l'icône <code>PROXY protocol</code></li>
<li>À l'aide d'un en-tête HTTP tel que <code>X-Forwarded-For</code></li>
</ul>
<p>Les paramètres suivants peuvent être utilisés :</p>
<ul>
<li><code>USE_REAL_IP</code> : activer/désactiver la récupération d'IP réelle</li>
<li><code>USE_PROXY_PROTOCOL</code> : activer/désactiver la prise en charge du protocole PROXY.</li>
<li><code>REAL_IP_FROM</code> : liste d'adresses IP/réseau de confiance autorisées pour nous envoyer la "vraie IP"</li>
<li><code>REAL_IP_HEADER</code> : l'en-tête HTTP contenant l'IP réelle ou la valeur spéciale <code>proxy_protocol</code> lors de l'utilisation du protocole PROXY</li>
</ul>
<p>Vous trouverez plus de paramètres sur l'IP réelle dans la <a href="../features/#real-ip">section des fonctionnalités</a> de la documentation.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">En-tête HTTP</label><label for="__tabbed_1_2">Protocole proxy</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Nous supposerons ce qui suit concernant les équilibreurs de charge ou les proxies inverses (vous devrez mettre à jour les paramètres en fonction de votre configuration) :</p>
<ul>
<li>Ils utilisent l' <code>X-Forwarded-For</code> en-tête pour définir l'adresse IP réelle</li>
<li>Ils ont des adresses IP dans les <code>1.2.3.0/24</code> réseaux<code>100.64.0.0/10</code> et</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="2:7"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><input id="__tabbed_2_3" name="__tabbed_2" type="radio" /><input id="__tabbed_2_4" name="__tabbed_2" type="radio" /><input id="__tabbed_2_5" name="__tabbed_2" type="radio" /><input id="__tabbed_2_6" name="__tabbed_2" type="radio" /><input id="__tabbed_2_7" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Interface utilisateur Web</label><label for="__tabbed_2_2">Linux</label><label for="__tabbed_2_3">Tout-en-un</label><label for="__tabbed_2_4">Docker</label><label for="__tabbed_2_5">Docker autoconf</label><label for="__tabbed_2_6">Kubernetes</label><label for="__tabbed_2_7">Swarm</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Accédez à la page <strong>Config Globale</strong>, sélectionnez le plugin <strong>Real IP</strong> et renseignez les paramètres suivants :</p>
<p><figure markdown><img align="center" alt="Paramètres Real IP (en-tête) via l'interface Web" src="../assets/img/advanced-proxy1.png" /><figcaption>Paramètres Real IP (en-tête) via l'interface Web</figcaption></figure></p>
<p>Veuillez noter qu'il est recommandé de redémarrer BunkerWeb lorsque vous modifiez des paramètres liés à la récupération de la vraie adresse IP.</p>
</div>
<div class="tabbed-block">
<p>Vous devrez ajouter ces paramètres au fichier /etc/bunkerweb/variables.env :</p>
<div class="highlight"><pre><span></span><code>...
USE_REAL_IP=yes
REAL_IP_FROM=1.2.3.0/24 100.64.0.0/16
REAL_IP_HEADER=X-Forwarded-For
...
</code></pre></div>
<p>Veuillez noter qu'il est recommandé de redémarrer plutôt que de recharger le service lorsque vous modifiez les paramètres liés à la récupération de la vraie adresse IP :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Vous devrez ajouter ces paramètres aux variables d'environnement lors de l'exécution du conteneur All-in-one :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>bunkerweb-aio<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>bw-storage:/data<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">USE_REAL_IP</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">REAL_IP_FROM</span><span class="o">=</span><span class="s2">&quot;1.2.3.0/24 100.64.0.0/10&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">REAL_IP_HEADER</span><span class="o">=</span><span class="s2">&quot;X-Forwarded-For&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">80</span>:8080/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">443</span>:8443/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">443</span>:8443/udp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>bunkerity/bunkerweb-all-in-one:1.6.5-rc1
</code></pre></div>
<p>Veuillez noter que si votre conteneur existe déjà, vous devrez le supprimer et le recréer afin que les nouvelles variables d'environnement soient prises en compte.</p>
</div>
<div class="tabbed-block">
<p>Vous devrez ajouter ces paramètres aux variables d'environnement des conteneurs BunkerWeb et du Scheduler :</p>
<div class="highlight"><pre><span></span><code><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.6.5-rc1</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X-Forwarded-For&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.6.5-rc1</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X-Forwarded-For&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p>Veuillez noter que si votre conteneur existe déjà, vous devrez le supprimer et le recréer afin que les nouvelles variables d'environnement soient prises en compte.</p>
</div>
<div class="tabbed-block">
<p>Vous devrez ajouter ces paramètres aux variables d'environnement des conteneurs BunkerWeb et du Scheduler :</p>
<div class="highlight"><pre><span></span><code><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.6.5-rc1</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X-Forwarded-For&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.6.5-rc1</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X-Forwarded-For&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p>Veuillez noter que si votre conteneur existe déjà, vous devrez le supprimer et le recréer afin que les nouvelles variables d'environnement soient prises en compte.</p>
</div>
<div class="tabbed-block">
<p>Vous devrez ajouter ces paramètres aux variables d'environnement des pods BunkerWeb et du Scheduler.</p>
<p>Voici la partie correspondante de votre fichier <code>values.yaml</code> que vous pouvez utiliser :</p>
<div class="highlight"><pre><span></span><code><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">extraEnvs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REAL_IP</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_FROM</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_HEADER</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X-Forwarded-For&quot;</span>
<span class="nt">scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">extraEnvs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REAL_IP</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_FROM</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_HEADER</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X-Forwarded-For&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Obsolète</p>
<p>L'intégration Swarm est obsolète et sera supprimée dans une future version. Veuillez envisager d'utiliser l'<a href="../integrations/#kubernetes">intégration Kubernetes</a> à la place.</p>
<p><strong>Plus d'informations sont disponibles dans la <a href="../integrations/#swarm">documentation de l'intégration Swarm</a>.</strong></p>
</div>
<p>Vous devrez ajouter ces paramètres aux variables d'environnement des services BunkerWeb et scheduler :</p>
<div class="highlight"><pre><span></span><code><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.6.5-rc1</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X-Forwarded-For&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.6.5-rc1</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X-Forwarded-For&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p>Veuillez noter que si votre conteneur existe déjà, vous devrez le supprimer et le recréer afin que les nouvelles variables d'environnement soient prises en compte.</p>
</div>
</div>
</div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Lire attentivement</p>
</div>
<p>N'utilisez le protocole <code>PROXY protocol</code> que si vous êtes certain que votre équilibreur de charge ou proxy inverse l'envoie. <strong>Si vous l'activez et qu'il n'est pas utilisé, vous obtiendrez des erreurs</strong>.</p>
<p>Nous supposerons ce qui suit concernant les équilibreurs de charge ou les proxies inverses (vous devrez adapter les paramètres en fonction de votre configuration) :</p>
<ul>
<li>Ils utilisent le <code>PROXY protocol</code> v1 ou v2 pour définir l'adresse IP réelle</li>
<li>Ils ont des adresses IP dans les réseaux <code>1.2.3.0/24</code> et <code>100.64.0.0/10</code></li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="3:7"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><input id="__tabbed_3_3" name="__tabbed_3" type="radio" /><input id="__tabbed_3_4" name="__tabbed_3" type="radio" /><input id="__tabbed_3_5" name="__tabbed_3" type="radio" /><input id="__tabbed_3_6" name="__tabbed_3" type="radio" /><input id="__tabbed_3_7" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Interface utilisateur Web</label><label for="__tabbed_3_2">Linux</label><label for="__tabbed_3_3">Tout-en-un</label><label for="__tabbed_3_4">Docker</label><label for="__tabbed_3_5">Docker autoconf</label><label for="__tabbed_3_6">Kubernetes</label><label for="__tabbed_3_7">Swarm</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Accédez à la page <strong>Config Globale</strong>, sélectionnez le plugin <strong>Real IP</strong> et renseignez les paramètres suivants :</p>
<p><figure markdown><img align="center" alt="Paramètres Real IP (protocole PROXY) via l'interface Web" src="../assets/img/advanced-proxy2.png" /><figcaption>Paramètres Real IP (protocole PROXY) via l'interface Web</figcaption></figure></p>
<p>Veuillez noter qu'il est recommandé de redémarrer BunkerWeb lorsque vous modifiez des paramètres liés à la récupération de la vraie adresse IP.</p>
</div>
<div class="tabbed-block">
<p>Vous devrez ajouter ces paramètres au fichier /etc/bunkerweb/variables.env :</p>
<div class="highlight"><pre><span></span><code>...
USE_REAL_IP=yes
USE_PROXY_PROTOCOL=yes
REAL_IP_FROM=1.2.3.0/24 100.64.0.0/16
REAL_IP_HEADER=proxy_protocol
...
</code></pre></div>
<p>Veuillez noter qu'il est recommandé de redémarrer plutôt que de recharger le service lors de la configuration des paramètres liés au protocole PROXY :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Vous devrez ajouter ces paramètres aux variables d'environnement lors de l'exécution du conteneur All-in-one :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>bunkerweb-aio<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>bw-storage:/data<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">USE_REAL_IP</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">USE_PROXY_PROTOCOL</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">REAL_IP_FROM</span><span class="o">=</span><span class="s2">&quot;1.2.3.0/24 100.64.0.0/10&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">REAL_IP_HEADER</span><span class="o">=</span><span class="s2">&quot;X-Forwarded-For&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">80</span>:8080/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">443</span>:8443/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">443</span>:8443/udp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>bunkerity/bunkerweb-all-in-one:1.6.5-rc1
</code></pre></div>
<p>Veuillez noter que si votre conteneur existe déjà, vous devrez le supprimer et le recréer afin que les nouvelles variables d'environnement soient prises en compte.</p>
</div>
<div class="tabbed-block">
<p>Vous devrez ajouter ces paramètres aux variables d'environnement des conteneurs BunkerWeb et du Scheduler :</p>
<div class="highlight"><pre><span></span><code><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.6.5-rc1</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">USE_PROXY_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proxy_protocol&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nn">...</span>
<span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.6.5-rc1</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">USE_PROXY_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proxy_protocol&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p>Veuillez noter que si votre conteneur existe déjà, vous devrez le supprimer et le recréer afin que les nouvelles variables d'environnement soient prises en compte.</p>
</div>
<div class="tabbed-block">
<p>Vous devrez ajouter ces paramètres aux variables d'environnement des conteneurs BunkerWeb et du Scheduler :</p>
<div class="highlight"><pre><span></span><code><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.6.5-rc1</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">USE_PROXY_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proxy_protocol&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nn">...</span>
<span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.6.5-rc1</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">USE_PROXY_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proxy_protocol&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p>Veuillez noter que si votre conteneur existe déjà, vous devrez le supprimer et le recréer afin que les nouvelles variables d'environnement soient prises en compte.</p>
</div>
<div class="tabbed-block">
<p>Vous devrez ajouter ces paramètres aux variables d'environnement des pods BunkerWeb et du Scheduler.</p>
<p>Voici la partie correspondante de votre fichier <code>values.yaml</code> que vous pouvez utiliser :</p>
<div class="highlight"><pre><span></span><code><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">extraEnvs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REAL_IP</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_PROXY_PROTOCOL</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_FROM</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_HEADER</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proxy_protocol&quot;</span>
<span class="nt">scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">extraEnvs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REAL_IP</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_PROXY_PROTOCOL</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_FROM</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_HEADER</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proxy_protocol&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Obsolète</p>
<p>L'intégration Swarm est obsolète et sera supprimée dans une future version. Veuillez envisager d'utiliser l'<a href="../integrations/#kubernetes">intégration Kubernetes</a> à la place.</p>
<p><strong>Plus d'informations sont disponibles dans la <a href="../integrations/#swarm">documentation de l'intégration Swarm</a>.</strong></p>
</div>
<p>Vous devrez ajouter ces paramètres aux variables d'environnement des services BunkerWeb et scheduler :</p>
<div class="highlight"><pre><span></span><code><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.6.5-rc1</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">USE_PROXY_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proxy_protocol&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nn">...</span>
<span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.6.5-rc1</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">USE_PROXY_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proxy_protocol&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p>Veuillez noter que si votre conteneur existe déjà, vous devrez le supprimer et le recréer afin que les nouvelles variables d'environnement soient prises en compte.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<h3 id="utilisation-de-mecanismes-de-resolution-dns-personnalises">Utilisation de mécanismes de résolution DNS personnalisés</h3>
<p>La configuration NGINX de BunkerWeb peut être personnalisée pour utiliser différents résolveurs DNS en fonction de vos besoins. Cela peut être particulièrement utile dans divers scénarios :</p>
<ol>
<li>Pour respecter les entrées de votre <code>/etc/hosts</code> fichier local</li>
<li>Lorsque vous devez utiliser des serveurs DNS personnalisés pour certains domaines</li>
<li>Pour s'intégrer à des solutions de mise en cache DNS locales</li>
</ol>
<h4 id="utilisation-de-systemd-resolved">Utilisation de systemd-resolved</h4>
<p>De nombreux systèmes Linux modernes utilisent <code>systemd-resolved</code> la résolution DNS. Si vous souhaitez que BunkerWeb respecte le contenu de votre <code>/etc/hosts</code> fichier et utilise le mécanisme de résolution DNS du système, vous pouvez le configurer pour utiliser le service DNS local résolu par systemd.</p>
<p>Pour vérifier que systemd-resolved est en cours d'exécution sur votre système, vous pouvez utiliser :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>systemd-resolved
</code></pre></div>
<p>Pour activer systemd-resolved comme résolveur DNS dans BunkerWeb, définissez le <code>DNS_RESOLVERS</code> paramètre sur <code>127.0.0.53</code>, qui est l'adresse d'écoute par défaut pour systemd-resolved :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Interface utilisateur Web</label><label for="__tabbed_4_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Accédez à la page <strong>Config Globale</strong> et définissez les résolveurs DNS sur <code>127.0.0.53</code></p>
<p><figure markdown><img align="center" alt="Paramètres des résolveurs DNS via l'interface Web" src="../assets/img/advanced-dns-resolvers.png" /><figcaption>Paramètres des résolveurs DNS via l'interface Web</figcaption></figure></p>
</div>
<div class="tabbed-block">
<p>Vous devrez modifier le fichier /etc/bunkerweb/variables.env :</p>
<div class="highlight"><pre><span></span><code>...
DNS_RESOLVERS=127.0.0.53
...
</code></pre></div>
<p>Après avoir effectué cette modification, rechargez le Scheduler pour appliquer la configuration :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>reload<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
</div>
</div>
</div>
<h4 id="utilisation-de-dnsmasq">Utilisation de dnsmasq</h4>
<p><a href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a> est un serveur DNS, DHCP et TFTP léger qui est couramment utilisé pour la mise en cache et la personnalisation du DNS local. C'est particulièrement utile lorsque vous avez besoin de plus de contrôle sur votre résolution DNS que celui fourni par systemd-resolved.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:3"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><input id="__tabbed_5_3" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">Linux</label><label for="__tabbed_5_2">Tout-en-un</label><label for="__tabbed_5_3">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Tout d'abord, installez et configurez dnsmasq sur votre système Linux :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">Debian/Ubuntu</label><label for="__tabbed_6_2">RHEL/Fedora</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1"># Install dnsmasq</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>dnsmasq

<span class="c1"># Configure dnsmasq to listen only on localhost</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;listen-address=127.0.0.1&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/dnsmasq.conf
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;bind-interfaces&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/dnsmasq.conf

<span class="c1"># Add custom DNS entries if needed</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;address=/custom.example.com/192.168.1.10&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/dnsmasq.conf

<span class="c1"># Restart dnsmasq</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>dnsmasq
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>dnsmasq
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1"># Install dnsmasq</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>dnsmasq

<span class="c1"># Configure dnsmasq to listen only on localhost</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;listen-address=127.0.0.1&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/dnsmasq.conf
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;bind-interfaces&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/dnsmasq.conf

<span class="c1"># Add custom DNS entries if needed</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;address=/custom.example.com/192.168.1.10&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/dnsmasq.conf

<span class="c1"># Restart dnsmasq</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>dnsmasq
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>dnsmasq
</code></pre></div>
</div>
</div>
</div>
<p>Ensuite, configurez BunkerWeb pour utiliser dnsmasq en définissant <code>DNS_RESOLVERS</code> sur <code>127.0.0.1</code> :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">Web UI</label><label for="__tabbed_7_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Accédez à la page <strong>Config Globale</strong> et sélectionnez le plugin <strong>NGINX</strong>, puis définissez les résolveurs DNS sur <code>127.0.0.1</code>.</p>
<p><figure markdown><img align="center" alt="Paramètres des résolveurs DNS via l'interface Web" src="../assets/img/advanced-dns-resolvers2.png" /><figcaption>Paramètres des résolveurs DNS via l'interface Web</figcaption></figure></p>
</div>
<div class="tabbed-block">
<p>Vous devrez modifier le fichier <code>/etc/bunkerweb/variables.env</code> :</p>
<div class="highlight"><pre><span></span><code>...
DNS_RESOLVERS=127.0.0.1
...
</code></pre></div>
<p>Après avoir effectué cette modification, rechargez le Scheduler pour appliquer la configuration :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>reload<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
</div>
</div>
</div>
</div>
<div class="tabbed-block">
<p>Lorsque vous utilisez l'image All-in-one, exécutez dnsmasq dans un conteneur séparé et configurez BunkerWeb pour l'utiliser :</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create a custom network for DNS communication</span>
docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>bw-dns

<span class="c1"># Run dnsmasq container using dockurr/dnsmasq with Quad9 DNS</span>
<span class="c1"># Quad9 provides security-focused DNS resolution with malware blocking</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>dnsmasq<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--network<span class="w"> </span>bw-dns<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">DNS1</span><span class="o">=</span><span class="s2">&quot;9.9.9.9&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">DNS2</span><span class="o">=</span><span class="s2">&quot;149.112.112.112&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">53</span>:53/udp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">53</span>:53/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cap-add<span class="o">=</span>NET_ADMIN<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--restart<span class="o">=</span>always<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>dockurr/dnsmasq

<span class="c1"># Run BunkerWeb All-in-one with dnsmasq DNS resolver</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>bunkerweb-aio<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--network<span class="w"> </span>bw-dns<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>bw-storage:/data<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">DNS_RESOLVERS</span><span class="o">=</span><span class="s2">&quot;dnsmasq&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">80</span>:8080/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">443</span>:8443/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">443</span>:8443/udp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>bunkerity/bunkerweb-all-in-one:1.6.5-rc1
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Ajoutez un service dnsmasq à votre fichier docker-compose et configurez BunkerWeb pour l'utiliser :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">dnsmasq</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dockurr/dnsmasq</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dnsmasq</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Using Quad9 DNS servers for enhanced security and privacy</span>
<span class="w">      </span><span class="c1"># Primary: 9.9.9.9 (Quad9 with malware blocking)</span>
<span class="w">      </span><span class="c1"># Secondary: 149.112.112.112 (Quad9 backup server)</span>
<span class="w">      </span><span class="nt">DNS1</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;9.9.9.9&quot;</span>
<span class="w">      </span><span class="nt">DNS2</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;149.112.112.112&quot;</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53:53/udp</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53:53/tcp</span>
<span class="w">    </span><span class="nt">cap_add</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NET_ADMIN</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-dns</span>

<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.6.5-rc1</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">DNS_RESOLVERS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dnsmasq&quot;</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-dns</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.6.5-rc1</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">DNS_RESOLVERS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dnsmasq&quot;</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-dns</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ...existing networks...</span>
<span class="w">  </span><span class="nt">bw-dns</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-dns</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="configurations-personnalisees">Configurations personnalisées</h3>
<p>Pour personnaliser et ajouter des configurations personnalisées à BunkerWeb, vous pouvez profiter de sa base NGINX. Des configurations NGINX personnalisées peuvent être ajoutées dans différents contextes NGINX, y compris des configurations pour le pare-feu d'applications Web (WAF) ModSecurity, qui est un composant central de BunkerWeb. Vous trouverez plus de détails sur les configurations de ModSecurity <a href="../features/#custom-configurations">ici</a>.</p>
<p>Voici les types de configurations personnalisées disponibles :</p>
<ul>
<li><strong>http</strong> : Configurations au niveau HTTP de NGINX.</li>
<li><strong>server-http</strong> : configurations au niveau HTTP/Server de NGINX.</li>
<li><strong>default-server-http</strong>: configurations au niveau du serveur de NGINX, en particulier pour le "serveur par défaut" lorsque le nom de client fourni ne correspond à aucun nom de serveur dans <code>SERVER_NAME</code>.</li>
<li><strong>modsec-crs</strong>: Configurations appliquées avant le chargement de l'ensemble de règles de base OWASP.</li>
<li><strong>modsec</strong>: configurations appliquées après le chargement de l'ensemble de règles de base OWASP ou utilisées lorsque l'ensemble de règles de base n'est pas chargé.</li>
<li><strong>crs-plugins-before</strong>: Configurations pour les plugins CRS, appliquées avant le chargement des plugins CRS.</li>
<li><strong>crs-plugins-after</strong>: Configurations pour les plugins CRS, appliquées après le chargement des plugins CRS.</li>
<li><strong>stream</strong> : Configurations au niveau du flux de NGINX.</li>
<li><strong>server-stream</strong> : Configurations au niveau Stream/Server de NGINX.</li>
</ul>
<p>Les configurations personnalisées peuvent être appliquées globalement ou spécifiquement pour un serveur particulier, en fonction du contexte applicable et de l'activation ou non du <a href="../concepts/#multisite-mode">mode multisite</a> .</p>
<p>La méthode d'application des configurations personnalisées dépend de l'intégration utilisée. Cependant, le processus sous-jacent implique l'ajout de fichiers avec le <code>.conf</code> suffixe à des dossiers spécifiques. Pour appliquer une configuration personnalisée à un serveur spécifique, le fichier doit être placé dans un sous-dossier nommé d'après le nom du serveur principal.</p>
<p>Certaines intégrations offrent des moyens plus pratiques d'appliquer des configurations, par exemple à l'aide de <a href="https://docs.docker.com/engine/swarm/configs/">Configs</a> dans Docker Swarm ou de <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">ConfigMap</a> dans Kubernetes. Ces options offrent des approches plus simples pour la gestion et l'application des configurations.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:7"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><input id="__tabbed_8_3" name="__tabbed_8" type="radio" /><input id="__tabbed_8_4" name="__tabbed_8" type="radio" /><input id="__tabbed_8_5" name="__tabbed_8" type="radio" /><input id="__tabbed_8_6" name="__tabbed_8" type="radio" /><input id="__tabbed_8_7" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">Interface utilisateur Web</label><label for="__tabbed_8_2">Linux</label><label for="__tabbed_8_3">Tout-en-un</label><label for="__tabbed_8_4">Docker</label><label for="__tabbed_8_5">Docker autoconf</label><label for="__tabbed_8_6">Kubernetes</label><label for="__tabbed_8_7">Swarm</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Accédez à la page <strong>Configs</strong>, cliquez sur <strong>Create new custom config</strong>, puis choisissez s'il s'agit d'une configuration globale ou spécifique à un service, le type de configuration et le nom de la configuration :</p>
<p><figure markdown><img align="center" alt="Configurations personnalisées via l'interface Web" src="../assets/img/advanced-config.png" /><figcaption>Configurations personnalisées via l'interface Web</figcaption></figure></p>
<p>N'oubliez pas de cliquer sur le bouton <code>💾 Enregistrer</code>.</p>
</div>
<div class="tabbed-block">
<p>Lorsque vous utilisez l'intégration <a href="../integrations/#linux">Linux</a>, les configurations personnalisées doivent être écrites dans le dossier <code>/etc/bunkerweb/configs</code>.</p>
<p>Voici un exemple pour server-http/hello-world.conf :</p>
<div class="highlight"><pre><span></span><code><span class="k">location</span><span class="w"> </span><span class="s">/hello</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kn">default_type</span><span class="w"> </span><span class="s">&#39;text/plain&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="kn">content_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">ngx.say(&#39;world&#39;)</span>
<span class="w">  </span><span class="err">}</span>
<span class="err">}</span>
</code></pre></div>
<p>Comme BunkerWeb s'exécute en tant qu'utilisateur non privilégié (nginx:nginx), vous devrez modifier les permissions :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:nginx<span class="w"> </span>/etc/bunkerweb/configs<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>/etc/bunkerweb/configs
</code></pre></div>
<p>Vérifions maintenant l'état du Scheduler :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
<p>S'ils sont déjà en cours d'exécution, nous pouvons le recharger :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>reload<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
<p>Sinon, nous devrons le démarrer :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Lorsque vous utilisez l'image <a href="../integrations/#all-in-one-aio-image">Tout-en-un</a>, vous avez deux options pour ajouter des configurations personnalisées :</p>
<ul>
<li>Utilisation de paramètres spécifiques <code>*_CUSTOM_CONF_*</code> comme variables d'environnement lors de l'exécution du conteneur (recommandé).</li>
<li>Écriture <code>.conf</code> de fichiers dans le <code>/data/configs/</code> répertoire du volume monté sur <code>/data</code>.</li>
</ul>
<p><strong>Utilisation des paramètres (variables d'environnement)</strong></p>
<p>Les paramètres à utiliser doivent suivre le schéma <code>&lt;SITE&gt;_CUSTOM_CONF_&lt;TYPE&gt;_&lt;NAME&gt;</code>:</p>
<ul>
<li><code>&lt;SITE&gt;</code> : Nom du serveur primaire facultatif si le mode multisite est activé et que la configuration doit être appliquée à un service spécifique.</li>
<li><code>&lt;TYPE&gt;</code> : Le type de configuration, les valeurs acceptées sont <code>HTTP</code>, <code>DEFAULT_SERVER_HTTP</code>, <code>SERVER_HTTP</code> <code>MODSEC</code> <code>MODSEC_CRS</code> <code>CRS_PLUGINS_BEFORE</code>, <code>CRS_PLUGINS_AFTER</code> <code>STREAM</code> , et <code>SERVER_STREAM</code>.</li>
<li><code>&lt;NAME&gt;</code> : Le nom de la configuration sans le <code>.conf</code> suffixe.</li>
</ul>
<p>Voici un exemple fictif lors de l'exécution du conteneur All-in-one :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>bunkerweb-aio<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>bw-storage:/data<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="s2">&quot;CUSTOM_CONF_SERVER_HTTP_hello-world=location /hello { \</span>
<span class="s2">        default_type &#39;text/plain&#39;; \</span>
<span class="s2">        content_by_lua_block { \</span>
<span class="s2">          ngx.say(&#39;world&#39;); \</span>
<span class="s2">        } \</span>
<span class="s2">      }&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">80</span>:8080/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">443</span>:8443/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>bunkerity/bunkerweb-all-in-one:1.6.5-rc1
</code></pre></div>
<p>Veuillez noter que si votre conteneur est déjà créé, vous devrez le supprimer et le recréer pour que les nouvelles variables d'environnement soient appliquées.</p>
<p><strong>Utilisation de fichiers</strong></p>
<p>La première chose à faire est de créer les dossiers :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>./bw-data/configs/server-http
</code></pre></div>
<p>Vous pouvez maintenant écrire vos configurations :</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;location /hello {</span>
<span class="s2">  default_type &#39;text/plain&#39;;</span>
<span class="s2">  content_by_lua_block {</span>
<span class="s2">    ngx.say(&#39;world&#39;)</span>
<span class="s2">  }</span>
<span class="s2">}&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>./bw-data/configs/server-http/hello-world.conf
</code></pre></div>
<p>Étant donné que le Scheduler s'exécute en tant qu'utilisateur non privilégié avec UID et GID 101, vous devrez modifier les autorisations :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:101<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div>
<p>Au démarrage du conteneur de l'ordonnanceur, vous devrez monter le dossier sur /data :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>bunkerweb-aio<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>./bw-data:/data<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">80</span>:8080/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">443</span>:8443/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">443</span>:8443/udp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>bunkerity/bunkerweb-all-in-one:1.6.5-rc1
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Lorsque vous utilisez l'intégration <a href="../integrations/#docker">Docker</a>, vous avez deux options pour ajouter des configurations personnalisées :</p>
<ul>
<li>Utilisation de paramètres spécifiques <code>*_CUSTOM_CONF_*</code> comme variables d'environnement (recommandé)</li>
<li>Écriture des fichiers .conf sur le volume monté sur /data de l'ordonnanceur</li>
</ul>
<p><strong>Utilisation des paramètres</strong></p>
<p>Les paramètres à utiliser doivent suivre le schéma <code>&lt;SITE&gt;_CUSTOM_CONF_&lt;TYPE&gt;_&lt;NAME&gt;</code> :</p>
<ul>
<li><code>&lt;SITE&gt;</code> : nom de serveur primaire facultatif si le mode multisite est activé et que la configuration doit être appliquée à un service spécifique</li>
<li><code>&lt;TYPE&gt;</code> : le type de configuration, les valeurs acceptées sont <code>HTTP</code>, <code>DEFAULT_SERVER_HTTP</code> <code>SERVER_HTTP</code> <code>MODSEC</code> <code>MODSEC_CRS</code> <code>CRS_PLUGINS_BEFORE</code>, <code>CRS_PLUGINS_AFTER</code>, <code>STREAM</code> , et <code>SERVER_STREAM</code></li>
<li><code>&lt;NAME&gt;</code> : le nom de config sans le suffixe .conf</li>
</ul>
<p>Voici un exemple factice utilisant un fichier docker-compose :</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.6.5-rc1</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">CUSTOM_CONF_SERVER_HTTP_hello-world=</span>
<span class="w">      </span><span class="no">location /hello {</span>
<span class="w">        </span><span class="no">default_type &#39;text/plain&#39;;</span>
<span class="w">        </span><span class="no">content_by_lua_block {</span>
<span class="w">          </span><span class="no">ngx.say(&#39;world&#39;)</span>
<span class="w">        </span><span class="no">}</span>
<span class="w">      </span><span class="no">}</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p><strong>Utilisation de fichiers</strong></p>
<p>La première chose à faire est de créer les dossiers :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>./bw-data/configs/server-http
</code></pre></div>
<p>Vous pouvez maintenant écrire vos configurations :</p>
<div class="highlight"><pre><span></span><code><span class="k">echo</span><span class="w"> </span><span class="s">&quot;location</span><span class="w"> </span><span class="s">/hello</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kn">default_type</span><span class="w"> </span><span class="s">&#39;text/plain&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="kn">content_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">ngx.say(&#39;world&#39;)</span>
<span class="w">  </span><span class="err">}</span>
<span class="err">}</span><span class="s">&quot;</span><span class="w"> </span><span class="s">&gt;</span><span class="w"> </span><span class="s">./bw-data/configs/server-http/hello-world.conf</span>
</code></pre></div>
<p>Étant donné que le Scheduler s'exécute en tant qu'utilisateur non privilégié avec UID et GID 101, vous devrez modifier les autorisations :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:101<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div>
<p>Au démarrage du conteneur de l'ordonnanceur, vous devrez monter le dossier sur /data :</p>
<div class="highlight"><pre><span></span><code><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.6.5-rc1</span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./bw-data:/data</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Lorsque vous utilisez l'intégration <a href="../integrations/#docker-autoconf">Docker autoconf</a>, vous avez deux options pour ajouter des configurations personnalisées :</p>
<ul>
<li>Utilisation de paramètres spécifiques <code>*_CUSTOM_CONF_*</code> comme étiquettes (le plus simple)</li>
<li>Écriture des fichiers .conf sur le volume monté sur /data de l'ordonnanceur</li>
</ul>
<p><strong>Utilisation des étiquettes</strong></p>
<div class="admonition warning">
<p class="admonition-title">Limitations de l'utilisation des étiquettes</p>
<p>Lorsque vous utilisez des étiquettes avec l'intégration Docker autoconf, vous ne pouvez appliquer des configurations personnalisées que pour le service web correspondant. L'application de <strong>http</strong>, <strong>default-server-http</strong>, <strong>stream</strong> ou de toute configuration globale (comme <strong>server-http</strong> ou <strong>server-stream</strong> pour tous les services) n'est pas possible : vous devrez monter des fichiers à cet effet.</p>
</div>
<p>Les étiquettes à utiliser doivent suivre le modèle <code>bunkerweb.CUSTOM_CONF_&lt;TYPE&gt;_&lt;NAME&gt;</code> :</p>
<ul>
<li><code>&lt;TYPE&gt;</code> : le type de configuration, les valeurs acceptées sont <code>SERVER_HTTP</code>, <code>MODSEC</code>, <code>MODSEC_CRS</code>, <code>CRS_PLUGINS_BEFORE</code> <code>CRS_PLUGINS_AFTER</code> et <code>SERVER_STREAM</code></li>
<li><code>&lt;NAME&gt;</code> : le nom de config sans le suffixe .conf</li>
</ul>
<p>Voici un exemple factice utilisant un fichier docker-compose :</p>
<div class="highlight"><pre><span></span><code><span class="nt">myapp</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginxdemos/nginx-hello</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">bunkerweb.CUSTOM_CONF_SERVER_HTTP_hello-world=</span>
<span class="w">      </span><span class="no">location /hello {</span>
<span class="w">        </span><span class="no">default_type &#39;text/plain&#39;;</span>
<span class="w">        </span><span class="no">content_by_lua_block {</span>
<span class="w">            </span><span class="no">ngx.say(&#39;world&#39;)</span>
<span class="w">        </span><span class="no">}</span>
<span class="w">      </span><span class="no">}</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p><strong>Utilisation de fichiers</strong></p>
<p>La première chose à faire est de créer les dossiers :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>./bw-data/configs/server-http
</code></pre></div>
<p>Vous pouvez maintenant écrire vos configurations :</p>
<div class="highlight"><pre><span></span><code><span class="k">echo</span><span class="w"> </span><span class="s">&quot;location</span><span class="w"> </span><span class="s">/hello</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kn">default_type</span><span class="w"> </span><span class="s">&#39;text/plain&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="kn">content_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">ngx.say(&#39;world&#39;)</span>
<span class="w">  </span><span class="err">}</span>
<span class="err">}</span><span class="s">&quot;</span><span class="w"> </span><span class="s">&gt;</span><span class="w"> </span><span class="s">./bw-data/configs/server-http/hello-world.conf</span>
</code></pre></div>
<p>Étant donné que le Scheduler s'exécute en tant qu'utilisateur non privilégié avec UID et GID 101, vous devrez modifier les autorisations :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:101<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div>
<p>Au démarrage du conteneur de l'ordonnanceur, vous devrez monter le dossier sur /data :</p>
<div class="highlight"><pre><span></span><code><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.6.5-rc1</span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./bw-data:/data</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Lors de l'utilisation de l'<a href="../integrations/#kubernetes">intégration Kubernetes</a>, les configurations personnalisées sont gérées à l'aide de <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">ConfigMap</a>.</p>
<p>Pour simplifier, vous n'avez même pas besoin d'attacher le ConfigMap à un Pod (par ex. comme variable d'environnement ou volume) : le Pod d'autoconf écoute les événements ConfigMap et mettra à jour les configurations personnalisées lorsque nécessaire.</p>
<p>Lors de la création d'un ConfigMap, vous devrez ajouter des labels spéciaux :</p>
<ul>
<li><strong>bunkerweb.io/CONFIG_TYPE</strong> : doit être défini sur un type de configuration personnalisé valide (http, server-http, default-server-http, modsec, modsec-crs, crs-plugins-before, crs-plugins-after, stream ou server-stream)</li>
<li><strong>bunkerweb.io/CONFIG_SITE</strong> : défini sur un nom de serveur pour appliquer la configuration à ce serveur spécifique (facultatif, sera appliqué globalement s'il n'est pas défini)</li>
</ul>
<p>Voici l'exemple :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cfg-bunkerweb-all-server-http</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb.io/CONFIG_TYPE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;server-http&quot;</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myconf</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">location /hello {</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">default_type &#39;text/plain&#39;;</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">content_by_lua_block {</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">ngx.say(&#39;world&#39;)</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">}</span>
<span class="w">  </span><span class="err">}</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Custom Extra Config</p>
<p>Depuis la version <code>1.6.0</code>, vous pouvez ajouter/remplacer des paramètres à l'aide de l'annotation <code>bunkerweb.io/CONFIG_TYPE=settings</code>. En voici un exemple :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cfg-bunkerweb-extra-settings</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb.io/CONFIG_TYPE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;settings&quot;</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">USE_ANTIBOT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;captcha&quot;</span><span class="w"> </span><span class="c1"># multisite setting that will be applied to all services that do not override it</span>
<span class="w">  </span><span class="nt">USE_REDIS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="c1"># global setting that will be applied globally</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Obsolète</p>
<p>L'intégration Swarm est obsolète et sera supprimée dans une future version. Veuillez envisager d'utiliser l'<a href="../integrations/#kubernetes">intégration Kubernetes</a> à la place.</p>
<p><strong>Plus d'informations sont disponibles dans la <a href="../integrations/#swarm">documentation de l'intégration Swarm</a>.</strong></p>
</div>
<p>Lorsque vous utilisez l'<a href="../integrations/#swarm">Swarm integration</a>, les configurations personnalisées sont gérées à l'aide des <a href="https://docs.docker.com/engine/swarm/configs/">Docker Configs</a>.</p>
<p>Pour simplifier, vous n'avez même pas besoin d'attacher le Config à un service : le service d'autoconf écoute les événements Config et mettra à jour les configurations personnalisées lorsque nécessaire.</p>
<p>Lors de la création d'un Config, vous devrez ajouter des labels spéciaux :</p>
<ul>
<li><strong>bunkerweb.CONFIG_TYPE</strong> : doit être défini sur un type de configuration personnalisé valide (http, server-http, default-server-http, modsec, modsec-crs, crs-plugins-before, crs-plugins-after, stream ou server-stream)</li>
<li><strong>bunkerweb.CONFIG_SITE</strong> : défini sur un nom de serveur pour appliquer la configuration à ce serveur spécifique (facultatif, sera appliqué globalement s'il n'est pas défini)</li>
</ul>
<p>Voici l'exemple :</p>
<div class="highlight"><pre><span></span><code><span class="k">echo</span><span class="w"> </span><span class="s">&quot;location</span><span class="w"> </span><span class="s">/hello</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kn">default_type</span><span class="w"> </span><span class="s">&#39;text/plain&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="kn">content_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">ngx.say(&#39;world&#39;)</span>
<span class="w">  </span><span class="err">}</span>
<span class="err">}</span><span class="s">&quot;</span><span class="w"> </span><span class="s">|</span><span class="w"> </span><span class="s">docker</span><span class="w"> </span><span class="s">config</span><span class="w"> </span><span class="s">create</span><span class="w"> </span><span class="s">-l</span><span class="w"> </span><span class="s">bunkerweb.CONFIG_TYPE=server-http</span><span class="w"> </span><span class="s">my-config</span><span class="w"> </span><span class="s">-</span>
</code></pre></div>
<p>Il n'y a pas de mécanisme de mise à jour : l'alternative est de supprimer une configuration existante à l'aide puis de <code>docker config rm</code> la recréer.</p>
</div>
</div>
</div>
<h3 id="execution-de-nombreux-services-en-production">Exécution de nombreux services en production</h3>
<h4 id="crs-mondial">CRS mondial</h4>
<div class="admonition warning">
<p class="admonition-title">Plugins CRS</p>
<p>Lorsque le SCR est chargé globalement, les <strong>plug-ins SCR ne sont pas pris en charge</strong>. Si vous avez besoin de les utiliser, vous devrez charger le SCR par service.</p>
</div>
<p>Si vous utilisez BunkerWeb en production avec un grand nombre de services, et que vous activez la <strong>fonctionnalité ModSecurity globalement</strong> avec des règles CRS, le temps nécessaire pour charger les configurations BunkerWeb peut devenir trop long, ce qui peut entraîner un délai d'expiration.</p>
<p>La solution de contournement consiste à charger les règles CRS globalement plutôt que par service. Ce comportement n'est pas activé par défaut pour des raisons de compatibilité descendante et parce qu'il présente un inconvénient : si vous activez le chargement des règles CRS globales, <strong>il ne sera plus possible de définir des règles modsec-crs</strong> (exécutées avant les règles CRS) par service. Cependant, cette limitation peut être contournée en écrivant des règles d'exclusion globales <code>modsec-crs</code> comme suit :</p>
<div class="highlight"><pre><span></span><code>SecRule REQUEST_FILENAME &quot;@rx ^/somewhere$&quot; &quot;nolog,phase:4,allow,id:1010,chain&quot;
SecRule REQUEST_HEADERS:Host &quot;@rx ^app1\.example\.com$&quot; &quot;nolog&quot;
</code></pre></div>
<p>Vous pouvez activer le chargement global du SCR en définissant <code>USE_MODSECURITY_GLOBAL_CRS</code> la valeur . <code>yes</code></p>
<h4 id="ajuster-max_allowed_packet-pour-mariadbmysql">Ajuster max_allowed_packet pour MariaDB/MySQL</h4>
<p>Il semble que la valeur par défaut du <code>max_allowed_packet</code> paramètre dans les serveurs de bases de données MariaDB et MySQL ne soit pas suffisante lors de l'utilisation de BunkerWeb avec un grand nombre de services.</p>
<p>Si vous rencontrez des erreurs comme celle-ci, en particulier sur le Scheduler :</p>
<div class="highlight"><pre><span></span><code>[Warning] Aborted connection 5 to db: &#39;db&#39; user: &#39;bunkerweb&#39; host: &#39;172.20.0.4&#39; (Got a packet bigger than &#39;max_allowed_packet&#39; bytes)
</code></pre></div>
<p>Vous devrez augmenter le <code>max_allowed_packet</code> sur votre serveur de base de données.</p>
<h3 id="persistance-des-interdictions-et-des-signalements">Persistance des interdictions et des signalements</h3>
<p>Par défaut, BunkerWeb stocke les bannissements et les rapports dans un magasin de données Lua local. Bien que simple et efficace, cette configuration signifie que des données sont perdues lors du redémarrage de l'instance. Pour vous assurer que les bannissements et les rapports persistent lors des redémarrages, vous pouvez configurer BunkerWeb pour utiliser un <a href="https://redis.io/"> serveur Redis</a> ou <a href="https://valkey.io/">Valkey</a> distant  .</p>
<p><strong>Pourquoi utiliser Redis/Valkey ?</strong></p>
<p>Redis et Valkey sont de puissants magasins de données en mémoire couramment utilisés comme bases de données, caches et courtiers de messages. Ils sont hautement évolutifs et prennent en charge une variété de structures de données, notamment :</p>
<ul>
<li><strong>Chaînes</strong>: paires clé-valeur de base.</li>
<li><strong>Hachages</strong>: paires champ-valeur au sein d'une seule clé.</li>
<li><strong>Listes</strong>: collections ordonnées de chaînes.</li>
<li><strong>Ensembles</strong>: collections non ordonnées de chaînes uniques.</li>
<li><strong>Ensembles triés</strong>: Collections ordonnées avec partitions.</li>
</ul>
<p>En tirant parti de Redis ou de Valkey, BunkerWeb peut stocker de manière persistante les bannissements, les rapports et les données de cache, garantissant ainsi la durabilité et l'évolutivité.</p>
<p><strong>Activation de la prise en charge Redis/Valkey</strong></p>
<p>Pour activer la prise en charge de Redis ou Valkey, configurez les paramètres suivants dans votre fichier de configuration BunkerWeb :</p>
<div class="highlight"><pre><span></span><code># Enable Redis/Valkey support
USE_REDIS=yes

# Redis/Valkey server hostname or IP address
REDIS_HOST=&lt;hostname&gt;

# Redis/Valkey server port number (default: 6379)
REDIS_PORT=6379

# Redis/Valkey database number (default: 0)
REDIS_DATABASE=0
</code></pre></div>
<ul>
<li><strong><code>USE_REDIS</code></strong>: Réglez sur <code>yes</code> pour activer l'intégration Redis/Valkey.</li>
<li><strong><code>REDIS_HOST</code></strong>: Spécifiez le nom d'hôte ou l'adresse IP du serveur Redis/Valkey.</li>
<li><strong><code>REDIS_PORT</code></strong>: Spécifiez le numéro de port pour le serveur Redis/Valkey. La valeur par défaut est <code>6379</code>.</li>
<li><strong><code>REDIS_DATABASE</code></strong>: Indiquez le numéro de base de données Redis/Valkey à utiliser. La valeur par défaut est <code>0</code>.</li>
</ul>
<p>Si vous avez besoin de paramètres plus avancés, tels que l'authentification, la prise en charge SSL/TLS ou le mode Sentinel, reportez-vous à la documentation sur les paramètres du <a href="../features/#redis">plug-in Redis</a> pour obtenir des conseils détaillés.</p>
<h3 id="proteger-les-applications-udptcp">Protéger les applications UDP/TCP</h3>
<div class="admonition example">
<p class="admonition-title">Fonctionnalité expérimentale</p>
<p>This feature is not production-ready. Feel free to test it and report us any bug using <a href="https://github.com/bunkerity/bunkerweb/issues">issues</a> in the GitHub repository.</p>
</div>
<p>BunkerWeb offre la possibilité de fonctionner comme un <strong>proxy inverse UDP/TCP générique</strong>, ce qui vous permet de protéger toutes les applications basées sur le réseau fonctionnant au moins sur la couche 4 du modèle OSI. Au lieu d'utiliser le module HTTP "classique", BunkerWeb exploite le <a href="https://nginx.org/en/docs/stream/ngx_stream_core_module.html">module de flux</a> de NGINX.</p>
<p>Il est important de noter que <strong>tous les paramètres et fonctionnalités de sécurité ne sont pas disponibles lors de l'utilisation du module de flux</strong>. Vous trouverez de plus amples informations à ce sujet dans les sections des <a href="../features/">fonctionnalités</a> de la documentation.</p>
<p>La configuration d'un proxy inverse de base est assez similaire à la configuration HTTP, car elle implique l'utilisation des mêmes paramètres : <code>USE_REVERSE_PROXY=yes</code> et <code>REVERSE_PROXY_HOST=myapp:9000</code>. Même lorsque BunkerWeb est positionné derrière un équilibreur de charge, les paramètres restent les mêmes (le <strong>protocole PROXY</strong> étant l'option prise en charge pour des raisons évidentes).</p>
<p>En plus de cela, les paramètres spécifiques suivants sont utilisés :</p>
<ul>
<li><code>SERVER_TYPE=stream</code> : activer  le <code>stream</code> mode (UDP/TCP générique) au lieu d' <code>http</code> un (qui est la valeur par défaut)</li>
<li><code>LISTEN_STREAM_PORT=4242</code> : le port d'écoute "simple" (sans SSL/TLS) sur lequel BunkerWeb écoutera</li>
<li><code>LISTEN_STREAM_PORT_SSL=4343</code> : le port d'écoute "ssl/tls" sur lequel BunkerWeb écoutera</li>
<li><code>USE_UDP=no</code> : écouter et transférer les paquets UDP au lieu de TCP</li>
</ul>
<p>Pour la liste complète des paramètres concernant <code>stream</code> le  mode, veuillez vous référer à la sections des <a href="../features/">fonctionnalités</a> de la documentation.</p>
<div class="admonition tip">
<p class="admonition-title">Plusieurs ports d'écoute</p>
<p>Depuis la version <code>1.6.0</code>, BunkerWeb prend en charge plusieurs ports d'écoute pour le mode <code>stream</code>. Vous pouvez les spécifier à l'aide des paramètres <code>LISTEN_STREAM_PORT</code> et <code>LISTEN_STREAM_PORT_SSL</code>.</p>
<p>Voici un exemple :</p>
<div class="highlight"><pre><span></span><code>...
LISTEN_STREAM_PORT=4242
LISTEN_STREAM_PORT_SSL=4343
LISTEN_STREAM_PORT_1=4244
LISTEN_STREAM_PORT_SSL_1=4344
...
</code></pre></div>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="9:6"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><input id="__tabbed_9_3" name="__tabbed_9" type="radio" /><input id="__tabbed_9_4" name="__tabbed_9" type="radio" /><input id="__tabbed_9_5" name="__tabbed_9" type="radio" /><input id="__tabbed_9_6" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">Tout-en-un</label><label for="__tabbed_9_2">Docker</label><label for="__tabbed_9_3">Docker autoconf</label><label for="__tabbed_9_4">Kubernetes</label><label for="__tabbed_9_5">Linux</label><label for="__tabbed_9_6">Swarm</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Vous devrez ajouter ces paramètres aux variables d'environnement lors de l'exécution du conteneur All-in-one. Vous devrez également exposer les ports de stream.</p>
<p>Cet exemple configure BunkerWeb pour agir comme proxy inverse pour deux applications basées sur le mode stream : <code>app1.example.com</code> et <code>app2.example.com</code>.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>bunkerweb-aio<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>bw-storage:/data<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">SERVICE_UI</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">SERVER_NAME</span><span class="o">=</span><span class="s2">&quot;app1.example.com app2.example.com&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">MULTISITE</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">USE_REVERSE_PROXY</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">SERVER_TYPE</span><span class="o">=</span><span class="s2">&quot;stream&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span>app1.example.com_REVERSE_PROXY_HOST<span class="o">=</span><span class="s2">&quot;myapp1:9000&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span>app1.example.com_LISTEN_STREAM_PORT<span class="o">=</span><span class="s2">&quot;10000&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span>app2.example.com_REVERSE_PROXY_HOST<span class="o">=</span><span class="s2">&quot;myapp2:9000&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span>app2.example.com_LISTEN_STREAM_PORT<span class="o">=</span><span class="s2">&quot;20000&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">80</span>:8080/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">443</span>:8443/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">443</span>:8443/udp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">10000</span>:10000/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">20000</span>:20000/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>bunkerity/bunkerweb-all-in-one:1.6.5-rc1
</code></pre></div>
<p>Veuillez noter que si votre conteneur existe déjà, vous devrez le supprimer et le recréer afin que les nouvelles variables d'environnement soient prises en compte.</p>
<p>Vos applications (<code>myapp1</code>, <code>myapp2</code>) doivent s'exécuter dans des conteneurs séparés (ou être autrement accessibles) et leurs noms d'hôte/adresses IP (par ex. <code>myapp1</code>, <code>myapp2</code> utilisés dans <code>_REVERSE_PROXY_HOST</code>) doivent être résolubles et atteignables depuis le conteneur <code>bunkerweb-aio</code>. Cela implique généralement de les connecter à un réseau Docker partagé.</p>
<div class="admonition note">
<p class="admonition-title">Désactiver le service UI</p>
<p>Il est recommandé de désactiver le service d'interface Web (par exemple en définissant la variable d'environnement <code>SERVICE_UI=no</code>) car l'interface Web n'est pas compatible avec <code>SERVER_TYPE=stream</code>.</p>
</div>
</div>
<div class="tabbed-block">
<p>Lors de l'utilisation de l'intégration Docker, la manière la plus simple de protéger des applications réseau existantes est d'ajouter les services au réseau <code>bw-services</code> :</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-bw-api-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-api-env</span>
<span class="w">  </span><span class="c1"># We use an anchor to avoid repeating the same settings for all services</span>
<span class="w">  </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.6.5-rc1</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080&quot;</span><span class="w"> </span><span class="c1"># Keep it if you want to use Let&#39;s Encrypt automation when using http challenge type</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;10000:10000&quot;</span><span class="w"> </span><span class="c1"># app1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;20000:20000&quot;</span><span class="w"> </span><span class="c1"># app2</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE=yes&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.6.5-rc1</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span><span class="w"> </span><span class="c1"># This setting is mandatory to specify the BunkerWeb instance</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;app1.example.com</span><span class="nv"> </span><span class="s">app2.example.com&quot;</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">USE_REVERSE_PROXY</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="c1"># Will be applied to all services</span>
<span class="w">      </span><span class="nt">SERVER_TYPE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;stream&quot;</span><span class="w"> </span><span class="c1"># Will be applied to all services</span>
<span class="w">      </span><span class="nt">app1.example.com_REVERSE_PROXY_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;myapp1:9000&quot;</span>
<span class="w">      </span><span class="nt">app1.example.com_LISTEN_STREAM_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10000&quot;</span>
<span class="w">      </span><span class="nt">app2.example.com_REVERSE_PROXY_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;myapp2:9000&quot;</span>
<span class="w">      </span><span class="nt">app2.example.com_LISTEN_STREAM_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;20000&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>

<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app1&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app2&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Avant d'exécuter la pile de l'intégration <a href="../integrations/#docker-autoconf">Docker autoconf</a> sur votre machine, vous devrez modifier les ports :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.6.5-rc1</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080&quot;</span><span class="w"> </span><span class="c1"># Keep it if you want to use Let&#39;s Encrypt automation when using http challenge type</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;10000:10000&quot;</span><span class="w"> </span><span class="c1"># app1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;20000:20000&quot;</span><span class="w"> </span><span class="c1"># app2</span>
<span class="nn">...</span>
</code></pre></div>
<p>Une fois la pile en cours d'exécution, vous pouvez connecter vos applications existantes au réseau <code>bw-services</code> et configurer BunkerWeb avec des <code>labels</code> :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app1&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app1.example.com&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_TYPE=stream&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=myapp1:9000&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.LISTEN_STREAM_PORT=10000&quot;</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app2&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app2.example.com&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_TYPE=stream&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=myapp2:9000&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.LISTEN_STREAM_PORT=20000&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition example">
<p class="admonition-title">Fonctionnalité expérimentale</p>
<p>Actuellement, les <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingresses</a> ne prennent pas en charge le mode <code>stream</code>. <strong>Ce que nous proposons ici est une solution de contournement pour le faire fonctionner.</strong></p>
<p>N'hésitez pas à le tester et à nous signaler tout bug en ouvrant une issue via <a href="https://github.com/bunkerity/bunkerweb/issues">issues</a> du dépôt GitHub.</p>
</div>
<p>Avant d'exécuter la pile de l'<a href="../integrations/#kubernetes">intégration Kubernetes</a> sur votre machine, vous devrez ouvrir les ports sur votre équilibreur de charge :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"> </span><span class="c1"># Keep it if you want to use Let&#39;s Encrypt automation when using http challenge type</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20000</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20000</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
</code></pre></div>
<p>Une fois la pile en cours d'exécution, vous pouvez créer vos ressources Ingress :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">services</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb.io/SERVER_TYPE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;stream&quot;</span><span class="w"> </span><span class="c1"># Will be applied to all services</span>
<span class="w">    </span><span class="nt">bunkerweb.io/app1.example.com_LISTEN_STREAM_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10000&quot;</span>
<span class="w">    </span><span class="nt">bunkerweb.io/app2.example.com_LISTEN_STREAM_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;20000&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1.example.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"> </span><span class="c1"># This isn&#39;t used in stream mode but is required</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app1</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2.example.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"> </span><span class="c1"># This isn&#39;t used in stream mode but is required</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app2</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">services</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">          </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app1&quot;</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app1</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">services</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">services</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">          </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app2&quot;</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app2</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">services</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Vous devrez ajouter ces paramètres au fichier /etc/bunkerweb/variables.env :</p>
<div class="highlight"><pre><span></span><code>...
SERVER_NAME=app1.example.com app2.example.com
MULTISITE=yes
USE_REVERSE_PROXY=yes
SERVER_TYPE=stream
app1.example.com_REVERSE_PROXY_HOST=myapp1.domain.or.ip:9000
app1.example.com_LISTEN_STREAM_PORT=10000
app2.example.com_REVERSE_PROXY_HOST=myapp2.domain.or.ip:9000
app2.example.com_LISTEN_STREAM_PORT=20000
...
</code></pre></div>
<p>Vérifions maintenant l'état du Scheduler :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
<p>S'ils sont déjà en cours d'exécution, nous pouvons le recharger :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>reload<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
<p>Sinon, nous devrons le démarrer :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Obsolète</p>
<p>L'intégration Swarm est obsolète et sera supprimée dans une future version. Veuillez envisager d'utiliser l'<a href="../integrations/#kubernetes">intégration Kubernetes</a> à la place.</p>
<p><strong>Plus d'informations sont disponibles dans la <a href="../integrations/#swarm">documentation de l'intégration Swarm</a>.</strong></p>
</div>
<p>Avant d'exécuter la pile de l'intégration <a href="../integrations/#swarm">Swarm</a> sur votre machine, vous devrez modifier les ports :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.6.5-rc1</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Keep it if you want to use Let&#39;s Encrypt automation when using http challenge type</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="c1"># app1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="c1"># app2</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20000</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20000</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="nn">...</span>
</code></pre></div>
<p>Une fois la pile en cours d'exécution, vous pouvez connecter vos applications existantes au réseau <code>bw-services</code> et configurer BunkerWeb à l'aide d'étiquettes :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>

<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app1&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app1.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_TYPE=stream&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=myapp1:9000&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.LISTEN_STREAM_PORT=10000&quot;</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app2&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app2.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_TYPE=stream&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=myapp2:9000&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.LISTEN_STREAM_PORT=20000&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="le-php">Le PHP</h3>
<div class="admonition example">
<p class="admonition-title">Fonctionnalité expérimentale</p>
<p>Pour le moment, le support PHP avec BunkerWeb est encore en version bêta et nous vous recommandons d'utiliser une architecture de proxy inverse si vous le pouvez. D'ailleurs, PHP n'est pas du tout pris en charge pour certaines intégrations comme Kubernetes.</p>
</div>
<p>BunkerWeb prend en charge PHP en utilisant des  instances <a href="https://www.php.net/manual/en/install.fpm.php">PHP-FPM externes ou </a> distantes. Nous supposerons que vous êtes déjà familiarisé avec la gestion de ce type de services.</p>
<p>Les paramètres suivants peuvent être utilisés :</p>
<ul>
<li><code>REMOTE_PHP</code> : Nom d'hôte de l'instance PHP-FPM distante.</li>
<li><code>REMOTE_PHP_PATH</code> : Dossier racine contenant les fichiers dans l'instance PHP-FPM distante.</li>
<li><code>REMOTE_PHP_PORT</code> : Port de l'instance PHP-FPM distante (<em>9000 par défaut</em>).</li>
<li><code>LOCAL_PHP</code> : Chemin d'accès au fichier socket local de l'instance PHP-FPM.</li>
<li><code>LOCAL_PHP_PATH</code> : Dossier racine contenant les fichiers dans l'instance locale PHP-FPM.</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="10:6"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><input id="__tabbed_10_3" name="__tabbed_10" type="radio" /><input id="__tabbed_10_4" name="__tabbed_10" type="radio" /><input id="__tabbed_10_5" name="__tabbed_10" type="radio" /><input id="__tabbed_10_6" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">Tout-en-un</label><label for="__tabbed_10_2">Docker</label><label for="__tabbed_10_3">Docker autoconf</label><label for="__tabbed_10_4">Kubernetes</label><label for="__tabbed_10_5">Linux</label><label for="__tabbed_10_6">Swarm</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Lorsque vous utilisez l'image <a href="../integrations/#all-in-one-aio-image">Tout-en-un</a>, pour prendre en charge les applications PHP, vous devrez :</p>
<ul>
<li>Montez vos fichiers PHP dans le <code>/var/www/html</code> dossier de BunkerWeb.</li>
<li>Configurez un conteneur PHP-FPM pour votre application et montez le dossier contenant les fichiers PHP.</li>
<li>Utilisez les paramètres spécifiques <code>REMOTE_PHP</code> et <code>REMOTE_PHP_PATH</code> comme variables d'environnement lors de l'exécution de BunkerWeb.</li>
</ul>
<p>Si vous activez le <a href="../concepts/#multisite-mode">mode multisite</a>, vous devrez créer des répertoires distincts pour chacune de vos applications. Chaque sous-répertoire doit être nommé à l'aide de la première valeur de <code>SERVER_NAME</code>. Voici un exemple fictif :</p>
<div class="highlight"><pre><span></span><code>www
├── app1.example.com
│   └── index.php
└── app2.example.com
    └── index.php

2 directories, 2 files
</code></pre></div>
<p>Nous supposerons que vos applications PHP se trouvent dans un dossier nommé <code>www</code>. Veuillez noter que vous devrez corriger les permissions pour que BunkerWeb (UID/GID 101) puisse au moins lire les fichiers et lister les dossiers et PHP-FPM (UID/GID 33 si vous utilisez l' <code>php:fpm</code> image) soit le propriétaire des fichiers et dossiers :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">33</span>:101<span class="w"> </span>./www<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>./www<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0640</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>./www<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div>
<p>Vous pouvez maintenant exécuter BunkerWeb, le configurer pour votre application PHP et également exécuter les applications PHP. Vous devrez créer un réseau Docker personnalisé pour permettre à BunkerWeb de communiquer avec vos conteneurs PHP-FPM.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create a custom network</span>
docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>php-network

<span class="c1"># Run PHP-FPM containers</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>myapp1-php<span class="w"> </span>--network<span class="w"> </span>php-network<span class="w"> </span>-v<span class="w"> </span>./www/app1.example.com:/app<span class="w"> </span>php:fpm
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>myapp2-php<span class="w"> </span>--network<span class="w"> </span>php-network<span class="w"> </span>-v<span class="w"> </span>./www/app2.example.com:/app<span class="w"> </span>php:fpm

<span class="c1"># Run BunkerWeb All-in-one</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>bunkerweb-aio<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--network<span class="w"> </span>php-network<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>./www:/var/www/html<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>bw-storage:/data<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">SERVER_NAME</span><span class="o">=</span><span class="s2">&quot;app1.example.com app2.example.com&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">MULTISITE</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">REMOTE_PHP_PATH</span><span class="o">=</span><span class="s2">&quot;/app&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span>app1.example.com_REMOTE_PHP<span class="o">=</span><span class="s2">&quot;myapp1-php&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span>app2.example.com_REMOTE_PHP<span class="o">=</span><span class="s2">&quot;myapp2-php&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">80</span>:8080/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">443</span>:8443/tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">443</span>:8443/udp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>bunkerity/bunkerweb-all-in-one:1.6.5-rc1
</code></pre></div>
<p>Veuillez noter que si votre conteneur est déjà créé, vous devrez le supprimer et le recréer pour que les nouvelles variables d'environnement soient appliquées.</p>
</div>
<div class="tabbed-block">
<p>Lors de l'utilisation de l'intégration <a href="../integrations/#docker">Docker</a>, pour prendre en charge les applications PHP, vous devrez :</p>
<ul>
<li>Montez vos fichiers PHP dans le <code>/var/www/html</code> dossier de BunkerWeb</li>
<li>Configurez un conteneur PHP-FPM pour votre application et montez le dossier contenant les fichiers PHP</li>
<li>Utilisez les paramètres spécifiques <code>REMOTE_PHP</code> et <code>REMOTE_PHP_PATH</code> comme variables d'environnement lors du démarrage de BunkerWeb</li>
</ul>
<p>Si vous activez le <a href="../concepts/#multisite-mode">mode multisite</a>, vous devrez créer des répertoires distincts pour chacune de vos applications. Chaque sous-répertoire doit être nommé à l'aide de la première valeur de <code>SERVER_NAME</code>. Voici un exemple fictif :</p>
<div class="highlight"><pre><span></span><code>www
├── app1.example.com
│   └── index.php
├── app2.example.com
│   └── index.php
└── app3.example.com
    └── index.php

3 directories, 3 files
</code></pre></div>
<p>Nous supposerons que vos applications PHP se trouvent dans un dossier nommé <code>www</code>. Veuillez noter que vous devrez corriger les permissions pour que BunkerWeb (UID/GID 101) puisse au moins lire les fichiers et lister les dossiers et PHP-FPM (UID/GID 33 si vous utilisez l' <code>php:fpm</code> image) soit le propriétaire des fichiers et dossiers :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">33</span>:101<span class="w"> </span>./www<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>./www<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0640</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>./www<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div>
<p>Vous pouvez maintenant exécuter BunkerWeb, le configurer pour votre application PHP et également exécuter les applications PHP :</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-bw-api-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-api-env</span>
<span class="w">  </span><span class="c1"># We use an anchor to avoid repeating the same settings for all services</span>
<span class="w">  </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.6.5-rc1</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/udp&quot;</span><span class="w"> </span><span class="c1"># QUIC</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www:/var/www/html</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.6.5-rc1</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span><span class="w"> </span><span class="c1"># This setting is mandatory to specify the BunkerWeb instance</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;app1.example.com</span><span class="nv"> </span><span class="s">app2.example.com&quot;</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">REMOTE_PHP_PATH</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/app&quot;</span><span class="w"> </span><span class="c1"># Will be applied to all services thanks to the MULTISITE setting</span>
<span class="w">      </span><span class="nt">app1.example.com_REMOTE_PHP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;myapp1&quot;</span>
<span class="w">      </span><span class="nt">app2.example.com_REMOTE_PHP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;myapp2&quot;</span>
<span class="w">      </span><span class="nt">app3.example.com_REMOTE_PHP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;myapp3&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>

<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app1.example.com:/app</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app2.example.com:/app</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">myapp3</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app3.example.com:/app</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition info">
<p class="admonition-title">Mode multisite activé</p>
<p>L'intégration <a href="../integrations/#docker-autoconf">Docker autoconf</a> implique l'utilisation du mode multisite : protéger une application PHP équivaut à protéger plusieurs.</p>
</div>
<p>Lors de l'utilisation de l'intégration <a href="../integrations/#docker-autoconf">Docker autoconf</a>, pour prendre en charge les applications PHP, vous devrez :</p>
<ul>
<li>Montez vos fichiers PHP dans le <code>/var/www/html</code> dossier de BunkerWeb</li>
<li>Configurez un conteneur PHP-FPM pour vos applications et montez le dossier contenant les applications PHP</li>
<li>Utilisez les paramètres spécifiques <code>REMOTE_PHP</code> et <code>REMOTE_PHP_PATH</code> comme étiquettes pour votre conteneur PHP-FPM</li>
</ul>
<p>Comme l'autoconf de Docker implique d'utiliser le <a href="../concepts/#multisite-mode">mode multisite</a>, vous devrez créer des répertoires distincts pour chacune de vos applications. Chaque sous-répertoire doit être nommé à l'aide de la première valeur de <code>SERVER_NAME</code>. Voici un exemple fictif :</p>
<div class="highlight"><pre><span></span><code>www
├── app1.example.com
│   └── index.php
├── app2.example.com
│   └── index.php
└── app3.example.com
    └── index.php

3 directories, 3 files
</code></pre></div>
<p>Une fois les dossiers créés, copiez vos fichiers et corrigez les permissions afin que BunkerWeb (UID/GID 101) puisse au moins lire les fichiers et lister les dossiers et PHP-FPM (UID/GID 33 si vous utilisez l' <code>php:fpm</code> image) soit le propriétaire des fichiers et dossiers :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">33</span>:101<span class="w"> </span>./www<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>./www<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0640</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>./www<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div>
<p>Lorsque vous démarrez la pile autoconf de BunkerWeb, montez le <code>www</code> dossier dans <code>/var/www/html</code> le  conteneur <strong>Scheduler</strong> :</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-bw-api-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-api-env</span>
<span class="w">  </span><span class="c1"># We use an anchor to avoid repeating the same settings for all services</span>
<span class="w">  </span><span class="nt">AUTOCONF_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">  </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.6.5-rc1</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE=yes&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www:/var/www/html</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.6.5-rc1</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1"># We don&#39;t need to specify the BunkerWeb instance here as they are automatically detected by the autoconf service</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1"># The server name will be filled with services labels</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="c1"># Mandatory setting for autoconf</span>
<span class="w">      </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:1.6.5-rc1</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">AUTOCONF_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="nt">DOCKER_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tcp://bw-docker:2375&quot;</span><span class="w"> </span><span class="c1"># The Docker socket</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy:nightly</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">CONTAINERS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warning&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="c1"># We set the max allowed packet size to avoid issues with large queries</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--max-allowed-packet=67108864</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
</code></pre></div>
<p>Vous pouvez maintenant créer vos conteneurs PHP-FPM, monter les bons sous-dossiers et utiliser des libellés pour configurer BunkerWeb :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app1.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp1</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app1.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp1&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app2.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp2</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app2.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp2&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="w">  </span><span class="nt">myapp3</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app3.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp3</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app3.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp3&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">PHP n'est pas pris en charge pour Kubernetes</p>
</div>
<p>L'intégration Kubernetes permet la configuration via <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a> et le contrôleur BunkerWeb ne prend actuellement en charge que les applications HTTP.</p>
</div>
<div class="tabbed-block">
<p>Nous supposerons que vous avez déjà la pile d'intégration <a href="../integrations/#linux">Linux integration</a> en cours d'exécution sur votre machine.</p>
<p>Par défaut, BunkerWeb recherchera les fichiers web dans le dossier /var/www/html. Vous pouvez l'utiliser pour stocker vos applications PHP. Veuillez noter que vous devrez configurer votre service PHP-FPM pour définir l'utilisateur/groupe des processus en cours et le fichier de socket UNIX utilisé pour communiquer avec BunkerWeb.</p>
<p>Tout d'abord, assurez-vous que votre instance PHP-FPM peut accéder aux fichiers situés dans /var/www/html et que BunkerWeb peut accéder au fichier de socket UNIX afin de communiquer avec PHP-FPM. Il est recommandé d'utiliser un utilisateur distinct tel que www-data pour le service PHP-FPM et d'autoriser le groupe nginx à accéder au fichier de socket UNIX. Voici la configuration PHP-FPM correspondante :</p>
<div class="highlight"><pre><span></span><code><span class="na">...</span>
<span class="k">[www]</span>
<span class="na">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">www-data</span>
<span class="na">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">www-data</span>
<span class="na">listen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/run/php/php-fpm.sock</span>
<span class="na">listen.owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">www-data</span>
<span class="na">listen.group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">nginx</span>
<span class="na">listen.mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0660</span>
<span class="na">...</span>
</code></pre></div>
<p>N'oubliez pas de redémarrer votre service PHP-FPM :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>php-fpm
</code></pre></div>
<p>Si vous activez le <a href="../concepts/#multisite-mode">mode multisite</a>, vous devrez créer des répertoires distincts pour chacune de vos applications. Chaque sous-répertoire doit être nommé en utilisant la première valeur de <code>SERVER_NAME</code>. Voici un exemple fictif :</p>
<div class="highlight"><pre><span></span><code>/var/www/html
├── app1.example.com
│   └── index.php
├── app2.example.com
│   └── index.php
└── app3.example.com
    └── index.php

3 directories, 3 files
</code></pre></div>
<p>Veuillez noter que vous devrez corriger les permissions afin que BunkerWeb (groupe <code>nginx</code>) puisse au moins lire les fichiers et lister les dossiers, et que PHP-FPM (utilisateur <code>www-data</code>, qui peut varier selon votre système) soit le propriétaire des fichiers et dossiers :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>www-data:nginx<span class="w"> </span>/var/www/html<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>/var/www/html<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0640</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>/var/www/html<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div>
<p>Vous pouvez maintenant éditer le fichier <code>/etc/bunkerweb/variable.env</code> :</p>
<div class="highlight"><pre><span></span><code>HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=9.9.9.9 8.8.8.8 8.8.4.4
API_LISTEN_IP=127.0.0.1
MULTISITE=yes
SERVER_NAME=app1.example.com app2.example.com app3.example.com
app1.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app1.example.com_LOCAL_PHP_PATH=/var/www/html/app1.example.com
app2.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app2.example.com_LOCAL_PHP_PATH=/var/www/html/app2.example.com
app3.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app3.example.com_LOCAL_PHP_PATH=/var/www/html/app3.example.com
</code></pre></div>
<p>Vérifions maintenant l'état du Scheduler :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
<p>S'il est déjà en cours d'exécution, nous pouvons le recharger :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>reload<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
<p>Sinon, nous devrons le démarrer :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Obsolète</p>
<p>L'intégration Swarm est obsolète et sera supprimée dans une future version. Veuillez envisager d'utiliser l'<a href="../integrations/#kubernetes">intégration Kubernetes</a> à la place.</p>
<p><strong>Plus d'informations sont disponibles dans la <a href="../integrations/#swarm">documentation de l'intégration Swarm</a>.</strong></p>
</div>
<div class="admonition info">
<p class="admonition-title">Mode multisite activé</p>
<p>L'intégration <a href="../integrations/#docker-autoconf">Swarm</a> implique l'utilisation du mode multisite : protéger une application PHP équivaut à protéger plusieurs applications.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Volume partagé</p>
<p>L'utilisation de PHP avec l'intégration Docker Swarm nécessite un volume partagé entre toutes les instances BunkerWeb et PHP-FPM, ce qui n'est pas couvert dans cette documentation.</p>
</div>
<p>Lors de l'utilisation de l'intégration <a href="../integrations/#swarm">Swarm</a>, pour prendre en charge les applications PHP, vous devrez :</p>
<ul>
<li>Montez vos fichiers PHP dans le <code>/var/www/html</code> dossier de BunkerWeb</li>
<li>Configurez un conteneur PHP-FPM pour vos applications et montez le dossier contenant les applications PHP</li>
<li>Utilisez les paramètres spécifiques <code>REMOTE_PHP</code> et <code>REMOTE_PHP_PATH</code> comme étiquettes pour votre conteneur PHP-FPM</li>
</ul>
<p>Étant donné que l'intégration de Swarm implique l'utilisation du <a href="../concepts/#multisite-mode">mode multisite</a>, vous devrez créer des répertoires distincts pour chacune de vos applications. Chaque sous-répertoire doit être nommé à l'aide de la première valeur de <code>SERVER_NAME</code>. Voici un exemple fictif :</p>
<div class="highlight"><pre><span></span><code>www
├── app1.example.com
│   └── index.php
├── app2.example.com
│   └── index.php
└── app3.example.com
    └── index.php

3 directories, 3 files
</code></pre></div>
<p>À titre d'exemple, nous considérerons que vous avez un dossier partagé monté sur vos nœuds de travail sur le point de <code>/shared</code> terminaison.</p>
<p>Une fois les dossiers créés, copiez vos fichiers et corrigez les permissions afin que BunkerWeb (UID/GID 101) puisse au moins lire les fichiers et lister les dossiers et PHP-FPM (UID/GID 33 si vous utilisez l' <code>php:fpm</code> image) soit le propriétaire des fichiers et dossiers :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">33</span>:101<span class="w"> </span>/shared/www<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>/shared/www<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0640</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>/shared/www<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div>
<p>Lorsque vous démarrez la pile BunkerWeb, montez le dossier /shared/www sur /var/www/html dans le conteneur <strong>Scheduler</strong> :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:1.6.5-rc1</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/shared/www:/var/www/html</span>
<span class="nn">...</span>
</code></pre></div>
<p>Vous pouvez maintenant créer vos services PHP-FPM, monter les sous-dossiers appropriés et utiliser des labels pour configurer BunkerWeb :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app1.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp1</span>
<span class="w">      </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">          </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app1.example.com&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp1&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app2.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp2</span>
<span class="w">      </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">          </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app2.example.com&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp2&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="w">  </span><span class="nt">myapp3</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app3.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp3</span>
<span class="w">      </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">          </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app3.example.com&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp3&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="ipv6">IPv6</h3>
<div class="admonition example">
<p class="admonition-title">Fonctionnalité expérimentale</p>
<p>Cette fonctionnalité n'est pas prête pour la production. N'hésitez pas à la tester et à nous signaler tout bug via les <a href="https://github.com/bunkerity/bunkerweb/issues">issues</a> du dépôt GitHub.</p>
</div>
<p>Par défaut, BunkerWeb n'écoutera que les adresses IPv4 et n'utilisera pas IPv6 pour les communications réseau. Si vous souhaitez activer la prise en charge d'IPv6, vous devez définir <code>USE_IPV6=yes</code>. Veuillez noter que la configuration IPv6 de votre réseau et de votre environnement n'entre pas dans le champ d'application de cette documentation.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:2"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><input id="__tabbed_11_2" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">Docker / Autoconf / Swarm</label><label for="__tabbed_11_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Tout d'abord, vous devrez configurer le démon Docker pour activer la prise en charge d'IPv6 pour les conteneurs et utiliser ip6tables si nécessaire. Voici une configuration d'exemple pour votre fichier /etc/docker/daemon.json :</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;experimental&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;ipv6&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;ip6tables&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;fixed-cidr-v6&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fd00:dead:beef::/48&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>Vous pouvez maintenant redémarrer le service Docker pour appliquer les modifications :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>docker
</code></pre></div>
<p>Une fois Docker configuré pour prendre en charge IPv6, vous pouvez ajouter le paramètre <code>USE_IPV6</code> et configurer le réseau bw-services pour IPv6 :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:1.6.5-rc1</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">USE_IPv6</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>

<span class="nn">...</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">enable_ipv6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fd00:13:37::/48</span>
<span class="w">          </span><span class="nt">gateway</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fd00:13:37::1</span>

<span class="nn">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Vous devrez ajouter ces paramètres au fichier /etc/bunkerweb/variables.env :</p>
<div class="highlight"><pre><span></span><code>...
USE_IPV6=yes
...
</code></pre></div>
<p>Vérifions maintenant l'état de BunkerWeb :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb
</code></pre></div>
<p>S'il est déjà en cours d'exécution, nous pouvons le redémarrer :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb
</code></pre></div>
<p>Sinon, nous devrons le démarrer :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
</div>
</div>
<h2 id="reglage-de-la-securite">Réglage de la sécurité</h2>
<p>BunkerWeb offre de nombreuses fonctionnalités de sécurité que vous pouvez configurer avec les <a href="../features/">fonctionnalités</a>. Même si les valeurs par défaut des paramètres assurent une "sécurité par défaut" minimale, nous vous recommandons vivement de les régler. Ce faisant, vous serez en mesure de vous assurer du niveau de sécurité de votre choix, mais aussi de gérer les faux positifs.</p>
<div class="admonition tip">
<p class="admonition-title">Autres fonctionnalités</p>
<p>Cette section se concentre uniquement sur le réglage de la sécurité, voir la section <a href="../features/">fonctionnalités</a> de la documentation pour d'autres paramètres.</p>
</div>
<figure>
<p><img align="center" alt="Vue d'ensemble" src="../../assets/img/core-order.svg" />
  </p>
<figcaption>Vue d'ensemble et ordre des plugins de sécurité de base</figcaption>
</figure>
<h2 id="integration-de-la-console-crowdsec">Intégration de la console CrowdSec</h2>
<p>Si vous n'êtes pas déjà familier avec l'intégration de la console CrowdSec, <a href="https://www.crowdsec.net/?utm_campaign=bunkerweb&amp;utm_source=doc">CrowdSec</a> exploite l'intelligence participative pour lutter contre les cybermenaces. Considérez-le comme le "Waze de la cybersécurité" : lorsqu'un serveur est attaqué, les autres systèmes du monde entier sont alertés et protégés contre les mêmes attaquants. Vous pouvez en savoir plus à ce sujet <a href="https://www.crowdsec.net/about?utm_campaign=bunkerweb&amp;utm_source=blog">ici</a>.</p>
<p><strong>Félicitations, votre instance BunkerWeb est maintenant inscrite dans votre console CrowdSec !</strong></p>
<p>Conseil professionnel : Lorsque vous consultez vos alertes, cliquez sur l'option "colonnes" et cochez la case "contexte" pour accéder aux données spécifiques à BunkerWeb.</p>
<figure>
<p><img align="center" alt="Vue d'ensemble" src="../../assets/img/crowdity4.png" />
  </p>
<figcaption>Données BunkerWeb affichées dans la colonne de contexte</figcaption>
</figure>
<h2 id="surveillance-et-rapports">Surveillance et rapports</h2>
<h4 id="monitoring-pro">Monitoring <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style="transform : translateY(3px);"> (PRO)</h4>
<p>Prise en charge de STREAM <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Le plugin de surveillance vous permet de collecter et de récupérer des métriques sur BunkerWeb. En l'activant, votre ou vos instances commenceront à collecter diverses données liées aux attaques, aux requêtes et aux performances. Vous pouvez ensuite les récupérer en appelant régulièrement le point de terminaison de l' <code>/monitoring</code> API ou en utilisant d'autres plugins comme celui de l'exportateur Prometheus.</p>
<p><strong>Liste des fonctionnalités</strong></p>
<ul>
<li>Permettre la collecte de diverses métriques BunkerWeb</li>
<li>Récupérer des métriques à partir de l'API</li>
<li>Utilisation en combinaison avec d'autres plugins (par exemple Prometheus exporter)</li>
<li>Dédiée à la page d'interface utilisateur pour surveiller vos instances</li>
</ul>
<p><strong>Liste des paramètres</strong></p>
<table>
<thead>
<tr>
<th>Réglage</th>
<th>Défaut</th>
<th>Contexte</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_MONITORING</code></td>
<td><code>yes</code></td>
<td>global</td>
<td>Non</td>
<td>Activez la surveillance de BunkerWeb.</td>
</tr>
<tr>
<td><code>MONITORING_METRICS_DICT_SIZE</code></td>
<td><code>10M</code></td>
<td>global</td>
<td>Non</td>
<td>Taille du dictionnaire pour stocker les métriques de surveillance.</td>
</tr>
</tbody>
</table>
<h4 id="prometheus-exporter-pro">Prometheus exporter <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style="transform : translateY(3px);"> (PRO)</h4>
<p>Prise en charge de STREAM <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Le plugin d'exportation Prometheus ajoute un <a href="https://prometheus.io/docs/instrumenting/exporters/">exportateur Prometheus</a> sur votre ou vos instances BunkerWeb. Lorsqu'elle est activée, vous pouvez configurer votre ou vos instances Prometheus pour récupérer un point de terminaison spécifique sur Bunkerweb et collecter des métriques internes.</p>
<p>Nous fournissons également un <a href="https://grafana.com/grafana/dashboards/20755-bunkerweb/">tableau de bord Grafana</a> que vous pouvez importer dans votre propre instance et connecter à votre propre source de données Prometheus.</p>
<p><strong>Veuillez noter que l'utilisation du plugin d'exportation Prometheus nécessite d'activer le plugin de surveillance (<code>USE_MONITORING=yes</code>)</strong></p>
<p><strong>Liste des fonctionnalités</strong></p>
<ul>
<li>L'exportateur Prometheus fournit des métriques internes à BunkerWeb</li>
<li>Port dédié et configurable, IP et URL d'écoute</li>
<li>Liste blanche IP/réseau pour une sécurité maximale</li>
</ul>
<p><strong>Liste des paramètres</strong></p>
<table>
<thead>
<tr>
<th>Réglage</th>
<th>Ddéfaut</th>
<th>Contexte</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_PROMETHEUS_EXPORTER</code></td>
<td><code>no</code></td>
<td>global</td>
<td>Non</td>
<td>Activez l'exportation Prometheus.</td>
</tr>
<tr>
<td><code>PROMETHEUS_EXPORTER_IP</code></td>
<td><code>0.0.0.0</code></td>
<td>global</td>
<td>Non</td>
<td>IP d'écoute de l'exportateur Prometheus.</td>
</tr>
<tr>
<td><code>PROMETHEUS_EXPORTER_PORT</code></td>
<td><code>9113</code></td>
<td>global</td>
<td>Non</td>
<td>Port d'écoute de l'exportateur Prometheus.</td>
</tr>
<tr>
<td><code>PROMETHEUS_EXPORTER_URL</code></td>
<td><code>/metrics</code></td>
<td>global</td>
<td>Non</td>
<td>URL HTTP de l'exportateur Prometheus.</td>
</tr>
<tr>
<td><code>PROMETHEUS_EXPORTER_ALLOW_IP</code></td>
<td><code>127.0.0.0/8 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16</code></td>
<td>global</td>
<td>Non</td>
<td>Liste des adresses IP/réseaux autorisés à contacter le point de terminaison de l'exportateur Prometheus.</td>
</tr>
</tbody>
</table>
<h4 id="reporting-pro">Reporting <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style="transform : translateY(3px);"> (PRO)</h4>
<p>Prise en charge de STREAM <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<div class="admonition warning">
<p class="admonition-title">Plugin de surveillance nécessaire</p>
<p>Ce plug-in nécessite l'installation et l'activation du plug-in Monitoring Pro avec le <code>USE_MONITORING</code> paramètre défini sur <code>yes</code>.</p>
</div>
<p>Le plugin Reporting fournit une solution complète pour la communication régulière de données importantes de BunkerWeb, y compris les statistiques mondiales, les attaques, les bannissements, les demandes, les raisons et les informations AS. Il offre un large éventail de fonctionnalités, notamment la création automatique de rapports, des options de personnalisation et une intégration transparente avec le plugin monitoring pro. Avec le plugin Reporting, vous pouvez facilement générer et gérer des rapports pour surveiller les performances et la sécurité de votre application.</p>
<p><strong>Liste des fonctionnalités</strong></p>
<ul>
<li>Rapports réguliers sur les données importantes de BunkerWeb, y compris les statistiques mondiales, les attaques, les bannissements, les demandes, les raisons et les informations sur les SA.</li>
<li>Intégration avec le plug-in Monitoring Pro pour une intégration transparente et des capacités de reporting améliorées.</li>
<li>Prise en charge des webhooks (classique, Discord et Slack) pour les notifications en temps réel.</li>
<li>Prise en charge de SMTP pour les notifications par e-mail.</li>
<li>Options de configuration pour plus de personnalisation et de flexibilité.</li>
</ul>
<p><strong>Liste des paramètres</strong></p>
<table>
<thead>
<tr>
<th>Réglage</th>
<th>Faire défaut</th>
<th>Contexte</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_REPORTING_SMTP</code></td>
<td><code>no</code></td>
<td>global</td>
<td>Activez l'envoi du rapport par e-mail.</td>
</tr>
<tr>
<td><code>USE_REPORTING_WEBHOOK</code></td>
<td><code>no</code></td>
<td>global</td>
<td>Activez l'envoi du rapport via le webhook.</td>
</tr>
<tr>
<td><code>REPORTING_SCHEDULE</code></td>
<td><code>weekly</code></td>
<td>global</td>
<td>La fréquence à laquelle les rapports sont envoyés.</td>
</tr>
<tr>
<td><code>REPORTING_WEBHOOK_URLS</code></td>
<td></td>
<td>global</td>
<td>Liste des URL de webhook pour recevoir le rapport en Markdown (séparées par des espaces).</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_EMAILS</code></td>
<td></td>
<td>global</td>
<td>Liste des adresses e-mail pour recevoir le rapport au format HTML (séparées par des espaces).</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_HOST</code></td>
<td></td>
<td>global</td>
<td>Serveur hôte utilisé pour l'envoi SMTP.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_PORT</code></td>
<td><code>465</code></td>
<td>global</td>
<td>Port utilisé pour SMTP. Veuillez noter qu'il existe différentes normes en fonction du type de connexion (SSL = 465, TLS = 587).</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_FROM_EMAIL</code></td>
<td></td>
<td>global</td>
<td>L'adresse e-mail utilisée comme expéditeur. Notez que 2FA doit être désactivé pour cette adresse e-mail.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_FROM_USER</code></td>
<td></td>
<td>global</td>
<td>Valeur d'authentification de l'utilisateur pour l'envoi via l'adresse e-mail de l'expéditeur.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_FROM_PASSWORD</code></td>
<td></td>
<td>global</td>
<td>La valeur d'authentification par mot de passe pour l'envoi via l'adresse e-mail de l'expéditeur.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_SSL</code></td>
<td><code>SSL</code></td>
<td>global</td>
<td>Déterminez s'il faut ou non utiliser une connexion sécurisée pour SMTP.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_SUBJECT</code></td>
<td><code>BunkerWeb Report</code></td>
<td>global</td>
<td>La ligne d'objet de l'e-mail.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Information et comportement</p>
<ul>
<li>cas <code>USE_REPORTING_SMTP</code> est défini sur <code>yes</code>, le paramètre <code>REPORTING_SMTP_EMAILS</code> doit être défini.</li>
<li>cas <code>USE_REPORTING_WEBHOOK</code> est défini sur <code>yes</code>, le paramètre <code>REPORTING_WEBHOOK_URLS</code> doit être défini.</li>
<li>Les valeurs acceptées pour <code>REPORTING_SCHEDULE</code> sont <code>daily</code>, <code>weekly</code> et <code>monthly</code>.</li>
<li>cas aucun <code>REPORTING_SMTP_FROM_USER</code> et <code>REPORTING_SMTP_FROM_PASSWORD</code> ne sont définis, le plugin essaiera d'envoyer l'e-mail sans authentification.</li>
<li>cas <code>REPORTING_SMTP_FROM_USER</code> n'est pas défini mais <code>REPORTING_SMTP_FROM_PASSWORD</code> est défini, le plugin utilisera le <code>REPORTING_SMTP_FROM_EMAIL</code> comme nom d'utilisateur.</li>
<li>En cas d'échec du travail, le plug-in réessaiera d'envoyer le rapport lors de la prochaine exécution.</li>
</ul>
</div>
<h3 id="sauvegarde-et-restauration">Sauvegarde et restauration</h3>
<h4 id="backup-s3-pro">Backup S3 <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style="transform : translateY(3px);"> (PRO)</h4>
<p>Prise en charge STREAM <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>L'outil Backup S3 automatise de manière transparente la protection des données, à l'instar du plug-in de sauvegarde communautaire. Cependant, il se distingue par le stockage sécurisé des sauvegardes directement dans un compartiment S3.</p>
<p>En activant cette fonctionnalité, vous protégez de manière proactive <strong>l'intégrité de vos données</strong>. Le stockage à <strong>distance</strong> des sauvegardes protège les informations cruciales contre les menaces telles que ** les pannes matérielles<strong>, </strong>les cyberattaques<strong> ou </strong>les catastrophes naturelles<strong>. Cela garantit à la fois </strong>la sécurité<strong> et </strong>la disponibilité<strong>, ce qui permet une récupération rapide en cas ** d'événements inattendus</strong>, préservant la <strong>continuité opérationnelle</strong> et garantissant <strong>la tranquillité d'esprit</strong>.</p>
<details class="warning">
<summary>Informations pour les utilisateurs de Red Hat Enterprise Linux (RHEL) 8.9</summary>
<p>Si vous utilisez <strong>RHEL 8.9</strong> et que vous prévoyez d'utiliser une <strong>base de données externe</strong>, vous devez installer le <code>mysql-community-client</code> package pour vous assurer que la <code>mysqldump</code> commande est disponible. Vous pouvez installer le package en exécutant les commandes suivantes :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:2"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><input id="__tabbed_12_2" name="__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="__tabbed_12_1">MySQL/MariaDB</label><label for="__tabbed_12_2">PostgreSQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li><strong>Installez le paquet de configuration du dépôt MySQL</strong></li>
</ol>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>https://dev.mysql.com/get/mysql80-community-release-el8-9.noarch.rpm
</code></pre></div>
<ol>
<li><strong>Activez le dépôt MySQL</strong></li>
</ol>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>config-manager<span class="w"> </span>--enable<span class="w"> </span>mysql80-community
</code></pre></div>
<ol>
<li><strong>Installez le client MySQL</strong></li>
</ol>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>mysql-community-client
</code></pre></div>
</div>
<div class="tabbed-block">
<ol>
<li><strong>Installez le paquet de configuration du dépôt PostgreSQL</strong></li>
</ol>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-</span><span class="k">$(</span>uname<span class="w"> </span>-m<span class="k">)</span><span class="s2">/pgdg-redhat-repo-latest.noarch.rpm&quot;</span>
</code></pre></div>
<ol>
<li><strong>Installez le client PostgreSQL</strong></li>
</ol>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span>postgresql&lt;version&gt;
</code></pre></div>
</div>
</div>
</div>
</details>
<p><strong>Liste des fonctionnalités</strong></p>
<ul>
<li>Sauvegarde automatique des données dans un compartiment S3</li>
<li>Options de planification flexibles : quotidienne, hebdomadaire ou mensuelle</li>
<li>Gestion de la rotation pour contrôler le nombre de sauvegardes à conserver</li>
<li>Niveau de compression personnalisable pour les fichiers de sauvegarde</li>
</ul>
<p><strong>Liste des paramètres</strong></p>
<table>
<thead>
<tr>
<th>Réglage</th>
<th>Faire défaut</th>
<th>Contexte</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BACKUP_S3</code></td>
<td><code>no</code></td>
<td>global</td>
<td>Activer ou désactiver la fonction de sauvegarde S3</td>
</tr>
<tr>
<td><code>BACKUP_S3_SCHEDULE</code></td>
<td><code>daily</code></td>
<td>global</td>
<td>La fréquence de la sauvegarde</td>
</tr>
<tr>
<td><code>BACKUP_S3_ROTATION</code></td>
<td><code>7</code></td>
<td>global</td>
<td>Le nombre de sauvegardes à conserver</td>
</tr>
<tr>
<td><code>BACKUP_S3_ENDPOINT</code></td>
<td></td>
<td>global</td>
<td>Le point de terminaison S3</td>
</tr>
<tr>
<td><code>BACKUP_S3_BUCKET</code></td>
<td></td>
<td>global</td>
<td>Le godet S3</td>
</tr>
<tr>
<td><code>BACKUP_S3_DIR</code></td>
<td></td>
<td>global</td>
<td>L'annuaire S3</td>
</tr>
<tr>
<td><code>BACKUP_S3_REGION</code></td>
<td></td>
<td>global</td>
<td>La région S3</td>
</tr>
<tr>
<td><code>BACKUP_S3_ACCESS_KEY_ID</code></td>
<td></td>
<td>global</td>
<td>L'ID de la clé d'accès S3</td>
</tr>
<tr>
<td><code>BACKUP_S3_ACCESS_KEY_SECRET</code></td>
<td></td>
<td>global</td>
<td>Le secret de la clé d'accès S3</td>
</tr>
<tr>
<td><code>BACKUP_S3_COMP_LEVEL</code></td>
<td><code>6</code></td>
<td>global</td>
<td>Le niveau de compression du fichier zip de sauvegarde</td>
</tr>
</tbody>
</table>
<h5 id="sauvegarde-manuelle">Sauvegarde manuelle</h5>
<p>Pour lancer manuellement une sauvegarde, exécutez la commande suivante :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:2"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><input id="__tabbed_13_2" name="__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="__tabbed_13_1">Linux</label><label for="__tabbed_13_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>save
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>save
</code></pre></div>
</div>
</div>
</div>
<p>Cette commande crée une sauvegarde de votre base de données et la stocke dans le compartiment S3 spécifié dans le <code>BACKUP_S3_BUCKET</code> paramètre.</p>
<p>Vous pouvez également spécifier un compartiment S3 personnalisé pour la sauvegarde en fournissant la variable d' <code>BACKUP_S3_BUCKET</code> environnement lors de l'exécution de la commande :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="14:2"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><input id="__tabbed_14_2" name="__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="__tabbed_14_1">Linux</label><label for="__tabbed_14_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nv">BACKUP_S3_BUCKET</span><span class="o">=</span>your-bucket-name<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>save
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>-e<span class="w"> </span><span class="nv">BACKUP_S3_BUCKET</span><span class="o">=</span>your-bucket-name<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>save
</code></pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Spécifications pour MariaDB/MySQL</p>
<p>Si vous utilisez MariaDB/MySQL, vous pouvez rencontrer l'erreur suivante lors de la sauvegarde de votre base de données :</p>
<div class="highlight"><pre><span></span><code>caching_sha2_password<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>loaded:<span class="w"> </span>Error<span class="w"> </span>loading<span class="w"> </span>shared<span class="w"> </span>library<span class="w"> </span>/usr/lib/mariadb/plugin/caching_sha2_password.so
</code></pre></div>
<p>Pour résoudre ce problème, vous pouvez exécuter la commande suivante pour changer le plugin d'authentification en <code>mysql_native_password</code> :</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;yourusername&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">mysql_native_password</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;youpassword&#39;</span><span class="p">;</span>
</code></pre></div>
<p>Si vous utilisez l'intégration Docker, vous pouvez ajouter la commande suivante au fichier <code>docker-compose.yml</code> pour changer automatiquement le plugin d'authentification :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="15:2"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><input id="__tabbed_15_2" name="__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="__tabbed_15_1">MariaDB</label><label for="__tabbed_15_2">MySQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:&lt;version&gt;</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--default-authentication-plugin=mysql_native_password</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql:&lt;version&gt;</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--default-authentication-plugin=mysql_native_password</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
</div>
</div>
</div>
<h5 id="restauration-manuelle">Restauration manuelle</h5>
<p>Pour lancer manuellement une restauration, exécutez la commande suivante :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="16:2"><input checked="checked" id="__tabbed_16_1" name="__tabbed_16" type="radio" /><input id="__tabbed_16_2" name="__tabbed_16" type="radio" /><div class="tabbed-labels"><label for="__tabbed_16_1">Linux</label><label for="__tabbed_16_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>restore
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>restore
</code></pre></div>
</div>
</div>
</div>
<p>Cette commande crée une sauvegarde temporaire de votre base de données dans le compartiment S3 spécifié dans le <code>BACKUP_S3_BUCKET</code> paramètre et restaure votre base de données à la dernière sauvegarde disponible dans le compartiment.</p>
<p>Vous pouvez également spécifier un fichier de sauvegarde personnalisé pour la restauration en fournissant le chemin d'accès à celui-ci en tant qu'argument lors de l'exécution de la commande :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="17:2"><input checked="checked" id="__tabbed_17_1" name="__tabbed_17" type="radio" /><input id="__tabbed_17_2" name="__tabbed_17" type="radio" /><div class="tabbed-labels"><label for="__tabbed_17_1">Linux</label><label for="__tabbed_17_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>restore<span class="w"> </span>s3_backup_file.zip
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>restore<span class="w"> </span>s3_backup_file.zip
</code></pre></div>
</div>
</div>
</div>
<div class="admonition example">
<p class="admonition-title">En cas de panne</p>
<p>Don't worry if the restore fails, you can always restore your database to the previous state by executing the command again as a backup is created before the restore:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="18:2"><input checked="checked" id="__tabbed_18_1" name="__tabbed_18" type="radio" /><input id="__tabbed_18_2" name="__tabbed_18" type="radio" /><div class="tabbed-labels"><label for="__tabbed_18_1">Linux</label><label for="__tabbed_18_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>restore
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>restore
</code></pre></div>
</div>
</div>
</div>
</div>
<h3 id="migration-pro">Migration <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style="transform : translateY(3px);"> (PRO)</h3>
<p>Prise en charge STREAM <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Le plug-in de migration <strong>révolutionne les transferts de</strong> configuration BunkerWeb entre les instances grâce à son <strong>interface Web conviviale</strong>, simplifiant ainsi l'ensemble du parcours de migration. Que vous mettiez à niveau des systèmes, que vous fassiez évoluer une infrastructure ou que vous transformiez d'environnement, cet outil vous permet de transférer sans effort les <strong>paramètres, les préférences et les données</strong> avec une facilité et une confiance inégalées. Dites adieu aux processus manuels fastidieux et bonjour à une expérience de <strong>migration transparente et sans tracas</strong>.</p>
<p><strong>Liste des fonctionnalités</strong></p>
<ul>
<li>
<p><strong>Migration sans effort :</strong> Transférez facilement les configurations BunkerWeb entre les instances sans les complexités des procédures manuelles.</p>
</li>
<li>
<p><strong>Interface Web intuitive :</strong> Naviguez sans effort dans le processus de migration grâce à une interface Web conviviale conçue pour un fonctionnement intuitif.</p>
</li>
<li>
<p><strong>Compatibilité entre bases de données :</strong> profitez d'une migration transparente sur diverses plates-formes de bases de données, notamment SQLite, MySQL, MariaDB et PostgreSQL, garantissant la compatibilité avec votre environnement de base de données préféré.</p>
</li>
</ul>
<h4 id="creer-un-fichier-de-migration">Créer un fichier de migration</h4>
<p>Pour créer manuellement un fichier de migration, exécutez la commande suivante :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="19:2"><input checked="checked" id="__tabbed_19_1" name="__tabbed_19" type="radio" /><input id="__tabbed_19_2" name="__tabbed_19" type="radio" /><div class="tabbed-labels"><label for="__tabbed_19_1">Linux</label><label for="__tabbed_19_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>migration<span class="w"> </span>create<span class="w"> </span>/path/to/migration/file
</code></pre></div>
</div>
<div class="tabbed-block">
<ol>
<li>
<p>Créez un fichier de migration :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>migration<span class="w"> </span>create<span class="w"> </span>/path/to/migration/file
</code></pre></div>
</li>
<li>
<p>Copiez le fichier de migration sur votre ordinateur local :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>cp<span class="w"> </span>&lt;scheduler_container&gt;:/path/to/migration/file<span class="w"> </span>/path/to/migration/file
</code></pre></div>
</li>
</ol>
</div>
</div>
</div>
<p>Cette commande créera une sauvegarde de votre base de données et la stockera dans le répertoire de sauvegarde spécifié dans la commande.</p>
<div class="admonition note">
<p class="admonition-title">Spécifications pour MariaDB/MySQL</p>
<p>Si vous utilisez MariaDB/MySQL, vous pouvez rencontrer l'erreur suivante lors de la sauvegarde de votre base de données :</p>
<div class="highlight"><pre><span></span><code>caching_sha2_password<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>loaded:<span class="w"> </span>Error<span class="w"> </span>loading<span class="w"> </span>shared<span class="w"> </span>library<span class="w"> </span>/usr/lib/mariadb/plugin/caching_sha2_password.so
</code></pre></div>
<p>Pour résoudre ce problème, vous pouvez exécuter la commande suivante pour changer le plugin d'authentification en <code>mysql_native_password</code> :</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;yourusername&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">mysql_native_password</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;youpassword&#39;</span><span class="p">;</span>
</code></pre></div>
<p>Si vous utilisez l'intégration Docker, vous pouvez ajouter la commande suivante au fichier <code>docker-compose.yml</code> pour changer automatiquement le plugin d'authentification :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="20:2"><input checked="checked" id="__tabbed_20_1" name="__tabbed_20" type="radio" /><input id="__tabbed_20_2" name="__tabbed_20" type="radio" /><div class="tabbed-labels"><label for="__tabbed_20_1">MariaDB</label><label for="__tabbed_20_2">MySQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:&lt;version&gt;</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--default-authentication-plugin=mysql_native_password</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql:&lt;version&gt;</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--default-authentication-plugin=mysql_native_password</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
</div>
</div>
</div>
<h4 id="initialiser-une-migration">Initialiser une migration</h4>
<p>Pour initialiser manuellement une migration, exécutez la commande suivante :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="21:3"><input checked="checked" id="__tabbed_21_1" name="__tabbed_21" type="radio" /><input id="__tabbed_21_2" name="__tabbed_21" type="radio" /><input id="__tabbed_21_3" name="__tabbed_21" type="radio" /><div class="tabbed-labels"><label for="__tabbed_21_1">Linux</label><label for="__tabbed_21_2">Docker</label><label for="__tabbed_21_3">Tout-en-un</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>migration<span class="w"> </span>migrate<span class="w"> </span>/path/to/migration/file
</code></pre></div>
</div>
<div class="tabbed-block">
<ol>
<li>
<p>Copiez le fichier de migration dans le conteneur :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>cp<span class="w"> </span>/path/to/migration/file<span class="w"> </span>&lt;scheduler_container&gt;:/path/to/migration/file
</code></pre></div>
</li>
<li>
<p>Initialisez la migration :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>migration<span class="w"> </span>migrate<span class="w"> </span>/path/to/migration/file
</code></pre></div>
</li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>
<p>Copiez le fichier de migration dans le conteneur :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>cp<span class="w"> </span>/path/to/migration/file<span class="w"> </span>bunkerweb-aio:/path/to/migration/file
</code></pre></div>
</li>
<li>
<p>Initialisez la migration :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>bunkerweb-aio<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>migration<span class="w"> </span>migrate<span class="w"> </span>/path/to/migration/file
</code></pre></div>
</li>
</ol>
</div>
</div>
</div>
<p>Cette commande migre de manière transparente vos données BunkerWeb pour qu'elles correspondent précisément à la configuration décrite dans le fichier de migration.</p>
<h2 id="anti-ddos-pro">Anti DDoS <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style="transform : translateY(3px);"> (PRO)</h2>
<p>Prise en charge de STREAM <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Le  plug-in <strong>anti-DDoS</strong> offre une protection avancée contre les attaques par déni de service distribué (DDoS) en surveillant, analysant et filtrant le trafic suspect en temps réel.</p>
<p>En utilisant un mécanisme de <strong>fenêtre glissante</strong>, le plugin maintient un dictionnaire en mémoire des horodatages des requêtes pour détecter les pics de trafic anormaux à partir d'adresses IP individuelles. En fonction du mode de sécurité configuré, il peut soit bloquer les connexions incriminées, soit consigner l'activité suspecte pour un examen plus approfondi.</p>
<h4 id="fonctionnalites">Fonctionnalités</h4>
<ul>
<li><strong>Analyse du trafic en temps réel :</strong> surveille en permanence les demandes entrantes pour détecter les attaques DDoS potentielles.</li>
<li><strong>Mécanisme de fenêtre glissante :</strong> suit l'activité récente des demandes dans une fenêtre de temps configurable.</li>
<li><strong>Seuils configurables :</strong> vous permet de définir le nombre maximum de requêtes suspectes par IP.</li>
<li><strong>Logique de blocage avancée :</strong> évalue à la fois le nombre de requêtes par IP et le nombre d'adresses IP distinctes dépassant le seuil.</li>
<li><strong>Modes de sécurité flexibles :</strong> choisissez entre le blocage immédiat de la connexion ou le mode de détection uniquement (journalisation).</li>
<li><strong>Magasin de données en mémoire optimisé :</strong> Garantit des recherches à grande vitesse et un suivi efficace des métriques.</li>
<li><strong>Entretien ménager automatique :</strong> efface périodiquement les données obsolètes pour maintenir des performances optimales.</li>
</ul>
<h4 id="configuration">Configuration</h4>
<p>Personnalisez le comportement du plug-in à l'aide des paramètres suivants :</p>
<table>
<thead>
<tr>
<th>Réglage</th>
<th>Faire défaut</th>
<th>Contexte</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_ANTIDDOS</code></td>
<td><code>no</code></td>
<td>global</td>
<td>Non</td>
<td>Activez ou désactivez la protection anti-DDoS. Réglez sur <code>"yes"</code> pour activer le plugin.</td>
</tr>
<tr>
<td><code>ANTIDDOS_METRICS_DICT_SIZE</code></td>
<td><code>10M</code></td>
<td>global</td>
<td>Non</td>
<td>Taille de la banque de données en mémoire pour le suivi des métriques DDoS (par exemple, <code>10M</code>, <code>500k</code>).</td>
</tr>
<tr>
<td><code>ANTIDDOS_THRESHOLD</code></td>
<td><code>100</code></td>
<td>global</td>
<td>Non</td>
<td>Nombre maximum de requêtes suspectes autorisées par IP dans la fenêtre de temps définie.</td>
</tr>
<tr>
<td><code>ANTIDDOS_WINDOW_TIME</code></td>
<td><code>10</code></td>
<td>global</td>
<td>Non</td>
<td>Fenêtre de temps en secondes pendant laquelle les demandes suspectes sont comptabilisées.</td>
</tr>
<tr>
<td><code>ANTIDDOS_STATUS_CODES</code></td>
<td><code>429 403 444</code></td>
<td>global</td>
<td>Non</td>
<td>Codes d'état HTTP considérés comme suspects et utilisés pour déclencher des actions anti-DDoS.</td>
</tr>
<tr>
<td><code>ANTIDDOS_DISTINCT_IP</code></td>
<td><code>5</code></td>
<td>global</td>
<td>Non</td>
<td>Nombre minimum d'adresses IP distinctes qui doivent dépasser le seuil avant d'appliquer le mode de blocage.</td>
</tr>
</tbody>
</table>
<h4 id="bonnes-pratiques">Bonnes pratiques</h4>
<ul>
<li><strong>Réglage du seuil :</strong> ajustez <code>ANTIDDOS_THRESHOLD</code> et <code>ANTIDDOS_WINDOW_TIME</code> en fonction de vos modèles de trafic typiques.</li>
<li><strong>Révision du code d'état :</strong> mettez régulièrement à jour <code>ANTIDDOS_STATUS_CODES</code> pour capturer les comportements suspects nouveaux ou en évolution.</li>
<li><strong>Surveillance :</strong> analysez régulièrement les journaux et les métriques pour affiner les paramètres et améliorer la protection globale.</li>
</ul>
<h2 id="gestionnaire-dutilisateurs-pro">Gestionnaire d'utilisateurs <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style="transform : translateY(3px);"> (PRO)</h2>
<p>Le plug-in de gestion des utilisateurs offre une interface robuste pour l'administration des comptes d'utilisateurs au sein de votre système.</p>
<p>Avec ce plugin, les administrateurs peuvent sans effort créer, mettre à jour et désactiver des comptes utilisateurs, gérer les rôles des utilisateurs, basculer l'authentification à deux facteurs (2FA) et afficher des informations détaillées sur les utilisateurs telles que les horodatages de la dernière connexion et les statuts des comptes (actif ou inactif). Conçu dans un souci de sécurité et de facilité d'utilisation, ce plug-in simplifie les tâches de gestion des utilisateurs tout en garantissant la conformité et l'auditabilité.</p>
<h4 id="fonctionnalites_1">Fonctionnalités</h4>
<ul>
<li><strong>Opérations de compte d'utilisateur :</strong> importez au format CSV/XSLX, créez, modifiez et supprimez des comptes d'utilisateur en toute simplicité.</li>
<li><strong>Contrôle d'accès basé sur les rôles :</strong> Attribuez et modifiez les rôles d'utilisateur pour gérer les autorisations et les niveaux d'accès.</li>
<li><strong>Gestion 2FA :</strong> désactivez l'authentification à deux facteurs en fonction des décisions administratives.</li>
<li><strong>Informations complètes sur les utilisateurs :</strong> surveillez les données clés des utilisateurs, notamment les heures de dernière connexion, les dates de création de compte et le statut actif/inactif.</li>
<li><strong>Journalisation des audits :</strong> conservez une piste d'audit pour toutes les actions de gestion des utilisateurs afin d'améliorer la sécurité et la conformité.</li>
</ul>
<figure>
<p><img align="center" alt="Vue d'ensemble" src="../../assets/img/user-manager.png" />
  </p>
<figcaption>Page Gestionnaire d'utilisateurs</figcaption>
</figure>
<figure>
<p><img align="center" alt="Créer un formulaire utilisateur" src="../../assets/img/user-manager-create.png" />
  </p>
<figcaption>Gestionnaire d'utilisateurs - Créer un formulaire d'utilisateur</figcaption>
</figure>
<figure>
<p><img align="center" alt="Page d'activités" src="../../assets/img/user-manager-activities.png" />
  </p>
<figcaption>Gestionnaire d'utilisateurs - Page Activités</figcaption>
</figure>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; <script>document.write(new Date().getFullYear())</script> Bunkerity
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://discord.com/invite/fTf46FmtyD" target="_blank" rel="noopener" title="discord.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/bunkerity" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/bunkerity/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/bunkerity" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "toc.integrate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": {"provider": "mike", "version": "latest"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../assets/extra.js"></script>
      
        <script src="https://chatbot.bunkerweb.io/static/js/chatbot.js"></script>
      
    
  </body>
</html>