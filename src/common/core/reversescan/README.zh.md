反向扫描插件通过扫描客户端端口来检测其是否正在运行代理服务器或其他网络服务，从而有力地防止代理绕过企图。此功能有助于识别和阻止可能试图隐藏其真实身份或来源的客户端带来的潜在威胁，从而增强您网站的安全状况。

**工作原理：**

1.  当客户端连接到您的服务器时，BunkerWeb 会尝试扫描客户端 IP 地址上的特定端口。
2.  该插件会检查客户端上是否有任何常见的代理端口（例如 80、443、8080 等）处于打开状态。
3.  如果检测到打开的端口，表明客户端可能正在运行代理服务器，则连接将被拒绝。
4.  这为防止自动化工具、机器人和试图掩盖其身份的恶意用户增加了一层额外的安全保障。

!!! success "主要优势"

      1. **增强安全性：** 识别可能运行用于恶意目的的代理服务器的客户端。
      2. **代理检测：** 帮助检测并阻止试图隐藏其真实身份的客户端。
      3. **可配置设置：** 根据您的特定安全要求自定义要扫描的端口。
      4. **性能优化：** 智能扫描，具有可配置的超时，以最大限度地减少对合法用户的影响。
      5. **无缝集成：** 与您现有的安全层透明地协同工作。

### 如何使用

请按照以下步骤配置和使用反向扫描功能：

1.  **启用该功能：** 将 `USE_REVERSE_SCAN` 设置为 `yes` 以启用客户端端口扫描。
2.  **配置要扫描的端口：** 自定义 `REVERSE_SCAN_PORTS` 设置以指定应检查哪些客户端端口。
3.  **设置扫描超时：** 调整 `REVERSE_SCAN_TIMEOUT` 以在彻底扫描和性能之间取得平衡。
4.  **监控扫描活动：** 检查日志和 [Web UI](web-ui.md) 以审查扫描结果和潜在的安全事件。

### 配置设置

| 设置                   | 默认值                     | 上下文    | 多选 | 描述                                                    |
| ---------------------- | -------------------------- | --------- | ---- | ------------------------------------------------------- |
| `USE_REVERSE_SCAN`     | `no`                       | multisite | 否   | **启用反向扫描：** 设置为 `yes` 以启用客户端端口扫描。  |
| `REVERSE_SCAN_PORTS`   | `22 80 443 3128 8000 8080` | multisite | 否   | **要扫描的端口：** 要在客户端检查的端口的空格分隔列表。 |
| `REVERSE_SCAN_TIMEOUT` | `500`                      | multisite | 否   | **扫描超时：** 允许扫描端口的最长时间（毫秒）。         |

!!! warning "性能注意事项"
    扫描多个端口会增加客户端连接的延迟。请使用适当的超时值并限制扫描的端口数量以保持良好的性能。

!!! info "常见代理端口"
    默认配置包括代理服务器（80、443、8080、3128）和 SSH（22）使用的常见端口。您可能需要根据您的威胁模型自定义此列表。

### 配置示例

=== "基本配置"

    一个用于启用客户端端口扫描的简单配置：

    ```yaml
    USE_REVERSE_SCAN: "yes"
    REVERSE_SCAN_TIMEOUT: "500"
    REVERSE_SCAN_PORTS: "80 443 8080"
    ```

=== "全面扫描"

    一个更彻底的配置，检查其他端口：

    ```yaml
    USE_REVERSE_SCAN: "yes"
    REVERSE_SCAN_TIMEOUT: "1000"
    REVERSE_SCAN_PORTS: "22 80 443 3128 8080 8000 8888 1080 3333 8081"
    ```

=== "性能优化配置"

    通过检查更少的端口和更低的超时来调整以获得更好性能的配置：

    ```yaml
    USE_REVERSE_SCAN: "yes"
    REVERSE_SCAN_TIMEOUT: "250"
    REVERSE_SCAN_PORTS: "80 443 8080"
    ```

=== "高安全性配置"

    专注于最大安全性并进行扩展扫描的配置：

    ```yaml
    USE_REVERSE_SCAN: "yes"
    REVERSE_SCAN_TIMEOUT: "1500"
    REVERSE_SCAN_PORTS: "22 25 80 443 1080 3128 3333 4444 5555 6588 6666 7777 8000 8080 8081 8800 8888 9999"
    ```
