
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation of BunkerWeb, the open source and next generation WAF.">
      
      
      
        <link rel="canonical" href="https://docs.bunkerweb.io/latest/print_page/">
      
      
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>Print Site - BunkerWeb documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
    <script async
            defer
            data-domain="docs.bunkerweb.io"
            src="https://data.bunkerity.com/js/script.js"></script>

    <script defer>
      window.addEventListener('DOMContentLoaded', (e) => {

        const customHeaders = document.querySelectorAll('[data-custom-header]')
        customHeaders.forEach(header => {
          const getHeaders = document.querySelectorAll(`#${header.getAttribute('id')}`);
          getHeaders.forEach(el => {

            if(!el.hasAttribute('data-custom-header')) el.remove()
        })})
      })
    </script>

    <script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script>

    <script defer>
  // Lazy load images and embed youtube videos
  window.addEventListener("load", () => {
    document.querySelectorAll("[data-src]").forEach((el) => {
      el.setAttribute("src", el.getAttribute("data-src"));
    });
  });
  // Add missing label
  try {
    document
      .querySelector('div.md-search[data-md-component="search"][role="dialog"]')
      .setAttribute("aria-label", "Search in documentation");
  } catch (err) {}
    </script>

    <script defer>
      window.addEventListener('DOMContentLoaded', () => {
        const bannerEl = document.querySelector('aside.md-banner');
        let defaultContent = [{ "content" : '<p>Get the most of BunkerWeb by upgrading to the PRO version. More info and free trial <a style="text-decoration:underline; color :  white;" href="https://panel.bunkerweb.io/?utm_campaign=self&utm_source=doc#pro">here</a>.</p>'},
        { "content" : '<p>Need premium support or tailored consulting around BunkerWeb ? Check out our <a style="text-decoration:underline; color :  white;" href="https://panel.bunkerweb.io/?utm_campaign=self&utm_source=doc#services">professional services</a>.</p>'},
        { "content" : '<p>Be part of the Bunker community by joining the <a style="text-decoration:underline; color: white;" href="https://discord.bunkerweb.io">Discord chat</a> and following us on <a style="text-decoration:underline; color: white;" href="https://www.linkedin.com/company/bunkerity/">LinkedIn</a>.</p>'}
        ]

      function setBannerStyle() {
        const bannerItem = bannerEl.querySelector('.md-banner__inner');
        bannerEl.style.backgroundColor = "#2eac68";
        bannerItem.style.textAlign = "center";
        bannerItem.style.transition = "all 0.5s ease-out";
      }

      function setDefault() {
        const bannerItem = bannerEl.querySelector('.md-banner__inner');
        const clone = bannerItem.cloneNode(true);
        clone.innerHTML = defaultContent[0]["content"];
        bannerEl.replaceChild(clone, bannerItem);
      }

      function startBannerLoop() {
        const switchDelay = 7000;
        let i = 0;

        setInterval(() => {
          // Update or reset index
          if(i + 1 === defaultContent.length) {
            i = 0;
          } else {
            i++;
          }

          // Prepare data with next el with opacity 0 too
          const currItem = bannerEl.querySelector('.md-banner__inner');
          currItem.style.opacity = 0;
          const clone = currItem.cloneNode(true);
          clone.innerHTML = defaultContent[i]["content"];
          setTimeout(() => {
            bannerEl.replaceChild(clone, currItem);
            setTimeout(() => {
              const newItem = bannerEl.querySelector('.md-banner__inner');
              newItem.style.opacity = 1;
            }, 20);
          }, 600);

        }, switchDelay);
      }

      function runBanner() {
        startBannerLoop();
        // Try to get dynamic content
        // Else keep static ones
        // fetch("https://www.bunkerweb.io/api/bw-ui-news")
        // .then((res) => {
        //   return res.json();
        // })
        // .then((res) => {
        //   defaultContent = res.data[0].data;
        //   startBannerLoop();
        // })
        // .catch((e) => {
        //   startBannerLoop();
        // });
      }

        setBannerStyle();
        setDefault();
        runBanner()

      })
    </script>

    
      
    
    
      <link rel="stylesheet" href="../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../assets/extra.css">
    
    <script>__md_scope=new URL("/latest",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
    📢 Looking for BunkerWeb PRO version, technical support or tailored services ? Visit the
    <a href="https://panel.bunkerweb.io/?utm_campaign=self&utm_source=doc"
       style="color: #3f6ec6;
              text-decoration: underline">BunkerWeb Panel</a>
    for more information on our enterprise offers.

          </div>
          
        </aside>
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
    You're not viewing the
    documentation of the latest version.
    <a href="..//latest">
        <strong>Click here to view latest.</strong>
    </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("/latest"),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="BunkerWeb documentation" class="md-header__button md-logo" aria-label="BunkerWeb documentation" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BunkerWeb documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Print Site
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/bunkerity/bunkerweb" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Introduction

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../concepts/" class="md-tabs__link">
        
  
    
  
  Concepts

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../integrations/" class="md-tabs__link">
        
  
    
  
  Integrations

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../quickstart-guide/" class="md-tabs__link">
        
  
    
  
  Quickstart guide

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../advanced/" class="md-tabs__link">
        
  
    
  
  Advanced usages

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../settings/" class="md-tabs__link">
        
  
    
  
  Settings

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../web-ui/" class="md-tabs__link">
        
  
    
  
  Web UI

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../upgrading/" class="md-tabs__link">
        
  
    
  
  Upgrading

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../troubleshooting/" class="md-tabs__link">
        
  
    
  
  Troubleshooting

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../plugins/" class="md-tabs__link">
        
  
    
  
  Plugins

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../professional-services/" class="md-tabs__link">
        
  
    
  
  Professional services

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../about/" class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="BunkerWeb documentation" class="md-nav__button md-logo" aria-label="BunkerWeb documentation" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    BunkerWeb documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bunkerity/bunkerweb" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced usages
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Settings
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../web-ui/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web UI
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../upgrading/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plugins
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../professional-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Professional services
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="index"><h1 id="index-introduction">Introduction</h1>
<h2 id="index-overview">Overview</h2>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/intro-overview.svg" width="800" />
  </p>
<figcaption>Make your web services secure by default !</figcaption>
</figure>
<p>BunkerWeb is a next-generation and open-source Web Application Firewall (WAF).</p>
<p>Being a full-featured web server (based on <a href="https://nginx.org/">NGINX</a> under the hood), it will protect your web services to make them "secure by default". BunkerWeb integrates seamlessly into your existing environments (<a href="#integrations-linux">Linux</a>, <a href="#integrations-docker">Docker</a>, <a href="#integrations-swarm">Swarm</a>, <a href="#integrations-kubernetes">Kubernetes</a>, …) and is fully configurable (don't panic, there is an <a href="#web-ui">awesome web UI</a> if you don't like the CLI) to meet your own use-cases . In other words, cybersecurity is no more a hassle.</p>
<p>BunkerWeb contains primary <a href="#advanced-security-tuning">security features</a> as part of the core but can be easily extended with additional ones thanks to a <a href="#plugins">plugin system</a>.</p>
<h2 id="index-why-bunkerweb">Why BunkerWeb ?</h2>
<p align="center">
    <iframe style="display: block;" width="560" height="315" data-src="https://www.youtube-nocookie.com/embed/oybLtyhWJIo" title="BunkerWeb overview" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</p>

<ul>
<li>
<p><strong>Easy integration into existing environments</strong> : Seamlessly integrate BunkerWeb into various environments such as Linux, Docker, Swarm, Kubernetes and more. Enjoy a smooth transition and hassle-free implementation.</p>
</li>
<li>
<p><strong>Highly customizable</strong> : Tailor BunkerWeb to your specific requirements with ease. Enable, disable, and configure features effortlessly, allowing you to customize the security settings according to your unique use case.</p>
</li>
<li>
<p><strong>Secure by default</strong> : BunkerWeb provides out-of-the-box, hassle-free minimal security for your web services. Experience peace of mind and enhanced protection right from the start.</p>
</li>
<li>
<p><strong>Awesome web UI</strong> : Take control of BunkerWeb more efficiently with the exceptional web user interface (UI). Navigate settings and configurations effortlessly through a user-friendly graphical interface, eliminating the need for the command-line interface (CLI).</p>
</li>
<li>
<p><strong>Plugin system</strong> : Extend the capabilities of BunkerWeb to meet your own use cases. Seamlessly integrate additional security measures and customize the functionality of BunkerWeb according to your specific requirements.</p>
</li>
<li>
<p><strong>Free as in "freedom"</strong> : BunkerWeb is licensed under the free <a href="https://www.gnu.org/licenses/agpl-3.0.en.html">AGPLv3 license</a>, embracing the principles of freedom and openness. Enjoy the freedom to use, modify, and distribute the software, backed by a supportive community.</p>
</li>
<li>
<p><strong>Professional services</strong> : Get technical support, tailored consulting and custom development directly from the maintainers of BunkerWeb. Visit the <a href="https://panel.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc#pro">BunkerWeb Panel</a> for more information.</p>
</li>
</ul>
<h2 id="index-security-features">Security features</h2>
<p>Explore the impressive array of security features offered by BunkerWeb. While not exhaustive, here are some notable highlights:</p>
<ul>
<li>
<p><strong>HTTPS</strong> support with transparent <strong>Let's Encrypt</strong> automation : Easily secure your web services with automated Let's Encrypt integration, ensuring encrypted communication between clients and your server.</p>
</li>
<li>
<p><strong>State-of-the-art web security</strong> : Benefit from cutting-edge web security measures, including comprehensive HTTP security headers, prevention of data leaks, and TLS hardening techniques.</p>
</li>
<li>
<p>Integrated <strong>ModSecurity WAF</strong> with the <strong>OWASP Core Rule Set</strong> : Enjoy enhanced protection against web application attacks with the integration of ModSecurity, fortified by the renowned OWASP Core Rule Set.</p>
</li>
<li>
<p><strong>Automatic ban</strong> of strange behaviors based on HTTP status code : BunkerWeb intelligently identifies and blocks suspicious activities by automatically banning behaviors that trigger abnormal HTTP status codes.</p>
</li>
<li>
<p>Apply <strong>connections and requests limit</strong> for clients : Set limits on the number of connections and requests from clients, preventing resource exhaustion and ensuring fair usage of server resources.</p>
</li>
<li>
<p><strong>Block bots</strong> with <strong>challenge-based verification</strong> : Keep malicious bots at bay by challenging them to solve puzzles such as cookies, JavaScript tests, captcha, hCaptcha, reCAPTCHA or Turnstile, effectively blocking unauthorized access.</p>
</li>
<li>
<p><strong>Block known bad IPs</strong> with external blacklists and DNSBL : Utilize external blacklists and DNS-based blackhole lists (DNSBL) to proactively block known malicious IP addresses, bolstering your defense against potential threats.</p>
</li>
<li>
<p><strong>And much more...</strong> : BunkerWeb is packed with a plethora of additional security features that go beyond this list, providing you with comprehensive protection and peace of mind.</p>
</li>
</ul>
<p>To delve deeper into the core security features, we invite you to explore the <a href="#advanced-security-tuning">security tuning</a> section of the documentation. Discover how BunkerWeb empowers you to fine-tune and optimize security measures according to your specific needs.</p>
<h2 id="index-demo">Demo</h2>
<p align="center">
    <iframe style="display: block;" width="560" height="315" data-src="https://www.youtube-nocookie.com/embed/ZhYV-QELzA4" title="Fooling automated tools and scanners" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</p>

<p>A demo website protected with BunkerWeb is available at <a href="https://demo.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc">demo.bunkerweb.io</a>. Feel free to visit it and perform some security tests.</p>
<h2 id="index-web-ui">Web UI</h2>
<p align="center">
    <iframe style="display: block;" width="560" height="315" data-src="https://www.youtube-nocookie.com/embed/tGS3pzquEjY" title="BunkerWeb web UI" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</p>

<p>BunkerWeb offers an optional <a href="#web-ui">user interface</a> to manage your instances and their configurations. An online read-only demo is available at <a href="https://demo-ui.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc">demo-ui.bunkerweb.io</a>, feel free to test it by yourself.</p>
<h2 id="index-bunkerweb-cloud">BunkerWeb Cloud</h2>
<p>Don't want to self-host and manage your own BunkerWeb instance(s) ? You might be interested into BunkerWeb Cloud, our fully managed SaaS offer for BunkerWeb.</p>
<p>Try our <a href="https://panel.bunkerweb.io/order/bunkerweb-cloud/14?utm_source=doc&amp;utm_campaign=self">BunkerWeb Cloud beta offer for free</a> and get access to :</p>
<ul>
<li>Fully managed BunkerWeb instance hosted in our cloud</li>
<li>All BunkerWeb features including PRO ones</li>
<li>Monitoring platform including dashboards and alerts</li>
<li>Technical support to assist you in the configuration</li>
</ul>
<p>You will find more information about BunkerWeb Cloud in the <a href="https://panel.bunkerweb.io/knowledgebase/55/BunkerWeb-Cloud?utm_source=doc&amp;utm_campaign=self">FAQ page</a> of the BunkerWeb panel.</p>
<h2 id="index-pro-version">PRO version</h2>
<p>When using BunkerWeb you have the choice of the version you want to use : open-source or PRO.</p>
<p>Whether it's enhanced security, an enriched user experience, or technical monitoring, the BunkerWeb PRO version will allow you to fully benefit from BunkerWeb and respond to your professional needs.</p>
<p>Be it in the documentation or the user interface, the PRO features are annotated with a crown <img src="../assets/img/pro-icon.svg" alt="crow pro icon" height="32px" width="32px"> to distinguish them from those integrated into the open-source version.</p>
<p>You can upgrade from the open-source version to the PRO one easily and at any time you want. The process is pretty straightforward :</p>
<ul>
<li>Claim your <a href="https://panel.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc">free trial on the BunkerWeb panel</a></li>
<li>Once connected to the client area, copy your PRO license key</li>
<li>Paste your private key into BunkerWeb using the <a href="#web-ui-upgrade-to-pro">web UI</a> or <a href="#settings-pro">specific setting</a></li>
</ul>
<p>Do not hesitate to visit the <a href="https://panel.bunkerweb.io/knowledgebase?utm_campaign=self&amp;utm_source=doc">BunkerWeb panel</a> or <a href="https://panel.bunkerweb.io/contact.php?utm_campaign=self&amp;utm_source=doc">contact us</a> if you have any question regarding the PRO version.</p>
<h2 id="index-professional-services">Professional services</h2>
<p>Get the most of BunkerWeb by getting professional services directly from the maintainers of the project. From technical support to tailored consulting and development, we are here to assist you in the security of your web services.</p>
<p>You will find more information by visiting the <a href="https://panel.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc">BunkerWeb Panel</a>, our dedicated platform for professional services.</p>
<p>Don't hesitate to <a href="https://panel.bunkerweb.io/contact.php?utm_campaign=self&amp;utm_source=doc">contact us</a> if you have any question, we will be more than happy to respond to your needs.</p>
<h2 id="index-ecosystem-community-and-resources">Ecosystem, community and resources</h2>
<p>Official websites, tools and resources about BunkerWeb :</p>
<ul>
<li><a href="https://www.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc"><strong>Website</strong></a> : get more information, news and articles about BunkerWeb</li>
<li><a href="https://panel.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc"><strong>Panel</strong></a> : dedicated platform to order and manage professional services (e.g. technical support) around BunkerWeb</li>
<li><a href="https://docs.bunkerweb.io"><strong>Documentation</strong></a> : technical documentation of the BunkerWeb solution</li>
<li><a href="https://demo.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc"><strong>Demo</strong></a> : demonstration website of BunkerWeb, don't hesitate to attempt attacks to test the robustness of the solution</li>
<li><a href="https://demo-ui.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc"><strong>Web UI</strong></a> : online read-only demo of the web UI of BunkerWeb</li>
<li><a href="https://config.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc"><strong>Configurator</strong></a> : user-friendly tool to help you configure BunkerWeb</li>
<li><a href="https://threatmap.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc"><strong>Threatmap</strong></a> : live cyber attack blocked by BunkerWeb instances all around the world</li>
</ul>
<p>Community and social networks :</p>
<ul>
<li><a href="https://discord.com/invite/fTf46FmtyD"><strong>Discord</strong></a></li>
<li><a href="https://www.linkedin.com/company/bunkerity/"><strong>LinkedIn</strong></a></li>
<li><a href="https://twitter.com/bunkerity"><strong>Twitter</strong></a></li>
<li><a href="https://www.reddit.com/r/BunkerWeb/"><strong>Reddit</strong></a></li>
</ul></section><section class="print-page" id="concepts"><h1 id="concepts-concepts">Concepts</h1>
<h2 id="concepts-architecture">Architecture</h2>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/concepts.svg" width="600" /></p>
</figure>
<p>Within your infrastructure, BunkerWeb acts as a reverse proxy in front of your web services. The typical architecture consists of accessing BunkerWeb from the Internet, which then forwards requests to the appropriate application service on a secure network.</p>
<p>Using BunkerWeb that way (classical reverse proxy architecture) with TLS offloading and centralized security policies enhances performance by reducing encryption overhead on backend servers while ensuring consistent access control, threat mitigation, and compliance enforcement across all services.</p>
<h2 id="concepts-integrations">Integrations</h2>
<p>The first concept is the integration of BunkerWeb into the target environment. We prefer to use the word "integration" instead of "installation" because one of the goals of BunkerWeb is to integrate seamlessly into existing environments.</p>
<p>The following integrations are officially supported :</p>
<ul>
<li><a href="#integrations-docker">Docker</a></li>
<li><a href="#integrations-linux">Linux</a></li>
<li><a href="#integrations-docker-autoconf">Docker autoconf</a></li>
<li><a href="#integrations-kubernetes">Kubernetes</a></li>
<li><a href="#integrations-swarm">Swarm</a></li>
</ul>
<p>If you think that a new integration should be supported, do not hesitate to open a <a href="https://github.com/bunkerity/bunkerweb/issues">new issue</a> on the GitHub repository.</p>
<div class="admonition info">
<p class="admonition-title">Going further</p>
<p>The technical details of all BunkerWeb integrations are available in the <a href="#integrations">integrations section</a> of the documentation.</p>
</div>
<h2 id="concepts-settings">Settings</h2>
<div class="admonition tip">
<p class="admonition-title">PRO settings</p>
<p>Some plugins are reserved for the <strong>PRO version</strong>. <a href="https://panel.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc#pro">Find out more about the pro version here.</a></p>
</div>
<p>Once BunkerWeb is integrated into your environment, you will need to configure it to serve and protect your web applications.</p>
<p>The configuration of BunkerWeb is done by using what we call the "settings" or "variables". Each setting is identified by a name such as <code>AUTO_LETS_ENCRYPT</code> or <code>USE_ANTIBOT</code>. You can assign values to the settings to configure BunkerWeb.</p>
<p>Here is a dummy example of a BunkerWeb configuration :</p>
<div class="highlight"><pre><span></span><code>SERVER_NAME=www.example.com
AUTO_LETS_ENCRYPT=yes
USE_ANTIBOT=captcha
REFERRER_POLICY=no-referrer
USE_MODSECURITY=no
USE_GZIP=yes
USE_BROTLI=no
</code></pre></div>
<p>Please note that if you are using the web User Interface, the setting names are also displayed in addition to a "human-friendly" label :</p>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/settings-ui1.png" width="800" />
  </p>
<figcaption>Settings name in the web UI</figcaption>
</figure>
<p>You can also use the search bar and directly specify a setting name :</p>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/settings-ui2.png" width="600" />
  </p>
<figcaption>Settings search in the web UI</figcaption>
</figure>
<div class="admonition info">
<p class="admonition-title">Going further</p>
<p>The complete list of available settings with descriptions and possible values is available in the <a href="#settings">settings section</a> of the documentation.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Settings generator tool</p>
<p>To help you tune BunkerWeb, we offer an easy-to-use settings generator tool available at <a href="https://config.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc">config.bunkerweb.io</a>.</p>
</div>
<h2 id="concepts-multisite-mode">Multisite mode</h2>
<p>Understanding the multisite mode is essential when utilizing BunkerWeb. As our primary focus is safeguarding web applications, our solution is intricately linked to the concept of "virtual hosts" or "vhosts" (more info <a href="https://en.wikipedia.org/wiki/Virtual_hosting">here</a>). These virtual hosts enable the serving of multiple web applications from a single instance or cluster.</p>
<p>By default, BunkerWeb has the multisite mode disabled. This means that only one web application will be served, and all settings will be applied to it. This setup is ideal when you have a single application to protect, as you don't need to concern yourself with multisite configurations.</p>
<p>However, when the multisite mode is enabled, BunkerWeb becomes capable of serving and protecting multiple web applications. Each web application is identified by a unique server name and has its own set of settings. This mode proves beneficial when you have multiple applications to secure, and you prefer to utilize a single instance (or a cluster) of BunkerWeb.</p>
<p>The activation of the multisite mode is controlled by the <code>MULTISITE</code> setting, which can be set to <code>yes</code> to enable it or <code>no</code> to keep it disabled (which is the default value).</p>
<p>Each setting within BunkerWeb has a specific context that determines where it can be applied. If the context is set to "global," the setting can't be applied per server or site but is instead applied to the entire configuration as a whole. On the other hand, if the context is "multisite," the setting can be applied globally and per server. To define a multisite setting for a specific server, simply add the server name as a prefix to the setting name. For example, <code>app1.example.com_AUTO_LETS_ENCRYPT</code> or <code>app2.example.com_USE_ANTIBOT</code> are examples of setting names with server name prefixes. When a multisite setting is defined globally without a server prefix, all servers inherit that setting. However, individual servers can still override the setting if the same setting is defined with a server name prefix.</p>
<p>Understanding the intricacies of multisite mode and its associated settings allows you to tailor BunkerWeb's behavior to suit your specific requirements, ensuring optimal protection for your web applications.</p>
<p>Here's a dummy example of a multisite BunkerWeb configuration :</p>
<div class="highlight"><pre><span></span><code>MULTISITE=yes
SERVER_NAME=app1.example.com app2.example.com app3.example.com
AUTO_LETS_ENCRYPT=yes
USE_GZIP=yes
USE_BROTLI=yes
app1.example.com_USE_ANTIBOT=javascript
app1.example.com_USE_MODSECURITY=no
app2.example.com_USE_ANTIBOT=cookie
app2.example.com_WHITELIST_COUNTRY=FR
app3.example.com_USE_BAD_BEHAVIOR=no
</code></pre></div>
<p>Please note that multisite mode is implicit when using the web User Interface. You have the option to apply configurations directly to your services or to set a global configuration that will be applied to all your services (you can still apply exceptions directly to specific services) :</p>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/ui-multisite.png" width="600" />
  </p>
<figcaption>Apply a setting to all services from the web UI</figcaption>
</figure>
<div class="admonition info">
<p class="admonition-title">Going further</p>
<p>You will find concrete examples of multisite mode in the <a href="#advanced">advanced usages</a> of the documentation and the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/examples">examples</a> directory of the repository.</p>
</div>
<h2 id="concepts-custom-configurations">Custom configurations</h2>
<p>To address unique challenges and cater to specific use cases, BunkerWeb offers the flexibility of custom configurations. While the provided settings and <a href="#plugins">external plugins</a> cover a wide range of scenarios, there may be situations that require additional customization.</p>
<p>BunkerWeb is built on the renowned NGINX web server, which provides a powerful configuration system. This means you can leverage NGINX's configuration capabilities to meet your specific needs. Custom NGINX configurations can be included in various <a href="https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/#contexts">contexts</a> such as HTTP or server, allowing you to fine-tune the behavior of BunkerWeb according to your requirements. Whether you need to customize global settings or apply configurations to specific server blocks, BunkerWeb empowers you to optimize its behavior to align perfectly with your use case.</p>
<p>Another integral component of BunkerWeb is the ModSecurity Web Application Firewall. With custom configurations, you have the flexibility to address false positives or add custom rules to further enhance the protection provided by ModSecurity. These custom configurations allow you to fine-tune the behavior of the firewall and ensure that it aligns with the specific requirements of your web applications.</p>
<p>By leveraging custom configurations, you unlock a world of possibilities to tailor BunkerWeb's behavior and security measures precisely to your needs. Whether it's adjusting NGINX configurations or fine-tuning ModSecurity, BunkerWeb provides the flexibility to meet your unique challenges effectively.</p>
<p>Managing custom configurations from the web User Interface is done through the <strong>Configs</strong> menu :</p>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/configs-ui.png" width="800" />
  </p>
<figcaption>Manage custom configurations from the web UI</figcaption>
</figure>
<div class="admonition info">
<p class="admonition-title">Going further</p>
<p>You will find concrete examples of custom configurations in the <a href="#advanced-custom-configurations">advanced usages</a> of the documentation and the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/examples">examples</a> directory of the repository.</p>
</div>
<h2 id="concepts-database">Database</h2>
<p>BunkerWeb securely stores its current configuration in a backend database, which contains essential data for smooth operation. The following information is stored in the database:</p>
<ul>
<li>
<p><strong>Settings for all services</strong>: The database holds the defined settings for all the services provided by BunkerWeb. This ensures that your configurations and preferences are preserved and readily accessible.</p>
</li>
<li>
<p><strong>Custom configurations</strong>: Any custom configurations you create are also stored in the backend database. This includes personalized settings and modifications tailored to your specific requirements.</p>
</li>
<li>
<p><strong>BunkerWeb instances</strong>: Information about BunkerWeb instances, including their setup and relevant details, is stored in the database. This allows for easy management and monitoring of multiple instances if applicable.</p>
</li>
<li>
<p><strong>Metadata about job execution</strong>: The database stores metadata related to the execution of various jobs within BunkerWeb. This includes information about scheduled tasks, maintenance processes, and other automated activities.</p>
</li>
<li>
<p><strong>Cached files</strong>: BunkerWeb utilizes caching mechanisms for improved performance. The database holds cached files, ensuring efficient retrieval and delivery of frequently accessed resources.</p>
</li>
</ul>
<p>Under the hood, whenever you edit a setting or add a new configuration, BunkerWeb automatically stores the changes in the database, ensuring data persistence and consistency. BunkerWeb supports multiple backend database options, including SQLite, MariaDB, MySQL, and PostgreSQL.</p>
<p>Configuring the database is straightforward using the <code>DATABASE_URI</code> setting, which follows the specified formats for each supported database:</p>
<ul>
<li><strong>SQLite</strong>: <code>sqlite:///var/lib/bunkerweb/db.sqlite3</code></li>
<li><strong>MariaDB</strong>: <code>mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db</code></li>
<li><strong>MySQL</strong>: <code>mysql+pymysql://bunkerweb:changeme@bw-db:3306/db</code></li>
<li><strong>PostgreSQL</strong>: <code>postgresql://bunkerweb:changeme@bw-db:5432/db</code></li>
</ul>
<p>By specifying the appropriate database URI in the configuration, you can seamlessly integrate BunkerWeb with your preferred database backend, ensuring efficient and reliable storage of your configuration data.</p>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/bunkerweb_db.svg" width="800" />
  </p>
<figcaption>Database Schema</figcaption>
</figure>
<h2 id="concepts-scheduler">Scheduler</h2>
<p>For seamless coordination and automation, BunkerWeb employs a specialized service known as the scheduler. The scheduler plays a vital role in ensuring smooth operation by performing the following tasks:</p>
<ul>
<li>
<p><strong>Storing settings and custom configurations</strong>: The scheduler is responsible for storing all the settings and custom configurations within the backend database. This centralizes the configuration data, making it easily accessible and manageable.</p>
</li>
<li>
<p><strong>Executing various tasks (jobs)</strong>: The scheduler handles the execution of various tasks, referred to as jobs. These jobs encompass a range of activities, such as periodic maintenance, scheduled updates, or any other automated tasks required by BunkerWeb.</p>
</li>
<li>
<p><strong>Generating BunkerWeb configuration</strong>: The scheduler generates a configuration that is readily understood by BunkerWeb. This configuration is derived from the stored settings and custom configurations, ensuring that the entire system operates cohesively.</p>
</li>
<li>
<p><strong>Acting as an intermediary for other services</strong>: The scheduler acts as an intermediary, facilitating communication and coordination between different components of BunkerWeb. It interfaces with services such as the web UI or autoconf, ensuring a seamless flow of information and data exchange.</p>
</li>
</ul>
<p>In essence, the scheduler serves as the brain of BunkerWeb, orchestrating various operations and ensuring the smooth functioning of the system.</p>
<p>Depending on the integration approach, the execution environment of the scheduler may differ. In container-based integrations, the scheduler is executed within its dedicated container, providing isolation and flexibility. On the other hand, for Linux-based integrations, the scheduler is self-contained within the bunkerweb service, simplifying the deployment and management process.</p>
<p>By employing the scheduler, BunkerWeb streamlines the automation and coordination of essential tasks, enabling efficient and reliable operation of the entire system.</p>
<p>If you are using the web User Interface, you can manage scheduler jobs by clicking on <strong>Jobs</strong> from the menu :</p>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/jobs-ui.png" width="800" />
  </p>
<figcaption>Manage jobs from the web UI</figcaption>
</figure>
<p><strong>Instances healthcheck</strong></p>
<p>Since the 1.6.0, the Scheduler possess a built-in healthcheck system, that will check the health of the instances. If an instance becomes unhealthy, the scheduler will stop sending the configuration to it. If the instance becomes healthy again, the scheduler will start sending the configuration to it again.</p>
<p>The healthcheck interval is set by the <code>HEALTHCHECK_INTERVAL</code> environment variable with a default value of <code>30</code> which means that the scheduler will check the health of the instances every 30 seconds.</p>
<h2 id="concepts-templates">Templates</h2>
<p>BunkerWeb leverages the power of templates to simplify the configuration process and enhance flexibility. Templates provide a structured and standardized approach to defining settings and custom configurations, ensuring consistency and ease of use.</p>
<ul>
<li>
<p><strong>Predefined templates</strong>: The community version offers three predefined templates that encapsulate common custom  configurations and settings. These templates serve as a starting point for configuring BunkerWeb, enabling quick setup and deployment. The predefined templates are the following:</p>
<ul>
<li><strong>low</strong>: A basic template that provides essential settings for web application protection.</li>
<li><strong>medium</strong>: A balanced template that offers a mix of security features and performance optimizations.</li>
<li><strong>high</strong>: An advanced template that focuses on robust security measures and comprehensive protection.</li>
</ul>
</li>
<li>
<p><strong>Custom templates</strong>: In addition to predefined templates, BunkerWeb allows users to create custom templates tailored to their specific requirements. Custom templates enable fine-tuning of settings and custom configurations, ensuring that BunkerWeb aligns perfectly with the user's needs.</p>
</li>
</ul>
<p>With the web User Interface, templates are available through <strong>easy mode</strong> when you add or edit a service :</p>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/templates-ui.png" width="800" />
  </p>
<figcaption>Templates usage from the web UI</figcaption>
</figure>
<p><strong>Creating custom templates</strong></p>
<p>Creating a custom template is a straightforward process that involves defining the desired settings, custom configurations and steps in a structured format.</p>
<ul>
<li><strong>Template structure</strong>: A custom template consists of a name, series of settings, custom configurations and optional steps. The template structure is defined in a JSON file that adheres to the specified format. The key components of a custom template include:<ul>
<li><strong>Settings</strong>: A setting is defined with a name and corresponding value. This value will override the default value of the setting. <strong>Only multisite settings are supported.</strong></li>
<li><strong>Configs</strong>: A custom configuration is a path to an NGINX configuration file that will be included as a custom configuration. To know where to place the custom configuration file, refer to the example of a plugin's tree below. <strong>Only multisite configuration types are supported.</strong></li>
<li><strong>Steps</strong>: A step contains a title, subtitle, settings and custom configurations. Each step represents a configuration step that the user can follow to set up BunkerWeb according to the custom template in the web UI.</li>
</ul>
</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Specifications about steps</p>
<p>If steps are declared, <strong>it is not mandatory to include all the settings and custom configurations in the settings and configs sections</strong>. keep in mind that when a setting or a custom configuration is declared in a step, the user will be allowed to make edits to it in the web UI.</p>
</div>
<ul>
<li>
<p><strong>Template file</strong>: The custom template is defined in a json file in a <code>templates</code> folder inside the plugin directory that adheres to the specified structure. The template file contains a name, the settings, custom configurations, and steps required to configure BunkerWeb according to the user's preferences.</p>
</li>
<li>
<p><strong>Selecting a template</strong>: Once the custom template is defined, users can select it during the easy-mode configuration process of a service in the web UI. A template can also be selected with the <code>USE_TEMPLATE</code> setting in the configuration. The name of the template file (without the <code>.json</code> extension) should be specified as the value of the <code>USE_TEMPLATE</code> setting.</p>
</li>
</ul>
<p>Example of a custom template file:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;template name&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// optional</span>
<span class="w">    </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;SETTING_1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;SETTING_2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;value&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="c1">// optional</span>
<span class="w">    </span><span class="nt">&quot;configs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;modsec/false_positives.conf&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;modsec/non_editable.conf&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;modsec-crs/custom_rules.conf&quot;</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="c1">// optional</span>
<span class="w">    </span><span class="nt">&quot;steps&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Title 1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;subtitle&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;subtitle 1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">&quot;SETTING_1&quot;</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;configs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">&quot;modsec-crs/custom_rules.conf&quot;</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Title 2&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;subtitle&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;subtitle 2&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">&quot;SETTING_2&quot;</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;configs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">&quot;modsec/false_positives.conf&quot;</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Example of a plugin's tree including custom templates:
<div class="highlight"><pre><span></span><code>.
├── plugin.json
└── templates
    ├── my_other_template.json
    ├── my_template
    │   └── configs
    │       ├── modsec
    │       │   ├── false_positives.conf
    │       │   └── non_editable.conf
    │       └── modsec-crs
    │           └── custom_rules.conf
    └── my_template.json
</code></pre></div></p></section><section class="print-page" id="integrations"><h1 id="integrations-integrations">Integrations</h1>
<h2 id="integrations-bunkerweb-cloud">BunkerWeb Cloud</h2>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/bunkerweb-cloud.webp" width="600" />
  </p>
<figcaption>BunkerWeb Cloud</figcaption>
</figure>
<div class="admonition example">
<p class="admonition-title">Coming soon</p>
<p>After a successful beta phase, we are working hard on the BunkerWeb Cloud offer to release it to the public.</p>
</div>
<p>BunkerWeb Cloud will be the easiest way to get started with BunkerWeb. It offers you a fully managed BunkerWeb service with no hassle. Think of a like a BunkerWeb-as-a-Service !</p>
<p>If you are interested into the BunkerWeb Cloud offer, don't hesitate to <a href="https://panel.bunkerweb.io/contact.php?utm_campaign=self&amp;utm_source=docs">contact us</a> so we can discuss about your needs.</p>
<h2 id="integrations-docker">Docker</h2>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/integration-docker.svg" width="600" />
  </p>
<figcaption>Docker integration</figcaption>
</figure>
<p>Utilizing BunkerWeb as a <a href="https://www.docker.com/">Docker</a> container offers a convenient and straightforward approach for testing and utilizing the solution, particularly if you are already familiar with Docker technology.</p>
<p>To facilitate your Docker deployment, we provide readily available prebuilt images on <a href="https://hub.docker.com/r/bunkerity/bunkerweb">Docker Hub</a>, supporting multiple architectures. These prebuilt images are optimized and prepared for use on the following architectures:</p>
<ul>
<li>x64 (64-bit)</li>
<li>x86</li>
<li>armv8 (ARM 64-bit)</li>
<li>armv7 (ARM 32-bit)</li>
</ul>
<p>By accessing these prebuilt images from Docker Hub, you can quickly pull and run BunkerWeb within your Docker environment, eliminating the need for extensive configuration or setup processes. This streamlined approach allows you to focus on leveraging the capabilities of BunkerWeb without unnecessary complexities.</p>
<p>Whether you're conducting tests, developing applications, or deploying BunkerWeb in production, the Docker containerization option provides flexibility and ease of use. Embracing this method empowers you to take full advantage of BunkerWeb's features while leveraging the benefits of Docker technology.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>bunkerity/bunkerweb:testing
</code></pre></div>
<p>Docker images are also available on <a href="https://github.com/orgs/bunkerity/packages?repo_name=bunkerweb">GitHub packages</a> and can be downloaded using the <code>ghcr.io</code> repository address :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>ghcr.io/bunkerity/bunkerweb:testing
</code></pre></div>
<p>Docker integration key concepts are :</p>
<ul>
<li><strong>Environment variables</strong> to configure BunkerWeb</li>
<li><strong>Scheduler</strong> container to store configuration and execute jobs</li>
<li><strong>Networks</strong> to expose ports for clients and connect to upstream web services</li>
</ul>
<p>When integrating BunkerWeb with Docker, there are key concepts to keep in mind, ensuring a smooth and efficient deployment:</p>
<ul>
<li>
<p><strong>Environment variables</strong>: BunkerWeb can be easily configured using environment variables. These variables allow you to customize various aspects of BunkerWeb's behavior, such as network settings, security options, and other parameters.</p>
</li>
<li>
<p><strong>Scheduler container</strong>: To effectively manage the configuration and execution of jobs, BunkerWeb utilizes a dedicated container called the <a href="#concepts-scheduler">scheduler</a>.</p>
</li>
<li>
<p><strong>Networks</strong>: Docker networks play a vital role in the integration of BunkerWeb. These networks serve two main purposes: exposing ports to clients and connecting to upstream web services. By exposing ports, BunkerWeb can accept incoming requests from clients, allowing them to access the protected web services. Additionally, by connecting to upstream web services, BunkerWeb can efficiently route and manage the traffic, providing enhanced security and performance.</p>
</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>Please be aware that our instructions assume you are using SQLite as the default database backend, as configured by the <code>DATABASE_URI</code> setting. However, we understand that you may prefer to utilize alternative backends for your Docker integration. If that is the case, rest assured that other database backends are still possible. See docker-compose files in the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/misc/integrations">misc/integrations folder</a> of the repository for more information.</p>
</div>
<h3 id="integrations-environment-variables">Environment variables</h3>
<p>Settings are passed to the Scheduler using Docker environment variables :</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MY_SETTING=value</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ANOTHER_SETTING=another value</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="nn">...</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Full list</p>
<p>For the complete list of environment variables, see the <a href="#settings">settings section</a> of the documentation.</p>
</div>
<h3 id="integrations-scheduler">Scheduler</h3>
<p>The <a href="#concepts-scheduler">scheduler</a> is executed in its own container which is also available on Docker Hub :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>bunkerity/bunkerweb-scheduler:testing
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">BunkerWeb settings</p>
<p>Since the <code>1.6.0</code> version, the Scheduler container is the one who you will define the settings for BunkerWeb. The Scheduler will then push the configuration to the BunkerWeb container.</p>
<p>⚠ <strong>Important</strong> : All API related settings (like <code>API_HTTP_PORT</code>, <code>API_LISTEN_IP</code>, <code>API_SERVER_NAME</code> and <code>API_WHITELIST_IP</code>) <strong>must be defined in the BunkerWeb container as well</strong>. (The settings have to be mirrored in both containers, else the BunkerWeb container will not accept API requests from the Scheduler).</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-bw-api-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-api-env</span>
<span class="w">  </span><span class="c1"># We use an anchor to avoid repeating the same settings for both containers</span>
<span class="w">  </span><span class="nt">API_HTTP_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5000&quot;</span><span class="w"> </span><span class="c1"># Default value</span>
<span class="w">  </span><span class="nt">API_LISTEN_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0.0.0.0&quot;</span><span class="w"> </span><span class="c1"># Default value</span>
<span class="w">  </span><span class="nt">API_SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bwapi&quot;</span><span class="w"> </span><span class="c1"># Default value</span>
<span class="w">  </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/24</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span><span class="w"> </span><span class="c1"># Set this according to your network settings</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># This will set the API settings for the BunkerWeb container</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># This will set the API settings for the Scheduler container</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="nn">...</span>
</code></pre></div>
</div>
<p>A volume is needed to store the SQLite database and the backups that will be used by the scheduler :</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span>
<span class="nn">...</span>
<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Using local folder for persistent data</p>
<p>The scheduler runs as an <strong>unprivileged user with UID 101 and GID 101</strong> inside the container. The reason behind this is security : in case a vulnerability is exploited, the attacker won't have full root (UID/GID 0) privileges.
But there is a downside : if you use a <strong>local folder for the persistent data</strong>, you will need to <strong>set the correct permissions</strong> so the unprivileged user can write data to it. Something like that should do the trick :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chown<span class="w"> </span>root:101<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div>
<p>Alternatively, if the folder already exists :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:101<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div>
<p>If you are using <a href="https://docs.docker.com/engine/security/rootless">Docker in rootless mode</a> or <a href="https://podman.io/">podman</a>, UIDs and GIDs in the container will be mapped to different ones in the host. You will first need to check your initial subuid and subgid :</p>
<div class="highlight"><pre><span></span><code>grep<span class="w"> </span>^<span class="k">$(</span>whoami<span class="k">)</span>:<span class="w"> </span>/etc/subuid<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
grep<span class="w"> </span>^<span class="k">$(</span>whoami<span class="k">)</span>:<span class="w"> </span>/etc/subgid
</code></pre></div>
<p>For example, if you have a value of <strong>100000</strong>, the mapped UID/GID will be <strong>100100</strong> (100000 + 100) :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>chgrp<span class="w"> </span><span class="m">100100</span><span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div>
<p>Or if the folder already exists :</p>
<p><code>shell
sudo chgrp -R 100100 bw-data &amp;&amp; \
chmod -R 770 bw-data</code></p>
</div>
<h3 id="integrations-networks">Networks</h3>
<p>By default, BunkerWeb container is listening (inside the container) on <strong>8080/tcp</strong> for <strong>HTTP</strong>, <strong>8443/tcp</strong> for <strong>HTTPS</strong> and <strong>8443/udp</strong> for <strong>QUIC</strong>.</p>
<div class="admonition warning">
<p class="admonition-title">Privileged ports in rootless mode or when using podman</p>
<p>If you are using <a href="https://docs.docker.com/engine/security/rootless">Docker in rootless mode</a> and want to redirect privileged ports (&lt; 1024) like 80 and 443 to BunkerWeb, please refer to the prerequisites <a href="https://docs.docker.com/engine/security/rootless/#exposing-privileged-ports">here</a>.</p>
<p>If you are using <a href="https://podman.io/">podman</a> you can lower the minimum number for unprivileged ports :
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>sysctl<span class="w"> </span>net.ipv4.ip_unprivileged_port_start<span class="o">=</span><span class="m">1</span>
</code></pre></div></p>
</div>
<p>The typical BunkerWeb stack when using the Docker integration contains the following containers :</p>
<ul>
<li>BunkerWeb</li>
<li>Scheduler</li>
<li>Your services</li>
</ul>
<p>For defense in depth purposes, we strongly recommend to create at least three different Docker networks :</p>
<ul>
<li><code>bw-services</code> : for BunkerWeb and your web services</li>
<li><code>bw-universe</code> : for BunkerWeb and scheduler</li>
</ul>
<p>To secure the communication between the scheduler and BunkerWeb API, <strong>it is important to authorize API calls</strong>. You can use the <code>API_WHITELIST_IP</code> setting to specify allowed IP addresses and subnets.</p>
<p><strong>It is strongly recommended to use a static subnet for the <code>bw-universe</code> network</strong> to enhance security. By implementing these measures, you can ensure that only authorized sources can access the BunkerWeb API, reducing the risk of unauthorized access or malicious activities:</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-bw-api-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-api-env</span>
<span class="w">  </span><span class="c1"># We use an anchor to avoid repeating the same settings for both containers</span>
<span class="w">  </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/24</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/udp&quot;</span><span class="w"> </span><span class="c1"># QUIC</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="nn">...</span>
<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span><span class="w"> </span><span class="c1"># This setting is mandatory to specify the BunkerWeb instance</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="nn">...</span>
<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span><span class="w"> </span><span class="c1"># Static subnet so only authorized sources can access the BunkerWeb API</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
<h3 id="integrations-full-compose-file">Full compose file</h3>
<div class="highlight"><pre><span></span><code><span class="nt">x-bw-api-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-api-env</span>
<span class="w">  </span><span class="c1"># We use an anchor to avoid repeating the same settings for both containers</span>
<span class="w">  </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/24</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/udp&quot;</span><span class="w"> </span><span class="c1"># QUIC</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span><span class="w"> </span><span class="c1"># This setting is mandatory to specify the BunkerWeb instance</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;www.example.com&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span><span class="w"> </span><span class="c1"># Static subnet so only authorized sources can access the BunkerWeb API</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
<h3 id="integrations-build-from-source">Build from source</h3>
<p>Alternatively, if you prefer a more hands-on approach, you have the option to build the Docker image directly from the <a href="https://github.com/bunkerity/bunkerweb">source</a>. Building the image from source gives you greater control and customization over the deployment process. However, please note that this method may take some time to complete, depending on your hardware configuration  (you can take a coffee ☕ if needed).</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb.git<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">cd</span><span class="w"> </span>bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>bw<span class="w"> </span>-f<span class="w"> </span>src/bw/Dockerfile<span class="w"> </span>.<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>bw-scheduler<span class="w"> </span>-f<span class="w"> </span>src/scheduler/Dockerfile<span class="w"> </span>.<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>bw-autoconf<span class="w"> </span>-f<span class="w"> </span>src/autoconf/Dockerfile<span class="w"> </span>.<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>bw-ui<span class="w"> </span>-f<span class="w"> </span>src/ui/Dockerfile<span class="w"> </span>.
</code></pre></div>
<h2 id="integrations-linux">Linux</h2>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/integration-linux.svg" width="600" />
  </p>
<figcaption>Linux integration</figcaption>
</figure>
<p>Supported Linux distributions for BunkerWeb (amd64/x86_64 and arm64/aarch64 architectures) include:</p>
<ul>
<li>Debian 12 "Bookworm"</li>
<li>Ubuntu 22.04 "Jammy"</li>
<li>Ubuntu 24.04 "Noble"</li>
<li>Fedora 40</li>
<li>Fedora 41</li>
<li>Red Hat Enterprise Linux (RHEL) 8.9</li>
<li>Red Hat Enterprise Linux (RHEL) 9.4</li>
</ul>
<h3 id="integrations-installation-using-package-manager">Installation using package manager</h3>
<p>Please ensure that you have <strong>NGINX 1.26.3 installed before installing BunkerWeb</strong>. For all distributions, except Fedora, it is mandatory to use prebuilt packages from the <a href="https://nginx.org/en/linux_packages.html">official NGINX repository</a>. Compiling NGINX from source or using packages from different repositories will not work with the official prebuilt packages of BunkerWeb. However, you have the option to build BunkerWeb from source.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="integrations-__tabbed_1_1" name="integrations-__tabbed_1" type="radio" /><input id="integrations-__tabbed_1_2" name="integrations-__tabbed_1" type="radio" /><input id="integrations-__tabbed_1_3" name="integrations-__tabbed_1" type="radio" /><input id="integrations-__tabbed_1_4" name="integrations-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="integrations-__tabbed_1_1">Debian</label><label for="integrations-__tabbed_1_2">Ubuntu</label><label for="integrations-__tabbed_1_3">Fedora</label><label for="integrations-__tabbed_1_4">RedHat</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>The first step is to add NGINX official repository :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>curl<span class="w"> </span>gnupg2<span class="w"> </span>ca-certificates<span class="w"> </span>lsb-release<span class="w"> </span>debian-archive-keyring<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
curl<span class="w"> </span>https://nginx.org/keys/nginx_signing.key<span class="w"> </span><span class="p">|</span><span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/usr/share/keyrings/nginx-archive-keyring.gpg<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \</span>
<span class="s2">http://nginx.org/packages/debian `lsb_release -cs` nginx&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/nginx.list
</code></pre></div>
<p>You should now be able to install NGINX 1.26.3 :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">nginx</span><span class="o">=</span><span class="m">1</span>.26.3-1~<span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Testing/dev version</p>
<p>If you use the <code>testing</code> or <code>dev</code> version, you will need to add the <code>force-bad-version</code> directive to your <code>/etc/dpkg/dpkg.cfg</code> file before installing BunkerWeb.</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;force-bad-version&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/dpkg/dpkg.cfg
</code></pre></div>
</div>
<div class="admonition example">
<p class="admonition-title">Disable the setup wizard</p>
<p>If you don't want to use the setup wizard of the web UI when BunkerWeb is installed, export the following variable :</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">UI_WIZARD</span><span class="o">=</span>no
</code></pre></div>
</div>
<p>And finally install BunkerWeb testing :</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://repo.bunkerweb.io/install/script.deb.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>-E<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">bunkerweb</span><span class="o">=</span>testing
</code></pre></div>
<p>To prevent upgrading NGINX and/or BunkerWeb packages when executing <code>apt upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-mark<span class="w"> </span>hold<span class="w"> </span>nginx<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The first step is to add NGINX official repository :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>curl<span class="w"> </span>gnupg2<span class="w"> </span>ca-certificates<span class="w"> </span>lsb-release<span class="w"> </span>ubuntu-keyring<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
curl<span class="w"> </span>https://nginx.org/keys/nginx_signing.key<span class="w"> </span><span class="p">|</span><span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/usr/share/keyrings/nginx-archive-keyring.gpg<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \</span>
<span class="s2">http://nginx.org/packages/ubuntu `lsb_release -cs` nginx&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/nginx.list
</code></pre></div>
<p>You should now be able to install NGINX 1.26.3 :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">nginx</span><span class="o">=</span><span class="m">1</span>.26.3-1~<span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Testing/dev version</p>
<p>If you use the <code>testing</code> or <code>dev</code> version, you will need to add the <code>force-bad-version</code> directive to your <code>/etc/dpkg/dpkg.cfg</code> file before installing BunkerWeb.</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;force-bad-version&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/dpkg/dpkg.cfg
</code></pre></div>
</div>
<div class="admonition example">
<p class="admonition-title">Disable the setup wizard</p>
<p>If you don't want to use the setup wizard of the web UI when BunkerWeb is installed, export the following variable :</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">UI_WIZARD</span><span class="o">=</span>no
</code></pre></div>
</div>
<p>And finally install BunkerWeb testing :</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://repo.bunkerweb.io/install/script.deb.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>-E<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">bunkerweb</span><span class="o">=</span>testing
</code></pre></div>
<p>To prevent upgrading NGINX and/or BunkerWeb packages when executing <code>apt upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-mark<span class="w"> </span>hold<span class="w"> </span>nginx<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition info">
<p class="admonition-title">Fedora Update Testing</p>
<p>If you can't find the NGINX version listed in the stable repository, you can enable the <code>updates-testing</code> repository :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="integrations-__tabbed_2_1" name="integrations-__tabbed_2" type="radio" /><input id="integrations-__tabbed_2_2" name="integrations-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="integrations-__tabbed_2_1">Fedora 41</label><label for="integrations-__tabbed_2_2">Fedora 40</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>config-manager<span class="w"> </span>setopt<span class="w"> </span>updates-testing.enabled<span class="o">=</span><span class="m">1</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>config-manager<span class="w"> </span>--set-enabled<span class="w"> </span>updates-testing
</code></pre></div>
</div>
</div>
</div>
</div>
<p>Fedora already provides NGINX 1.26.3 that we support :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>nginx-1.26.3
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Disable the setup wizard</p>
<p>If you don't want to use the setup wizard of the web UI when BunkerWeb is installed, export the following variable :</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">UI_WIZARD</span><span class="o">=</span>no
</code></pre></div>
</div>
<p>And finally install BunkerWeb testing :</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://repo.bunkerweb.io/install/script.rpm.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>makecache<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>-E<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>bunkerweb-testing
</code></pre></div>
<p>To prevent upgrading NGINX and/or BunkerWeb packages when executing <code>dnf upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>nginx<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The first step is to add NGINX official repository. Create the following file at <code>/etc/yum.repos.d/nginx.repo</code> :</p>
<div class="highlight"><pre><span></span><code>[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true

[nginx-mainline]
name=nginx mainline repo
baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/
gpgcheck=1
enabled=0
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
</code></pre></div>
<p>You should now be able to install NGINX 1.26.3 :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>nginx-1.26.3
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Disable the setup wizard</p>
<p>If you don't want to use the setup wizard of the web UI when BunkerWeb is installed, export the following variable :</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">UI_WIZARD</span><span class="o">=</span>no
</code></pre></div>
</div>
<p>And finally install BunkerWeb testing :</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>epel-release<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
curl<span class="w"> </span>-s<span class="w"> </span>https://repo.bunkerweb.io/install/script.rpm.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>check-update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>-E<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>bunkerweb-testing
</code></pre></div>
<p>To prevent upgrading NGINX and/or BunkerWeb packages when executing <code>dnf upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>nginx<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
</div>
</div>
<h3 id="integrations-configuration-and-service">Configuration and service</h3>
<p>Manual configuration of BunkerWeb is done by editing the <code>/etc/bunkerweb/variables.env</code> file :</p>
<div class="highlight"><pre><span></span><code>MY_SETTING_1=value1
MY_SETTING_2=value2
...
</code></pre></div>
<p>When installed, BunkerWeb comes with three services <code>bunkerweb</code>, <code>bunkerweb-scheduler</code> and <code>bunkerweb-ui</code> that you can manage using <code>systemctl</code>.</p>
<p>If you manually edit the BunkerWeb configuration using <code>/etc/bunkerweb/variables.env</code> a restart of the <code>bunkerweb-scheduler</code> service will be enough to generate and reload the configuration without any downtime. But depending on the case (such as changing listening ports) you might need to restart the <code>bunkerweb</code> service.</p>
<h3 id="integrations-high-availability">High availability</h3>
<p>The scheduler can be detached from the BunkerWeb instance to provide high availability. In this case, the scheduler will be installed on a separate server and will be able to manage multiple BunkerWeb instances.</p>
<p><strong>Manager</strong></p>
<p>To install only the scheduler on a server, you can export the following variables before executing the BunkerWeb installation :</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">MANAGER_MODE</span><span class="o">=</span>yes
<span class="nb">export</span><span class="w"> </span><span class="nv">UI_WIZARD</span><span class="o">=</span>no
</code></pre></div>
<p>Alternatively, you can also export the following variables to only enable the scheduler :</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">SERVICE_SCHEDULER</span><span class="o">=</span>yes
<span class="nb">export</span><span class="w"> </span><span class="nv">SERVICE_BUNKERWEB</span><span class="o">=</span>no
<span class="nb">export</span><span class="w"> </span><span class="nv">SERVICE_UI</span><span class="o">=</span>no
</code></pre></div>
<p><strong>Worker</strong></p>
<p>On another server, to install only BunkerWeb, you can export the following variables before executing the BunkerWeb installation :</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">WORKER_MODE</span><span class="o">=</span>yes
</code></pre></div>
<p>Alternatively, you can also export the following variables to only enable BunkerWeb :</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">SERVICE_BUNKERWEB</span><span class="o">=</span>yes
<span class="nb">export</span><span class="w"> </span><span class="nv">SERVICE_SCHEDULER</span><span class="o">=</span>no
<span class="nb">export</span><span class="w"> </span><span class="nv">SERVICE_UI</span><span class="o">=</span>no
</code></pre></div>
<p><strong>Web UI</strong></p>
<p>The Web UI can be installed on a separate server to provide a dedicated interface for managing BunkerWeb instances. To install only the Web UI, you can export the following variables before executing the BunkerWeb installation :</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">SERVICE_BUNKERWEB</span><span class="o">=</span>no
<span class="nb">export</span><span class="w"> </span><span class="nv">SERVICE_SCHEDULER</span><span class="o">=</span>no
<span class="nb">export</span><span class="w"> </span><span class="nv">SERVICE_UI</span><span class="o">=</span>yes
</code></pre></div>
<h2 id="integrations-docker-autoconf">Docker autoconf</h2>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/integration-autoconf.svg" width="600" />
  </p>
<figcaption>Docker autoconf integration</figcaption>
</figure>
<div class="admonition info">
<p class="admonition-title">Docker integration</p>
<p>The Docker autoconf integration is an "evolution" of the Docker one. Please read the <a href="#integrations-docker">Docker integration section</a> first if needed.</p>
</div>
<p>An alternative approach is available to address the inconvenience of recreating the container every time there is an update. By utilizing another image called <strong>autoconf</strong>, you can automate the real-time reconfiguration of BunkerWeb without the need for container recreation.</p>
<p>To leverage this functionality, instead of defining environment variables for the BunkerWeb container, you can add <strong>labels</strong> to your web application containers. The <strong>autoconf</strong> image will then listen for Docker events and seamlessly handle the configuration updates for BunkerWeb.</p>
<p>This "<em>automagical</em>" process simplifies the management of BunkerWeb configurations. By adding labels to your web application containers, you can delegate the reconfiguration tasks to <strong>autoconf</strong> without the manual intervention of container recreation. This streamlines the update process and enhances convenience.</p>
<p>By adopting this approach, you can enjoy real-time reconfiguration of BunkerWeb without the hassle of container recreation, making it more efficient and user-friendly.</p>
<div class="admonition info">
<p class="admonition-title">Multisite mode</p>
<p>The Docker autoconf integration implies the use of <strong>multisite mode</strong>. Please refer to the <a href="#concepts-multisite-mode">multisite section</a> of the documentation for more information.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>Please be aware that our instructions assume you are using MariaDB as the default database backend, as configured by the <code>DATABASE_URI</code> setting. However, we understand that you may prefer to utilize alternative backends for your Docker integration. If that is the case, rest assured that other database backends are still possible. See docker-compose files in the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/misc/integrations">misc/integrations folder</a> of the repository for more information.</p>
</div>
<p>To enable automated configuration updates, include an additional container called <code>bw-autoconf</code> in the stack. This container hosts the autoconf service, which manages dynamic configuration changes for BunkerWeb.</p>
<p>To support this functionality, use a dedicated "real" database backend (e.g., MariaDB, MySQL, or PostgreSQL) for synchronized configuration storage. By integrating <code>bw-autoconf</code> and a suitable database backend, you establish the infrastructure for seamless automated configuration management in BunkerWeb.</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-bw-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-env</span>
<span class="w">  </span><span class="c1"># We use an anchor to avoid repeating the same settings for both containers</span>
<span class="w">  </span><span class="nt">AUTOCONF_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">  </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/udp&quot;</span><span class="w"> </span><span class="c1"># QUIC</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE=yes&quot;</span><span class="w"> </span><span class="c1"># Mandatory label for the autoconf service to identify the BunkerWeb instance</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-env</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1"># We don&#39;t need to specify the BunkerWeb instance here as they are automatically detected by the autoconf service</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1"># The server name will be filled with services labels</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="c1"># Mandatory setting for autoconf</span>
<span class="w">      </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">AUTOCONF_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="nt">DOCKER_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tcp://bw-docker:2375&quot;</span><span class="w"> </span><span class="c1"># The Docker socket</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy:nightly</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">CONTAINERS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warning&quot;</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Database in the <code>bw-db</code> network</p>
<p>The database container is intentionally not included in the <code>bw-universe</code> network. It is used by the <code>bw-autoconf</code> and <code>bw-scheduler</code> containers rather than directly by BunkerWeb. Therefore, the database container is part of the <code>bw-db</code> network, which enhances security by making external access to the database more challenging. <strong>This deliberate design choice helps safeguard the database and strengthens the overall security perspective of the system</strong>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Using Docker in rootless mode</p>
<p>If you are using <a href="https://docs.docker.com/engine/security/rootless">Docker in rootless mode</a>, you will need to replace the mount of the docker socket with the following value : <code>$XDG_RUNTIME_DIR/docker.sock:/var/run/docker.sock:ro</code>.</p>
</div>
<h3 id="integrations-autoconf-services">Autoconf services</h3>
<p>Once the stack is set up, you will be able to create the web application container and add the settings as labels using the "bunkerweb." prefix in order to automatically set up BunkerWeb :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mywebapp:4.2</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.MY_SETTING_1=value1&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.MY_SETTING_2=value2&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
<h3 id="integrations-namespaces">Namespaces</h3>
<p>Starting from version <code>1.6.0</code>, BunkerWeb's Autoconf stacks now support namespaces. This feature enables you to manage multiple "<em>clusters</em>" of BunkerWeb instances and services on the same Docker host. To take advantage of namespaces, simply set the <code>NAMESPACE</code> label on your services. Here's an example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mywebapp:4.2</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.NAMESPACE=my-namespace&quot;</span><span class="w"> </span><span class="c1"># Set the namespace for the service</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.MY_SETTING_1=value1&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.MY_SETTING_2=value2&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Namespace behavior</p>
<p>By default all Autoconf stacks listen to all namespaces. If you want to restrict a stack to a specific namespaces, you can set the <code>NAMESPACES</code> environment variable in the <code>bw-autoconf</code> service :</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.NAMESPACE=my-namespace&quot;</span><span class="w"> </span><span class="c1"># Set the namespace for the BunkerWeb instance so the autoconf service can detect it</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">NAMESPACES</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;my-namespace</span><span class="nv"> </span><span class="s">my-other-namespace&quot;</span><span class="w"> </span><span class="c1"># Only listen to these namespaces</span>
<span class="nn">...</span>
</code></pre></div>
<p>Keep in mind that the <code>NAMESPACES</code> environment variable is a space-separated list of namespaces.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Namespace specifications</p>
<p>There can only be <strong>one database</strong> and <strong>one Scheduler</strong> per namespace. If you try to create multiple databases or Schedulers in the same namespace, the configurations will end up conflicting with each other.</p>
<p>The Scheduler doesn't need the <code>NAMESPACE</code> label to work properly. It will only need the <code>DATABASE_URI</code> setting properly configured so that it can access the same database as the autoconf service.</p>
</div>
<h2 id="integrations-kubernetes">Kubernetes</h2>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/integration-kubernetes.svg" width="600" />
  </p>
<figcaption>Kubernetes integration</figcaption>
</figure>
<p>To automate the configuration of BunkerWeb instances in a Kubernetes environment, the autoconf service serves as an <a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/">Ingress controller</a>. It configures the BunkerWeb instances based on <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress resources</a> and also monitors other Kubernetes objects, such as <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">ConfigMap</a>, for custom configurations.</p>
<p>For an optimal setup, it is recommended to define BunkerWeb as a <strong><a href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/">DaemonSet</a></strong>, which ensures that a pod is created on all nodes, while the <strong>autoconf and scheduler</strong> are defined as <strong>single replicated <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a></strong>.</p>
<p>Given the presence of multiple BunkerWeb instances, it is necessary to establish a shared data store implemented as a <a href="https://redis.io/">Redis</a> service. This Redis service will be utilized by the instances to cache and share data among themselves. Further information about the Redis settings can be found <a href="#settings-redis">here</a>.</p>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>Please be aware that our instructions assume you are using MariaDB as the default database backend, as configured by the <code>DATABASE_URI</code> setting. However, we understand that you may prefer to utilize alternative backends for your Docker integration. If that is the case, rest assured that other database backends are still possible. See docker-compose files in the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/misc/integrations">misc/integrations folder</a> of the repository for more information.</p>
<p>Clustered database backends setup are out-of-the-scope of this documentation.</p>
</div>
<p>Please ensure that the autoconf services have access to the Kubernetes API. It is recommended to utilize <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC authorization</a> for this purpose.</p>
<div class="admonition warn">
<p class="admonition-title">Custom CA for Kubernetes API</p>
<p>If you use a custom CA for your Kubernetes API, you can mount a bundle file containing your intermediate(s) and root certificates on the ingress controller and set the <code>KUBERNETES_SSL_CA_CERT</code> environment value to the path of the bundle inside the container. Alternatively, even if it's not recommended, you can disable certificate verification by setting the <code>KUBERNETES_SSL_VERIFY</code> environment variable of the ingress controller to <code>no</code> (default is <code>yes</code>).</p>
</div>
<p>Additionally, <strong>it is crucial to set the <code>KUBERNETES_MODE</code> environment variable to <code>yes</code> when utilizing the Kubernetes integration</strong>. This variable is mandatory for proper functionality.</p>
<h3 id="integrations-installation-using-helm-chart">Installation using Helm chart</h3>
<p>The recommended way to install Kubernetes is to use the Helm chart available at <code>https://repo.bunkerweb.io/charts</code> :</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>bunkerweb<span class="w"> </span>https://repo.bunkerweb.io/charts
</code></pre></div>
<p>You can then use the bunkerweb helm chart from that repository :</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>install<span class="w"> </span>-f<span class="w"> </span>myvalues.yaml<span class="w"> </span>mybunkerweb<span class="w"> </span>bunkerweb/bunkerweb
</code></pre></div>
<p>The full list of values are listed in the <a href="https://github.com/bunkerity/bunkerweb-helm/blob/main/charts/bunkerweb/values.yaml">charts/bunkerweb/values.yaml file</a> of the <a href="https://github.com/bunkerity/bunkerweb-helm">bunkerity/bunkerweb-helm repository</a>.</p>
<h3 id="integrations-ingress-resources">Ingress resources</h3>
<p>Once the BunkerWeb Kubernetes stack is successfully set up and operational (refer to the autoconf logs for detailed information), you can proceed with deploying web applications within the cluster and declaring your Ingress resource.</p>
<p>It is important to note that the BunkerWeb settings need to be specified as annotations for the Ingress resource. For the domain part, please use the special value <strong><code>bunkerweb.io</code></strong>. By including the appropriate annotations, you can configure BunkerWeb accordingly for the Ingress resource.</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-ingress</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb.io/MY_SETTING</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span>
<span class="w">    </span><span class="nt">bunkerweb.io/www.example.com_MY_SETTING</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-my-app</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<span class="nn">...</span>
</code></pre></div>
<h3 id="integrations-namespaces_1">Namespaces</h3>
<p>Starting from version <code>1.6.0</code>, BunkerWeb's autoconf stacks now support namespaces. This feature enables you to manage multiple clusters of BunkerWeb instances and services on the same Kubernetes cluster. To take advantage of namespaces, simply set the <code>namespace</code> metadata field on your BunkerWeb instances and services. Here's an example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DaemonSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-namespace</span><span class="w"> </span><span class="c1"># Set the namespace for the BunkerWeb instance</span>
<span class="nn">...</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Namespace behavior</p>
<p>By default all Autoconf stacks listen to all namespaces. If you want to restrict a stack to a specific namespaces, you can set the <code>NAMESPACES</code> environment variable in the <code>bunkerweb-controller</code> deployment :</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-namespace</span><span class="w"> </span><span class="c1"># Set the namespace for the Controller</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NAMESPACES</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;my-namespace</span><span class="nv"> </span><span class="s">my-other-namespace&quot;</span><span class="w"> </span><span class="c1"># Only listen to these namespaces</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="nn">...</span>
</code></pre></div>
<p>Keep in mind that the <code>NAMESPACES</code> environment variable is a space-separated list of namespaces.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Namespace specifications</p>
<p>There can only be <strong>one database</strong> and <strong>one Scheduler</strong> per namespace. If you try to create multiple databases or Schedulers in the same namespace, the configurations will end up conflicting with each other.</p>
<p>The Scheduler doesn't need the <code>NAMESPACE</code> annotation to work properly. It will only need the <code>DATABASE_URI</code> setting properly configured so that it can access the same database as the autoconf service.</p>
</div>
<h3 id="integrations-ingress-class">Ingress class</h3>
<p>When installed using the official methods in the documentation, BunkerWeb comes with the following <code>IngressClass</code> definition :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IngressClass</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb.io/ingress-controller</span>
</code></pre></div>
<p>In order to restrict the <code>Ingress</code> resources monitored by the ingress controller, you can set the <code>KUBERNETES_INGRESS_CLASS</code> environment variable with the value <code>bunkerweb</code>. Then, you can leverage the <code>ingressClassName</code> directive in your <code>Ingress</code> definitions :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-ingress</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb.io/MY_SETTING</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span>
<span class="w">    </span><span class="nt">bunkerweb.io/www.example.com_MY_SETTING</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-my-app</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
</code></pre></div>
<h3 id="integrations-custom-domain-name">Custom domain name</h3>
<p>If you use a custom domain name for your Kubernetes cluster different than the default <code>kubernetes.local</code> one, you can set the value using the <code>KUBERNETES_DOMAIN_NAME</code> environment variable on the scheduler container.</p>
<h3 id="integrations-full-yaml-file">Full YAML file</h3>
<p>To assist you, here is a YAML boilerplate that can serve as a foundation for your configuration:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cr-bunkerweb</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;services&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pods&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;configmaps&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;secrets&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;networking.k8s.io&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;ingresses&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">]</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crb-bunkerweb</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">    </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="nt">roleRef</span><span class="p">:</span>
<span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cr-bunkerweb</span>
<span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IngressClass</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb.io/ingress-controller</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DaemonSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="c1"># mandatory annotation</span>
<span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bunkerweb.io/INSTANCE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># using bunkerweb as name is mandatory</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span>
<span class="w">            </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">101</span>
<span class="w">            </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">101</span>
<span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">            </span><span class="nt">capabilities</span><span class="p">:</span>
<span class="w">              </span><span class="nt">drop</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">              </span><span class="nt">hostPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<span class="w">              </span><span class="nt">hostPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="c1"># replace with your DNS resolvers</span>
<span class="w">            </span><span class="c1"># e.g. : kube-dns.kube-system.svc.cluster.local</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS_RESOLVERS</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;coredns.kube-system.svc.cluster.local&quot;</span>
<span class="w">            </span><span class="c1"># 10.0.0.0/8 is the cluster internal subnet</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.0.0.0/8&quot;</span>
<span class="w">          </span><span class="nt">livenessProbe</span><span class="p">:</span>
<span class="w">            </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">              </span><span class="nt">command</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/share/bunkerweb/helpers/healthcheck.sh</span>
<span class="w">            </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">            </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">            </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">          </span><span class="nt">readinessProbe</span><span class="p">:</span>
<span class="w">            </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">              </span><span class="nt">command</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/share/bunkerweb/helpers/healthcheck.sh</span>
<span class="w">            </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">            </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@svc-bunkerweb-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@svc-bunkerweb-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">            </span><span class="c1"># replace with your DNS resolvers</span>
<span class="w">            </span><span class="c1"># e.g. : kube-dns.kube-system.svc.cluster.local</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS_RESOLVERS</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;coredns.kube-system.svc.cluster.local&quot;</span>
<span class="w">            </span><span class="c1"># 10.0.0.0/8 is the cluster internal subnet</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.0.0.0/8&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BUNKERWEB_INSTANCES</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1"># We don&#39;t need to specify the BunkerWeb instance here as they are automatically detected by the ingress controller</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_NAME</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1"># The server name will be filled with services annotations</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MULTISITE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="c1"># Mandatory setting for autoconf</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REDIS</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_HOST</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;svc-bunkerweb-redis.default.svc.cluster.local&quot;</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_RANDOM_ROOT_PASSWORD</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_DATABASE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_USER</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/var/lib/mysql&quot;</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vol-db</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vol-db</span>
<span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pvc-bunkerweb</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb-db</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb-redis</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pvc-bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5Gi</span>
</code></pre></div>
<h2 id="integrations-swarm">Swarm</h2>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/integration-swarm.svg" width="600" />
  </p>
<figcaption>Docker Swarm integration</figcaption>
</figure>
<div class="admonition warning">
<p class="admonition-title">Deprecated</p>
<p>The Swarm integration is deprecated and will be removed in a future release. Please consider using the <a href="#integrations-kubernetes">Kubernetes integration</a> instead.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">PRO support</p>
<p><strong>If you need Swarm support</strong>, please contact us at <a href="mailto:contact@bunkerity.com">contact@bunkerity.com</a> or via the <a href="https://panel.bunkerweb.io/contact.php">contact form</a>.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Docker autoconf</p>
<p>The Swarm integration is similar to the Docker autoconf one (but with services instead of containers). Please read the <a href="#integrations-docker-autoconf">Docker autoconf integration section</a> first if needed.</p>
</div>
<p>To enable automatic configuration of BunkerWeb instances, the <strong>autoconf</strong> service requires access to the Docker API. This service listens for Docker Swarm events, such as service creation or deletion, and seamlessly configures the <strong>BunkerWeb instances</strong> in real-time without any downtime. It also monitors other Swarm objects, such as <a href="https://docs.docker.com/engine/swarm/configs/">configs</a>, for custom configurations.</p>
<p>Similar to the <a href="#integrations-docker-autoconf">Docker autoconf integration</a>, configuration for web services is defined using labels that start with the <strong>bunkerweb</strong>  prefix.</p>
<p>For an optimal setup, it is recommended to schedule the <strong>BunkerWeb service</strong> as a <strong><em>global service</em></strong> on all nodes, while the <strong>autoconf, scheduler, and Docker API proxy services</strong> should be scheduled as <strong><em>single replicated services</em></strong>. Please note that the Docker API proxy service needs to be scheduled on a manager node unless you configure it to use a remote API (which is not covered in the documentation).</p>
<p>Since multiple instances of BunkerWeb are running, a shared data store implemented as a <a href="https://redis.io/">Redis</a> service must be created. These instances will utilize the Redis service to cache and share data. Further details regarding the Redis settings can be found <a href="#settings-redis">here</a>.</p>
<p>As for the database volume, the documentation does not specify a specific approach. Choosing either a shared folder or a specific driver for the database volume is dependent on your unique use-case and is left as an exercise for the reader.</p>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>Please be aware that our instructions assume you are using MariaDB as the default database backend, as configured by the <code>DATABASE_URI</code> setting. However, we understand that you may prefer to utilize alternative backends for your Docker integration. If that is the case, rest assured that other database backends are still possible. See docker-compose files in the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/misc/integrations">misc/integrations folder</a> of the repository for more information.</p>
<p>Clustered database backends setup are out-of-the-scope of this documentation.</p>
</div>
<p>Here is the stack boilerplate that you can deploy using <code>docker stack deploy</code> :</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-bw-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-env</span>
<span class="w">  </span><span class="c1"># We use an anchor to avoid repeating the same settings for both services</span>
<span class="w">  </span><span class="nt">SWARM_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">  </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">udp</span><span class="w"> </span><span class="c1"># QUIC</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-env</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">global</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE=yes&quot;</span><span class="w"> </span><span class="c1"># Mandatory label for the autoconf service to identify the BunkerWeb instance</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1"># We don&#39;t need to specify the BunkerWeb instance here as they are automatically detected by the autoconf service</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1"># The server name will be filled with services labels</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="c1"># Mandatory setting for autoconf</span>
<span class="w">      </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="nt">USE_REDIS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">REDIS_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bw-redis&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>

<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">SWARM_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="nt">DOCKER_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tcp://bw-docker:2375&quot;</span><span class="w"> </span><span class="c1"># The Docker socket</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy:nightly</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">CONFIGS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">CONTAINERS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">SERVICES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">SWARM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">TASKS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warning&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">manager&quot;</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>

<span class="w">  </span><span class="nt">bw-redis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Swarm mandatory setting</p>
<p>Please note that the <code>SWARM_MODE: "yes"</code> environment variable is mandatory when using the Swarm integration.</p>
</div>
<h3 id="integrations-swarm-services">Swarm services</h3>
<p>Once the BunkerWeb Swarm stack is set up and running (see autoconf and scheduler logs for more information), you will be able to deploy web applications in the cluster and use labels to dynamically configure BunkerWeb :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mywebapp:4.2</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.MY_SETTING_1=value1&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.MY_SETTING_2=value2&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
<h3 id="integrations-namespaces_2">Namespaces</h3>
<p>Starting from version <code>1.6.0</code>, BunkerWeb's Autoconf stacks now support namespaces. This feature enables you to manage multiple "<em>clusters</em>" of BunkerWeb instances and services on the same Docker host. To take advantage of namespaces, simply set the <code>NAMESPACE</code> label on your services. Here's an example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mywebapp:4.2</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.NAMESPACE=my-namespace&quot;</span><span class="w"> </span><span class="c1"># Set the namespace for the service</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.MY_SETTING_1=value1&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.MY_SETTING_2=value2&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Namespace behavior</p>
<p>By default all Autoconf stacks listen to all namespaces. If you want to restrict a stack to a specific namespaces, you can set the <code>NAMESPACES</code> environment variable in the <code>bw-autoconf</code> service :</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">global</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.NAMESPACE=my-namespace&quot;</span><span class="w"> </span><span class="c1"># Set the namespace for the BunkerWeb instance</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">NAMESPACES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;my-namespace</span><span class="nv"> </span><span class="s">my-other-namespace&quot;</span><span class="w"> </span><span class="c1"># Only listen to these namespaces</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>
<span class="nn">...</span>
</code></pre></div>
<p>Keep in mind that the <code>NAMESPACES</code> environment variable is a space-separated list of namespaces.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Namespace specifications</p>
<p>There can only be <strong>one database</strong> and <strong>one Scheduler</strong> per namespace. If you try to create multiple databases or Schedulers in the same namespace, the configurations will end up conflicting with each other.</p>
<p>The Scheduler doesn't need the <code>NAMESPACE</code> label to work properly. It will only need the <code>DATABASE_URI</code> setting properly configured so that it can access the same database as the autoconf service.</p>
</div>
<h2 id="integrations-microsoft-azure">Microsoft Azure</h2>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/integration-azure.webp" width="600" />
  </p>
<figcaption>Azure integration</figcaption>
</figure>
<div class="admonition info">
<p class="admonition-title">Recommended VM size</p>
<p>Please be aware while you choose the SKU of the VM. You must select a SKU compatible with Gen2 VM and we recommend starting at B2s or Ds2 series for optimal use.</p>
</div>
<p>You can easily deploy BunkerWeb on your Azure subscription in several ways:</p>
<ul>
<li>Azure CLI in Cloud Shell</li>
<li>Azure ARM Template</li>
<li>Azure portal via the Marketplace</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="3:3"><input checked="checked" id="integrations-__tabbed_3_1" name="integrations-__tabbed_3" type="radio" /><input id="integrations-__tabbed_3_2" name="integrations-__tabbed_3" type="radio" /><input id="integrations-__tabbed_3_3" name="integrations-__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="integrations-__tabbed_3_1">Cloud Shell</label><label for="integrations-__tabbed_3_2">ARM Template</label><label for="integrations-__tabbed_3_3">Marketplace</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Create a resource group. Replace value <code>RG_NAME</code></p>
<div class="highlight"><pre><span></span><code>az<span class="w"> </span>group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;RG_NAME&quot;</span><span class="w"> </span>--location<span class="w"> </span><span class="s2">&quot;LOCATION&quot;</span>
</code></pre></div>
<p>Create a VM with <code>Standard_B2s</code> SKU in the location of the resource group. Replace values <code>RG_NAME</code>, <code>VM_NAME</code>, <code>VNET_NAME</code>, <code>SUBNET_NAME</code></p>
<div class="highlight"><pre><span></span><code>az<span class="w"> </span>vm<span class="w"> </span>create<span class="w"> </span>--resource-group<span class="w"> </span><span class="s2">&quot;RG_NAME&quot;</span><span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;VM_NAME&quot;</span><span class="w"> </span>--image<span class="w"> </span>bunkerity:bunkerweb:bunkerweb:latest<span class="w"> </span>--accept-term<span class="w"> </span>--generate-ssh-keys<span class="w"> </span>--vnet-name<span class="w"> </span><span class="s2">&quot;VNET_NAME&quot;</span><span class="w"> </span>--size<span class="w"> </span>Standard_B2s<span class="w"> </span>--subnet<span class="w"> </span><span class="s2">&quot;SUBNET_NAME&quot;</span>
</code></pre></div>
<p>Full command. Replace values <code>RG_NAME</code>, <code>VM_NAME</code>, <code>LOCATION</code>, <code>HOSTNAME</code>, <code>USERNAME</code>, <code>PUBLIC_IP</code>, <code>VNET_NAME</code>, <code>SUBNET_NAME</code>, <code>NSG_NAME</code></p>
<div class="highlight"><pre><span></span><code>az<span class="w"> </span>vm<span class="w"> </span>create<span class="w"> </span>--resource-group<span class="w"> </span><span class="s2">&quot;RG_NAME&quot;</span><span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;VM_NAME&quot;</span><span class="w"> </span>--location<span class="w"> </span><span class="s2">&quot;LOCATION&quot;</span><span class="w"> </span>--image<span class="w"> </span>bunkerity:bunkerweb:bunkerweb:latest<span class="w"> </span>--accept-term<span class="w"> </span>--generate-ssh-keys<span class="w"> </span>--computer-name<span class="w"> </span><span class="s2">&quot;HOSTNAME&quot;</span><span class="w"> </span>--admin-username<span class="w"> </span><span class="s2">&quot;USERNAME&quot;</span><span class="w"> </span>--public-ip-address<span class="w"> </span><span class="s2">&quot;PUBLIC_IP&quot;</span><span class="w"> </span>--public-ip-address-allocation<span class="w"> </span>Static<span class="w"> </span>--size<span class="w"> </span>Standard_B2s<span class="w"> </span>--public-ip-sku<span class="w"> </span>Standard<span class="w"> </span>--os-disk-delete-option<span class="w"> </span>Delete<span class="w"> </span>--nic-delete-option<span class="w"> </span>Delete<span class="w"> </span>--vnet-name<span class="w"> </span><span class="s2">&quot;VNET_NAME&quot;</span><span class="w"> </span>--subnet<span class="w"> </span><span class="s2">&quot;SUBNET_NAME&quot;</span><span class="w"> </span>--nsg<span class="w"> </span><span class="s2">&quot;NSG_NAME&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition info">
<p class="admonition-title">Permissions requirement</p>
<p>To deploy a ARM template, you need write access on the resources you're deploying and access to all operations on the Microsoft.Resources/deployments resource type.
To deploy a virtual machine, you need Microsoft.Compute/virtualMachines/write and Microsoft.Resources/deployments/* permissions. The what-if operation has the same permission requirements.</p>
</div>
<p>Deploy the ARM Template:</p>
<p><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fbunkerity%2Fbunkerweb%2Fmaster%2Fmisc%2Fintegrations%2Fazure-arm-template.json" target="_blank"><img alt="Deploy to Azure" src="../assets/img/integration-azure-deploy.svg" /></a></p>
</div>
<div class="tabbed-block">
<p>Login in <a href="https://portal.azure.com" target="_blank">Azure portal</a>.</p>
<p>Get BunkerWeb from the <a href="https://portal.azure.com/#view/Microsoft_Azure_Marketplace/GalleryItemDetailsBladeNopdl/id/bunkerity.bunkerweb" target="_blank">Create resource menu</a>.</p>
<p>You can also go through the <a href="https://azuremarketplace.microsoft.com/fr-fr/marketplace/apps/bunkerity.bunkerweb?tab=Overview" target="_blank">Marketplace</a>.</p>
</div>
</div>
</div>
<p>You can access the setup wizard by browsing the <code>https://your-ip-address/setup</code> URI of your virtual machine.</p></section><section class="print-page" id="quickstart-guide"><h1 id="quickstart-guide-quickstart-guide">Quickstart guide</h1>
<div class="admonition info">
<p class="admonition-title">Prerequisites</p>
<p>We expect that you're already familiar with the <a href="#concepts">core concepts</a> and you have followed the <a href="#integrations">integrations instructions</a> for your environment.</p>
<p>This quickstart guide assumes that BunkerWeb is accessible from the Internet and you have configured at least two domains : one for the web UI and another one for your web service.</p>
<p><strong>System requirements</strong></p>
<p>The minimum recommended specifications for BunkerWeb are a machine with 2 (v)CPUs and 4 GB of RAM. Please note that this should be sufficient for testing environments or setups with very few services.</p>
<p>For production environments with many services to protect, we recommend at least 4 (v)CPUs and 16 GB of RAM. Resources should be adjusted based on your use case, network traffic, and potential DDoS attacks you may face.</p>
<p>It is highly recommended to enable global loading of CRS rules (by setting the <code>USE_MODSECURITY_GLOBAL_CRS</code> parameter to <code>yes</code>) if you are in environments with limited RAM or in production with many services. More details can be found in the <a href="#advanced-running-many-services-in-production">advanced usages</a> section of the documentation.</p>
</div>
<p>This quickstart guide will help you to quickly install BunkerWeb and secure a web service using the web User Interface.</p>
<p>Protecting existing web applications already accessible with the HTTP(S) protocol is the main goal of BunkerWeb : it will act as a classical <a href="https://en.wikipedia.org/wiki/Reverse_proxy">reverse proxy</a> with extra security features.</p>
<p>See the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/examples">examples folder</a> of the repository to get real-world examples.</p>
<h2 id="quickstart-guide-basic-setup">Basic setup</h2>
<div class="tabbed-set tabbed-alternate" data-tabs="1:5"><input checked="checked" id="quickstart-guide-__tabbed_1_1" name="quickstart-guide-__tabbed_1" type="radio" /><input id="quickstart-guide-__tabbed_1_2" name="quickstart-guide-__tabbed_1" type="radio" /><input id="quickstart-guide-__tabbed_1_3" name="quickstart-guide-__tabbed_1" type="radio" /><input id="quickstart-guide-__tabbed_1_4" name="quickstart-guide-__tabbed_1" type="radio" /><input id="quickstart-guide-__tabbed_1_5" name="quickstart-guide-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="quickstart-guide-__tabbed_1_1">Linux</label><label for="quickstart-guide-__tabbed_1_2">Docker</label><label for="quickstart-guide-__tabbed_1_3">Docker autoconf</label><label for="quickstart-guide-__tabbed_1_4">Kubernetes</label><label for="quickstart-guide-__tabbed_1_5">Swarm</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Please ensure that you have <strong>NGINX 1.26.3 installed before installing BunkerWeb</strong>. For all distributions, except Fedora, it is mandatory to use prebuilt packages from the <a href="https://nginx.org/en/linux_packages.html">official NGINX repository</a>. Compiling NGINX from source or using packages from different repositories will not work with the official prebuilt packages of BunkerWeb. However, you have the option to build BunkerWeb from source.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:4"><input checked="checked" id="quickstart-guide-__tabbed_2_1" name="quickstart-guide-__tabbed_2" type="radio" /><input id="quickstart-guide-__tabbed_2_2" name="quickstart-guide-__tabbed_2" type="radio" /><input id="quickstart-guide-__tabbed_2_3" name="quickstart-guide-__tabbed_2" type="radio" /><input id="quickstart-guide-__tabbed_2_4" name="quickstart-guide-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="quickstart-guide-__tabbed_2_1">Debian</label><label for="quickstart-guide-__tabbed_2_2">Ubuntu</label><label for="quickstart-guide-__tabbed_2_3">Fedora</label><label for="quickstart-guide-__tabbed_2_4">RedHat</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>The first step is to add NGINX official repository :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>curl<span class="w"> </span>gnupg2<span class="w"> </span>ca-certificates<span class="w"> </span>lsb-release<span class="w"> </span>debian-archive-keyring<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
curl<span class="w"> </span>https://nginx.org/keys/nginx_signing.key<span class="w"> </span><span class="p">|</span><span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/usr/share/keyrings/nginx-archive-keyring.gpg<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \</span>
<span class="s2">http://nginx.org/packages/debian `lsb_release -cs` nginx&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/nginx.list
</code></pre></div>
<p>You should now be able to install NGINX 1.26.3 :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">nginx</span><span class="o">=</span><span class="m">1</span>.26.3-1~<span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Testing/dev version</p>
<p>If you use the <code>testing</code> or <code>dev</code> version, you will need to add the <code>force-bad-version</code> directive to your <code>/etc/dpkg/dpkg.cfg</code> file before installing BunkerWeb.</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;force-bad-version&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/dpkg/dpkg.cfg
</code></pre></div>
</div>
<p>And finally install BunkerWeb testing :</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://repo.bunkerweb.io/install/script.deb.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>-E<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">bunkerweb</span><span class="o">=</span>testing
</code></pre></div>
<p>To prevent upgrading NGINX and/or BunkerWeb packages when executing <code>apt upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-mark<span class="w"> </span>hold<span class="w"> </span>nginx<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The first step is to add NGINX official repository :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>curl<span class="w"> </span>gnupg2<span class="w"> </span>ca-certificates<span class="w"> </span>lsb-release<span class="w"> </span>ubuntu-keyring<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
curl<span class="w"> </span>https://nginx.org/keys/nginx_signing.key<span class="w"> </span><span class="p">|</span><span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/usr/share/keyrings/nginx-archive-keyring.gpg<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \</span>
<span class="s2">http://nginx.org/packages/ubuntu `lsb_release -cs` nginx&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/nginx.list
</code></pre></div>
<p>You should now be able to install NGINX 1.26.3 :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">nginx</span><span class="o">=</span><span class="m">1</span>.26.3-1~<span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Testing/dev version</p>
<p>If you use the <code>testing</code> or <code>dev</code> version, you will need to add the <code>force-bad-version</code> directive to your <code>/etc/dpkg/dpkg.cfg</code> file before installing BunkerWeb.</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;force-bad-version&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/dpkg/dpkg.cfg
</code></pre></div>
</div>
<p>And finally install BunkerWeb testing :</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://repo.bunkerweb.io/install/script.deb.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>-E<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">bunkerweb</span><span class="o">=</span>testing
</code></pre></div>
<p>To prevent upgrading NGINX and/or BunkerWeb packages when executing <code>apt upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-mark<span class="w"> </span>hold<span class="w"> </span>nginx<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition info">
<p class="admonition-title">Fedora Update Testing</p>
<p>If you can't find the NGINX version listed in the stable repository, you can enable the <code>updates-testing</code> repository :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="quickstart-guide-__tabbed_3_1" name="quickstart-guide-__tabbed_3" type="radio" /><input id="quickstart-guide-__tabbed_3_2" name="quickstart-guide-__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="quickstart-guide-__tabbed_3_1">Fedora 41</label><label for="quickstart-guide-__tabbed_3_2">Fedora 40</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>config-manager<span class="w"> </span>setopt<span class="w"> </span>updates-testing.enabled<span class="o">=</span><span class="m">1</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>config-manager<span class="w"> </span>--set-enabled<span class="w"> </span>updates-testing
</code></pre></div>
</div>
</div>
</div>
</div>
<p>Fedora already provides NGINX 1.26.3 that we support :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>nginx-1.26.3
</code></pre></div>
<p>And finally install BunkerWeb testing :</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://repo.bunkerweb.io/install/script.rpm.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>makecache<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>-E<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>bunkerweb-testing
</code></pre></div>
<p>To prevent upgrading NGINX and/or BunkerWeb packages when executing <code>dnf upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>nginx<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The first step is to add NGINX official repository. Create the following file at <code>/etc/yum.repos.d/nginx.repo</code> :</p>
<div class="highlight"><pre><span></span><code>[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true

[nginx-mainline]
name=nginx mainline repo
baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/
gpgcheck=1
enabled=0
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
</code></pre></div>
<p>You should now be able to install NGINX 1.26.3 :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>nginx-1.26.3
</code></pre></div>
<p>And finally install BunkerWeb testing :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>epel-release<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
curl<span class="w"> </span>-s<span class="w"> </span>https://repo.bunkerweb.io/install/script.rpm.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>check-update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>-E<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>bunkerweb-testing
</code></pre></div>
<p>To prevent upgrading NGINX and/or BunkerWeb packages when executing <code>dnf upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>nginx<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
</div>
</div>
</div>
<div class="tabbed-block">
<p>Here is the full docker compose file that you can use, please note that we will later connect the web service to the <code>bw-services</code> network :</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-bw-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-env</span>
<span class="w">  </span><span class="c1"># We use an anchor to avoid repeating the same settings for both services</span>
<span class="w">  </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span><span class="w"> </span><span class="c1"># Make sure to set the correct IP range so the scheduler can send the configuration to the instance</span>
<span class="w">  </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># This is the name that will be used to identify the instance in the Scheduler</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/udp&quot;</span><span class="w"> </span><span class="c1"># For QUIC / HTTP3 support</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-env</span><span class="w"> </span><span class="c1"># We use the anchor to avoid repeating the same settings for all services</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span><span class="w"> </span><span class="c1"># Make sure to set the correct instance name</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">UI_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://bw-ui:7000&quot;</span><span class="w"> </span><span class="c1"># Change it if needed</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-env</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span><span class="w"> </span><span class="c1"># Make sure to set the correct IP range so the scheduler can send the configuration to the instance</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Here is the full docker compose file that you can use, please note that we will later connect the web service to the <code>bw-services</code> network :</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-ui-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-ui-env</span>
<span class="w">  </span><span class="c1"># We anchor the environment variables to avoid duplication</span>
<span class="w">  </span><span class="nt">AUTOCONF_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">  </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/udp&quot;</span><span class="w"> </span><span class="c1"># For QUIC / HTTP3 support</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE=yes&quot;</span><span class="w"> </span><span class="c1"># We set the instance label to allow the autoconf to detect the instance</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">AUTOCONF_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">UI_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://bw-ui:7000&quot;</span><span class="w"> </span><span class="c1"># Change it if needed</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">DOCKER_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tcp://bw-docker:2375&quot;</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy:nightly</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">CONTAINERS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warning&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">TOTP_SECRETS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysecret&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger secret key (see the Prerequisites section)</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The recommended way to install Kubernetes is to use the Helm chart available at <code>https://repo.bunkerweb.io/charts</code> :</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>bunkerweb<span class="w"> </span>https://repo.bunkerweb.io/charts
</code></pre></div>
<p>You can then use the <code>bunkerweb</code> helm chart from that repository :</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>install<span class="w"> </span>mybw<span class="w"> </span>bunkerweb/bunkerweb<span class="w"> </span>--namespace<span class="w"> </span>bunkerweb<span class="w"> </span>--create-namespace
</code></pre></div>
<p>Once installed, you can get the IP address of the <code>LoadBalancer</code> to setup your domains :</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>-n<span class="w"> </span>bunkerweb<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>mybw-external<span class="w"> </span>-o<span class="o">=</span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Deprecated</p>
<p>The Swarm integration is deprecated and will be removed in a future release. Please consider using the <a href="#integrations-kubernetes">Kubernetes integration</a> instead.</p>
<p><strong>More information can be found in the <a href="#integrations-swarm">Swarm integration documentation</a>.</strong></p>
</div>
<p>Here is the full docker compose stack file that you can use, please note that we will later connect the web service to the <code>bw-services</code> network :</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-ui-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-ui-env</span>
<span class="w">  </span><span class="c1"># We anchor the environment variables to avoid duplication</span>
<span class="w">  </span><span class="nt">SWARM_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">  </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">udp</span><span class="w"> </span><span class="c1"># For QUIC / HTTP3 support</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">SWARM_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">global</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE=yes&quot;</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">USE_REDIS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">REDIS_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bw-redis&quot;</span>
<span class="w">      </span><span class="nt">UI_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://bw-ui:7000&quot;</span><span class="w"> </span><span class="c1"># Change it if needed</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">DOCKER_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tcp://bw-docker:2375&quot;</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy:nightly</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">CONFIGS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">CONTAINERS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">SERVICES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">SWARM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">TASKS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warning&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">manager&quot;</span>

<span class="w">  </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">TOTP_SECRETS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysecret&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger secret key (see the Prerequisites section)</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-redis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="quickstart-guide-complete-the-setup-wizard">Complete the setup wizard</h2>
<div class="admonition tip">
<p class="admonition-title">Accessing the setup wizard</p>
<p>You can access the setup wizard by browsing the <code>https://your-fqdn-or-ip-addresss/setup</code> URI of your server.</p>
</div>
<h3 id="quickstart-guide-create-an-administrator-account">Create an Administrator account</h3>
<p>You should see a setup page just like this one :</p>
<figure>
<p><img align="center" alt="Setup Wizard landing page" src="../assets/img/ui-wizard-step1.png" />
  </p>
<figcaption>Setup Wizard landing page</figcaption>
</figure>
<p>Once you're on the setup page, you can enter the <strong>administrator username, email, and password</strong> and click on the "Next" button.</p>
<h3 id="quickstart-guide-configure-the-reverse-proxy-and-https">Configure the Reverse Proxy and HTTPS</h3>
<p>The next step will ask you to enter the <strong>server name</strong> (domain / fqdn) that the web UI will use. You can also choose to enable <strong>Let's Encrypt</strong> or use a <strong>custom certificate</strong>.</p>
<figure>
<p><img align="center" alt="Setup Wizard step 2" src="../assets/img/ui-wizard-step2.png" />
  </p>
<figcaption>Setup Wizard step 2</figcaption>
</figure>
<h3 id="quickstart-guide-overview-of-your-settings">Overview of your settings</h3>
<p>The last step will give you an overview of the settings you've entered. You can click on the "Setup" button to complete the setup.</p>
<figure>
<p><img align="center" alt="Setup Wizard final step" src="../assets/img/ui-wizard-step3.png" />
  </p>
<figcaption>Setup Wizard final step</figcaption>
</figure>
<h2 id="quickstart-guide-accessing-the-web-interface">Accessing the web interface</h2>
<p>You can now access the web interface by browsing to the domain you configured in the previous step and the URI if you changed it (default is <code>https://your-domain/</code>).</p>
<figure>
<p><img align="center" alt="Web interface login page" src="../assets/img/ui-login.png" />
  </p>
<figcaption>Web interface login page</figcaption>
</figure>
<p>You can now log in with the administrator account you created during the setup wizard.</p>
<figure>
<p><img align="center" alt="Web interface home" src="../assets/img/ui-home.png" />
  </p>
<figcaption>Web interface home</figcaption>
</figure>
<h2 id="quickstart-guide-creating-a-new-service">Creating a new service</h2>
<div class="tabbed-set tabbed-alternate" data-tabs="4:6"><input checked="checked" id="quickstart-guide-__tabbed_4_1" name="quickstart-guide-__tabbed_4" type="radio" /><input id="quickstart-guide-__tabbed_4_2" name="quickstart-guide-__tabbed_4" type="radio" /><input id="quickstart-guide-__tabbed_4_3" name="quickstart-guide-__tabbed_4" type="radio" /><input id="quickstart-guide-__tabbed_4_4" name="quickstart-guide-__tabbed_4" type="radio" /><input id="quickstart-guide-__tabbed_4_5" name="quickstart-guide-__tabbed_4" type="radio" /><input id="quickstart-guide-__tabbed_4_6" name="quickstart-guide-__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="quickstart-guide-__tabbed_4_1">Web UI</label><label for="quickstart-guide-__tabbed_4_2">Linux variables.env file</label><label for="quickstart-guide-__tabbed_4_3">Docker</label><label for="quickstart-guide-__tabbed_4_4">Docker autoconf labels</label><label for="quickstart-guide-__tabbed_4_5">Kubernetes annotations</label><label for="quickstart-guide-__tabbed_4_6">Swarm labels</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>You can create a new service by navigating to the <code>Services</code> section of the web interface and clicking on the <code>➕ Create new service</code> button.</p>
<p>Their are multiple ways of creating a service using the web interface :</p>
<ul>
<li>The <strong>Easy mode</strong> will guide you through the process of creating a new service.</li>
<li>The <strong>Advanced mode</strong> will allow you to configure the service with more options.</li>
<li>The <strong>Raw mode</strong> will allow you to enter the configuration directly like editing the <code>variables.env</code> file.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Draft service</p>
<p>You can create a draft service to save your progress and come back to it later. Just click on the <code>🌐 Online</code> button to toggle the service to draft mode.</p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="5:3"><input checked="checked" id="quickstart-guide-__tabbed_5_1" name="quickstart-guide-__tabbed_5" type="radio" /><input id="quickstart-guide-__tabbed_5_2" name="quickstart-guide-__tabbed_5" type="radio" /><input id="quickstart-guide-__tabbed_5_3" name="quickstart-guide-__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="quickstart-guide-__tabbed_5_1">Easy mode</label><label for="quickstart-guide-__tabbed_5_2">Advanced mode</label><label for="quickstart-guide-__tabbed_5_3">Raw mode</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>In this mode, you can choose among the available templates and fill in the required fields.</p>
<p><figure markdown>
  <img align="center" alt="Web interface create service easy" src="../assets/img/ui-create-service-easy.png" />
  <figcaption>Web interface create service easy</figcaption>
</figure></p>
<ul>
<li>To navigate between the different plugins, you can use the dropdown menu on the top left corner of the page.</li>
<li>Once you've selected the template, you can fill in the required fields and follow the instructions to create the service.</li>
<li>Once you're done configuring the service, you can click on the <code>💾 Save</code> button to save the configuration.</li>
</ul>
</div>
<div class="tabbed-block">
<p>In this mode, you can configure the service with more options while seeing all the available settings from all the different plugins.</p>
<p><figure markdown>
  <img align="center" alt="Web interface create service advanced" src="../assets/img/ui-create-service-advanced.png" />
  <figcaption>Web interface create service advanced</figcaption>
</figure></p>
<ul>
<li>To navigate between the different plugins, you can use the dropdown menu on the top left corner of the page.</li>
<li>Each setting has a small piece of information that will help you understand what it does.</li>
<li>Once you're done configuring the service, you can click on the <code>💾 Save</code> button to save the configuration.</li>
</ul>
</div>
<div class="tabbed-block">
<p>In this mode, you can enter the configuration directly like editing the <code>variables.env</code> file.</p>
<p><figure markdown>
  <img align="center" alt="Web interface create service RAW" src="../assets/img/ui-create-service-raw.png" />
  <figcaption>Web interface create service RAW</figcaption>
</figure></p>
<ul>
<li>Once you're done configuring the service, you can click on the <code>💾 Save</code> button to save the configuration.</li>
</ul>
</div>
</div>
</div>
<p>🚀 Once you've saved the configuration, you should see your new service in the list of services.</p>
<p><figure markdown>
  <img align="center" alt="Web interface services page" src="../assets/img/ui-services.png" />
  <figcaption>Web interface services page</figcaption>
</figure></p>
<p>If you wish to edit the service, you can click on the service name or the <code>📝 Edit</code> button.</p>
</div>
<div class="tabbed-block">
<p>We will assume that you followed the <a href="#quickstart-guide-__tabbed_1_5">Basic setup</a> and you have the Linux integration running on your machine.</p>
<p>You can create a new service by editing the <code>variables.env</code> file located in the <code>/etc/bunkerweb/</code> directory.</p>
<div class="highlight"><pre><span></span><code>nano<span class="w"> </span>/etc/bunkerweb/variables.env
</code></pre></div>
<p>You can then add the following configuration :</p>
<div class="highlight"><pre><span></span><code><span class="nv">SERVER_NAME</span><span class="o">=</span>www.example.com
<span class="nv">MULTISITE</span><span class="o">=</span>yes
www.example.com_USE_REVERSE_PROXY<span class="o">=</span>yes
www.example.com_REVERSE_PROXY_URL<span class="o">=</span>/
www.example.com_REVERSE_PROXY_HOST<span class="o">=</span>http://myapp:8080
</code></pre></div>
<p>You can then reload the <code>bunkerweb-scheduler</code> service to apply the changes.</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>reload<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We will assume that you followed the <a href="#quickstart-guide-__tabbed_1_1">Basic setup</a> and you have the Docker integration running on your machine.</p>
<p>You must then have a network called <code>bw-services</code> so you can connect your existing application and configure BunkerWeb:</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginxdemos/nginx-hello</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
<p>After that, you can create manually add the service in the docker compose file that you created in the previous step.</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">bw-scheduler</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">SERVER_NAME</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;www.example.com&quot;</span><span class="w"> </span><span class="c1"># When using the Docker integration, you can set the configuration directly in the scheduler, make sure to set the correct domain name</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="c1"># Enable multisite mode so you can add multiple services</span>
<span class="w">      </span><span class="nt">www.example.com_USE_REVERSE_PROXY</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">www.example.com_REVERSE_PROXY_URL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
<span class="w">      </span><span class="nt">www.example.com_REVERSE_PROXY_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://myapp:8080&quot;</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p>You can then restart the <code>bw-scheduler</code> service to apply the changes.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>down<span class="w"> </span>bw-scheduler<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>bw-scheduler
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We will assume that you followed the <a href="#quickstart-guide-__tabbed_1_2">Basic setup</a> and you have the Docker autoconf integration running on your machine.</p>
<p>You must then have a network called <code>bw-services</code> so you can connect your existing application and configure BunkerWeb with labels :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginxdemos/nginx-hello</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=www.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://myapp:8080&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
<p>Doing so will automatically create a new service with the provided labels as configuration.</p>
</div>
<div class="tabbed-block">
<p>We will assume that you followed the <a href="#quickstart-guide-__tabbed_1_4">Basic setup</a> and you have the Kubernetes stack running on your cluster.</p>
<p>Let's assume that you have a typical Deployment with a Service to access the web application from within the cluster :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginxdemos/nginx-hello</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div>
<p>Here is the corresponding Ingress definition to serve and protect the web application :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb.io/DUMMY_SETTING</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app</span>
<span class="w">              </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Deprecated</p>
<p>The Swarm integration is deprecated and will be removed in a future release. Please consider using the <a href="#quickstart-guide-__tabbed_2_2">Docker autoconf integration</a> instead.</p>
<p><strong>More information can be found in the <a href="#integrations-swarm">Swarm integration documentation</a>.</strong></p>
</div>
<p>We will assume that you followed the <a href="#quickstart-guide-__tabbed_1_3">Basic setup</a> and you have the Swarm stack running on your cluster and connected to a network called <code>bw-services</code> so you can connect your existing application and configure BunkerWeb with labels :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginxdemos/nginx-hello</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=www.example.com&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://myapp:8080&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="quickstart-guide-going-further">Going further</h2>
<p>Congratulations! You've just installed BunkerWeb and secured your first web service. Please note that BunkerWeb is capable of much more, whether it comes to security or integrations with other systems and solutions. Here's a list of resources and actions that may help you continue to deepen your knowledge of the solution:</p>
<ul>
<li>Join the Bunker community: <a href="https://discord.com/invite/fTf46FmtyD">Discord</a>, <a href="https://www.linkedin.com/company/bunkerity/">LinkedIn</a>, <a href="https://github.com/bunkerity">GitHub</a>, <a href="https://x.com/bunkerity">X</a></li>
<li>Check out the <a href="https://www.bunkerweb.io/blog?utm_campaign=self&amp;utm_source=doc">official blog</a></li>
<li>Explore <a href="#advanced">advanced use cases</a> in the documentation</li>
<li><a href="https://panel.bunkerweb.io/contact.php?utm_campaign=self&amp;utm_source=doc">Get in touch with us</a> to discuss your organization's needs</li>
</ul></section><section class="print-page" id="advanced"><h1 id="advanced-advanced-usages">Advanced usages</h1>
<p>Many real-world use case examples are available in the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/examples">examples</a> folder of the GitHub repository.</p>
<p>We also provide numerous boilerplates, such as YAML files for various integrations and database types. These are available in the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/misc/integrations">misc/integrations</a> folder.</p>
<p>This section only focuses on advanced usages and security tuning, see the <a href="#settings">settings section</a> of the documentation to see all the available settings.</p>
<h2 id="advanced-use-cases">Use cases</h2>
<div class="admonition tip">
<p class="admonition-title">Testing</p>
<p>To perform quick tests when multisite mode is enabled (and if you don't have the proper DNS entries set up for the domains) you can use curl with the HTTP Host header of your choice :
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Host: app1.example.com&quot;</span><span class="w"> </span>http://ip-or-fqdn-of-server
</code></pre></div></p>
<p>If you are using HTTPS, you will need to play with SNI :
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Host: app1.example.com&quot;</span><span class="w"> </span>--resolve<span class="w"> </span>example.com:443:ip-of-server<span class="w"> </span>https://example.com
</code></pre></div></p>
</div>
<h3 id="advanced-behind-load-balancer-or-reverse-proxy">Behind load balancer or reverse proxy</h3>
<div class="admonition info">
<p class="admonition-title">Real IP</p>
<p>When BunkerWeb is itself behind a load balancer or a reverse proxy, you need to configure it so it can get the real IP address of the clients. <strong>If you don't, the security features will block the IP address of the load balancer or reverse proxy instead of the client's one</strong>.</p>
</div>
<p>BunkerWeb actually supports two methods to retrieve the real IP address of the client :</p>
<ul>
<li>Using the <code>PROXY protocol</code></li>
<li>Using a HTTP header like <code>X-Forwarded-For</code></li>
</ul>
<p>The following settings can be used :</p>
<ul>
<li><code>USE_REAL_IP</code> : enable/disable real IP retrieval</li>
<li><code>USE_PROXY_PROTOCOL</code> : enable/disable PROXY protocol support.</li>
<li><code>REAL_IP_FROM</code> : list of trusted IP/network address allowed to send us the "real IP"</li>
<li><code>REAL_IP_HEADER</code> : the HTTP header containing the real IP or special value <code>proxy_protocol</code> when using PROXY protocol</li>
</ul>
<p>You will find more settings about real IP in the <a href="#settings-real-ip">settings section</a> of the documentation.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="advanced-__tabbed_1_1" name="advanced-__tabbed_1" type="radio" /><input id="advanced-__tabbed_1_2" name="advanced-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_1_1">HTTP header</label><label for="advanced-__tabbed_1_2">Proxy protocol</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>We will assume the following regarding the load balancers or reverse proxies (you will need to update the settings depending on your configuration) :</p>
<ul>
<li>They use the <code>X-Forwarded-For</code> header to set the real IP</li>
<li>They have IPs in the <code>1.2.3.0/24</code> and <code>100.64.0.0/10</code> networks</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="2:6"><input checked="checked" id="advanced-__tabbed_2_1" name="advanced-__tabbed_2" type="radio" /><input id="advanced-__tabbed_2_2" name="advanced-__tabbed_2" type="radio" /><input id="advanced-__tabbed_2_3" name="advanced-__tabbed_2" type="radio" /><input id="advanced-__tabbed_2_4" name="advanced-__tabbed_2" type="radio" /><input id="advanced-__tabbed_2_5" name="advanced-__tabbed_2" type="radio" /><input id="advanced-__tabbed_2_6" name="advanced-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_2_1">Web UI</label><label for="advanced-__tabbed_2_2">Linux</label><label for="advanced-__tabbed_2_3">Docker</label><label for="advanced-__tabbed_2_4">Docker autoconf</label><label for="advanced-__tabbed_2_5">Kubernetes</label><label for="advanced-__tabbed_2_6">Swarm</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Navigate to the <strong>Global config</strong> page, select the <strong>Real IP</strong> plugin and fill out the following settings :</p>
<p><figure markdown><img align="center" alt="Real IP settings (header) using web UI" src="../assets/img/advanced-proxy1.png" /><figcaption>Real IP settings (header) using web UI</figcaption></figure></p>
<p>Please note that it's recommended to restart BunkerWeb when you change settings related to real IP.</p>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the <code>/etc/bunkerweb/variables.env</code> file :</p>
<div class="highlight"><pre><span></span><code>...
USE_REAL_IP=yes
REAL_IP_FROM=1.2.3.0/24 100.64.0.0/16
REAL_IP_HEADER=X-Forwarded-For
...
</code></pre></div>
<p>Please note that it's recommended to issue a restart instead of reload when configuring settings related to real IP :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the environment variables of the BunkerWeb container(s) (doing it using the ingress is not supported because you will get into trouble when using things like Let's Encrypt).</p>
<div class="highlight"><pre><span></span><code><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X-Forwarded-For&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p>Please note that if your container is already created, you will need to delete it and recreate it so the new environment variables will be updated.</p>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the environment variables of the BunkerWeb container(s) (doing it using the ingress is not supported because you will get into trouble when using things like Let's Encrypt).</p>
<div class="highlight"><pre><span></span><code><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X-Forwarded-For&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p>Please note that if your container is already created, you will need to delete it and recreate it so the new environment variables will be updated.</p>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the environment variables of the BunkerWeb container(s) (doing it using the ingress is not supported because you will get into trouble when using things like Let's Encrypt).</p>
<p>Here is the corresponding part of your <code>values.yaml</code> file that you can use :</p>
<div class="highlight"><pre><span></span><code><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">extraEnvs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REAL_IP</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_FROM</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_HEADER</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X-Forwarded-For&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Deprecated</p>
<p>The Swarm integration is deprecated and will be removed in a future release. Please consider using the <a href="#advanced-__tabbed_2_2">Docker autoconf integration</a> instead.</p>
<p><strong>More information can be found in the <a href="#integrations-swarm">Swarm integration documentation</a>.</strong></p>
</div>
<p>You will need to add the settings to the environment variables of the BunkerWeb container(s) (doing it using the ingress is not supported because you will get into trouble when using things like Let's Encrypt).</p>
<div class="highlight"><pre><span></span><code><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;X-Forwarded-For&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p>Please note that if your service is already created, you will need to delete it and recreate it so the new environment variables will be updated.</p>
</div>
</div>
</div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Read carefully</p>
<p>Only use the PROXY protocol if you are sure that your load balancer or reverse proxy is sending it. <strong>If you enable it and it's not used, you will get errors</strong>.</p>
</div>
<p>We will assume the following regarding the load balancers or reverse proxies (you will need to update the settings depending on your configuration) :</p>
<ul>
<li>They use the <code>PROXY protocol</code> v1 or v2 to set the real IP</li>
<li>They have IPs in the <code>1.2.3.0/24</code> and <code>100.64.0.0/10</code> networks</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="3:6"><input checked="checked" id="advanced-__tabbed_3_1" name="advanced-__tabbed_3" type="radio" /><input id="advanced-__tabbed_3_2" name="advanced-__tabbed_3" type="radio" /><input id="advanced-__tabbed_3_3" name="advanced-__tabbed_3" type="radio" /><input id="advanced-__tabbed_3_4" name="advanced-__tabbed_3" type="radio" /><input id="advanced-__tabbed_3_5" name="advanced-__tabbed_3" type="radio" /><input id="advanced-__tabbed_3_6" name="advanced-__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_3_1">Web UI</label><label for="advanced-__tabbed_3_2">Linux</label><label for="advanced-__tabbed_3_3">Docker</label><label for="advanced-__tabbed_3_4">Docker autoconf</label><label for="advanced-__tabbed_3_5">Kubernetes</label><label for="advanced-__tabbed_3_6">Swarm</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Navigate to the <strong>Global config</strong> page, select the <strong>Real IP</strong> plugin and fill out the following settings :</p>
<p><figure markdown><img align="center" alt="Real IP settings (PROXY protocol) using web UI" src="../assets/img/advanced-proxy2.png" /><figcaption>Real IP settings (PROXY protocol) using web UI</figcaption></figure></p>
<p>Please note that it's recommended to restart BunkerWeb when you change settings related to real IP.</p>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the <code>/etc/bunkerweb/variables.env</code> file :</p>
<div class="highlight"><pre><span></span><code>...
USE_REAL_IP=yes
USE_PROXY_PROTOCOL=yes
REAL_IP_FROM=1.2.3.0/24 100.64.0.0/16
REAL_IP_HEADER=proxy_protocol
...
</code></pre></div>
<p>Please note that it's recommended to issue a restart instead of reload when configuring settings related to proxy protocols :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the environment variables of the BunkerWeb container(s) (doing it using the ingress is not supported because you will get into trouble when using things like Let's Encrypt).</p>
<div class="highlight"><pre><span></span><code><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">USE_PROXY_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proxy_protocol&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p>Please note that if your container is already created, you will need to delete it and recreate it so the new environment variables will be updated.</p>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the environment variables of the BunkerWeb container(s) (doing it using the ingress is not supported because you will get into trouble when using things like Let's Encrypt).</p>
<div class="highlight"><pre><span></span><code><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">USE_PROXY_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proxy_protocol&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p>Please note that if your container is already created, you will need to delete it and recreate it so the new environment variables will be updated.</p>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the environment variables of the BunkerWeb container(s) (doing it using the ingress is not supported because you will get into trouble when using things like Let's Encrypt).</p>
<p>Here is the corresponding part of your <code>values.yaml</code> file that you can use :</p>
<div class="highlight"><pre><span></span><code><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">extraEnvs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REAL_IP</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_PROXY_PROTOCOL</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_FROM</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REAL_IP_HEADER</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proxy_protocol&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Deprecated</p>
<p>The Swarm integration is deprecated and will be removed in a future release. Please consider using the <a href="#advanced-__tabbed_3_2">Docker autoconf integration</a> instead.</p>
<p><strong>More information can be found in the <a href="#integrations-swarm">Swarm integration documentation</a>.</strong></p>
</div>
<p>You will need to add the settings to the environment variables of the BunkerWeb container(s) (doing it using the ingress is not supported because you will get into trouble when using things like Let's Encrypt).</p>
<div class="highlight"><pre><span></span><code><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">USE_REAL_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">USE_PROXY_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_FROM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3.0/24</span><span class="nv"> </span><span class="s">100.64.0.0/10&quot;</span>
<span class="w">    </span><span class="nt">REAL_IP_HEADER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proxy_protocol&quot;</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p>Please note that if your service is already created, you will need to delete it and recreate it so the new environment variables will be updated.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<h3 id="advanced-custom-configurations">Custom configurations</h3>
<p>To customize and add custom configurations to BunkerWeb, you can take advantage of its NGINX foundation. Custom NGINX configurations can be added in different NGINX contexts, including configurations for the ModSecurity Web Application Firewall (WAF), which is a core component of BunkerWeb. More details about ModSecurity configurations can be found <a href="#advanced-modsecurity">here</a>.</p>
<p>Here are the available types of custom configurations:</p>
<ul>
<li><strong>http</strong>: Configurations at the HTTP level of NGINX.</li>
<li><strong>server-http</strong>: Configurations at the HTTP/Server level of NGINX.</li>
<li><strong>default-server-http</strong>: Configurations at the Server level of NGINX, specifically for the "default server" when the supplied client name doesn't match any server name in <code>SERVER_NAME</code>.</li>
<li><strong>modsec-crs</strong>: Configurations applied before the OWASP Core Rule Set is loaded.</li>
<li><strong>modsec</strong>: Configurations applied after the OWASP Core Rule Set is loaded, or used when the Core Rule Set is not loaded.</li>
<li><strong>stream</strong>: Configurations at the Stream level of NGINX.</li>
<li><strong>server-stream</strong>: Configurations at the Stream/Server level of NGINX.</li>
</ul>
<p>Custom configurations can be applied globally or specifically for a particular server, depending on the applicable context and whether the <a href="#concepts-multisite-mode">multisite mode</a> is enabled.</p>
<p>The method for applying custom configurations depends on the integration being used. However, the underlying process involves adding files with the <code>.conf</code> suffix to specific folders. To apply a custom configuration for a specific server, the file should be placed in a subfolder named after the primary server name.</p>
<p>Some integrations provide more convenient ways to apply configurations, such as using <a href="https://docs.docker.com/engine/swarm/configs/">Configs</a> in Docker Swarm or <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">ConfigMap</a> in Kubernetes. These options offer simpler approaches for managing and applying configurations.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:6"><input checked="checked" id="advanced-__tabbed_4_1" name="advanced-__tabbed_4" type="radio" /><input id="advanced-__tabbed_4_2" name="advanced-__tabbed_4" type="radio" /><input id="advanced-__tabbed_4_3" name="advanced-__tabbed_4" type="radio" /><input id="advanced-__tabbed_4_4" name="advanced-__tabbed_4" type="radio" /><input id="advanced-__tabbed_4_5" name="advanced-__tabbed_4" type="radio" /><input id="advanced-__tabbed_4_6" name="advanced-__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_4_1">Web UI</label><label for="advanced-__tabbed_4_2">Linux</label><label for="advanced-__tabbed_4_3">Docker</label><label for="advanced-__tabbed_4_4">Docker autoconf</label><label for="advanced-__tabbed_4_5">Kubernetes</label><label for="advanced-__tabbed_4_6">Swarm</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Navigate to the <strong>Configs</strong> page, click on <strong>Create new custom config</strong>, you can then choose if it's a global one or specific to a service, the configuration type and the configuration name :</p>
<p><figure markdown><img align="center" alt="Custom configurations using web UI" src="../assets/img/advanced-config.png" /><figcaption>Custom configurations using web UI</figcaption></figure></p>
<p>Don't forget to click on the save button.</p>
</div>
<div class="tabbed-block">
<p>When using the <a href="#integrations-linux">Linux integration</a>, custom configurations must be written to the /etc/bunkerweb/configs folder.</p>
<p>Here is an example for server-http/hello-world.conf :</p>
<div class="highlight"><pre><span></span><code>location /hello {
  default_type &#39;text/plain&#39;;
  content_by_lua_block {
    ngx.say(&#39;world&#39;)
  }
}
</code></pre></div>
<p>Because BunkerWeb runs as an unprivileged user (nginx:nginx), you will need to edit the permissions :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:nginx<span class="w"> </span>/etc/bunkerweb/configs<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>/etc/bunkerweb/configs
</code></pre></div>
<p>Now let's check the status of the Scheduler :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
<p>If they are already running, we can reload it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>reload<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
<p>Otherwise, we will need to start it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#integrations-docker">Docker integration</a>, you have two choices for the addition of custom configurations :</p>
<ul>
<li>Using specific settings <code>*_CUSTOM_CONF_*</code> as environment variables (recommended)</li>
<li>Writing .conf files to the volume mounted on /data of the scheduler</li>
</ul>
<p><strong>Using settings</strong></p>
<p>The settings to use must follow the pattern <code>&lt;SITE&gt;_CUSTOM_CONF_&lt;TYPE&gt;_&lt;NAME&gt;</code> :</p>
<ul>
<li><code>&lt;SITE&gt;</code> : optional primary server name if multisite mode is enabled and the config must be applied to a specific service</li>
<li><code>&lt;TYPE&gt;</code> : the type of config, accepted values are <code>HTTP</code>, <code>DEFAULT_SERVER_HTTP</code>, <code>SERVER_HTTP</code>, <code>MODSEC</code>, <code>MODSEC_CRS</code>, <code>STREAM</code> and <code>SERVER_STREAM</code></li>
<li><code>&lt;NAME&gt;</code> : the name of config without the .conf suffix</li>
</ul>
<p>Here is a dummy example using a docker-compose file :</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">CUSTOM_CONF_SERVER_HTTP_hello-world=</span>
<span class="w">      </span><span class="no">location /hello {</span>
<span class="w">        </span><span class="no">default_type &#39;text/plain&#39;;</span>
<span class="w">        </span><span class="no">content_by_lua_block {</span>
<span class="w">          </span><span class="no">ngx.say(&#39;world&#39;)</span>
<span class="w">          </span><span class="no">}</span>
<span class="w">      </span><span class="no">}</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p><strong>Using files</strong></p>
<p>The first thing to do is to create the folders :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>./bw-data/configs/server-http
</code></pre></div>
<p>You can now write your configurations :</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;location /hello {</span>
<span class="s2">    default_type &#39;text/plain&#39;;</span>
<span class="s2">    content_by_lua_block {</span>
<span class="s2">        ngx.say(&#39;world&#39;)</span>
<span class="s2">    }</span>
<span class="s2">}&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>./bw-data/configs/server-http/hello-world.conf
</code></pre></div>
<p>Because the scheduler runs as an unprivileged user with UID and GID 101, you will need to edit the permissions :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:101<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div>
<p>When starting the scheduler container, you will need to mount the folder on /data :</p>
<div class="highlight"><pre><span></span><code><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./bw-data:/data</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#integrations-docker-autoconf">Docker autoconf integration</a>, you have two choices for adding custom configurations :</p>
<ul>
<li>Using specific settings <code>*_CUSTOM_CONF_*</code> as labels (easiest)</li>
<li>Writing .conf files to the volume mounted on /data of the scheduler</li>
</ul>
<p><strong>Using labels</strong></p>
<div class="admonition warning">
<p class="admonition-title">Limitations using labels</p>
<p>When using labels with the Docker autoconf integration, you can only apply custom configurations for the corresponding web service. Applying <strong>http</strong>, <strong>default-server-http</strong>, <strong>stream</strong> or any global configurations (like <strong>server-http</strong> or <strong>server-stream</strong> for all services) is not possible : you will need to mount files for that purpose.</p>
</div>
<p>The labels to use must follow the pattern <code>bunkerweb.CUSTOM_CONF_&lt;TYPE&gt;_&lt;NAME&gt;</code> :</p>
<ul>
<li><code>&lt;TYPE&gt;</code> : the type of config, accepted values are <code>SERVER_HTTP</code>, <code>MODSEC</code>, <code>MODSEC_CRS</code> and <code>SERVER_STREAM</code></li>
<li><code>&lt;NAME&gt;</code> : the name of config without the .conf suffix</li>
</ul>
<p>Here is a dummy example using a docker-compose file :</p>
<div class="highlight"><pre><span></span><code><span class="nt">myapp</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginxdemos/nginx-hello</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">bunkerweb.CUSTOM_CONF_SERVER_HTTP_hello-world=</span>
<span class="w">      </span><span class="no">location /hello {</span>
<span class="w">        </span><span class="no">default_type &#39;text/plain&#39;;</span>
<span class="w">        </span><span class="no">content_by_lua_block {</span>
<span class="w">            </span><span class="no">ngx.say(&#39;world&#39;)</span>
<span class="w">        </span><span class="no">}</span>
<span class="w">        </span><span class="no">}</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<p><strong>Using files</strong></p>
<p>The first thing to do is to create the folders :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>./bw-data/configs/server-http
</code></pre></div>
<p>You can now write your configurations :</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;location /hello {</span>
<span class="s2">    default_type &#39;text/plain&#39;;</span>
<span class="s2">    content_by_lua_block {</span>
<span class="s2">        ngx.say(&#39;world&#39;)</span>
<span class="s2">    }</span>
<span class="s2">}&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>./bw-data/configs/server-http/hello-world.conf
</code></pre></div>
<p>Because the scheduler runs as an unprivileged user with UID and GID 101, you will need to edit the permissions :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:101<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div>
<p>When starting the scheduler container, you will need to mount the folder on /data :</p>
<div class="highlight"><pre><span></span><code><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./bw-data:/data</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#integrations-kubernetes">Kubernetes integration</a>, custom configurations are managed using <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">ConfigMap</a>.</p>
<p>To keep it simple, you don't even need to use the ConfigMap with a Pod (e.g. as environment variable or volume) : the autoconf Pod is listening for ConfigMap events and will update the custom configurations when needed.</p>
<p>When creating a ConfigMap, you will need to add special labels :</p>
<ul>
<li><strong>bunkerweb.io/CONFIG_TYPE</strong> : must be set to a valid custom configuration type (http, server-http, default-server-http, modsec, modsec-crs, stream or server-stream)</li>
<li><strong>bunkerweb.io/CONFIG_SITE</strong> : set to a server name to apply configuration to that specific server (optional, will be applied globally if unset)</li>
</ul>
<p>Here is the example :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cfg-bunkerweb-all-server-http</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bunkerweb.io/CONFIG_TYPE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;server-http&quot;</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myconf</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">location /hello {</span>
<span class="w">        </span><span class="no">default_type &#39;text/plain&#39;;</span>
<span class="w">        </span><span class="no">content_by_lua_block {</span>
<span class="w">            </span><span class="no">ngx.say(&#39;world&#39;)</span>
<span class="w">        </span><span class="no">}</span>
<span class="w">    </span><span class="no">}</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Custom Extra Config</p>
<p>Since the <code>1.6.0-rc3</code> version, you can add/override settings using the <code>bunkerweb.io/CONFIG_TYPE=settings</code> annotation. Here is an example :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cfg-bunkerweb-extra-settings</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb.io/CONFIG_TYPE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;settings&quot;</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">USE_ANTIBOT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;captcha&quot;</span><span class="w"> </span><span class="c1"># multisite setting that will be applied to all services that do not override it</span>
<span class="w">  </span><span class="nt">USE_REDIS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="c1"># global setting that will be applied globally</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Deprecated</p>
<p>The Swarm integration is deprecated and will be removed in a future release. Please consider using the <a href="#advanced-__tabbed_5_2">Docker autoconf integration</a> instead.</p>
<p><strong>More information can be found in the <a href="#integrations-swarm">Swarm integration documentation</a>.</strong></p>
</div>
<p>When using the <a href="#integrations-swarm">Swarm integration</a>, custom configurations are managed using <a href="https://docs.docker.com/engine/swarm/configs/">Docker Configs</a>.</p>
<p>To keep it simple, you don't even need to attach the Config to a service : the autoconf service is listening for Config events and will update the custom configurations when needed.</p>
<p>When creating a Config, you will need to add special labels :</p>
<ul>
<li><strong>bunkerweb.CONFIG_TYPE</strong> : must be set to a valid custom configuration type (http, server-http, default-server-http, modsec, modsec-crs, stream or server-stream)</li>
<li><strong>bunkerweb.CONFIG_SITE</strong> : set to a server name to apply configuration to that specific server (optional, will be applied globally if unset)</li>
</ul>
<p>Here is the example :</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;location /hello {</span>
<span class="s2">    default_type &#39;text/plain&#39;;</span>
<span class="s2">    content_by_lua_block {</span>
<span class="s2">        ngx.say(&#39;world&#39;)</span>
<span class="s2">    }</span>
<span class="s2">}&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>docker<span class="w"> </span>config<span class="w"> </span>create<span class="w"> </span>-l<span class="w"> </span>bunkerweb.CONFIG_TYPE<span class="o">=</span>server-http<span class="w"> </span>my-config<span class="w"> </span>-
</code></pre></div>
<p>There is no update mechanism : the alternative is to remove an existing config using <code>docker config rm</code> and then recreate it.</p>
</div>
</div>
</div>
<h3 id="advanced-running-many-services-in-production">Running many services in production</h3>
<h4 id="advanced-global-crs">Global CRS</h4>
<div class="admonition warning">
<p class="admonition-title">CRS plugins</p>
<p>When the CRS is loaded globally, <strong>CRS plugins are not supported</strong>. If you need to use them, you will need to load the CRS per service.</p>
</div>
<p>If you use BunkerWeb in production with a large number of services, and you enable the ModSecurity feature globally with CRS rules, the time required to load BunkerWeb configurations may become too long, potentially resulting in a timeout.</p>
<p>The workaround is to load the CRS rules globally rather than per service. This behavior is not enabled by default for backward compatibility reasons and because it has a drawback: if you enable global CRS rule loading, it will no longer be possible to define modsec-crs rules (executed before the CRS rules) on a per-service basis. However, this limitation can be bypassed by writing global <code>modsec-crs</code> exclusion rules like this:</p>
<div class="highlight"><pre><span></span><code>SecRule REQUEST_FILENAME &quot;@rx ^/somewhere$&quot; &quot;nolog,phase:4,allow,id:1010,chain&quot;
SecRule REQUEST_HEADERS:Host &quot;@rx ^app1\.example\.com$&quot; &quot;nolog&quot;
</code></pre></div>
<p>You can enable the global CRS loading by setting <code>USE_MODSECURITY_GLOBAL_CRS</code> to <code>yes</code>.</p>
<h4 id="advanced-adjust-max_allowed_packet-for-mariadbmysql">Adjust max_allowed_packet for MariaDB/MySQL</h4>
<p>It appears that the default value for the <code>max_allowed_packet</code> parameter in MariaDB and MySQL database servers is not sufficient when using BunkerWeb with a large number of services.</p>
<p>If you encounter errors like this, especially on the scheduler:</p>
<div class="highlight"><pre><span></span><code>[Warning] Aborted connection 5 to db: &#39;db&#39; user: &#39;bunkerweb&#39; host: &#39;172.20.0.4&#39; (Got a packet bigger than &#39;max_allowed_packet&#39; bytes)
</code></pre></div>
<p>You will need to increase the <code>max_allowed_packet</code> on your database server.</p>
<h3 id="advanced-persistence-of-bans-and-reports">Persistence of bans and reports</h3>
<p>By default, BunkerWeb stores bans and reports in a local Lua datastore. While simple and efficient, this setup means that data is lost when the instance is restarted. To ensure that bans and reports persist across restarts, you can configure BunkerWeb to use a remote Redis server.</p>
<p><strong>Why Use Redis?</strong></p>
<p>Redis is a powerful, in-memory data store commonly used as a database, cache, and message broker. It is highly scalable and supports a variety of data structures, including:</p>
<ul>
<li><strong>Strings</strong>: Basic key-value pairs.</li>
<li><strong>Hashes</strong>: Field-value pairs within a single key.</li>
<li><strong>Lists</strong>: Ordered collections of strings.</li>
<li><strong>Sets</strong>: Unordered collections of unique strings.</li>
<li><strong>Sorted Sets</strong>: Ordered collections with scores.</li>
</ul>
<p>By leveraging Redis, BunkerWeb can persistently store bans, reports, and cache data, ensuring durability and scalability.</p>
<p><strong>Enabling Redis Support</strong></p>
<p>To enable Redis support, configure the following settings in your BunkerWeb configuration file:</p>
<div class="highlight"><pre><span></span><code># Enable Redis support
USE_REDIS=yes

# Redis server hostname or IP address
REDIS_HOST=&lt;hostname&gt;

# Redis server port number (default: 6379)
REDIS_PORT=6379

# Redis database number (default: 0)
REDIS_DATABASE=0
</code></pre></div>
<ul>
<li><strong><code>USE_REDIS</code></strong>: Set to <code>yes</code> to enable Redis integration.</li>
<li><strong><code>REDIS_HOST</code></strong>: Specify the hostname or IP address of the Redis server.</li>
<li><strong><code>REDIS_PORT</code></strong>: Specify the port number for the Redis server. Defaults to <code>6379</code>.</li>
<li><strong><code>REDIS_DATABASE</code></strong>: Specify the Redis database number to use. Defaults to <code>0</code>.</li>
</ul>
<p>If you require more advanced settings, such as authentication, SSL/TLS support, or Sentinel mode, refer to the <a href="#settings-redis">Redis plugin settings documentation</a> for detailed guidance.</p>
<h3 id="advanced-protect-udptcp-applications">Protect UDP/TCP applications</h3>
<div class="admonition example">
<p class="admonition-title">Experimental feature</p>
<p>This feature is not production-ready. Feel free to test it and report us any bug using <a href="https://github.com/bunkerity/bunkerweb/issues">issues</a> in the GitHub repository.</p>
</div>
<p>BunkerWeb offers the capability to function as a <strong>generic UDP/TCP reverse proxy</strong>, allowing you to protect any network-based applications operating at least on layer 4 of the OSI model. Instead of utilizing the "classical" HTTP module, BunkerWeb leverages the <a href="https://nginx.org/en/docs/stream/ngx_stream_core_module.html">stream module</a> of NGINX.</p>
<p>It's important to note that <strong>not all settings and security features are available when using the stream module</strong>. Additional information on this can be found in the <a href="#settings">settings</a> sections of the documentation.</p>
<p>Configuring a basic reverse proxy is quite similar to the HTTP setup, as it involves using the same settings: <code>USE_REVERSE_PROXY=yes</code> and <code>REVERSE_PROXY_HOST=myapp:9000</code>. Even when BunkerWeb is positioned behind a Load Balancer, the settings remain the same (with <strong>PROXY protocol</strong> being the supported option due to evident reasons).</p>
<p>On top of that, the following specific settings are used :</p>
<ul>
<li><code>SERVER_TYPE=stream</code> : activate <code>stream</code> mode (generic UDP/TCP) instead of <code>http</code> one (which is the default)</li>
<li><code>LISTEN_STREAM_PORT=4242</code> : the listening "plain" (without SSL/TLS) port that BunkerWeb will listen on</li>
<li><code>LISTEN_STREAM_PORT_SSL=4343</code> : the listening "ssl/tls" port that BunkerWeb will listen on</li>
<li><code>USE_UDP=no</code> : listen for and forward UDP packets instead of TCP</li>
</ul>
<p>For complete list of settings regarding <code>stream</code> mode, please refer to the <a href="#settings">settings</a> section of the documentation.</p>
<div class="admonition tip">
<p class="admonition-title">multiple listening ports</p>
<p>Since the <code>1.6.0-rc2</code> version, BunkerWeb supports multiple listening ports for the <code>stream</code> mode. You can specify them using the <code>LISTEN_STREAM_PORT</code> and <code>LISTEN_STREAM_PORT_SSL</code> settings.</p>
<p>Here is an example :</p>
<div class="highlight"><pre><span></span><code>...
LISTEN_STREAM_PORT=4242
LISTEN_STREAM_PORT_SSL=4343
LISTEN_STREAM_PORT_1=4244
LISTEN_STREAM_PORT_SSL_1=4344
...
</code></pre></div>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="5:5"><input checked="checked" id="advanced-__tabbed_5_1" name="advanced-__tabbed_5" type="radio" /><input id="advanced-__tabbed_5_2" name="advanced-__tabbed_5" type="radio" /><input id="advanced-__tabbed_5_3" name="advanced-__tabbed_5" type="radio" /><input id="advanced-__tabbed_5_4" name="advanced-__tabbed_5" type="radio" /><input id="advanced-__tabbed_5_5" name="advanced-__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_5_1">Docker</label><label for="advanced-__tabbed_5_2">Docker autoconf</label><label for="advanced-__tabbed_5_3">Swarm</label><label for="advanced-__tabbed_5_4">Kubernetes</label><label for="advanced-__tabbed_5_5">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>When using Docker integration, the easiest way of protecting existing network applications is to add the services in the <code>bw-services</code> network :</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-bw-api-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-api-env</span>
<span class="w">  </span><span class="c1"># We use an anchor to avoid repeating the same settings for all services</span>
<span class="w">  </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080&quot;</span><span class="w"> </span><span class="c1"># Keep it if you want to use Let&#39;s Encrypt automation when using http challenge type</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;10000:10000&quot;</span><span class="w"> </span><span class="c1"># app1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;20000:20000&quot;</span><span class="w"> </span><span class="c1"># app2</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE=yes&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span><span class="w"> </span><span class="c1"># This setting is mandatory to specify the BunkerWeb instance</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;app1.example.com</span><span class="nv"> </span><span class="s">app2.example.com&quot;</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">USE_REVERSE_PROXY</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="c1"># Will be applied to all services</span>
<span class="w">      </span><span class="nt">SERVER_TYPE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;stream&quot;</span><span class="w"> </span><span class="c1"># Will be applied to all services</span>
<span class="w">      </span><span class="nt">app1.example.com_REVERSE_PROXY_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;myapp1:9000&quot;</span>
<span class="w">      </span><span class="nt">app1.example.com_LISTEN_STREAM_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10000&quot;</span>
<span class="w">      </span><span class="nt">app2.example.com_REVERSE_PROXY_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;myapp2:9000&quot;</span>
<span class="w">      </span><span class="nt">app2.example.com_LISTEN_STREAM_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;20000&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>

<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app1&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app2&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Before running the <a href="#integrations-docker-autoconf">Docker autoconf integration</a> stack on your machine, you will need to edit the ports :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080&quot;</span><span class="w"> </span><span class="c1"># Keep it if you want to use Let&#39;s Encrypt automation when using http challenge type</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;10000:10000&quot;</span><span class="w"> </span><span class="c1"># app1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;20000:20000&quot;</span><span class="w"> </span><span class="c1"># app2</span>
<span class="nn">...</span>
</code></pre></div>
<p>Once the stack is running, you can connect your existing applications to the <code>bw-services</code> network and configure BunkerWeb with labels :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app1&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app1.example.com&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_TYPE=stream&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=myapp1:9000&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.LISTEN_STREAM_PORT=10000&quot;</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app2&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app2.example.com&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_TYPE=stream&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=myapp2:9000&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.LISTEN_STREAM_PORT=20000&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Deprecated</p>
<p>The Swarm integration is deprecated and will be removed in a future release. Please consider using the <a href="#advanced-__tabbed_4_2">Docker autoconf integration</a> instead.</p>
<p><strong>More information can be found in the <a href="#integrations-swarm">Swarm integration documentation</a>.</strong></p>
</div>
<p>Before running the <a href="#integrations-swarm">Swarm integration</a> stack on your machine, you will need to edit the ports :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Keep it if you want to use Let&#39;s Encrypt automation when using http challenge type</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="c1"># app1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="c1"># app2</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20000</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20000</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="nn">...</span>
</code></pre></div>
<p>Once the stack is running, you can connect your existing applications to the <code>bw-services</code> network and configure BunkerWeb with labels :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>

<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app1&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app1.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_TYPE=stream&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=myapp1:9000&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.LISTEN_STREAM_PORT=10000&quot;</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app2&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app2.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_TYPE=stream&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=myapp2:9000&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.LISTEN_STREAM_PORT=20000&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition example">
<p class="admonition-title">Experimental feature</p>
<p>At the moment, <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingresses</a> does not support the <code>stream</code> mode. <strong>What we are doing here is a workaround to make it work.</strong></p>
<p>Feel free to test it and report us any bug using <a href="https://github.com/bunkerity/bunkerweb/issues">issues</a> in the GitHub repository.</p>
</div>
<p>Before running the <a href="#integrations-kubernetes">Kubernetes integration</a> stack on your machine, you will need to open the ports on your load balancer :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"> </span><span class="c1"># Keep it if you want to use Let&#39;s Encrypt automation when using http challenge type</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20000</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20000</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
</code></pre></div>
<p>Once the stack is running, you can create your ingress resources :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">services</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb.io/SERVER_TYPE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;stream&quot;</span><span class="w"> </span><span class="c1"># Will be applied to all services</span>
<span class="w">    </span><span class="nt">bunkerweb.io/app1.example.com_LISTEN_STREAM_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10000&quot;</span>
<span class="w">    </span><span class="nt">bunkerweb.io/app2.example.com_LISTEN_STREAM_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;20000&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1.example.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"> </span><span class="c1"># This isn&#39;t used in stream mode but is required</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app1</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2.example.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"> </span><span class="c1"># This isn&#39;t used in stream mode but is required</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app2</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">services</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">          </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app1&quot;</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app1</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">services</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">services</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio/tcp-echo-server:1.3</span>
<span class="w">          </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;9000&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app2&quot;</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-app2</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">services</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the <code>/etc/bunkerweb/variables.env</code> file :</p>
<div class="highlight"><pre><span></span><code>...
SERVER_NAME=app1.example.com app2.example.com
MULTISITE=yes
USE_REVERSE_PROXY=yes
SERVER_TYPE=stream
app1.example.com_REVERSE_PROXY_HOST=myapp1.domain.or.ip:9000
app1.example.com_LISTEN_STREAM_PORT=10000
app2.example.com_REVERSE_PROXY_HOST=myapp2.domain.or.ip:9000
app2.example.com_LISTEN_STREAM_PORT=20000
...
</code></pre></div>
<p>Now let's check the status of the Scheduler :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
<p>If they are already running, we can reload it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>reload<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
<p>Otherwise, we will need to start it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
</div>
</div>
</div>
<h3 id="advanced-php">PHP</h3>
<div class="admonition example">
<p class="admonition-title">Experimental feature</p>
<p>At the moment, PHP support with BunkerWeb is still in beta and we recommend you use a reverse-proxy architecture if you can. By the way, PHP is not supported at all for some integrations like Kubernetes.</p>
</div>
<p>BunkerWeb supports PHP using external or remote <a href="https://www.php.net/manual/en/install.fpm.php">PHP-FPM</a> instances. We will assume that you are already familiar with managing that kind of services.</p>
<p>The following settings can be used :</p>
<ul>
<li><code>REMOTE_PHP</code> : Hostname of the remote PHP-FPM instance.</li>
<li><code>REMOTE_PHP_PATH</code> : Root folder containing files in the remote PHP-FPM instance.</li>
<li><code>REMOTE_PHP_PORT</code> : Port of the remote PHP-FPM instance (<em>default is 9000</em>).</li>
<li><code>LOCAL_PHP</code> : Path to the local socket file of PHP-FPM instance.</li>
<li><code>LOCAL_PHP_PATH</code> : Root folder containing files in the local PHP-FPM instance.</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="6:5"><input checked="checked" id="advanced-__tabbed_6_1" name="advanced-__tabbed_6" type="radio" /><input id="advanced-__tabbed_6_2" name="advanced-__tabbed_6" type="radio" /><input id="advanced-__tabbed_6_3" name="advanced-__tabbed_6" type="radio" /><input id="advanced-__tabbed_6_4" name="advanced-__tabbed_6" type="radio" /><input id="advanced-__tabbed_6_5" name="advanced-__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_6_1">Docker</label><label for="advanced-__tabbed_6_2">Docker autoconf</label><label for="advanced-__tabbed_6_3">Swarm</label><label for="advanced-__tabbed_6_4">Kubernetes</label><label for="advanced-__tabbed_6_5">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>When using the <a href="#integrations-docker">Docker integration</a>, to support PHP applications, you will need to :</p>
<ul>
<li>Mount your PHP files into the <code>/var/www/html</code> folder of BunkerWeb</li>
<li>Set up a PHP-FPM container for your application and mount the folder containing PHP files</li>
<li>Use the specific settings <code>REMOTE_PHP</code> and <code>REMOTE_PHP_PATH</code> as environment variables when starting BunkerWeb</li>
</ul>
<p>If you enable the <a href="#concepts-multisite-mode">multisite mode</a>, you will need to create separate directories for each of your applications. Each subdirectory should be named using the first value of <code>SERVER_NAME</code>. Here is a dummy example :</p>
<div class="highlight"><pre><span></span><code>www
├── app1.example.com
│   └── index.php
├── app2.example.com
│   └── index.php
└── app3.example.com
    └── index.php

3 directories, 3 files
</code></pre></div>
<p>We will assume that your PHP apps are located into a folder named <code>www</code>. Please note that you will need to fix the permissions so BunkerWeb (UID/GID 101) can at least read files and list folders and PHP-FPM (UID/GID 33 if you use the <code>php:fpm</code> image) is the owner of the files and folders :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">33</span>:101<span class="w"> </span>./www<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>./www<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0640</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>./www<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div>
<p>You can now run BunkerWeb, configure it for your PHP application and also run the PHP apps :</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-bw-api-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-api-env</span>
<span class="w">  </span><span class="c1"># We use an anchor to avoid repeating the same settings for all services</span>
<span class="w">  </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/udp&quot;</span><span class="w"> </span><span class="c1"># QUIC</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www:/var/www/html</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span><span class="w"> </span><span class="c1"># This setting is mandatory to specify the BunkerWeb instance</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;app1.example.com</span><span class="nv"> </span><span class="s">app2.example.com&quot;</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">REMOTE_PHP_PATH</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/app&quot;</span><span class="w"> </span><span class="c1"># Will be applied to all services thanks to the MULTISITE setting</span>
<span class="w">      </span><span class="nt">app1.example.com_REMOTE_PHP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;myapp1&quot;</span>
<span class="w">      </span><span class="nt">app2.example.com_REMOTE_PHP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;myapp2&quot;</span>
<span class="w">      </span><span class="nt">app3.example.com_REMOTE_PHP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;myapp3&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>

<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app1.example.com:/app</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app2.example.com:/app</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">myapp3</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app3.example.com:/app</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition info">
<p class="admonition-title">Multisite mode enabled</p>
<p>The <a href="#integrations-docker-autoconf">Docker autoconf integration</a> integration implies the use of multisite mode : protecting one PHP application is the same as protecting multiple ones.</p>
</div>
<p>When using the <a href="#integrations-docker-autoconf">Docker autoconf integration</a>, to support PHP applications, you will need to :</p>
<ul>
<li>Mount your PHP files into the <code>/var/www/html</code> folder of BunkerWeb</li>
<li>Set up a PHP-FPM containers for your applications and mount the folder containing PHP apps</li>
<li>Use the specific settings <code>REMOTE_PHP</code> and <code>REMOTE_PHP_PATH</code> as labels for your PHP-FPM container</li>
</ul>
<p>Since the Docker autoconf implies using the <a href="#concepts-multisite-mode">multisite mode</a>, you will need to create separate directories for each of your applications. Each subdirectory should be named using the first value of <code>SERVER_NAME</code>. Here is a dummy example :</p>
<div class="highlight"><pre><span></span><code>www
├── app1.example.com
│   └── index.php
├── app2.example.com
│   └── index.php
└── app3.example.com
    └── index.php

3 directories, 3 files
</code></pre></div>
<p>Once the folders are created, copy your files and fix the permissions so BunkerWeb (UID/GID 101) can at least read files and list folders and PHP-FPM (UID/GID 33 if you use the <code>php:fpm</code> image) is the owner of the files and folders :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">33</span>:101<span class="w"> </span>./www<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>./www<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0640</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>./www<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div>
<p>When you start the BunkerWeb autoconf stack, mount the <code>www</code> folder into <code>/var/www/html</code> for the <strong>Scheduler</strong> container :</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-bw-api-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-api-env</span>
<span class="w">  </span><span class="c1"># We use an anchor to avoid repeating the same settings for all services</span>
<span class="w">  </span><span class="nt">AUTOCONF_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">  </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE=yes&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www:/var/www/html</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-api-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1"># We don&#39;t need to specify the BunkerWeb instance here as they are automatically detected by the autoconf service</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1"># The server name will be filled with services labels</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="c1"># Mandatory setting for autoconf</span>
<span class="w">      </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">AUTOCONF_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="nt">DOCKER_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tcp://bw-docker:2375&quot;</span><span class="w"> </span><span class="c1"># The Docker socket</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy:nightly</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">CONTAINERS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warning&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
</code></pre></div>
<p>You can now create your PHP-FPM containers, mount the correct subfolders and use labels to configure BunkerWeb :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app1.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp1</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app1.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp1&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app2.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp2</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app2.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp2&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="w">  </span><span class="nt">myapp3</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app3.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp3</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app3.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp3&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Deprecated</p>
<p>The Swarm integration is deprecated and will be removed in a future release. Please consider using the <a href="#advanced-__tabbed_6_2">Docker autoconf integration</a> instead.</p>
<p><strong>More information can be found in the <a href="#integrations-swarm">Swarm integration documentation</a>.</strong></p>
</div>
<div class="admonition info">
<p class="admonition-title">Multisite mode enabled</p>
<p>The <a href="#integrations-docker-autoconf">Swarm integration</a> integration implies the use of multisite mode : protecting one PHP application is the same as protecting multiple ones.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Shared volume</p>
<p>Using PHP with the Docker Swarm integration needs a shared volume between all BunkerWeb and PHP-FPM instances which is not covered in this documentation.</p>
</div>
<p>When using the <a href="#integrations-docker-autoconf">Docker autoconf integration</a>, to support PHP applications, you will need to :</p>
<ul>
<li>Mount your PHP files into the <code>/var/www/html</code> folder of BunkerWeb</li>
<li>Set up a PHP-FPM containers for your applications and mount the folder containing PHP apps</li>
<li>Use the specific settings <code>REMOTE_PHP</code> and <code>REMOTE_PHP_PATH</code> as labels for your PHP-FPM container</li>
</ul>
<p>Since the Swarm integration implies using the <a href="#concepts-multisite-mode">multisite mode</a>, you will need to create separate directories for each of your applications. Each subdirectory should be named using the first value of <code>SERVER_NAME</code>. Here is a dummy example :</p>
<div class="highlight"><pre><span></span><code>www
├── app1.example.com
│   └── index.php
├── app2.example.com
│   └── index.php
└── app3.example.com
    └── index.php

3 directories, 3 files
</code></pre></div>
<p>As an example, we will consider that you have a shared folder mounted on your worker nodes on the <code>/shared</code> endpoint.</p>
<p>Once the folders are created, copy your files and fix the permissions so BunkerWeb (UID/GID 101) can at least read files and list folders and PHP-FPM (UID/GID 33 if you use the <code>php:fpm</code> image) is the owner of the files and folders :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">33</span>:101<span class="w"> </span>/shared/www<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>/shared/www<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0640</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>/shared/www<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div>
<p>When you start the BunkerWeb stack, mount the <code>/shared/www</code> folder into <code>/var/www/html</code> for the <strong>Scheduler</strong> container :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/shared/www:/var/www/html</span>
<span class="nn">...</span>
</code></pre></div>
<p>You can now create your PHP-FPM services, mount the correct subfolders and use labels to configure BunkerWeb :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">myapp1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app1.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp1</span>
<span class="w">      </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">          </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app1.example.com&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp1&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="w">  </span><span class="nt">myapp2</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app2.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp2</span>
<span class="w">      </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">          </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app2.example.com&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp2&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="w">  </span><span class="nt">myapp3</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:fpm</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./www/app3.example.com:/app</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">            </span><span class="nt">aliases</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp3</span>
<span class="w">      </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">          </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role==worker&quot;</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=app3.example.com&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP=myapp3&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REMOTE_PHP_PATH=/app&quot;</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">PHP is not supported for Kubernetes</p>
<p>Kubernetes integration allows configuration through <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a> and the BunkerWeb controller only supports HTTP applications at the moment.</p>
</div>
</div>
<div class="tabbed-block">
<p>We will assume that you already have the <a href="#integrations-linux">Linux integration</a> stack running on your machine.</p>
<p>By default, BunkerWeb will search for web files inside the <code>/var/www/html</code> folder. You can use it to store your PHP applications. Please note that you will need to configure your PHP-FPM service to get or set the user/group of the running processes and the UNIX socket file used to communicate with BunkerWeb.</p>
<p>First of all, you will need to make sure that your PHP-FPM instance can access the files inside the <code>/var/www/html</code> folder and also that BunkerWeb can access the UNIX socket file in order to communicate with PHP-FPM. We recommend to set a different user like <code>www-data</code> for the PHP-FPM service and to give the nginx group access to the UNIX socket file. Here is corresponding PHP-FPM configuration :</p>
<div class="highlight"><pre><span></span><code><span class="na">...</span>
<span class="k">[www]</span>
<span class="na">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">www-data</span>
<span class="na">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">www-data</span>
<span class="na">listen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/run/php/php-fpm.sock</span>
<span class="na">listen.owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">www-data</span>
<span class="na">listen.group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">nginx</span>
<span class="na">listen.mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0660</span>
<span class="na">...</span>
</code></pre></div>
<p>Don't forget to restart your PHP-FPM service :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>php-fpm
</code></pre></div>
<p>If you enable the <a href="#concepts-multisite-mode">multisite mode</a>, you will need to create separate directories for each of your applications. Each subdirectory should be named using the first value of <code>SERVER_NAME</code>. Here is a dummy example :</p>
<div class="highlight"><pre><span></span><code>/var/www/html
├── app1.example.com
│   └── index.php
├── app2.example.com
│   └── index.php
└── app3.example.com
    └── index.php

3 directories, 3 files
</code></pre></div>
<p>Please note that you will need to fix the permissions so BunkerWeb (group <code>nginx</code>) can at least read files and list folders and PHP-FPM (user <code>www-data</code> but it might be different depending on your system) is the owner of the files and folders :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>www-data:nginx<span class="w"> </span>/var/www/html<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>/var/www/html<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0640</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
find<span class="w"> </span>/var/www/html<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">0750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div>
<p>You can now edit the <code>/etc/bunkerweb/variable.env</code> file :</p>
<div class="highlight"><pre><span></span><code>HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=9.9.9.9 8.8.8.8 8.8.4.4
API_LISTEN_IP=127.0.0.1
MULTISITE=yes
SERVER_NAME=app1.example.com app2.example.com app3.example.com
app1.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app1.example.com_LOCAL_PHP_PATH=/var/www/html/app1.example.com
app2.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app2.example.com_LOCAL_PHP_PATH=/var/www/html/app2.example.com
app3.example.com_LOCAL_PHP=/run/php/php-fpm.sock
app3.example.com_LOCAL_PHP_PATH=/var/www/html/app3.example.com
</code></pre></div>
<p>Now let's check the status of the Scheduler :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
<p>If they are already running, we can reload it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>reload<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
<p>Otherwise, we will need to start it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>bunkerweb-scheduler
</code></pre></div>
</div>
</div>
</div>
<h3 id="advanced-ipv6">IPv6</h3>
<div class="admonition example">
<p class="admonition-title">Experimental feature</p>
<p>This feature is not production-ready. Feel free to test it and report us any bug using <a href="https://github.com/bunkerity/bunkerweb/issues">issues</a> in the GitHub repository.</p>
</div>
<p>By default, BunkerWeb will only listen on IPv4 addresses and won't use IPv6 for network communications. If you want to enable IPv6 support, you need to set <code>USE_IPV6=yes</code>. Please note that IPv6 configuration of your network and environment is out-of-the-scope of this documentation.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="advanced-__tabbed_7_1" name="advanced-__tabbed_7" type="radio" /><input id="advanced-__tabbed_7_2" name="advanced-__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_7_1">Docker / Autoconf / Swarm</label><label for="advanced-__tabbed_7_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>First of all, you will need to configure your Docker daemon to enable IPv6 support for containers and use ip6tables if needed. Here is sample configuration for your <code>/etc/docker/daemon.json</code> file :</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;experimental&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;ipv6&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;ip6tables&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;fixed-cidr-v6&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fd00:dead:beef::/48&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>You can now restart the Docker service to apply the changes :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>docker
</code></pre></div>
<p>Once Docker is setup to support IPv6 you can add the <code>USE_IPV6</code> setting and configure the <code>bw-services</code> for IPv6 :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">USE_IPv6</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>

<span class="nn">...</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">enable_ipv6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fd00:13:37::/48</span>
<span class="w">          </span><span class="nt">gateway</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fd00:13:37::1</span>

<span class="nn">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>You will need to add the settings to the <code>/etc/bunkerweb/variables.env</code> file :</p>
<div class="highlight"><pre><span></span><code>...
USE_IPV6=yes
...
</code></pre></div>
<p>Let's check the status of BunkerWeb :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb
</code></pre></div>
<p>If they are already running, we can restart it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb
</code></pre></div>
<p>Otherwise, we will need to start it :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
</div>
</div>
<h2 id="advanced-security-tuning">Security tuning</h2>
<p>BunkerWeb offers many security features that you can configure with <a href="#settings">settings</a>. Even if the default values of settings ensure a minimal "security by default", we strongly recommend you tune them. By doing so you will be able to ensure the security level of your choice but also manage false positives.</p>
<div class="admonition tip">
<p class="admonition-title">Other settings</p>
<p>This section only focuses on security tuning, see the <a href="#settings">settings section</a> of the documentation for other settings.</p>
</div>
<figure>
<p><img align="center" alt="Overview" src="../assets/img/core-order.svg" />
  </p>
<figcaption>Overview and order of the core security plugins</figcaption>
</figure>
<h3 id="advanced-security-mode">Security Mode</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>The <strong>Security Mode</strong> setting determines how BunkerWeb handles detected threats. This flexible feature allows you to choose between monitoring or actively blocking suspicious activity, depending on their specific needs.</p>
<ul>
<li><strong><code>detect</code></strong>: Logs potential threats without blocking access. This mode is useful for identifying and analyzing false positives in a safe, non-disruptive manner.</li>
<li><strong><code>block</code></strong> (default): Actively blocks detected threats while logging incidents to prevent unauthorized access and protect your application.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Detect mode</p>
<p>Switching to <code>detect</code> mode can help you identify and resolve potential false positives without disrupting legitimate clients. Once these issues are addressed, you can confidently switch back to <code>block</code> mode for full protection.</p>
</div>
<h3 id="advanced-http-protocol">HTTP protocol</h3>
<h4 id="advanced-deny-status-code">Deny status code</h4>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /></p>
<p>The first step in handling denied client access is defining the appropriate action. This can be configured using the <code>DENY_HTTP_STATUS</code> setting, which supports the following values:</p>
<ul>
<li><strong><code>403</code></strong>: Sends a standard "Forbidden" HTTP status code. A web page or custom content will be displayed to the client.</li>
<li><strong><code>444</code></strong>: Silently closes the connection without displaying any web page or custom content.</li>
</ul>
<p>The default value is <code>403</code>. Setting it to <code>444</code> is recommended only if you have thoroughly addressed false positives, are experienced with BunkerWeb, and require a higher level of security.</p>
<p>In <strong>stream mode</strong>, this setting is always enforced as <code>444</code>, meaning the connection will be closed, regardless of the configured value.</p>
<h4 id="advanced-default-server">Default server</h4>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /></p>
<p>In the HTTP protocol, the <code>Host</code> header specifies the server the client intends to contact. However, this header is optional and may be missing or set to an unknown value. This scenario is common, as many bots scan the internet to exploit services or perform fingerprinting.</p>
<p>To block requests with undefined or unknown <code>Host</code> values, you can enable the <code>DISABLE_DEFAULT_SERVER</code> setting by setting it to <code>yes</code> (default: <code>no</code>). When enabled, such requests are silently denied by closing the TCP connection using NGINX's special <code>444</code> status code, meaning no response is sent to the client.</p>
<p>For stricter security, you can also close SSL/TLS connections when the <a href="https://en.wikipedia.org/wiki/Server_Name_Indication">Server Name Indication (SNI)</a> is undefined or unknown by setting <code>DISABLE_DEFAULT_SERVER_STRICT_SNI</code> to <code>yes</code> (default: <code>no</code>). This approach blocks attackers at the SSL/TLS level. However, it may cause issues if your BunkerWeb instance is behind a reverse proxy that forwards HTTPS requests without SNI.</p>
<h4 id="advanced-allowed-methods">Allowed methods</h4>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>You can define the allowed HTTP methods using the <code>ALLOWED_METHODS</code> setting, listing them separated by a <code>|</code> (default: <code>GET|POST|HEAD</code>). If a client sends a request using a method not listed, they will receive a <strong>405 - Method Not Allowed</strong> response.</p>
<div class="admonition abstract">
<p class="admonition-title">CORS requests</p>
<p>You should also include <code>OPTIONS</code> to accommodate CORS pre-flight requests if needed.</p>
</div>
<h4 id="advanced-max-sizes">Max sizes</h4>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>The maximum request body size can be controlled using the <code>MAX_CLIENT_SIZE</code> setting (default: <code>10m</code>). Accepted values follow the syntax described <a href="https://nginx.org/en/docs/syntax.html">here</a>.</p>
<p>To allow a request body of unlimited size, you can use the special value <code>0</code> (not recommended for security and performance reasons).</p>
<h4 id="advanced-serve-files">Serve files</h4>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>To prevent serving files from the <code>www</code> folder, set the <code>SERVE_FILES</code> option to <code>no</code> (default: <code>yes</code>). Using <code>no</code> is recommended if BunkerWeb is configured as a reverse proxy.</p>
<h4 id="advanced-headers">Headers</h4>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Headers play a crucial role in HTTP security. While some headers may be overly verbose, others might require enhanced verbosity to ensure better security, particularly on the client side.</p>
<h5 id="advanced-remove-headers">Remove headers</h5>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>You can use the <code>REMOVE_HEADERS</code> setting to automatically remove specific verbose headers from HTTP responses. By default, it removes the following headers: <code>Server</code>, <code>Expect-CT</code>, <code>X-Powered-By</code>, <code>X-AspNet-Version</code>, <code>X-AspNetMvc-Version</code> and <code>Public-Key-Pins</code>.</p>
<p>Headers to be removed should be listed and separated by spaces.</p>
<h5 id="advanced-keep-upstream-headers">Keep upstream headers</h5>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>The <code>KEEP_UPSTREAM_HEADERS</code> setting allows you to preserve specific headers from upstream servers, ensuring that BunkerWeb does not override them in HTTP responses.</p>
<ul>
<li>By default, it includes the headers: <code>Content-Security-Policy</code>, <code>Permissions-Policy</code>, and <code>X-Frame-Options</code>.</li>
<li>To preserve all headers from the upstream server, use the special value <code>*</code>.</li>
</ul>
<p>Headers to be preserved must be listed and separated by spaces.</p>
<h5 id="advanced-cookies">Cookies</h5>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Cookie security is <strong>critical</strong> for protecting user data and ensuring application security. Misconfigured cookies can expose sensitive information, making them a potential target for attacks such as Cross-Site Scripting (XSS) or Cross-Site Request Forgery (CSRF).</p>
<p>To strengthen cookie security, you can use the following flags:</p>
<ul>
<li><strong>HttpOnly</strong>: Prevents access to cookies via JavaScript using <code>document.cookie</code>, mitigating XSS risks.</li>
<li><strong>SameSite</strong>: Restricts cookie sharing policies for requests originating from third-party websites, reducing CSRF vulnerabilities.</li>
<li><strong>Secure</strong>: Ensures cookies are sent only over secure HTTPS connections, protecting them from being intercepted.</li>
</ul>
<p>You can configure these flags using the <code>COOKIE_FLAGS</code> setting (default: <code>* HttpOnly SameSite=Lax</code>). Refer to <a href="https://github.com/AirisX/nginx_cookie_flag_module">this guide</a> for accepted values.</p>
<p>To further enhance security, the <code>Secure</code> flag can be applied automatically for HTTPS requests by enabling the <code>COOKIE_AUTO_SECURE_FLAG</code> setting (default: <code>yes</code>).</p>
<div class="admonition danger">
<p class="admonition-title">Important</p>
<p>Disabling the <code>COOKIE_AUTO_SECURE_FLAG</code> setting may expose your cookies to interception over insecure HTTP connections.</p>
</div>
<h5 id="advanced-security-headers">Security headers</h5>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p><strong>Security headers are a fundamental aspect of web application security</strong>, helping protect against a wide range of vulnerabilities, including XSS, clickjacking, and other attacks. BunkerWeb simplifies the process by allowing you to configure these headers through its settings. Below is a list of key security headers, along with their corresponding settings and default values:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Header</th>
<th style="text-align: left;">Setting</th>
<th style="text-align: center;">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>Content-Security-Policy</code></td>
<td style="text-align: left;"><code>CONTENT_SECURITY_POLICY</code></td>
<td style="text-align: center;"><code>object-src 'none'; form-action 'self'; frame-ancestors 'self';</code></td>
</tr>
<tr>
<td style="text-align: center;"><code>Strict-Transport-Security</code></td>
<td style="text-align: left;"><code>STRICT_TRANSPORT_SECURITY</code></td>
<td style="text-align: center;"><code>mmax-age=63072000; includeSubDomains; preload</code></td>
</tr>
<tr>
<td style="text-align: center;"><code>Referrer-Policy</code></td>
<td style="text-align: left;"><code>REFERRER_POLICY</code></td>
<td style="text-align: center;"><code>strict-origin-when-cross-origin</code></td>
</tr>
<tr>
<td style="text-align: center;"><code>Permissions-Policy</code></td>
<td style="text-align: left;"><code>PERMISSIONS_POLICY</code></td>
<td style="text-align: center;"><code>accelerometer=(), ambient-light-sensor=(), attribution-reporting=(), autoplay=(), battery=(), bluetooth=(), browsing-topics=(), camera=(), compute-pressure=(), display-capture=(), encrypted-media=(), execution-while-not-rendered=(), execution-while-out-of-viewport=(), fullscreen=(), gamepad=(), geolocation=(), gyroscope=(), hid=(), identity-credentials-get=(), idle-detection=(), local-fonts=(), magnetometer=(), microphone=(), midi=(), otp-credentials=(), payment=(), picture-in-picture=(), publickey-credentials-create=(), publickey-credentials-get=(), screen-wake-lock=(), serial=(), speaker-selection=(), storage-access=(), usb=(), web-share=(), window-management=(), xr-spatial-tracking=(), interest-cohort=()</code></td>
</tr>
<tr>
<td style="text-align: center;"><code>X-Frame-Options</code></td>
<td style="text-align: left;"><code>X_FRAME_OPTIONS</code></td>
<td style="text-align: center;"><code>SAMEORIGIN</code></td>
</tr>
<tr>
<td style="text-align: center;"><code>X-Content-Type-Options</code></td>
<td style="text-align: left;"><code>X_CONTENT_TYPE_OPTIONS</code></td>
<td style="text-align: center;"><code>nosniff</code></td>
</tr>
<tr>
<td style="text-align: center;"><code>X-DNS-Prefetch-Control</code></td>
<td style="text-align: left;"><code>X_DNS_PREFETCH_CONTROL</code></td>
<td style="text-align: center;"><code>off</code></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">About Security Headers</p>
<p>Security headers are a <strong>first line of defense</strong> against malicious actors. Properly configuring them can drastically reduce the attack surface of your application. Use the BunkerWeb settings to fine-tune these headers and ensure your application adheres to the highest security standards.</p>
</div>
<h5 id="advanced-cors">CORS</h5>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">Cross-Origin Resource Sharing (CORS)</a> lets you control which origins can access your service and how they can do so.</p>
<p>To enable CORS:
1. Include the <code>OPTIONS</code> HTTP method in the <code>ALLOWED_METHODS</code> setting to support pre-flight requests.
2. Configure the necessary CORS headers for proper handling of requests.</p>
<p>Here is a list of settings related to CORS:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_CORS</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use CORS</td>
</tr>
<tr>
<td><code>CORS_ALLOW_ORIGIN</code></td>
<td><code>self</code></td>
<td>multisite</td>
<td>no</td>
<td>Allowed origins to make CORS requests : PCRE regex or * or self (for the same origin).</td>
</tr>
<tr>
<td><code>CORS_ALLOW_METHODS</code></td>
<td><code>GET, POST, OPTIONS</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Allow-Methods header.</td>
</tr>
<tr>
<td><code>CORS_ALLOW_HEADERS</code></td>
<td><code>DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Allow-Headers header.</td>
</tr>
<tr>
<td><code>CORS_ALLOW_CREDENTIALS</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Send the Access-Control-Allow-Credentials header.</td>
</tr>
<tr>
<td><code>CORS_EXPOSE_HEADERS</code></td>
<td><code>Content-Length,Content-Range</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Expose-Headers header.</td>
</tr>
<tr>
<td><code>CROSS_ORIGIN_OPENER_POLICY</code></td>
<td><code>same-origin</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Cross-Origin-Opener-Policy header.</td>
</tr>
<tr>
<td><code>CROSS_ORIGIN_EMBEDDER_POLICY</code></td>
<td><code>require-corp</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Cross-Origin-Embedder-Policy header.</td>
</tr>
<tr>
<td><code>CROSS_ORIGIN_RESOURCE_POLICY</code></td>
<td><code>same-site</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Cross-Origin-Resource-Policy header.</td>
</tr>
<tr>
<td><code>CORS_MAX_AGE</code></td>
<td><code>86400</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Max-Age header.</td>
</tr>
<tr>
<td><code>CORS_DENY_REQUEST</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Deny request and don't send it to backend if Origin is not allowed.</td>
</tr>
</tbody>
</table>
<p>Here are examples of possible values for the <code>CORS_ALLOW_ORIGIN</code> setting, along with their behavior:</p>
<ul>
<li><strong><code>*</code></strong>: Allows requests from all origins.</li>
<li><strong><code>self</code></strong>: Automatically allows requests from the same origin as the server_name configured.</li>
<li><strong><code>^https://www\.example\.com$</code></strong>: Allows requests only from <code>https://www.example.com</code>.</li>
<li><strong><code>^https://.+\.example\.com$</code></strong>: Allows requests from any subdomain ending with <code>.example.com</code>.</li>
<li><strong><code>^https://(www\.example1\.com|www\.example2\.com)$</code></strong>: Allows requests from either <code>https://www.example1.com</code> or <code>https://www.example2.com</code>.</li>
<li><strong><code>^https?://www\.example\.com$</code></strong>: Allows requests from both <code>https://www.example.com</code> and <code>http://www.example.com</code>.</li>
</ul>
<p>Helpful resources for configuring CORS settings:</p>
<ul>
<li><strong>Cross-Origin-Opener-Policy</strong>: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Opener-Policy">MDN Documentation</a></li>
<li><strong>Cross-Origin-Embedder-Policy</strong>: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Embedder-Policy">MDN Documentation</a></li>
<li><strong>Cross-Origin-Resource-Policy</strong>: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Resource-Policy">MDN Documentation</a></li>
</ul>
<p>These examples and resources will help you configure CORS policies effectively, ensuring secure and controlled access to your service.</p>
<h4 id="advanced-compression-algorithms">Compression algorithms</h4>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Compression algorithms in BunkerWeb, such as Brotli and Gzip, optimize performance by reducing the size of HTTP responses. These algorithms help save bandwidth and improve loading times for end-users.</p>
<h5 id="advanced-brotli">Brotli</h5>
<p>The <strong>Brotli</strong> algorithm provides higher compression rates compared to Gzip, making it ideal for modern web applications.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BROTLI</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable or disable Brotli compression.</td>
</tr>
<tr>
<td><code>BROTLI_TYPES</code></td>
<td><code>application/atom+xml application/javascript application/json application/rss+xml application/vnd.ms-fontobject application/x-font-opentype application/x-font-truetype application/x-font-ttf application/x-javascript application/xhtml+xml application/xml font/eot font/opentype font/otf font/truetype image/svg+xml image/vnd.microsoft.icon image/x-icon image/x-win-bitmap text/css text/javascript text/plain text/xml</code></td>
<td>multisite</td>
<td>no</td>
<td>List of MIME types that will be compressed with brotli.</td>
</tr>
<tr>
<td><code>BROTLI_MIN_LENGTH</code></td>
<td><code>1000</code></td>
<td>multisite</td>
<td>no</td>
<td>Minimum response size (in bytes) for Brotli compression to apply.</td>
</tr>
<tr>
<td><code>BROTLI_COMP_LEVEL</code></td>
<td><code>6</code></td>
<td>multisite</td>
<td>no</td>
<td>Compression level for Brotli (0 = no compression, 11 = maximum compression).</td>
</tr>
</tbody>
</table>
<h5 id="advanced-gzip">Gzip</h5>
<p>The <strong>Gzip</strong> algorithm is widely supported and ensures compatibility with older clients.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_GZIP</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable or disable Gzip compression.</td>
</tr>
<tr>
<td><code>GZIP_TYPES</code></td>
<td><code>application/atom+xml application/javascript application/json application/rss+xml application/vnd.ms-fontobject application/x-font-opentype application/x-font-truetype application/x-font-ttf application/x-javascript application/xhtml+xml application/xml font/eot font/opentype font/otf font/truetype image/svg+xml image/vnd.microsoft.icon image/x-icon image/x-win-bitmap text/css text/javascript text/plain text/xml</code></td>
<td>multisite</td>
<td>no</td>
<td>List of MIME types that will be compressed with gzip.</td>
</tr>
<tr>
<td><code>GZIP_MIN_LENGTH</code></td>
<td><code>1000</code></td>
<td>multisite</td>
<td>no</td>
<td>Minimum response size (in bytes) for Gzip compression to apply.</td>
</tr>
<tr>
<td><code>GZIP_COMP_LEVEL</code></td>
<td><code>5</code></td>
<td>multisite</td>
<td>no</td>
<td>Compression level for Gzip (1 = least compression, 9 = maximum compression).</td>
</tr>
<tr>
<td><code>GZIP_PROXIED</code></td>
<td><code>no-cache no-store private expired auth</code></td>
<td>multisite</td>
<td>no</td>
<td>Specifies which proxied requests should be compressed.</td>
</tr>
</tbody>
</table>
<p><strong>Choosing the Right Algorithm</strong>:</p>
<ul>
<li><strong>Brotli</strong>: Provides better compression rates, suitable for modern browsers and applications where reducing payload size is a priority.</li>
<li><strong>Gzip</strong>: Offers broader compatibility and is ideal for environments with older clients.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Optimizing Compression Settings</p>
<p>Properly configuring MIME types and compression levels helps balance performance gains with resource usage.</p>
</div>
<h3 id="advanced-https-ssltls">HTTPS / SSL/TLS</h3>
<p>Strong SSL/TLS certificates are <strong>essential</strong> for ensuring secure communication between clients and your server. They protect sensitive data from being intercepted or tampered with and are a fundamental component of a secure HTTPS setup.</p>
<p>Ensuring your SSL/TLS certificates are strong, up-to-date, and properly configured is critical to safeguarding your application and building trust with your users. Combine these settings with a robust HTTPS/SSL/TLS setup for maximum protection.</p>
<p>In addition to configuring HTTPS and SSL/TLS protocols, the following settings can be customized to enhance your security:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Setting</th>
<th style="text-align: center;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>REDIRECT_HTTP_TO_HTTPS</code></td>
<td style="text-align: center;"><code>no</code></td>
<td style="text-align: left;">When set to <code>yes</code>, will redirect every HTTP request to HTTPS even if BunkerWeb is not configured with HTTPS.</td>
</tr>
<tr>
<td style="text-align: center;"><code>AUTO_REDIRECT_HTTP_TO_HTTPS</code></td>
<td style="text-align: center;"><code>yes</code></td>
<td style="text-align: left;">When set to <code>yes</code>, will redirect every HTTP request to HTTPS only if BunkerWeb is configured with HTTPS.</td>
</tr>
<tr>
<td style="text-align: center;"><code>SSL_PROTOCOLS</code></td>
<td style="text-align: center;"><code>TLSv1.2 TLSv1.3</code></td>
<td style="text-align: left;">List of supported SSL/TLS protocols when SSL is enabled.</td>
</tr>
<tr>
<td style="text-align: center;"><code>HTTP2</code></td>
<td style="text-align: center;"><code>yes</code></td>
<td style="text-align: left;">When set to <code>yes</code>, will enable HTTP2 protocol support when using HTTPS.</td>
</tr>
<tr>
<td style="text-align: center;"><code>HTTP3</code></td>
<td style="text-align: center;"><code>no</code></td>
<td style="text-align: left;">When set to <code>yes</code>, will enable HTTP3 protocol support when using HTTPS.</td>
</tr>
<tr>
<td style="text-align: center;"><code>HTTP3_ALT_SVC_PORT</code></td>
<td style="text-align: center;"><code>443</code></td>
<td style="text-align: left;">HTTP3 alternate service port. This value will be used as part of the Alt-Svc header.</td>
</tr>
<tr>
<td style="text-align: center;"><code>LISTEN_HTTP</code></td>
<td style="text-align: center;"><code>yes</code></td>
<td style="text-align: left;">When set to <code>no</code>, BunkerWeb will not listen for HTTP requests. Useful if you want HTTPS only for example.</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">About HTTP3</p>
<p>HTTP/3 is the latest iteration of the Hypertext Transfer Protocol, designed to enhance web performance and security. Unlike its predecessors, HTTP/1.1 and HTTP/2, which rely on the Transmission Control Protocol (TCP), HTTP/3 utilizes QUIC—a transport layer protocol developed by Google that operates over the User Datagram Protocol (UDP). This shift addresses issues like head-of-line blocking in TCP, leading to faster and more reliable connections.</p>
<p>NGINX introduced experimental support for QUIC and HTTP/3 starting from version 1.25.0. However, <strong>this support is still in the experimental stage, and caution is advised when deploying it in production environments</strong>. For more details, refer to <a href="https://nginx.org/en/docs/quic.html">NGINX's official documentation</a>.</p>
<p>Given the experimental nature of HTTP/3 support in NGINX, it may not be suitable for all use cases. Thorough testing is recommended before enabling it in a production setting.</p>
</div>
<h4 id="advanced-lets-encrypt">Let's Encrypt</h4>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>BunkerWeb offers automatic Let's Encrypt certificate generation and renewal, making it simple to secure your web applications with HTTPS / SSL/TLS. Let’s Encrypt is a free, automated, and widely trusted Certificate Authority (CA) that provides SSL/TLS certificates to enable encrypted communication.</p>
<div class="admonition info">
<p class="admonition-title">Prerequisites</p>
<p>To use this feature, ensure proper DNS <strong>A records</strong> are set up for each domain, pointing to the public IP(s) where BunkerWeb is accessible.</p>
</div>
<p>Below is the list of related settings:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Setting</th>
<th style="text-align: center;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>AUTO_LETS_ENCRYPT</code></td>
<td style="text-align: center;"><code>no</code></td>
<td style="text-align: left;">When set to <code>yes</code>, HTTPS / SSL/TLS will be enabled with automatic certificate generation and renewal from Let's Encrypt.</td>
</tr>
<tr>
<td style="text-align: center;"><code>EMAIL_LETS_ENCRYPT</code></td>
<td style="text-align: center;"><code>contact@{FIRST_SERVER}</code></td>
<td style="text-align: left;">Email to use when generating certificates. Let's Encrypt will send notifications to that email like certificate expiration.</td>
</tr>
<tr>
<td style="text-align: center;"><code>LETS_ENCRYPT_CHALLENGE</code></td>
<td style="text-align: center;"><code>http</code></td>
<td style="text-align: left;">The challenge type to use for Let's Encrypt (http or dns).</td>
</tr>
<tr>
<td style="text-align: center;"><code>LETS_ENCRYPT_DNS_PROVIDER</code></td>
<td style="text-align: center;"></td>
<td style="text-align: left;">The DNS provider to use for DNS challenges.</td>
</tr>
<tr>
<td style="text-align: center;"><code>LETS_ENCRYPT_DNS_PROPAGATION</code></td>
<td style="text-align: center;"><code>default</code></td>
<td style="text-align: left;">The time to wait for DNS propagation in seconds for DNS challenges.</td>
</tr>
<tr>
<td style="text-align: center;"><code>LETS_ENCRYPT_DNS_CREDENTIAL_ITEM</code></td>
<td style="text-align: center;"></td>
<td style="text-align: left;">Configuration item that will be added to the credentials.ini file for the DNS provider (e.g. 'cloudflare_api_token 123456') for DNS challenges.</td>
</tr>
<tr>
<td style="text-align: center;"><code>USE_LETS_ENCRYPT_WILDCARD</code></td>
<td style="text-align: center;"><code>no</code></td>
<td style="text-align: left;">Create wildcard certificates for all domains. This allows a single certificate to secure multiple subdomains. (Only available with DNS challenges)</td>
</tr>
<tr>
<td style="text-align: center;"><code>USE_LETS_ENCRYPT_STAGING</code></td>
<td style="text-align: center;"><code>no</code></td>
<td style="text-align: left;">Use the staging environment for Let’s Encrypt certificate generation. Useful when you are testing your deployments to avoid being rate limited in the production environment.</td>
</tr>
<tr>
<td style="text-align: center;"><code>LETS_ENCRYPT_CLEAR_OLD_CERTS</code></td>
<td style="text-align: center;"><code>no</code></td>
<td style="text-align: left;">Clear old certificates when renewing.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Information and behavior</p>
<ul>
<li>
<p>The <code>LETS_ENCRYPT_DNS_CREDENTIAL_ITEM</code> setting is a multiple setting and can be used to set multiple items for the DNS provider. The items will be saved as a cache file and Certbot will read the credentials from it.</p>
</li>
<li>
<p>If no <code>LETS_ENCRYPT_DNS_PROPAGATION</code> setting is set, the provider's default propagation time will be used.</p>
</li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Wildcard certificates</p>
<p>Wildcard certificates are only available with DNS challenges. If you want to use them, you will need to set the <code>USE_LETS_ENCRYPT_WILDCARD</code> setting to <code>yes</code>.</p>
</div>
<h5 id="advanced-available-dns-providers">Available DNS Providers</h5>
<table>
<thead>
<tr>
<th>Provider</th>
<th>Description</th>
<th>Mandatory Settings</th>
<th>Optional Settings</th>
<th>Link(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cloudflare</code></td>
<td>Cloudflare</td>
<td><code>api_token</code></td>
<td></td>
<td><a href="https://certbot-dns-cloudflare.readthedocs.io/en/stable/">Documentation</a></td>
</tr>
<tr>
<td><code>desec</code></td>
<td>deSEC</td>
<td><code>token</code></td>
<td></td>
<td><a href="https://github.com/desec-io/certbot-dns-desec/blob/main/README.md">Documentation</a></td>
</tr>
<tr>
<td><code>digitalocean</code></td>
<td>DigitalOcean</td>
<td><code>token</code></td>
<td></td>
<td><a href="https://certbot-dns-digitalocean.readthedocs.io/en/stable/">Documentation</a></td>
</tr>
<tr>
<td><code>dnsimple</code></td>
<td>DNSimple</td>
<td><code>token</code></td>
<td></td>
<td><a href="https://certbot-dns-dnsimple.readthedocs.io/en/stable/">Documentation</a></td>
</tr>
<tr>
<td><code>dnsmadeeasy</code></td>
<td>DNS Made Easy</td>
<td><code>api_key</code><br><code>secret_key</code></td>
<td></td>
<td><a href="https://certbot-dns-dnsmadeeasy.readthedocs.io/en/stable/">Documentation</a></td>
</tr>
<tr>
<td><code>gehirn</code></td>
<td>Gehirn DNS</td>
<td><code>api_token</code><br><code>api_secret</code></td>
<td></td>
<td><a href="https://certbot-dns-gehirn.readthedocs.io/en/stable/">Documentation</a></td>
</tr>
<tr>
<td><code>google</code></td>
<td>Google Cloud</td>
<td><code>project_id</code><br><code>private_key_id</code><br><code>private_key</code><br><code>client_email</code><br><code>client_id</code><br><code>client_x509_cert_url</code></td>
<td><code>type</code> (default: <code>service_account</code>)<br><code>auth_uri</code> (default: <code>https://accounts.google.com/o/oauth2/auth</code>)<br><code>token_uri</code> (default: <code>https://accounts.google.com/o/oauth2/token</code>)<br><code>auth_provider_x509_cert_url</code> (default: <code>https://www.googleapis.com/oauth2/v1/certs</code>)</td>
<td><a href="https://certbot-dns-google.readthedocs.io/en/stable/">Documentation</a></td>
</tr>
<tr>
<td><code>linode</code></td>
<td>Linode</td>
<td><code>key</code></td>
<td></td>
<td><a href="https://certbot-dns-linode.readthedocs.io/en/stable/">Documentation</a></td>
</tr>
<tr>
<td><code>luadns</code></td>
<td>LuaDNS</td>
<td><code>email</code><br><code>token</code></td>
<td></td>
<td><a href="https://certbot-dns-luadns.readthedocs.io/en/stable/">Documentation</a></td>
</tr>
<tr>
<td><code>nsone</code></td>
<td>NS1</td>
<td><code>api_key</code></td>
<td></td>
<td><a href="https://certbot-dns-nsone.readthedocs.io/en/stable/">Documentation</a></td>
</tr>
<tr>
<td><code>ovh</code></td>
<td>OVH</td>
<td><code>application_key</code><br><code>application_secret</code><br><code>consumer_key</code></td>
<td><code>endpoint</code> (default: <code>ovh-eu</code>)</td>
<td><a href="https://certbot-dns-ovh.readthedocs.io/en/stable/">Documentation</a></td>
</tr>
<tr>
<td><code>rfc2136</code></td>
<td>RFC 2136</td>
<td><code>server</code><br><code>name</code><br><code>secret</code></td>
<td><code>port</code> (default: <code>53</code>)<br><code>algorithm</code> (default: <code>HMAC-SHA512</code>)<br><code>sign_query</code> (default: <code>false</code>)</td>
<td><a href="https://certbot-dns-rfc2136.readthedocs.io/en/stable/">Documentation</a></td>
</tr>
<tr>
<td><code>route53</code></td>
<td>Amazon Route 53</td>
<td><code>access_key_id</code><br><code>secret_access_key</code></td>
<td></td>
<td><a href="https://certbot-dns-route53.readthedocs.io/en/stable/">Documentation</a></td>
</tr>
<tr>
<td><code>sakuracloud</code></td>
<td>Sakura Cloud</td>
<td><code>api_token</code><br><code>api_secret</code></td>
<td></td>
<td><a href="https://certbot-dns-sakuracloud.readthedocs.io/en/stable/">Documentation</a></td>
</tr>
<tr>
<td><code>scaleway</code></td>
<td>Scaleway</td>
<td><code>application_token</code></td>
<td></td>
<td><a href="https://github.com/vanonox/certbot-dns-scaleway/blob/main/README.rst">Documentation</a></td>
</tr>
</tbody>
</table>
<p>Full Let's Encrypt automation using the <code>http</code> challenge is fully working with stream mode as long as you open the <code>80/tcp</code> port from the outside. Please note that you will need to use the <code>LISTEN_STREAM_PORT_SSL</code> setting in order to choose your listening SSL/TLS port.</p>
<h4 id="advanced-custom-certificates">Custom certificates</h4>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>BunkerWeb also allows you to use your own custom SSL/TLS certificates, providing flexibility for advanced use cases or specific organizational requirements. This feature is ideal for scenarios where you need to use certificates issued by a specific Certificate Authority (CA) or self-signed certificates for internal purposes.</p>
<p>Below is the list of related settings to configure your own certificates:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_CUSTOM_SSL</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use custom HTTPS / SSL/TLS certificate.</td>
</tr>
<tr>
<td><code>CUSTOM_SSL_CERT</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Full path of the certificate or bundle file (must be readable by the scheduler).</td>
</tr>
<tr>
<td><code>CUSTOM_SSL_KEY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Full path of the key file (must be readable by the scheduler).</td>
</tr>
<tr>
<td><code>CUSTOM_SSL_CERT_DATA</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Certificate data encoded in base64.</td>
</tr>
<tr>
<td><code>CUSTOM_SSL_KEY_DATA</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Key data encoded in base64.</td>
</tr>
</tbody>
</table>
<p>When you enable custom SSL/TLS by setting <code>USE_CUSTOM_SSL</code> to <code>yes</code>, BunkerWeb will automatically monitor the custom certificate specified in <code>CUSTOM_SSL_CERT</code>. It checks for changes daily and reloads NGINX if any modifications are detected, ensuring the latest certificate is always in use.</p>
<p>For stream mode, you must configure the <code>LISTEN_STREAM_PORT_SSL</code> setting to specify the SSL/TLS listening port. This step is essential for proper operation in stream mode.</p>
<h4 id="advanced-self-signed">Self-signed</h4>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>If you need to quickly test HTTPS / SSL/TLS in a staging or development environment, BunkerWeb can generate self-signed certificates for you. This is a convenient way to enable encryption without requiring an external Certificate Authority (CA).</p>
<p>Below is the list of related settings:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Setting</th>
<th style="text-align: center;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>GENERATE_SELF_SIGNED_SSL</code></td>
<td style="text-align: center;"><code>no</code></td>
<td style="text-align: left;">When set to <code>yes</code>, HTTPS / SSL/TLS will be enabled with automatic self-signed certificate generation and renewal from Let's Encrypt.</td>
</tr>
<tr>
<td style="text-align: center;"><code>SELF_SIGNED_SSL_EXPIRY</code></td>
<td style="text-align: center;"><code>365</code></td>
<td style="text-align: left;">Number of days for the certificate expiration (<strong>-days</strong> value used with <strong>openssl</strong>).</td>
</tr>
<tr>
<td style="text-align: center;"><code>SELF_SIGNED_SSL_SUBJ</code></td>
<td style="text-align: center;"><code>/CN=www.example.com/</code></td>
<td style="text-align: left;">Certificate subject to use (<strong>-subj</strong> value used with <strong>openssl</strong>).</td>
</tr>
</tbody>
</table>
<p>For stream mode, you must configure the <code>LISTEN_STREAM_PORT_SSL</code> setting to specify the SSL/TLS listening port. This step is essential for proper operation in stream mode.</p>
<h3 id="advanced-modsecurity">ModSecurity</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p><a href="https://modsecurity.org">ModSecurity</a> is a robust web application firewall (WAF) that helps protect your applications from a wide range of attacks, including SQL injection, cross-site scripting (XSS), and other common vulnerabilities. It acts as a shield, inspecting incoming and outgoing HTTP traffic and enforcing security rules to block malicious activity.</p>
<p>In BunkerWeb, ModSecurity is integrated and enabled by default, paired with the <strong><a href="https://coreruleset.org">OWASP Core Rule Set (CRS)</a></strong>. The OWASP CRS is a curated set of rules designed to detect and mitigate common web application vulnerabilities, offering strong baseline protection for your applications.</p>
<p>Below is the list of related settings:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_MODSECURITY</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable ModSecurity WAF.</td>
</tr>
<tr>
<td><code>USE_MODSECURITY_CRS</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable OWASP Core Rule Set.</td>
</tr>
<tr>
<td><code>USE_MODSECURITY_CRS_PLUGINS</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable OWASP Core Rule Set plugins.</td>
</tr>
<tr>
<td><code>MODSECURITY_CRS_VERSION</code></td>
<td><code>4</code></td>
<td>multisite</td>
<td>no</td>
<td>Version of the OWASP Core Rule Set to use with ModSecurity (3, 4 or nightly).</td>
</tr>
<tr>
<td><code>MODSECURITY_CRS_PLUGINS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of OWASP CRS plugins (plugin-name[/tag] or URL) to download and install (separated with spaces). (Not compatible with CRS version 3)</td>
</tr>
<tr>
<td><code>USE_MODSECURITY_GLOBAL_CRS</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Use ModSecurity CRS in global mode to improve rules loading when you have many services.</td>
</tr>
<tr>
<td><code>MODSECURITY_SEC_AUDIT_ENGINE</code></td>
<td><code>RelevantOnly</code></td>
<td>multisite</td>
<td>no</td>
<td>SecAuditEngine directive of ModSecurity.</td>
</tr>
<tr>
<td><code>MODSECURITY_SEC_RULE_ENGINE</code></td>
<td><code>On</code></td>
<td>multisite</td>
<td>no</td>
<td>SecRuleEngine directive of ModSecurity.</td>
</tr>
<tr>
<td><code>MODSECURITY_SEC_AUDIT_LOG_PARTS</code></td>
<td><code>ABCFHZ</code></td>
<td>multisite</td>
<td>no</td>
<td>SecAuditLogParts directive of ModSecurity.</td>
</tr>
<tr>
<td><code>MODSECURITY_REQ_BODY_NO_FILES_LIMIT</code></td>
<td><code>131072</code></td>
<td>multisite</td>
<td>no</td>
<td>SecRequestBodyNoFilesLimit directive of ModSecurity.</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">ModSecurity and the OWASP Core Rule Set</p>
<p><strong>We strongly recommend keeping both ModSecurity and the OWASP Core Rule Set (CRS) enabled</strong> to provide robust protection against common web vulnerabilities. While occasional false positives may occur, they can be resolved with some effort by fine-tuning rules or using predefined exclusions.</p>
<p>The CRS team actively maintains a list of exclusions for popular applications such as WordPress, Nextcloud, Drupal, and Cpanel, making it easier to integrate without impacting functionality. The security benefits far outweigh the minimal configuration effort required to address false positives.</p>
</div>
<p>You can select from the following versions of the OWASP Core Rule Set (CRS) to suit your application's security needs:</p>
<ul>
<li><strong><code>3</code></strong>: The stable <a href="https://github.com/coreruleset/coreruleset/releases/tag/v3.3.7">v3.3.7</a> release of the OWASP CRS.</li>
<li><strong><code>4</code></strong>: The stable <a href="https://github.com/coreruleset/coreruleset/releases/tag/v4.11.0">v4.11.0</a> release of the OWASP CRS (<strong>default</strong>).</li>
<li><strong><code>nightly</code></strong>: The <a href="https://github.com/coreruleset/coreruleset/releases/tag/nightly">nightly build</a>, which is updated daily with the latest rules and improvements.</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Nightly Build</p>
<p>The <strong>nightly build</strong> contains the most up-to-date rules, offering the latest protections against emerging threats. However, since it is updated daily and may include experimental or untested changes, it is recommended to first use the nightly build in a <strong>staging environment</strong> before deploying it in production.</p>
</div>
<h4 id="advanced-custom-configurations_1">Custom configurations</h4>
<p>Tuning ModSecurity and the OWASP Core Rule Set (CRS) can be achieved through <a href="#advanced-custom-configurations">custom configurations</a>. These configurations allow you to customize behavior at specific stages of the security rules processing:</p>
<ul>
<li><strong><code>modsec-crs</code></strong>: Applied <strong>before</strong> the OWASP Core Rule Set is loaded.</li>
<li><strong><code>modsec</code></strong>: Applied <strong>after</strong> the OWASP Core Rule Set is loaded. This is also used if the CRS is not loaded at all.</li>
<li><strong><code>crs-plugins-before</code></strong>: Applied <strong>before</strong> the CRS plugins are loaded.</li>
<li><strong><code>crs-plugins-after</code></strong>: Applied <strong>after</strong> the CRS plugins are loaded.</li>
</ul>
<p>This structure provides flexibility, allowing you to fine-tune ModSecurity and CRS settings to suit your application's specific needs while maintaining a clear configuration flow.</p>
<h4 id="advanced-adding-crs-exclusions-with-modsec-crs">Adding CRS Exclusions with <code>modsec-crs</code></h4>
<p>You can use a custom configuration of type <code>modsec-crs</code> to add exclusions for specific use cases, such as enabling predefined exclusions for WordPress:</p>
<div class="highlight"><pre><span></span><code>SecAction \
 &quot;id:900130,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.crs_exclusions_wordpress=1&quot;
</code></pre></div>
<p>In this example:</p>
<ul>
<li>The action is executed in <strong>Phase 1</strong> (early in the request lifecycle).</li>
<li>It enables WordPress-specific CRS exclusions by setting the variable <code>tx.crs_exclusions_wordpress</code>.</li>
</ul>
<h4 id="advanced-updating-crs-rules-with-modsec">Updating CRS Rules with <code>modsec</code></h4>
<p>To fine-tune the loaded CRS rules, you can use a custom configuration of type <code>modsec</code>. For example, you can remove specific rules or tags for certain request paths:</p>
<div class="highlight"><pre><span></span><code>SecRule REQUEST_FILENAME &quot;/wp-admin/admin-ajax.php&quot; &quot;id:1,ctl:ruleRemoveByTag=attack-xss,ctl:ruleRemoveByTag=attack-rce&quot;
SecRule REQUEST_FILENAME &quot;/wp-admin/options.php&quot; &quot;id:2,ctl:ruleRemoveByTag=attack-xss&quot;
SecRule REQUEST_FILENAME &quot;^/wp-json/yoast&quot; &quot;id:3,ctl:ruleRemoveById=930120&quot;
</code></pre></div>
<p>In this example:</p>
<ul>
<li><strong>Rule 1</strong>: Removes rules tagged as <code>attack-xss</code> and <code>attack-rce</code> for requests to <code>/wp-admin/admin-ajax.php</code>.</li>
<li><strong>Rule 2</strong>: Removes rules tagged as <code>attack-xss</code> for requests to <code>/wp-admin/options.php</code>.</li>
<li><strong>Rule 3</strong>: Removes a specific rule (ID <code>930120</code>) for requests matching <code>/wp-json/yoast</code>.</li>
</ul>
<h4 id="advanced-key-points">Key Points</h4>
<ul>
<li>Use <code>modsec-crs</code> for configurations that should be applied <strong>before</strong> CRS rules are loaded, such as enabling exclusions or setting variables.</li>
<li>Use <code>modsec</code> for configurations that modify or extend <strong>loaded CRS rules</strong>, such as removing rules by ID or tag.</li>
</ul>
<p>This approach provides precise control over the security rules, allowing you to adapt them to your application's specific needs while minimizing false positives.</p>
<div class="admonition info">
<p class="admonition-title">Order of execution</p>
<p>The execution order for ModSecurity in BunkerWeb is as follows, ensuring a clear and logical progression of rule application:</p>
<ol>
<li><strong>OWASP CRS Configuration</strong>: Base configuration for the OWASP Core Rule Set.</li>
<li><strong>Custom Plugins Configuration (<code>crs-plugins-before</code>)</strong>: Settings specific to plugins, applied before any CRS rules.</li>
<li><strong>Custom Plugin Rules (Before CRS Rules) (<code>crs-plugins-before</code>)</strong>: Custom rules for plugins executed prior to CRS rules.</li>
<li><strong>Downloaded Plugins Configuration</strong>: Configuration for externally downloaded plugins.</li>
<li><strong>Downloaded Plugin Rules (Before CRS Rules)</strong>: Rules for downloaded plugins executed before CRS rules.</li>
<li><strong>Custom CRS Rules (<code>modsec-crs</code>)</strong>: User-defined rules applied before loading the CRS rules.</li>
<li><strong>OWASP CRS Rules</strong>: The core set of security rules provided by OWASP.</li>
<li><strong>Custom Plugin Rules (After CRS Rules) (<code>crs-plugins-after</code>)</strong>: Custom plugin rules executed after CRS rules.</li>
<li><strong>Downloaded Plugin Rules (After CRS Rules)</strong>: Rules for downloaded plugins executed after CRS rules.</li>
<li><strong>Custom Rules (<code>modsec</code>)</strong>: User-defined rules applied after all CRS and plugin rules.</li>
</ol>
<p><strong>Key Notes</strong>:</p>
<ul>
<li><strong>Pre-CRS customizations</strong> (<code>crs-plugins-before</code>, <code>modsec-crs</code>) allow you to define exceptions or preparatory rules before the core CRS rules are loaded.</li>
<li><strong>Post-CRS customizations</strong> (<code>crs-plugins-after</code>, <code>modsec</code>) are ideal for overriding or extending rules after CRS and plugin rules have been applied.</li>
<li>This structure provides maximum flexibility, enabling precise control over rule execution and customization while maintaining a strong security baseline.</li>
</ul>
</div>
<h4 id="advanced-owasp-crs-plugins">OWASP CRS Plugins</h4>
<p>The OWASP Core Rule Set also supports a range of <strong>plugins</strong> designed to extend its functionality and improve compatibility with specific applications or environments. These plugins can help fine-tune the CRS for use with popular platforms such as WordPress, Nextcloud, and Drupal, or even custom setups. For more information and a list of available plugins, refer to the <a href="https://github.com/coreruleset/plugin-registry">OWASP CRS plugin registry</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Plugin download</p>
<p>The <code>MODSECURITY_CRS_PLUGINS</code> setting allows you to download and install plugins to extend the functionality of the OWASP Core Rule Set (CRS). This setting accepts a list of plugin names with optional tags or URLs, making it easy to integrate additional security features tailored to your specific needs.</p>
<p>Here's a non-exhaustive of accepted values for the <code>MODSECURITY_CRS_PLUGINS</code> setting:</p>
<ul>
<li><code>fake-bot</code> &lt;---- <em>Download the latest release of the plugin.</em></li>
<li><code>wordpress-rule-exclusions/v1.0.0</code> &lt;---- <em>Download the version 1.0.0 of the plugin.</em></li>
<li><code>https://github.com/coreruleset/dos-protection-plugin-modsecurity/archive/refs/heads/main.zip</code> &lt;---- <em>Download the plugin directly from the URL.</em></li>
</ul>
</div>
<!-- ## CrowdSec

STREAM support :x:

<figure markdown>
  ![Overview](assets/img/crowdsec.svg){ align=center, width="600" }
</figure>

This BunkerWeb plugin acts as a [CrowdSec](https://crowdsec.net/) bouncer. It will deny requests based on the decision of your CrowdSec API. Not only you will benefinit from the crowdsourced blacklist, you can also configure [scenarios](https://docs.crowdsec.net/docs/concepts#scenarios) to automatically ban IPs based on suspicious behaviors.

### Setup

=== "Docker"
    **Acquisition file**

    You will need to run CrowdSec instance and configure it to parse BunkerWeb logs. Because BunkerWeb is based on NGINX, you can use the `nginx` value for the `type` parameter in your acquisition file (assuming that BunkerWeb logs are stored "as is" without additional data) :

    <div class="highlight"><pre><span></span><code><span class="nt">filenames</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/bunkerweb.log</span>
<span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</code></pre></div>

    **Syslog**

    For container-based integrations, we recommend you to redirect the logs of the BunkerWeb container to a syslog service that will store the logs so CrowdSec can access it easily. Here is an example configuration for syslog-ng that will store raw logs coming from BunkerWeb to a local `/var/log/bunkerweb.log` file :

    <div class="highlight"><pre><span></span><code>@version: 4.7

source s_net {
    udp(
        ip(&quot;0.0.0.0&quot;)
    );
};

template t_imp {
    template(&quot;$MSG\n&quot;);
    template_escape(no);
};

destination d_file {
    file(&quot;/var/log/bunkerweb.log&quot; template(t_imp));
};

log {
    source(s_net);
    destination(d_file);
};
</code></pre></div>

    **Optional : Application Security Component**

    CrowdSec also provides an [Application Security Component](https://docs.crowdsec.net/docs/appsec/intro) that can be used to protect your application from attacks. You can configure the plugin to send requests to the AppSec Component for further analysis. If you want to use it, you will need to create another acquisition file for the AppSec Component :

    <div class="highlight"><pre><span></span><code><span class="nt">appsec_config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crowdsecurity/appsec-default</span>
<span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appsec</span>
<span class="nt">listen_addr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0:7422</span>
<span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appsec</span>
</code></pre></div>

    **Docker Compose**

    Here is the docker-compose boilerplate that you can use (**don't forget to edit the bouncer key**) :

    <div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443&quot;</span>
<span class="w">        </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">            </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/24</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">        </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">        </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-plugins</span>
<span class="w">        </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">            </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">syslog</span>
<span class="w">            </span><span class="nt">options</span><span class="p">:</span>
<span class="w">                </span><span class="nt">syslog-address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;udp://10.10.10.254:514&quot;</span>

<span class="w">    </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">        </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">        </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">            </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">            </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;www.example.com&quot;</span>
<span class="w">            </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/24</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">            </span><span class="nt">USE_CROWDSEC</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="nt">CROWDSEC_API</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://crowdsec:8080&quot;</span><span class="w"> </span><span class="c1"># This is the API URL of the CrowdSec instance</span>
<span class="w">            </span><span class="nt">CROWDSEC_APPSEC_URL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://crowdsec:7422&quot;</span><span class="w"> </span><span class="c1"># This is the AppSec Component URL of the CrowdSec instance, comment if you don&#39;t want to use it</span>
<span class="w">            </span><span class="nt">CROWDSEC_API_KEY</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;s3cr3tb0unc3rk3y&quot;</span><span class="w"> </span><span class="c1"># This is the API key of the Bouncer, we recommend have a more complex key</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">        </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">        </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>

<span class="w">    </span><span class="nt">crowdsec</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crowdsecurity/crowdsec:v1.6.2</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cs-data:/var/lib/crowdsec/data</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./acquis.yaml:/etc/crowdsec/acquis.yaml</span><span class="w"> </span><span class="c1"># This is the acquisition file for CrowdSec created above</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./appsec.yaml:/etc/crowdsec/acquis.d/appsec.yaml</span><span class="w"> </span><span class="c1"># Comment if you don&#39;t want to use the AppSec Component</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-logs:/var/log:ro</span>
<span class="w">        </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">            </span><span class="nt">BOUNCER_KEY_bunkerweb</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;s3cr3tb0unc3rk3y&quot;</span><span class="w"> </span><span class="c1"># This is the API key of the Bouncer, we recommend have a more complex key (it must match the one configured)</span>
<span class="w">            </span><span class="nt">COLLECTIONS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;crowdsecurity/nginx</span><span class="nv"> </span><span class="s">crowdsecurity/appsec-virtual-patching</span><span class="nv"> </span><span class="s">crowdsecurity/appsec-generic-rules&quot;</span>
<span class="w">            </span><span class="c1">#   COLLECTIONS: &quot;crowdsecurity/nginx&quot; # If you don&#39;t want to use the AppSec Component use this line instead</span>
<span class="w">        </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-plugins</span>

<span class="w">    </span><span class="nt">syslog</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">balabit/syslog-ng:4.8.0</span>
<span class="w">        </span><span class="c1"># image: lscr.io/linuxserver/syslog-ng:4.8.1-r1-ls147 # For aarch64 architecture</span>
<span class="w">        </span><span class="nt">cap_add</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NET_BIND_SERVICE</span><span class="w">  </span><span class="c1"># Bind to low ports</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NET_BROADCAST</span><span class="w">  </span><span class="c1"># Send broadcasts</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NET_RAW</span><span class="w">  </span><span class="c1"># Use raw sockets</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DAC_READ_SEARCH</span><span class="w">  </span><span class="c1"># Read files bypassing permissions</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DAC_OVERRIDE</span><span class="w">  </span><span class="c1"># Override file permissions</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CHOWN</span><span class="w">  </span><span class="c1"># Change ownership</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SYSLOG</span><span class="w">  </span><span class="c1"># Write to system logs</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-logs:/var/log/bunkerweb</span><span class="w"> </span><span class="c1"># This is the volume used to store the logs</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./syslog-ng.conf:/etc/syslog-ng/syslog-ng.conf</span><span class="w"> </span><span class="c1"># This is the syslog-ng configuration file</span>
<span class="w">        </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">            </span><span class="nt">bw-plugins</span><span class="p">:</span>
<span class="w">                </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.10.10.254</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">        </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">        </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">        </span><span class="nt">config</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">    </span><span class="nt">bw-plugins</span><span class="p">:</span>
<span class="w">        </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">        </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">        </span><span class="nt">config</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.10.10.0/24</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bw-storage</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bw-logs</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cs-data</span><span class="p">:</span>
</code></pre></div>

=== "Linux"

    You'll need to install CrowdSec and configure it to parse BunkerWeb logs. To do so, you can follow the [official documentation](https://doc.crowdsec.net/docs/getting_started/install_crowdsec).

    For CrowdSec to parse BunkerWeb logs, you have to add the following lines to your acquisition file located in `/etc/crowdsec/acquis.yaml` :

    <div class="highlight"><pre><span></span><code><span class="nt">filenames</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/bunkerweb/access.log</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/bunkerweb/error.log</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/bunkerweb/modsec_audit.log</span>
<span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</code></pre></div>

    Now we have to add our custom bouncer to the CrowdSec API. To do so, you can use the `cscli` tool :

    <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>cscli<span class="w"> </span>bouncers<span class="w"> </span>add<span class="w"> </span>crowdsec-bunkerweb-bouncer/v1.6
</code></pre></div>

    !!! warning "API key"
        Keep the key generated by the `cscli` command, you will need it later.

    Now restart the CrowdSec service :

    <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>crowdsec
</code></pre></div>

    **Optional : Application Security Component with Linux**

    If you want to use the AppSec Component, you will need to create another acquisition file for it located in `/etc/crowdsec/acquis.d/appsec.yaml` :

    <div class="highlight"><pre><span></span><code><span class="nt">appsec_config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crowdsecurity/appsec-default</span>
<span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appsec</span>
<span class="nt">listen_addr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1:7422</span>
<span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appsec</span>
</code></pre></div>

    And you will need to install the AppSec Component's collections :

    <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>cscli<span class="w"> </span>collections<span class="w"> </span>install<span class="w"> </span>crowdsecurity/appsec-virtual-patching
sudo<span class="w"> </span>cscli<span class="w"> </span>collections<span class="w"> </span>install<span class="w"> </span>crowdsecurity/appsec-generic-rules
</code></pre></div>

    Now you just have to restart the CrowdSec service :

    <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>crowdsec
</code></pre></div>

    If you need more information about the AppSec Component, you can refer to the [official documentation](https://docs.crowdsec.net/docs/appsec/intro).

    **Settings**

    Now you can configure the plugin by adding the following settings to your BunkerWeb configuration file :

    <div class="highlight"><pre><span></span><code>USE_CROWDSEC=yes
CROWDSEC_API=http://127.0.0.1:8080
CROWDSEC_API_KEY=&lt;The key provided by cscli&gt;
CROWDSEC_APPSEC_URL=http://127.0.0.1:7422 # Comment if you don&#39;t want to use the AppSec Component
</code></pre></div>

    And finally reload the BunkerWeb service :

    ```shell
    sudo systemctl reload bunkerweb
    ``` -->

<h3 id="advanced-bad-behavior">Bad behavior</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Attackers often generate "suspicious" HTTP status codes when probing for or exploiting vulnerabilities—codes that a typical user is unlikely to trigger within a given time frame. By detecting this behavior, BunkerWeb can automatically ban the offending IP address, forcing the attacker to switch to a new IP to continue their attempts.</p>
<p>This security measure, known as <strong>"Bad Behavior,"</strong> is implemented and enabled by default in BunkerWeb, providing an additional layer of protection against malicious activity.</p>
<p>Below is the list of related settings:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Setting</th>
<th style="text-align: center;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>USE_BAD_BEHAVIOR</code></td>
<td style="text-align: center;"><code>yes</code></td>
<td style="text-align: left;">When set to <code>yes</code>, the Bad behavior feature will be enabled.</td>
</tr>
<tr>
<td style="text-align: center;"><code>BAD_BEHAVIOR_STATUS_CODES</code></td>
<td style="text-align: center;"><code>400 401 403 404 405 429 444</code></td>
<td style="text-align: left;">List of HTTP status codes considered as "suspicious".</td>
</tr>
<tr>
<td style="text-align: center;"><code>BAD_BEHAVIOR_THRESHOLD</code></td>
<td style="text-align: center;"><code>10</code></td>
<td style="text-align: left;">Maximum number of "suspicious" HTTP status codes within the time period.</td>
</tr>
<tr>
<td style="text-align: center;"><code>BAD_BEHAVIOR_COUNT_TIME</code></td>
<td style="text-align: center;"><code>60</code></td>
<td style="text-align: left;">Period of time during which we count "suspicious" HTTP status codes.</td>
</tr>
<tr>
<td style="text-align: center;"><code>BAD_BEHAVIOR_BAN_TIME</code></td>
<td style="text-align: center;"><code>86400</code></td>
<td style="text-align: left;">The duration time (in seconds) of a ban when a client reached the threshold.</td>
</tr>
</tbody>
</table>
<p>By default, BunkerWeb's <strong>"Bad Behavior"</strong> feature works as follows:</p>
<ul>
<li>If a client generates more than <strong>10</strong> HTTP status codes from the list <code>400, 401, 403, 404, 405, 429, 444</code> within a <strong>60-second</strong> period, their IP address will be banned for <strong>86400 seconds</strong> (24 hours).</li>
</ul>
<p>In <strong>stream mode</strong>, only the <code>444</code> status code is considered "bad" and will trigger this behavior.</p>
<p>This configuration helps prevent attackers from repeatedly probing your server for vulnerabilities while minimizing the impact on legitimate users.</p>
<h3 id="advanced-antibot">Antibot</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Attackers often use automated tools to exploit vulnerabilities in web applications. A common countermeasure is to challenge users to determine whether they are bots. If the challenge is successfully completed, the client is deemed "legitimate" and granted access to the web application.</p>
<p>BunkerWeb includes a built-in "Antibot" feature to implement this type of security, though it is not enabled by default. Below are the supported challenge mechanisms:</p>
<ul>
<li><strong>Cookie</strong>: Sends a cookie to the client and expects it to be returned on subsequent requests.</li>
<li><strong>JavaScript</strong>: Requires the client to solve a computational challenge using JavaScript.</li>
<li><strong>Captcha</strong>: Presents a traditional CAPTCHA challenge (no external dependencies).</li>
<li><strong>reCAPTCHA</strong>: Uses Google reCAPTCHA to ensure the client achieves a minimum score.</li>
<li><strong>hCaptcha</strong>: Challenges the client with a CAPTCHA provided by hCaptcha.</li>
<li><strong>Turnstile</strong>: Enforces rate limiting and access control using Cloudflare Turnstile, leveraging various mechanisms.</li>
<li><strong>mCaptcha</strong>: Challenges the client with a CAPTCHA provided by mCaptcha.</li>
</ul>
<p>Here is the list of related settings :</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_ANTIBOT</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate antibot feature.</td>
</tr>
<tr>
<td><code>ANTIBOT_URI</code></td>
<td><code>/challenge</code></td>
<td>multisite</td>
<td>no</td>
<td>Unused URI that clients will be redirected to to solve the challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_TIME_RESOLVE</code></td>
<td><code>60</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum time (in seconds) clients have to resolve the challenge. Once this time has passed, a new challenge will be generated.</td>
</tr>
<tr>
<td><code>ANTIBOT_TIME_VALID</code></td>
<td><code>86400</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum validity time of solved challenges. Once this time has passed, clients will need to resolve a new one.</td>
</tr>
<tr>
<td><code>ANTIBOT_RECAPTCHA_SCORE</code></td>
<td><code>0.7</code></td>
<td>multisite</td>
<td>no</td>
<td>Minimum score required for reCAPTCHA challenge (Only compatible with reCAPTCHA v3).</td>
</tr>
<tr>
<td><code>ANTIBOT_RECAPTCHA_SITEKEY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Sitekey for reCAPTCHA challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_RECAPTCHA_SECRET</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Secret for reCAPTCHA challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_HCAPTCHA_SITEKEY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Sitekey for hCaptcha challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_HCAPTCHA_SECRET</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Secret for hCaptcha challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_TURNSTILE_SITEKEY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Sitekey for Turnstile challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_TURNSTILE_SECRET</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Secret for Turnstile challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_MCAPTCHA_SITEKEY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Sitekey for mCaptcha challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_MCAPTCHA_SECRET</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Secret for mCaptcha challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_MCAPTCHA_URL</code></td>
<td><code>https://demo.mcaptcha.org</code></td>
<td>multisite</td>
<td>no</td>
<td>Domain to use for mCaptcha challenge.</td>
</tr>
</tbody>
</table>
<p>Please note that antibot feature is using a cookie to maintain a session with clients. If you are using BunkerWeb in a clustered environment, you will need to set the <code>SESSIONS_SECRET</code> and <code>SESSIONS_NAME</code> settings to another value than the default one (which is <code>random</code>). You will find more info about sessions <a href="#settings-sessions">here</a>.</p>
<h4 id="advanced-captcha">Captcha</h4>
<p>Our homemade Captcha mechanism offers a simple yet effective challenge designed and hosted entirely within your BunkerWeb environment. It generates dynamic, image-based challenges that test users' ability to recognize and interpret randomized characters, ensuring automated bots are effectively blocked without the need for any external API calls or third-party services.</p>
<p>To enable the Captcha antibot mechanism, set the <code>USE_ANTIBOT</code> setting to <code>captcha</code> in your BunkerWeb configuration.</p>
<h4 id="advanced-recaptcha">reCAPTCHA</h4>
<p>When enabled, reCAPTCHA runs in the background (v3) to assign a score based on user behavior. A score lower than the configured threshold will prompt further verification or block the request. For visible challenges (v2), users must interact with the reCAPTCHA widget before continuing.</p>
<p>To use reCAPTCHA with BunkerWeb, you need to obtain your site and secret keys from the <a href="https://www.google.com/recaptcha/admin">Google reCAPTCHA admin console</a>. Once you have the keys, you can configure BunkerWeb to use reCAPTCHA as an antibot mechanism.</p>
<p>Add or update the following settings as needed in your BunkerWeb configuration:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ANTIBOT_RECAPTCHA_SITEKEY</code></td>
<td></td>
<td>Your Google reCAPTCHA site key.</td>
</tr>
<tr>
<td><code>ANTIBOT_RECAPTCHA_SECRET</code></td>
<td></td>
<td>Your Google reCAPTCHA secret key.</td>
</tr>
<tr>
<td><code>ANTIBOT_RECAPTCHA_SCORE</code></td>
<td>0.7</td>
<td>Minimum score required for reCAPTCHA v3 validation.</td>
</tr>
</tbody>
</table>
<p>Make sure to set the <code>USE_ANTIBOT</code> setting to <code>recaptcha</code> to enable the reCAPTCHA antibot mechanism.</p>
<h4 id="advanced-hcaptcha">hCaptcha</h4>
<p>When enabled, hCaptcha provides an effective alternative to reCAPTCHA by verifying user interactions without relying on a scoring mechanism. It challenges users with a simple, interactive test to confirm their legitimacy.</p>
<p>To integrate hCaptcha with BunkerWeb, you must obtain the necessary credentials from the hCaptcha dashboard at <a href="https://www.hcaptcha.com">hCaptcha</a>. These credentials include a site key and a secret key.</p>
<p>After acquiring the keys, update your BunkerWeb configuration with the following settings to enable hCaptcha antibot protection:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ANTIBOT_HCAPTCHA_SITEKEY</code></td>
<td></td>
<td>Your hCaptcha site key.</td>
</tr>
<tr>
<td><code>ANTIBOT_HCAPTCHA_SECRET</code></td>
<td></td>
<td>Your hCaptcha secret key used for verification.</td>
</tr>
</tbody>
</table>
<p>Make sure to set the <code>USE_ANTIBOT</code> setting to <code>hcaptcha</code> to enable the hCaptcha antibot mechanism.</p>
<h4 id="advanced-turnstile">Turnstile</h4>
<p>Turnstile is a modern, privacy-friendly challenge mechanism that leverages Cloudflare’s technology to detect and block automated traffic. It validates user interactions in a seamless, background manner, reducing friction for legitimate users while effectively discouraging bots.</p>
<p>To integrate Turnstile with BunkerWeb, ensure you obtain the necessary credentials from <a href="https://www.cloudflare.com/turnstile">Cloudflare Turnstile</a> and update your configuration with the following settings:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ANTIBOT_TURNSTILE_SITEKEY</code></td>
<td></td>
<td>Your Cloudflare Turnstile site key.</td>
</tr>
<tr>
<td><code>ANTIBOT_TURNSTILE_SECRET</code></td>
<td></td>
<td>Your Cloudflare Turnstile secret key for validation.</td>
</tr>
</tbody>
</table>
<p>Make sure to set the <code>USE_ANTIBOT</code> setting to <code>turnstile</code> to enable the Turnstile antibot mechanism.</p>
<h4 id="advanced-mcaptcha">mCaptcha</h4>
<p>mCaptcha is an alternative CAPTCHA challenge mechanism that verifies the legitimacy of users by presenting an interactive test similar to other antibot solutions. When enabled, it challenges users with a CAPTCHA provided by mCaptcha, ensuring that only genuine users bypass the automated security checks.</p>
<p>mCaptcha is designed with privacy in mind. It is fully GDPR compliant, ensuring that all user data involved in the challenge process adheres to strict data protection standards. Additionally, mCaptcha offers the flexibility to be self-hosted, allowing organizations to maintain full control over their data and infrastructure. This self-hosting capability not only enhances privacy but also optimizes performance and customization to suit specific deployment needs.</p>
<p>To integrate mCaptcha with BunkerWeb, you must obtain the necessary credentials from the <a href="https://mcaptcha.org/">mCaptcha</a> platform or yours. These credentials include a site key and a secret key for verification. After acquiring the keys, update your BunkerWeb configuration with the following settings to enable mCaptcha antibot protection:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ANTIBOT_MCAPTCHA_SITEKEY</code></td>
<td></td>
<td>Your mCaptcha site key used in the challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_MCAPTCHA_SECRET</code></td>
<td></td>
<td>Your mCaptcha secret for verifying responses.</td>
</tr>
<tr>
<td><code>ANTIBOT_MCAPTCHA_URL</code></td>
<td><code>https://demo.mcaptcha.org</code></td>
<td>The endpoint URL for mCaptcha challenge integration.</td>
</tr>
</tbody>
</table>
<p>Make sure to set the <code>USE_ANTIBOT</code> setting to <code>mcaptcha</code> to enable the mCaptcha antibot mechanism.</p>
<h3 id="advanced-blacklisting-whitelisting-and-greylisting">Blacklisting, whitelisting and greylisting</h3>
<p>The security features for blacklisting, whitelisting, and greylisting are straightforward to understand:</p>
<ul>
<li><strong>Blacklisting</strong>: If a specific criterion is met, the client will be blocked.</li>
<li><strong>Whitelisting</strong>: If a specific criterion is met, the client will be allowed, bypassing all additional security checks.</li>
<li><strong>Greylisting</strong>: If a specific criterion is met, the client will be allowed but subjected to additional security checks else the client will be blocked.</li>
</ul>
<p>These mechanisms can be configured simultaneously. If all three are enabled and a client meets criteria for multiple lists, <strong>whitelisting takes precedence</strong>, followed by blacklisting, and finally greylisting. In such cases, a whitelisted client will bypass both blacklisting and greylisting, regardless of overlapping criteria.</p>
<h4 id="advanced-blacklisting">Blacklisting</h4>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /></p>
<p>You can use the following settings to set up blacklisting :</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BLACKLIST</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>Activate blacklist feature.</td>
</tr>
<tr>
<td><code>BLACKLIST_IP</code></td>
<td></td>
<td>multisite</td>
<td>List of IP/network, separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_RDNS</code></td>
<td><code>.shodan.io .censys.io</code></td>
<td>multisite</td>
<td>List of reverse DNS suffixes, separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_RDNS_GLOBAL</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>Only perform RDNS blacklist checks on global IP addresses.</td>
</tr>
<tr>
<td><code>BLACKLIST_ASN</code></td>
<td></td>
<td>multisite</td>
<td>List of ASN numbers, separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_USER_AGENT</code></td>
<td></td>
<td>multisite</td>
<td>List of User-Agent (PCRE regex), separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_URI</code></td>
<td></td>
<td>multisite</td>
<td>List of URI (PCRE regex), separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_IP</code></td>
<td></td>
<td>multisite</td>
<td>List of IP/network, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_RDNS</code></td>
<td></td>
<td>multisite</td>
<td>List of reverse DNS suffixes, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_ASN</code></td>
<td></td>
<td>multisite</td>
<td>List of ASN numbers, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_USER_AGENT</code></td>
<td></td>
<td>multisite</td>
<td>List of User-Agent (PCRE regex), separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_URI</code></td>
<td></td>
<td>multisite</td>
<td>List of URI (PCRE regex), separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IP_URLS</code></td>
<td><code>https://www.dan.me.uk/torlist/?exit</code></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing bad IP/network to block. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_RDNS_URLS</code></td>
<td></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing reverse DNS suffixes to block. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_ASN_URLS</code></td>
<td></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing ASN to block. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_USER_AGENT_URLS</code></td>
<td><code>https://raw.githubusercontent.com/mitchellkrogza/nginx-ultimate-bad-bot-blocker/master/_generator_lists/bad-user-agents.list</code></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing bad User-Agent to block. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_URI_URLS</code></td>
<td></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing bad URI to block. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_IP_URLS</code></td>
<td></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing IP/network to ignore in the blacklist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_RDNS_URLS</code></td>
<td></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing reverse DNS suffixes to ignore in the blacklist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_ASN_URLS</code></td>
<td></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing ASN to ignore in the blacklist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_USER_AGENT_URLS</code></td>
<td></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing User-Agent to ignore in the blacklist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_URI_URLS</code></td>
<td></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing URI to ignore in the blacklist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">stream mode</p>
<p>When using stream mode, only IP, RDNS and ASN checks will be done.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Ignore lists</p>
<p>The ignore lists are useful when you want to block a specific criterion but want to exclude some IPs, RDNS, ASN, User-Agent, or URI from the blacklist.</p>
</div>
<h4 id="advanced-greylisting">Greylisting</h4>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /></p>
<p>You can use the following settings to set up greylisting :</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_GREYLIST</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>Activate greylist feature.</td>
</tr>
<tr>
<td><code>GREYLIST_IP</code></td>
<td></td>
<td>multisite</td>
<td>List of IP/network, separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_RDNS</code></td>
<td></td>
<td>multisite</td>
<td>List of reverse DNS suffixes, separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_RDNS_GLOBAL</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>Only perform RDNS greylist checks on global IP addresses.</td>
</tr>
<tr>
<td><code>GREYLIST_ASN</code></td>
<td></td>
<td>multisite</td>
<td>List of ASN numbers, separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_USER_AGENT</code></td>
<td></td>
<td>multisite</td>
<td>List of User-Agent (PCRE regex), separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_URI</code></td>
<td></td>
<td>multisite</td>
<td>List of URI (PCRE regex), separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_IP_URLS</code></td>
<td></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing good IP/network to put into the greylist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>GREYLIST_RDNS_URLS</code></td>
<td></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing reverse DNS suffixes to put into the greylist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>GREYLIST_ASN_URLS</code></td>
<td></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing ASN to put into the greylist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>GREYLIST_USER_AGENT_URLS</code></td>
<td></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing good User-Agent to put into the greylist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>GREYLIST_URI_URLS</code></td>
<td></td>
<td>multisite</td>
<td>List of URLs, separated with spaces, containing bad URI to put into the greylist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">stream mode</p>
<p>When using stream mode, only IP, RDNS and ASN checks will be done.</p>
</div>
<h4 id="advanced-whitelisting">Whitelisting</h4>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /></p>
<p>You can use the following settings to set up whitelisting :</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_WHITELIST</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate whitelist feature.</td>
</tr>
<tr>
<td><code>WHITELIST_IP</code></td>
<td>``</td>
<td>multisite</td>
<td>no</td>
<td>List of IP/network, separated with spaces, to put into the whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_RDNS</code></td>
<td><code>.google.com .googlebot.com .yandex.ru .yandex.net .yandex.com .search.msn.com .baidu.com .baidu.jp .crawl.yahoo.net .fwd.linkedin.com .twitter.com .twttr.com .discord.com</code></td>
<td>multisite</td>
<td>no</td>
<td>List of reverse DNS suffixes, separated with spaces, to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_RDNS_GLOBAL</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Only perform RDNS whitelist checks on global IP addresses.</td>
</tr>
<tr>
<td><code>WHITELIST_ASN</code></td>
<td><code>32934</code></td>
<td>multisite</td>
<td>no</td>
<td>List of ASN numbers, separated with spaces, to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_USER_AGENT</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of User-Agent (PCRE regex), separated with spaces, to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_URI</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URI (PCRE regex), separated with spaces, to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_IP_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing good IP/network to whitelist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>WHITELIST_RDNS_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing reverse DNS suffixes to whitelist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>WHITELIST_ASN_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing ASN to whitelist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>WHITELIST_USER_AGENT_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing good User-Agent to whitelist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>WHITELIST_URI_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing bad URI to whitelist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">stream mode</p>
<p>When using stream mode, only IP, RDNS and ASN checks will be done.</p>
</div>
<h3 id="advanced-reverse-scan">Reverse scan</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>The reverse scan feature is designed to identify open ports by attempting to establish TCP connections with clients' IP addresses. This is particularly useful for detecting potential open proxies or connections originating from servers.</p>
<p>By default, we provide a list of suspicious ports, which you can customize to suit your specific needs. However, keep in mind that adding too many ports to the list may slow down client connections due to the additional network checks. If an open port from the list is detected, the client's access will be denied.</p>
<p>Here is the list of settings related to reverse scan :</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Setting</th>
<th style="text-align: center;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>USE_REVERSE_SCAN</code></td>
<td style="text-align: center;"><code>no</code></td>
<td style="text-align: left;">When set to <code>yes</code>, will enable ReverseScan.</td>
</tr>
<tr>
<td style="text-align: center;"><code>REVERSE_SCAN_PORTS</code></td>
<td style="text-align: center;"><code>22 80 443 3128 8000 8080</code></td>
<td style="text-align: left;">List of suspicious ports to scan.</td>
</tr>
<tr>
<td style="text-align: center;"><code>REVERSE_SCAN_TIMEOUT</code></td>
<td style="text-align: center;"><code>500</code></td>
<td style="text-align: left;">Specify the maximum timeout (in ms) when scanning a port.</td>
</tr>
</tbody>
</table>
<h3 id="advanced-bunkernet">BunkerNet</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p><strong>BunkerNet</strong> is a global, crowdsourced database of malicious requests, collaboratively shared among all BunkerWeb instances worldwide.</p>
<p>When you enable BunkerNet, malicious requests detected by your instance are sent to a remote server, where they are analyzed by our advanced systems. This process allows us to aggregate and extract malicious patterns from reports across all participating instances. The resulting insights are then redistributed to bolster the security of every BunkerWeb instance connected to BunkerNet.</p>
<p>Beyond the enhanced security that comes from leveraging this collective intelligence, enabling BunkerNet unlocks additional features, such as seamless integration with the <strong>CrowdSec Console</strong>, providing further tools to monitor and manage threats effectively.</p>
<p>The setting used to enable or disable BunkerNet is <code>USE_BUNKERNET</code> (default : <code>yes</code>).</p>
<h4 id="advanced-crowdsec-console-integration">CrowdSec Console integration</h4>
<p>If you're not already familiar with it, <a href="https://www.crowdsec.net/?utm_campaign=bunkerweb&amp;utm_source=doc">CrowdSec</a> is an open-source cybersecurity solution that leverages crowdsourced intelligence to combat cyber threats. Think of it as the "Waze of cybersecurity"—when one server is attacked, other systems worldwide are alerted and protected from the same attackers. You can learn more about it <a href="https://www.crowdsec.net/about?utm_campaign=bunkerweb&amp;utm_source=blog">here</a>.</p>
<p>Through our partnership with CrowdSec, you can enroll your BunkerWeb instances into your <a href="https://app.crowdsec.net/signup?utm_source=external-blog&amp;utm_medium=cta&amp;utm_campaign=bunker-web-integration">CrowdSec Console</a>. This means that attacks blocked by BunkerWeb will be visible in your CrowdSec Console alongside attacks blocked by CrowdSec Security Engines, giving you a unified view of threats.</p>
<p>Importantly, CrowdSec does not need to be installed for this integration (though we highly recommend trying it out with the <a href="https://github.com/bunkerity/bunkerweb-plugins/tree/main/crowdsec">CrowdSec plugin for BunkerWeb</a> to further enhance the security of your web services). Additionally, you can enroll your CrowdSec Security Engines into the same Console account for even greater synergy.</p>
<p><strong>Step #1 : create your CrowdSec Console account</strong></p>
<p>Go to the <a href="https://app.crowdsec.net/signup?utm_source=external-blog&amp;utm_medium=cta&amp;utm_campaign=bunker-web-integration">CrowdSec Console</a> and register your account if you don't already have one. Once it's done, write down your enroll key by going to "Security Engines", then "Engines" and click on "Add Security Engine" :</p>
<figure>
<p><img align="center" alt="Overview" src="../assets/img/crowdity1.png" />
  </p>
<figcaption>Get your Crowdsec Console enroll key</figcaption>
</figure>
<p><strong>Step #2 : get your BunkerNet ID</strong></p>
<p>Activating the BunkerNet feature (which is the case by default) is mandatory if you want to enroll your BunkerWeb instance(s) into your CrowdSec console. You can do it by setting <code>USE_BUNKERNET</code> to <code>yes</code>.</p>
<p>Get your BunkerNet ID on Docker :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>my-bw-scheduler<span class="w"> </span>cat<span class="w"> </span>/var/cache/bunkerweb/bunkernet/instance.id
</code></pre></div>
<p>Get your BunkerNet ID on Linux :</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/var/cache/bunkerweb/bunkernet/instance.id
</code></pre></div>
<p><strong>Step #3 : enroll your instance using the Panel</strong></p>
<p>Once you have noted your BunkerNet ID and CrowdSec Console enroll key, you can <a href="https://panel.bunkerweb.io/order/bunkernet/11?utm_campaign=self&amp;utm_source=doc">order the free product "BunkerNet / CrowdSec" on the Panel</a>. Please note that you will need to create an account if you don't already have one.</p>
<p>You can now select the "BunkerNet / CrowdSec" service and fill out the form by pasting your BunkerNet ID and CrowdSec Console enroll key :</p>
<figure>
<p><img align="center" alt="Overview" src="../assets/img/crowdity2.png" />
  </p>
<figcaption>Enroll your BunkerWeb instance into the CrowdSec Console</figcaption>
</figure>
<p><strong>Step #4 : accept new security engine on the Console</strong></p>
<p>Last but not least, you need to go back to your CrowdSec Console and accept the new Security Engine :</p>
<figure>
<p><img align="center" alt="Overview" src="../assets/img/crowdity3.png" />
  </p>
<figcaption>Accept enroll into the CrowdSec Console</figcaption>
</figure>
<p><strong>Congratulations, your BunkerWeb instance is now enrolled into your CrowdSec Console !</strong></p>
<p>Pro tip : when viewing your alerts, click on "columns" and tick the "context" checkbox to get access to BunkerWeb specific data.</p>
<figure>
<p><img align="center" alt="Overview" src="../assets/img/crowdity4.png" />
  </p>
<figcaption>BunkerWeb data shown in the context column</figcaption>
</figure>
<h3 id="advanced-dnsbl">DNSBL</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p><strong>DNSBL</strong> (Domain Name System Blacklist) is an external database of malicious IP addresses that can be queried using the DNS protocol. BunkerWeb supports automatic querying of such blacklists, providing an additional layer of security.</p>
<p>When a client connects, BunkerWeb can query the DNSBL server of your choice. If the server confirms that the client's IP address is listed as malicious, BunkerWeb will automatically ban the client, preventing any potential threats from reaching your application. This streamlined integration enhances your ability to block known malicious actors in real time.</p>
<p>Here is the list of settings related to DNSBL :</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Setting</th>
<th style="text-align: center;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>USE_DNSBL</code></td>
<td style="text-align: center;"><code>yes</code></td>
<td style="text-align: left;">When set to <code>yes</code>, will enable DNSBL checking.</td>
</tr>
<tr>
<td style="text-align: center;"><code>DNSBL_LIST</code></td>
<td style="text-align: center;"><code>bl.blocklist.de sbl.spamhaus.org xbl.spamhaus.org</code></td>
<td style="text-align: left;">List of DNSBL servers to ask.</td>
</tr>
</tbody>
</table>
<h3 id="advanced-limiting">Limiting</h3>
<p>BunkerWeb allows you to enforce limit policies on the following:</p>
<ul>
<li><strong>Number of connections per IP</strong></li>
<li><strong>Number of requests per IP and URL within a specific time period</strong></li>
</ul>
<p>While these policies are not designed to effectively mitigate DoS or DDoS attacks, they serve as powerful tools for preventing brute-force attempts or implementing rate limiting for APIs.</p>
<p>In both cases—whether the limit applies to connections or requests—clients exceeding the defined limits will receive an HTTP status code <strong>"429 - Too Many Requests"</strong>, ensuring fair usage and protecting your resources.</p>
<h4 id="advanced-connections">Connections</h4>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>The following settings are related to the Limiting connections feature :</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Setting</th>
<th style="text-align: center;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>USE_LIMIT_CONN</code></td>
<td style="text-align: center;"><code>yes</code></td>
<td style="text-align: left;">When set to <code>yes</code>, will limit the maximum number of concurrent connections for a given IP.</td>
</tr>
<tr>
<td style="text-align: center;"><code>LIMIT_CONN_MAX_HTTP1</code></td>
<td style="text-align: center;"><code>10</code></td>
<td style="text-align: left;">Maximum number of concurrent connections when using HTTP1 protocol.</td>
</tr>
<tr>
<td style="text-align: center;"><code>LIMIT_CONN_MAX_HTTP2</code></td>
<td style="text-align: center;"><code>100</code></td>
<td style="text-align: left;">Maximum number of concurrent streams when using HTTP2 protocol.</td>
</tr>
<tr>
<td style="text-align: center;"><code>LIMIT_CONN_MAX_HTTP3</code></td>
<td style="text-align: center;"><code>100</code></td>
<td style="text-align: left;">Maximum number of concurrent streams when using HTTP3 protocol.</td>
</tr>
<tr>
<td style="text-align: center;"><code>LIMIT_CONN_MAX_STREAM</code></td>
<td style="text-align: center;"><code>10</code></td>
<td style="text-align: left;">Maximum number of connections per IP when using stream.</td>
</tr>
</tbody>
</table>
<h4 id="advanced-requests">Requests</h4>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>The following settings are related to the Limiting requests feature :</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_LIMIT_REQ</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate limit requests feature.</td>
</tr>
<tr>
<td><code>LIMIT_REQ_URL</code></td>
<td><code>/</code></td>
<td>multisite</td>
<td>yes</td>
<td>URL (PCRE regex) where the limit request will be applied or special value / for all requests.</td>
</tr>
<tr>
<td><code>LIMIT_REQ_RATE</code></td>
<td><code>2r/s</code></td>
<td>multisite</td>
<td>yes</td>
<td>Rate to apply to the URL (s for second, m for minute, h for hour and d for day).</td>
</tr>
</tbody>
</table>
<p>You can configure specific rate limits for different URLs by appending a numeric suffix to the relevant settings, providing fine-grained control over traffic to various endpoints. For example:</p>
<ul>
<li><strong><code>LIMIT_REQ_URL_1=^/url1$</code></strong> and <strong><code>LIMIT_REQ_RATE_1=5r/d</code></strong>: Limits requests to <code>/url1</code> to a maximum of 5 requests per day.</li>
<li><strong><code>LIMIT_REQ_URL_2=^/url2/subdir/.*$</code></strong> and <strong><code>LIMIT_REQ_RATE_2=1r/m</code></strong>: Imposes a stricter limit of 1 request per minute for any URL under <code>/url2/subdir/</code>.</li>
</ul>
<p>This flexibility ensures tailored rate limits for different endpoints based on their usage patterns, sensitivity, or importance.</p>
<div class="admonition tip">
<p class="admonition-title">Rate Limiting Best Practices</p>
<ul>
<li>
<p><strong>Regex Matching</strong>:
  The <code>LIMIT_REQ_URL</code> values use <strong>PCRE (Perl Compatible Regular Expressions)</strong>, allowing advanced patterns to precisely match specific URLs or structures. This supports complex scenarios such as:</p>
<ul>
<li>Matching nested paths.</li>
<li>Limiting requests to specific file types (e.g., <code>^/files/.*\.pdf$</code>).</li>
<li>Handling parameterized URLs.</li>
</ul>
</li>
<li>
<p><strong>Efficient Traffic Management</strong>:
  Properly applied, these settings help balance resource usage, mitigate abuse, and protect critical endpoints without impacting legitimate users.</p>
</li>
</ul>
</div>
<h3 id="advanced-country">Country</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>The <strong>Country Security</strong> feature enables you to enforce policies based on the geographic location of a client's IP address. This provides an additional layer of control and security for your application. You can configure it to:</p>
<ul>
<li><strong>Blacklist</strong>: Deny access to clients if their country is included in a blacklist. These clients will be entirely blocked from reaching your application.</li>
<li><strong>Whitelist</strong>: Allow access only to clients whose country is included in a whitelist. Clients from other countries will be denied access, but those allowed will still undergo other configured security checks.</li>
</ul>
<p>This feature is particularly useful for restricting access to certain regions, protecting sensitive resources, or reducing exposure to potential threats originating from specific areas.</p>
<p>Here is the list of related settings :</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BLACKLIST_COUNTRY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Deny access if the country of the client is in the list (ISO 3166-1 alpha-2 format separated with spaces).</td>
</tr>
<tr>
<td><code>WHITELIST_COUNTRY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Deny access if the country of the client is not in the list (ISO 3166-1 alpha-2 format separated with spaces).</td>
</tr>
</tbody>
</table>
<p>Using both a country blacklist and a whitelist simultaneously is logically redundant and not recommended. If both are configured, the <strong>whitelist takes precedence</strong>, meaning only the whitelist will be applied, and the blacklist will be ignored.</p>
<p>To avoid confusion and ensure clear policy enforcement, use either a blacklist or a whitelist based on your specific security requirements, but not both at the same time.</p>
<h3 id="advanced-authentication">Authentication</h3>
<h4 id="advanced-auth-basic">Auth basic</h4>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>To safeguard sensitive resources, such as an admin area, you can enable <strong>HTTP Basic Authentication</strong>. This simple yet effective mechanism requires users to provide valid credentials before accessing the protected resource, adding an extra layer of security with minimal configuration.</p>
<p>Here is the list of related settings :</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Setting</th>
<th style="text-align: center;">Default</th>
<th style="text-align: left;">Multiple</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>USE_AUTH_BASIC</code></td>
<td style="text-align: center;"><code>no</code></td>
<td style="text-align: left;">no</td>
<td style="text-align: left;">When set to <code>yes</code> HTTP auth basic will be enabled.</td>
</tr>
<tr>
<td style="text-align: center;"><code>AUTH_BASIC_LOCATION</code></td>
<td style="text-align: center;"><code>sitewide</code></td>
<td style="text-align: left;">no</td>
<td style="text-align: left;">Location (URL) of the sensitive resource. Use special value <code>sitewide</code> to enable everywhere.</td>
</tr>
<tr>
<td style="text-align: center;"><code>AUTH_BASIC_USER</code></td>
<td style="text-align: center;"><code>changeme</code></td>
<td style="text-align: left;">yes</td>
<td style="text-align: left;">The username required.</td>
</tr>
<tr>
<td style="text-align: center;"><code>AUTH_BASIC_PASSWORD</code></td>
<td style="text-align: center;"><code>changeme</code></td>
<td style="text-align: left;">yes</td>
<td style="text-align: left;">The password required.</td>
</tr>
<tr>
<td style="text-align: center;"><code>AUTH_BASIC_TEXT</code></td>
<td style="text-align: center;"><code>Restricted area</code></td>
<td style="text-align: left;">Text to display in the auth prompt.</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">multi users</p>
<p>You can set multiple users by using the following format : <code>AUTH_BASIC_USER_1</code>, <code>AUTH_BASIC_PASSWORD_1</code>, <code>AUTH_BASIC_USER_2</code>, <code>AUTH_BASIC_PASSWORD_2</code>, etc.</p>
</div>
<h4 id="advanced-auth-request">Auth request</h4>
<p>For more advanced authentication methods, such as Single Sign-On (SSO), you can leverage the <strong>auth request settings</strong>. This allows integration with external authentication systems by using subrequest-based authentication. For detailed information about this feature, refer to the <a href="https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-subrequest-authentication/">NGINX documentation</a>.</p>
<p>To help you get started, the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/examples">BunkerWeb repository</a> includes examples for popular authentication solutions like <a href="https://www.authelia.com/">Authelia</a> and <a href="https://goauthentik.io/">Authentik</a>. These examples demonstrate how to integrate these tools seamlessly with your deployment.</p>
<p><strong>Auth request settings are related to reverse proxy rules.</strong></p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>REVERSE_PROXY_AUTH_REQUEST</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Enable authentication using an external provider (value of auth_request directive).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_AUTH_REQUEST_SIGNIN_URL</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Redirect clients to sign-in URL when using REVERSE_PROXY_AUTH_REQUEST (used when auth_request call returned 401).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_AUTH_REQUEST_SET</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>List of variables to set from the authentication provider, separated with ; (values of auth_request_set directives).</td>
</tr>
</tbody>
</table>
<h3 id="advanced-monitoring-and-reporting">Monitoring and reporting</h3>
<h4 id="advanced-monitoring-pro">Monitoring <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style="transform : translateY(3px);"> (PRO)</h4>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>The monitoring plugin lets you collect and retrieve metrics about BunkerWeb. By enabling it, your instance(s) will start collecting various data related to attacks, requests and performance. You can then retrieve them by calling the <code>/monitoring</code> API endpoint on regular basis or by using other plugins like the Prometheus exporter one.</p>
<p><strong>List of features</strong></p>
<ul>
<li>Enable collection of various BunkerWeb metrics</li>
<li>Retrieve metrics from the API</li>
<li>Use in combination with other plugins (e.g. Prometheus exporter)</li>
<li>Dedicate UI page to monitor your instance(s)</li>
</ul>
<p><strong>List of settings</strong></p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_MONITORING</code></td>
<td><code>yes</code></td>
<td>global</td>
<td>no</td>
<td>Enable monitoring of BunkerWeb.</td>
</tr>
<tr>
<td><code>MONITORING_METRICS_DICT_SIZE</code></td>
<td><code>10M</code></td>
<td>global</td>
<td>no</td>
<td>Size of the dict to store monitoring metrics.</td>
</tr>
</tbody>
</table>
<h4 id="advanced-prometheus-exporter-pro">Prometheus exporter <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style="transform : translateY(3px);"> (PRO)</h4>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>The Prometheus exporter plugin adds a <a href="https://prometheus.io/docs/instrumenting/exporters/">Prometheus exporter</a> on your BunkerWeb instance(s). When enabled, you can configure your Prometheus instance(s) to scrape a specific endpoint on Bunkerweb and gather internal metrics.</p>
<p>We also provide a <a href="https://grafana.com/grafana/dashboards/20755-bunkerweb/">Grafana dashboard</a> that you can import into your own instance and connect to your own Prometheus datasource.</p>
<p><strong>Please note that the use of Prometheus exporter plugin requires to enable the Monitoring plugin (<code>USE_MONITORING=yes</code>)</strong></p>
<p><strong>List of features</strong></p>
<ul>
<li>Prometheus exporter providing internal BunkerWeb metrics</li>
<li>Dedicated and configurable port, listen IP and URL</li>
<li>Whitelist IP/network for maximum security</li>
</ul>
<p><strong>List of settings</strong></p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_PROMETHEUS_EXPORTER</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable the Prometheus export.</td>
</tr>
<tr>
<td><code>PROMETHEUS_EXPORTER_IP</code></td>
<td><code>0.0.0.0</code></td>
<td>global</td>
<td>no</td>
<td>Listening IP of the Prometheus exporter.</td>
</tr>
<tr>
<td><code>PROMETHEUS_EXPORTER_PORT</code></td>
<td><code>9113</code></td>
<td>global</td>
<td>no</td>
<td>Listening port of the Prometheus exporter.</td>
</tr>
<tr>
<td><code>PROMETHEUS_EXPORTER_URL</code></td>
<td><code>/metrics</code></td>
<td>global</td>
<td>no</td>
<td>HTTP URL of the Prometheus exporter.</td>
</tr>
<tr>
<td><code>PROMETHEUS_EXPORTER_ALLOW_IP</code></td>
<td><code>127.0.0.0/8 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16</code></td>
<td>global</td>
<td>no</td>
<td>List of IP/networks allowed to contact the Prometheus exporter endpoint.</td>
</tr>
</tbody>
</table>
<h4 id="advanced-reporting-pro">Reporting <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style="transform : translateY(3px);"> (PRO)</h4>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<div class="admonition warning">
<p class="admonition-title">Monitoring plugin needed</p>
<p>This plugins requires the Monitoring Pro plugin to be installed and enabled with the <code>USE_MONITORING</code> setting set to <code>yes</code>.</p>
</div>
<p>The Reporting plugin provides a comprehensive solution for regular reporting of important data from BunkerWeb, including global statistics, attacks, bans, requests, reasons, and AS information. It offers a wide range of features, including automatic report creation, customization options, and seamless integration with monitoring pro plugin. With the Reporting plugin, you can easily generate and manage reports to monitor the performance and security of your application.</p>
<p><strong>List of features</strong></p>
<ul>
<li>Regular reporting of important data from BunkerWeb, including global statistics, attacks, bans, requests, reasons, and AS information.</li>
<li>Integration with Monitoring Pro plugin for seamless integration and enhanced reporting capabilities.</li>
<li>Support for webhooks (classic, Discord, and Slack) for real-time notifications.</li>
<li>Support for SMTP for email notifications.</li>
<li>Configuration options for customization and flexibility.</li>
</ul>
<p><strong>List of settings</strong></p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_REPORTING_SMTP</code></td>
<td><code>no</code></td>
<td>global</td>
<td>Enable sending the report via email.</td>
</tr>
<tr>
<td><code>USE_REPORTING_WEBHOOK</code></td>
<td><code>no</code></td>
<td>global</td>
<td>Enable sending the report via webhook.</td>
</tr>
<tr>
<td><code>REPORTING_SCHEDULE</code></td>
<td><code>weekly</code></td>
<td>global</td>
<td>The frequency at which reports are sent.</td>
</tr>
<tr>
<td><code>REPORTING_WEBHOOK_URLS</code></td>
<td></td>
<td>global</td>
<td>List of webhook URLs to receive the report in Markdown (separated by spaces).</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_EMAILS</code></td>
<td></td>
<td>global</td>
<td>List of email addresses to receive the report in HTML format (separated by spaces).</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_HOST</code></td>
<td></td>
<td>global</td>
<td>The host server used for SMTP sending.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_PORT</code></td>
<td><code>465</code></td>
<td>global</td>
<td>The port used for SMTP. Please note that there are different standards depending on the type of connection (SSL = 465, TLS = 587).</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_FROM_EMAIL</code></td>
<td></td>
<td>global</td>
<td>The email address used as the sender. Note that 2FA must be disabled for this email address.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_FROM_USER</code></td>
<td></td>
<td>global</td>
<td>The user authentication value for sending via the from email address.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_FROM_PASSWORD</code></td>
<td></td>
<td>global</td>
<td>The password authentication value for sending via the from email address.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_SSL</code></td>
<td><code>SSL</code></td>
<td>global</td>
<td>Determine whether or not to use a secure connection for SMTP.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_SUBJECT</code></td>
<td><code>BunkerWeb Report</code></td>
<td>global</td>
<td>The subject line of the email.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Information and behavior</p>
<ul>
<li>case <code>USE_REPORTING_SMTP</code> is set to <code>yes</code>, the setting <code>REPORTING_SMTP_EMAILS</code> must be set.</li>
<li>case <code>USE_REPORTING_WEBHOOK</code> is set to <code>yes</code>, the setting <code>REPORTING_WEBHOOK_URLS</code> must be set.</li>
<li>Accepted values for <code>REPORTING_SCHEDULE</code> are <code>daily</code>, <code>weekly</code>and <code>monthly</code>.</li>
<li>case no <code>REPORTING_SMTP_FROM_USER</code> and <code>REPORTING_SMTP_FROM_PASSWORD</code> are set, the plugin will try to send the email without authentication.</li>
<li>case <code>REPORTING_SMTP_FROM_USER</code> isn't set but <code>REPORTING_SMTP_FROM_PASSWORD</code> is set, the plugin will use the <code>REPORTING_SMTP_FROM_EMAIL</code> as the username.</li>
<li>case the job fails, the plugin will retry sending the report in the next execution.</li>
</ul>
</div>
<h3 id="advanced-backup-and-restore">Backup and restore</h3>
<h4 id="advanced-backup">Backup</h4>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<h5 id="advanced-automated-backup">Automated backup</h5>
<div class="admonition warning">
<p class="admonition-title">Information for Red Hat Enterprise Linux (RHEL) 8.9 users</p>
<p>If you are using <strong>RHEL 8.9</strong> and plan on using an <strong>external database</strong>, you will need to install the <code>mysql-community-client</code> package to ensure the <code>mysqldump</code> command is available. You can install the package by executing the following commands:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="advanced-__tabbed_8_1" name="advanced-__tabbed_8" type="radio" /><input id="advanced-__tabbed_8_2" name="advanced-__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_8_1">MySQL/MariaDB</label><label for="advanced-__tabbed_8_2">PostgreSQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li>
<p><strong>Install the MySQL repository configuration package</strong></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>https://dev.mysql.com/get/mysql80-community-release-el8-9.noarch.rpm
</code></pre></div>
</li>
<li>
<p><strong>Enable the MySQL repository</strong></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>config-manager<span class="w"> </span>--enable<span class="w"> </span>mysql80-community
</code></pre></div>
</li>
<li>
<p><strong>Install the MySQL client</strong></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>mysql-community-client
</code></pre></div>
</li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Install the PostgreSQL repository configuration package</strong></p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-</span><span class="k">$(</span>uname<span class="w"> </span>-m<span class="k">)</span><span class="s2">/pgdg-redhat-repo-latest.noarch.rpm&quot;</span>
</code></pre></div>
</li>
<li>
<p><strong>Install the PostgreSQL client</strong></p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span>postgresql&lt;version&gt;
</code></pre></div>
</li>
</ol>
</div>
</div>
</div>
</div>
<p>Data is invaluable, especially in digital environments where it's susceptible to loss due to various factors such as hardware failures, software errors, or human mistakes. To mitigate such risks and ensure the safety and availability of your important files, it's crucial to establish a robust backup system. This section outlines the backup functionality provided by BunkerWeb, allowing you to securely store your data in a custom location through regular backups.</p>
<div class="admonition info">
<p class="admonition-title">Information and behavior</p>
<p>The importance of backups cannot be overstated. They serve as a safety net against data loss scenarios, providing a means to restore your system to a previous state in case of unexpected events. Regular backups not only safeguard your data but also offer peace of mind, knowing that you have a reliable mechanism in place to recover from any mishaps.</p>
</div>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BACKUP</code></td>
<td><code>yes</code></td>
<td>global</td>
<td>no</td>
<td>Enable or disable the backup feature</td>
</tr>
<tr>
<td><code>BACKUP_SCHEDULE</code></td>
<td><code>daily</code></td>
<td>global</td>
<td>no</td>
<td>The frequency of the backup</td>
</tr>
<tr>
<td><code>BACKUP_ROTATION</code></td>
<td><code>7</code></td>
<td>global</td>
<td>no</td>
<td>The number of backups to keep</td>
</tr>
<tr>
<td><code>BACKUP_DIRECTORY</code></td>
<td><code>/var/lib/bunkerweb/backups</code></td>
<td>global</td>
<td>no</td>
<td>The directory where the backup will be stored</td>
</tr>
</tbody>
</table>
<h5 id="advanced-manual-backup">Manual backup</h5>
<p>To manually initiate a backup, execute the following command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="advanced-__tabbed_9_1" name="advanced-__tabbed_9" type="radio" /><input id="advanced-__tabbed_9_2" name="advanced-__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_9_1">Linux</label><label for="advanced-__tabbed_9_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>save
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>save
</code></pre></div>
</div>
</div>
</div>
<p>This command will create a backup of your database and store it in the backup directory specified in the <code>BACKUP_DIRECTORY</code> setting.</p>
<p>You can also specify a custom directory for the backup by providing the <code>BACKUP_DIRECTORY</code> environment variable when executing the command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:2"><input checked="checked" id="advanced-__tabbed_10_1" name="advanced-__tabbed_10" type="radio" /><input id="advanced-__tabbed_10_2" name="advanced-__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_10_1">Linux</label><label for="advanced-__tabbed_10_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nv">BACKUP_DIRECTORY</span><span class="o">=</span>/path/to/backup/directory<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>save
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>-e<span class="w"> </span><span class="nv">BACKUP_DIRECTORY</span><span class="o">=</span>/path/to/backup/directory<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>save
</code></pre></div>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>cp<span class="w"> </span>&lt;scheduler_container&gt;:/path/to/backup/directory<span class="w"> </span>/path/to/backup/directory
</code></pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Specifications for MariaDB/MySQL</p>
<p>In case you are using MariaDB/MySQL, you may encounter the following error when trying to backup your database:</p>
<div class="highlight"><pre><span></span><code>caching_sha2_password<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>loaded:<span class="w"> </span>Error<span class="w"> </span>loading<span class="w"> </span>shared<span class="w"> </span>library<span class="w"> </span>/usr/lib/mariadb/plugin/caching_sha2_password.so
</code></pre></div>
<p>To resolve this issue, you can execute the following command to change the authentication plugin to <code>mysql_native_password</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;yourusername&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">mysql_native_password</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;youpassword&#39;</span><span class="p">;</span>
</code></pre></div>
<p>If you're using the Docker integration, you can add the following command to the <code>docker-compose.yml</code> file to automatically change the authentication plugin:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:2"><input checked="checked" id="advanced-__tabbed_11_1" name="advanced-__tabbed_11" type="radio" /><input id="advanced-__tabbed_11_2" name="advanced-__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_11_1">MariaDB</label><label for="advanced-__tabbed_11_2">MySQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:&lt;version&gt;</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--default-authentication-plugin=mysql_native_password</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql:&lt;version&gt;</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--default-authentication-plugin=mysql_native_password</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
</div>
</div>
</div>
<h5 id="advanced-manual-restore">Manual restore</h5>
<p>To manually initiate a restore, execute the following command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:2"><input checked="checked" id="advanced-__tabbed_12_1" name="advanced-__tabbed_12" type="radio" /><input id="advanced-__tabbed_12_2" name="advanced-__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_12_1">Linux</label><label for="advanced-__tabbed_12_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>restore
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>restore
</code></pre></div>
</div>
</div>
</div>
<p>This command will create a temporary backup of your database in <code>/var/tmp/bunkerweb/backups</code> and restore your database to the latest backup available in the backup directory specified in the <code>BACKUP_DIRECTORY</code> setting.</p>
<p>You can also specify a custom backup file for the restore by providing the path to it as an argument when executing the command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:2"><input checked="checked" id="advanced-__tabbed_13_1" name="advanced-__tabbed_13" type="radio" /><input id="advanced-__tabbed_13_2" name="advanced-__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_13_1">Linux</label><label for="advanced-__tabbed_13_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>restore<span class="w"> </span>/path/to/backup/file
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>cp<span class="w"> </span>/path/to/backup/file<span class="w"> </span>&lt;scheduler_container&gt;:/path/to/backup/file
</code></pre></div>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>restore<span class="w"> </span>/path/to/backup/file
</code></pre></div>
</div>
</div>
</div>
<div class="admonition example">
<p class="admonition-title">In case of failure</p>
<p>Don't worry if the restore fails, you can always restore your database to the previous state by executing the command again but with the <code>BACKUP_DIRECTORY</code> setting set to <code>/var/tmp/bunkerweb/backups</code>:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="14:2"><input checked="checked" id="advanced-__tabbed_14_1" name="advanced-__tabbed_14" type="radio" /><input id="advanced-__tabbed_14_2" name="advanced-__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_14_1">Linux</label><label for="advanced-__tabbed_14_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nv">BACKUP_DIRECTORY</span><span class="o">=</span>/var/tmp/bunkerweb/backups<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>restore
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>cp<span class="w"> </span>&lt;scheduler_container&gt;:/var/tmp/bunkerweb/backups<span class="w"> </span>/var/tmp/bunkerweb/backups
</code></pre></div>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>-e<span class="w"> </span><span class="nv">BACKUP_DIRECTORY</span><span class="o">=</span>/var/tmp/bunkerweb/backups<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>restore
</code></pre></div>
</div>
</div>
</div>
</div>
<h4 id="advanced-backup-s3-pro">Backup S3 <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style="transform : translateY(3px);"> (PRO)</h4>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>The Backup S3 tool seamlessly automates data protection, similar to the community backup plugin. However, it stands out by securely storing backups directly in an S3 bucket.</p>
<p>By activating this feature, you're proactively safeguarding your <strong>data's integrity</strong>. Storing backups <strong>remotely</strong> shields crucial information from threats like <strong>hardware failures</strong>, <strong>cyberattacks</strong>, or <strong>natural disasters</strong>. This ensures both <strong>security</strong> and <strong>availability</strong>, enabling swift recovery during <strong>unexpected events</strong>, preserving <strong>operational continuity</strong>, and ensuring <strong>peace of mind</strong>.</p>
<div class="admonition warning">
<p class="admonition-title">Information for Red Hat Enterprise Linux (RHEL) 8.9 users</p>
<p>If you are using <strong>RHEL 8.9</strong> and plan on using an <strong>external database</strong>, you will need to install the <code>mysql-community-client</code> package to ensure the <code>mysqldump</code> command is available. You can install the package by executing the following commands:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="15:2"><input checked="checked" id="advanced-__tabbed_15_1" name="advanced-__tabbed_15" type="radio" /><input id="advanced-__tabbed_15_2" name="advanced-__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_15_1">MySQL/MariaDB</label><label for="advanced-__tabbed_15_2">PostgreSQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li>
<p><strong>Install the MySQL repository configuration package</strong></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>https://dev.mysql.com/get/mysql80-community-release-el8-9.noarch.rpm
</code></pre></div>
</li>
<li>
<p><strong>Enable the MySQL repository</strong></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>config-manager<span class="w"> </span>--enable<span class="w"> </span>mysql80-community
</code></pre></div>
</li>
<li>
<p><strong>Install the MySQL client</strong></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>mysql-community-client
</code></pre></div>
</li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Install the PostgreSQL repository configuration package</strong></p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-</span><span class="k">$(</span>uname<span class="w"> </span>-m<span class="k">)</span><span class="s2">/pgdg-redhat-repo-latest.noarch.rpm&quot;</span>
</code></pre></div>
</li>
<li>
<p><strong>Install the PostgreSQL client</strong></p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span>postgresql&lt;version&gt;
</code></pre></div>
</li>
</ol>
</div>
</div>
</div>
</div>
<p><strong>List of features</strong></p>
<ul>
<li>Automatic data backup to an S3 bucket</li>
<li>Flexible scheduling options: daily, weekly, or monthly</li>
<li>Rotation management for controlling the number of backups to keep</li>
<li>Customizable compression level for backup files</li>
</ul>
<p><strong>List of settings</strong></p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BACKUP_S3</code></td>
<td><code>no</code></td>
<td>global</td>
<td>Enable or disable the S3 backup feature</td>
</tr>
<tr>
<td><code>BACKUP_S3_SCHEDULE</code></td>
<td><code>daily</code></td>
<td>global</td>
<td>The frequency of the backup</td>
</tr>
<tr>
<td><code>BACKUP_S3_ROTATION</code></td>
<td><code>7</code></td>
<td>global</td>
<td>The number of backups to keep</td>
</tr>
<tr>
<td><code>BACKUP_S3_ENDPOINT</code></td>
<td></td>
<td>global</td>
<td>The S3 endpoint</td>
</tr>
<tr>
<td><code>BACKUP_S3_BUCKET</code></td>
<td></td>
<td>global</td>
<td>The S3 bucket</td>
</tr>
<tr>
<td><code>BACKUP_S3_DIR</code></td>
<td></td>
<td>global</td>
<td>The S3 directory</td>
</tr>
<tr>
<td><code>BACKUP_S3_REGION</code></td>
<td></td>
<td>global</td>
<td>The S3 region</td>
</tr>
<tr>
<td><code>BACKUP_S3_ACCESS_KEY_ID</code></td>
<td></td>
<td>global</td>
<td>The S3 access key ID</td>
</tr>
<tr>
<td><code>BACKUP_S3_ACCESS_KEY_SECRET</code></td>
<td></td>
<td>global</td>
<td>The S3 access key secret</td>
</tr>
<tr>
<td><code>BACKUP_S3_COMP_LEVEL</code></td>
<td><code>6</code></td>
<td>global</td>
<td>The compression level of the backup zip file</td>
</tr>
</tbody>
</table>
<h5 id="advanced-manual-backup_1">Manual backup</h5>
<p>To manually initiate a backup, execute the following command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="16:2"><input checked="checked" id="advanced-__tabbed_16_1" name="advanced-__tabbed_16" type="radio" /><input id="advanced-__tabbed_16_2" name="advanced-__tabbed_16" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_16_1">Linux</label><label for="advanced-__tabbed_16_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>save
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>save
</code></pre></div>
</div>
</div>
</div>
<p>This command will create a backup of your database and store it in the S3 bucket specified in the <code>BACKUP_S3_BUCKET</code> setting.</p>
<p>You can also specify a custom S3 bucket for the backup by providing the <code>BACKUP_S3_BUCKET</code> environment variable when executing the command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="17:2"><input checked="checked" id="advanced-__tabbed_17_1" name="advanced-__tabbed_17" type="radio" /><input id="advanced-__tabbed_17_2" name="advanced-__tabbed_17" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_17_1">Linux</label><label for="advanced-__tabbed_17_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nv">BACKUP_S3_BUCKET</span><span class="o">=</span>your-bucket-name<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>save
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>-e<span class="w"> </span><span class="nv">BACKUP_S3_BUCKET</span><span class="o">=</span>your-bucket-name<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>save
</code></pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Specifications for MariaDB/MySQL</p>
<p>In case you are using MariaDB/MySQL, you may encounter the following error when trying to backup your database:</p>
<div class="highlight"><pre><span></span><code>caching_sha2_password<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>loaded:<span class="w"> </span>Error<span class="w"> </span>loading<span class="w"> </span>shared<span class="w"> </span>library<span class="w"> </span>/usr/lib/mariadb/plugin/caching_sha2_password.so
</code></pre></div>
<p>To resolve this issue, you can execute the following command to change the authentication plugin to <code>mysql_native_password</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;yourusername&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">mysql_native_password</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;youpassword&#39;</span><span class="p">;</span>
</code></pre></div>
<p>If you're using the Docker integration, you can add the following command to the <code>docker-compose.yml</code> file to automatically change the authentication plugin:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="18:2"><input checked="checked" id="advanced-__tabbed_18_1" name="advanced-__tabbed_18" type="radio" /><input id="advanced-__tabbed_18_2" name="advanced-__tabbed_18" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_18_1">MariaDB</label><label for="advanced-__tabbed_18_2">MySQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:&lt;version&gt;</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--default-authentication-plugin=mysql_native_password</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql:&lt;version&gt;</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--default-authentication-plugin=mysql_native_password</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
</div>
</div>
</div>
<h5 id="advanced-manual-restore_1">Manual restore</h5>
<p>To manually initiate a restore, execute the following command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="19:2"><input checked="checked" id="advanced-__tabbed_19_1" name="advanced-__tabbed_19" type="radio" /><input id="advanced-__tabbed_19_2" name="advanced-__tabbed_19" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_19_1">Linux</label><label for="advanced-__tabbed_19_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>restore
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>restore
</code></pre></div>
</div>
</div>
</div>
<p>This command will create a temporary backup of your database in the S3 bucket specified in the <code>BACKUP_S3_BUCKET</code> setting and restore your database to the latest backup available in the bucket.</p>
<p>You can also specify a custom backup file for the restore by providing the path to it as an argument when executing the command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="20:2"><input checked="checked" id="advanced-__tabbed_20_1" name="advanced-__tabbed_20" type="radio" /><input id="advanced-__tabbed_20_2" name="advanced-__tabbed_20" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_20_1">Linux</label><label for="advanced-__tabbed_20_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>restore<span class="w"> </span>s3_backup_file.zip
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>restore<span class="w"> </span>s3_backup_file.zip
</code></pre></div>
</div>
</div>
</div>
<div class="admonition example">
<p class="admonition-title">In case of failure</p>
<p>Don't worry if the restore fails, you can always restore your database to the previous state by executing the command again as a backup is created before the restore:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="21:2"><input checked="checked" id="advanced-__tabbed_21_1" name="advanced-__tabbed_21" type="radio" /><input id="advanced-__tabbed_21_2" name="advanced-__tabbed_21" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_21_1">Linux</label><label for="advanced-__tabbed_21_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>restore
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup_s3<span class="w"> </span>restore
</code></pre></div>
</div>
</div>
</div>
</div>
<h3 id="advanced-migration-pro">Migration <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style="transform : translateY(3px);"> (PRO)</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>The Migration plugin <strong>revolutionizes</strong> BunkerWeb configuration transfers between instances with its <strong>user-friendly web interface</strong>, simplifying the entire migration journey. Whether you're upgrading systems, scaling infrastructure, or transitioning environments, this tool empowers you to effortlessly transfer <strong>settings, preferences, and data</strong> with unmatched ease and confidence. Say goodbye to cumbersome manual processes and hello to a <strong>seamless, hassle-free migration experience</strong>.</p>
<p><strong>List of features</strong></p>
<ul>
<li>
<p><strong>Effortless Migration:</strong> Easily transfer BunkerWeb configurations between instances without the complexities of manual procedures.</p>
</li>
<li>
<p><strong>Intuitive Web Interface:</strong> Navigate through the migration process effortlessly with a user-friendly web interface designed for intuitive operation.</p>
</li>
<li>
<p><strong>Cross-Database Compatibility:</strong> Enjoy seamless migration across various database platforms, including SQLite, MySQL, MariaDB, and PostgreSQL, ensuring compatibility with your preferred database environment.</p>
</li>
</ul>
<h4 id="advanced-create-a-migration-file">Create a migration file</h4>
<p>To manually create a migration file, execute the following command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="22:2"><input checked="checked" id="advanced-__tabbed_22_1" name="advanced-__tabbed_22" type="radio" /><input id="advanced-__tabbed_22_2" name="advanced-__tabbed_22" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_22_1">Linux</label><label for="advanced-__tabbed_22_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>migration<span class="w"> </span>create<span class="w"> </span>/path/to/migration/file
</code></pre></div>
</div>
<div class="tabbed-block">
<ol>
<li>
<p>Create a migration file:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>migration<span class="w"> </span>create<span class="w"> </span>/path/to/migration/file
</code></pre></div>
</li>
<li>
<p>Copy the migration file to your local machine:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>cp<span class="w"> </span>&lt;scheduler_container&gt;:/path/to/migration/file<span class="w"> </span>/path/to/migration/file
</code></pre></div>
</li>
</ol>
</div>
</div>
</div>
<p>This command will create a backup of your database and store it in the backup directory specified in the command.</p>
<div class="admonition note">
<p class="admonition-title">Specifications for MariaDB/MySQL</p>
<p>In case you are using MariaDB/MySQL, you may encounter the following error when trying to backup your database:</p>
<div class="highlight"><pre><span></span><code>caching_sha2_password<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>loaded:<span class="w"> </span>Error<span class="w"> </span>loading<span class="w"> </span>shared<span class="w"> </span>library<span class="w"> </span>/usr/lib/mariadb/plugin/caching_sha2_password.so
</code></pre></div>
<p>To resolve this issue, you can execute the following command to change the authentication plugin to <code>mysql_native_password</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;yourusername&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">mysql_native_password</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;youpassword&#39;</span><span class="p">;</span>
</code></pre></div>
<p>If you're using the Docker integration, you can add the following command to the <code>docker-compose.yml</code> file to automatically change the authentication plugin:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="23:2"><input checked="checked" id="advanced-__tabbed_23_1" name="advanced-__tabbed_23" type="radio" /><input id="advanced-__tabbed_23_2" name="advanced-__tabbed_23" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_23_1">MariaDB</label><label for="advanced-__tabbed_23_2">MySQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:&lt;version&gt;</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--default-authentication-plugin=mysql_native_password</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql:&lt;version&gt;</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--default-authentication-plugin=mysql_native_password</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</div>
</div>
</div>
</div>
<h4 id="advanced-initialize-a-migration">Initialize a migration</h4>
<p>To manually initialize a migration, execute the following command:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="24:2"><input checked="checked" id="advanced-__tabbed_24_1" name="advanced-__tabbed_24" type="radio" /><input id="advanced-__tabbed_24_2" name="advanced-__tabbed_24" type="radio" /><div class="tabbed-labels"><label for="advanced-__tabbed_24_1">Linux</label><label for="advanced-__tabbed_24_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>bwcli<span class="w"> </span>plugin<span class="w"> </span>migration<span class="w"> </span>migrate<span class="w"> </span>/path/to/migration/file
</code></pre></div>
</div>
<div class="tabbed-block">
<ol>
<li>
<p>Copy the migration file to the container:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>cp<span class="w"> </span>/path/to/migration/file<span class="w"> </span>&lt;scheduler_container&gt;:/path/to/migration/file
</code></pre></div>
</li>
<li>
<p>Initialize the migration:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>migration<span class="w"> </span>migrate<span class="w"> </span>/path/to/migration/file
</code></pre></div>
</li>
</ol>
</div>
</div>
</div>
<p>This command seamlessly migrates your BunkerWeb data to precisely match the configuration outlined in the migration file.</p>
<h3 id="advanced-securitytxt">Security.txt</h3>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>The Security.txt plugin allows you to easily create a <code>security.txt</code> file for your website, providing a standardized method for security researchers and others to report security vulnerabilities. By enabling this feature, you can enhance your site's security posture and streamline the reporting process for potential security issues.</p>
<p><strong>List of features</strong></p>
<ul>
<li><strong>Streamlined and Standardized Reporting:</strong> Implement a standardized and user-friendly method for security researchers to report vulnerabilities, ensuring clear communication and timely responses.</li>
<li><strong>Enhanced Security Posture and Transparency:</strong> Strengthen your site's security by providing clear guidelines for reporting security issues, fostering transparency and trust within the security community.</li>
<li><strong>Customizable and User-Friendly Configuration:</strong> Customize the <code>security.txt</code> file to include specific contact information and security policies, and manage it easily through a user-friendly web interface.</li>
<li><strong>Compliance with Best Practices:</strong> Align with industry best practices by implementing a <code>security.txt</code> file, demonstrating your commitment to security and fostering a collaborative security culture.</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Settings required</p>
<p>To enable the Security.txt plugin, you need to at least set the <code>SECURITYTXT_CONTACT</code> setting to a valid value to specify the contact information for reporting security vulnerabilities. If this setting is not configured, the <code>security.txt</code> file won't be served.</p>
</div>
<p><strong>List of settings</strong></p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_SECURITYTXT</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable security.txt file.</td>
</tr>
<tr>
<td><code>SECURITYTXT_URI</code></td>
<td><code>/.well-known/security.txt</code></td>
<td>multisite</td>
<td>no</td>
<td>Indicates the URI where the "security.txt" file will be accessible from.</td>
</tr>
<tr>
<td><code>SECURITYTXT_CONTACT</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Indicates a method that researchers should use for reporting security vulnerabilities such as an email address, a phone number, and/or a web page with contact information. (If the value is empty, the security.txt file will not be created as it is a required field)</td>
</tr>
<tr>
<td><code>SECURITYTXT_EXPIRES</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Indicates the date and time after which the data contained in the "security.txt" file is considered stale and should not be used (If the value is empty, the value will always be the current date and time + 1 year).</td>
</tr>
<tr>
<td><code>SECURITYTXT_ENCRYPTION</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Indicates an encryption key that security researchers should use for encrypted communication.</td>
</tr>
<tr>
<td><code>SECURITYTXT_ACKNOWLEDGEMENTS</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Indicates a link to a page where security researchers are recognized for their reports.</td>
</tr>
<tr>
<td><code>SECURITYTXT_PREFERRED_LANG</code></td>
<td><code>en</code></td>
<td>multisite</td>
<td>no</td>
<td>Can be used to indicate a set of natural languages that are preferred when submitting security reports.</td>
</tr>
<tr>
<td><code>SECURITYTXT_CANONICAL</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Indicates the canonical URIs where the "security.txt" file is located, which is usually something like "https://example.com/.well-known/security.txt". (If the value is empty, the default value will be automatically generated from the site URL + SECURITYTXT_URI)</td>
</tr>
<tr>
<td><code>SECURITYTXT_POLICY</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Indicates a link to where the vulnerability disclosure policy is located.</td>
</tr>
<tr>
<td><code>SECURITYTXT_HIRING</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Used for linking to the vendor's security-related job positions.</td>
</tr>
<tr>
<td><code>SECURITYTXT_CSAF</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>A link to the provider-metadata.json of your CSAF (Common Security Advisory Framework) provider.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Autogenerated values</p>
<ul>
<li>The <code>SECURITYTXT_CANONICAL</code> setting is automatically generated from the site URL and the <code>SECURITYTXT_URI</code> setting (if the value is empty).</li>
<li>The <code>SECURITYTXT_EXPIRES</code> setting is automatically generated to be the current date and time + 1 year if the value is empty.</li>
</ul>
</div>
<h3 id="advanced-anti-ddos-pro">Anti DDoS <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style="transform : translateY(3px);"> (PRO)</h3>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>The <strong>Anti DDoS</strong> Plugin provides advanced protection against Distributed Denial of Service (DDoS) attacks by monitoring, analyzing, and filtering suspicious traffic in real-time.</p>
<p>By employing a <strong>sliding window mechanism</strong>, the plugin maintains an in-memory dictionary of request timestamps to detect abnormal traffic spikes from individual IP addresses. Based on the configured security mode, it can either block offending connections or log the suspicious activity for further review.</p>
<h4 id="advanced-features">Features</h4>
<ul>
<li><strong>Real-Time Traffic Analysis:</strong> Continuously monitors incoming requests to detect potential DDoS attacks.</li>
<li><strong>Sliding Window Mechanism:</strong> Tracks recent request activity within a configurable time window.</li>
<li><strong>Configurable Thresholds:</strong> Allows you to define the maximum number of suspicious requests per IP.</li>
<li><strong>Advanced Blocking Logic:</strong> Evaluates both per-IP request counts and the number of distinct IPs exceeding the threshold.</li>
<li><strong>Flexible Security Modes:</strong> Choose between immediate connection blocking or detection-only (logging) mode.</li>
<li><strong>Optimized In-Memory Datastore:</strong> Ensures high-speed lookups and efficient metric tracking.</li>
<li><strong>Automatic Housekeeping:</strong> Periodically clears outdated data to maintain optimal performance.</li>
</ul>
<h4 id="advanced-configuration">Configuration</h4>
<p>Customize the plugin behavior using the following settings:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_ANTIDDOS</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable or disable the Anti DDoS protection. Set to <code>"yes"</code> to activate the plugin.</td>
</tr>
<tr>
<td><code>ANTIDDOS_METRICS_DICT_SIZE</code></td>
<td><code>10M</code></td>
<td>global</td>
<td>no</td>
<td>Size of the in-memory datastore for tracking DDoS metrics (e.g., <code>10M</code>, <code>500k</code>).</td>
</tr>
<tr>
<td><code>ANTIDDOS_THRESHOLD</code></td>
<td><code>100</code></td>
<td>global</td>
<td>no</td>
<td>Maximum number of suspicious requests allowed per IP within the defined time window.</td>
</tr>
<tr>
<td><code>ANTIDDOS_WINDOW_TIME</code></td>
<td><code>10</code></td>
<td>global</td>
<td>no</td>
<td>Time window in seconds during which suspicious requests are tallied.</td>
</tr>
<tr>
<td><code>ANTIDDOS_STATUS_CODES</code></td>
<td><code>429 403 444</code></td>
<td>global</td>
<td>no</td>
<td>HTTP status codes considered suspicious and used to trigger anti-DDoS actions.</td>
</tr>
<tr>
<td><code>ANTIDDOS_DISTINCT_IP</code></td>
<td><code>5</code></td>
<td>global</td>
<td>no</td>
<td>Minimum number of distinct IPs that must exceed the threshold before enforcing the block mode.</td>
</tr>
</tbody>
</table>
<h4 id="advanced-best-practices">Best Practices</h4>
<ul>
<li><strong>Threshold Tuning:</strong> Adjust <code>ANTIDDOS_THRESHOLD</code> and <code>ANTIDDOS_WINDOW_TIME</code> based on your typical traffic patterns.</li>
<li><strong>Status Code Review:</strong> Regularly update <code>ANTIDDOS_STATUS_CODES</code> to capture new or evolving suspicious behaviors.</li>
<li><strong>Monitoring:</strong> Analyze logs and metrics periodically to fine-tune settings and improve overall protection.</li>
</ul>
<h3 id="advanced-user-manager-pro">User Manager <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style="transform : translateY(3px);"> (PRO)</h3>
<p>The User Management Plugin offers a robust interface for administering user accounts within your system.</p>
<p>With this plugin, administrators can effortlessly create, update, and disable user accounts, manage user roles, toggle two-factor authentication (2FA), and view detailed user information such as last login timestamps and account statuses (active or inactive). Designed with security and ease-of-use in mind, this plugin simplifies routine user management tasks while ensuring compliance and auditability.</p>
<h4 id="advanced-features_1">Features</h4>
<ul>
<li><strong>User Account Operations:</strong> Create, edit, and delete user accounts with ease.</li>
<li><strong>Role-Based Access Control:</strong> Assign and modify user roles to manage permissions and access levels.</li>
<li><strong>2FA Management:</strong> Disable two-factor authentication based on administrative decisions.</li>
<li><strong>Comprehensive User Insights:</strong> Monitor key user data including last login times, account creation dates, and active/inactive status.</li>
<li><strong>Audit Logging:</strong> Maintain an audit trail for all user management actions for enhanced security and compliance.</li>
</ul>
<figure>
<p><img align="center" alt="Overview" src="../assets/img/user-manager.png" />
  </p>
<figcaption>User Manager page</figcaption>
</figure>
<figure>
<p><img align="center" alt="Create user form" src="../assets/img/user-manager-create.png" />
  </p>
<figcaption>User Manager - Create user form</figcaption>
</figure></section><section class="print-page" id="settings"><h1 id="settings-settings">Settings</h1>
<div class="admonition info">
<p class="admonition-title">Settings generator tool</p>
<p>To help you tune BunkerWeb, we have made an easy-to-use settings generator tool available at <a href="https://config.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc">config.bunkerweb.io</a>.</p>
</div>
<p>This section contains the full list of settings supported by BunkerWeb. If you are not yet familiar with BunkerWeb, you should first read the <a href="#concepts">concepts</a> section of the documentation. Please follow the instructions for your own <a href="#integrations">integration</a> on how to apply the settings.</p>
<p>As a general rule when multisite mode is enabled, if you want to apply settings with multisite context to a specific server, you will need to add the primary (first) server name as a prefix like <code>www.example.com_USE_ANTIBOT=captcha</code> or <code>myapp.example.com_USE_GZIP=yes</code> for example.</p>
<p>When settings are considered as "multiple", it means that you can have multiple groups of settings for the same feature by adding numbers as suffix like <code>REVERSE_PROXY_URL_1=/subdir</code>, <code>REVERSE_PROXY_HOST_1=http://myhost1</code>, <code>REVERSE_PROXY_URL_2=/anotherdir</code>, <code>REVERSE_PROXY_HOST_2=http://myhost2</code>, ... for example.</p>
<h2 id="settings-global-settings">Global settings</h2>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /></p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>IS_LOADING</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Internal use : set to yes when BW is loading.</td>
</tr>
<tr>
<td><code>NGINX_PREFIX</code></td>
<td><code>/etc/nginx/</code></td>
<td>global</td>
<td>no</td>
<td>Where nginx will search for configurations.</td>
</tr>
<tr>
<td><code>HTTP_PORT</code></td>
<td><code>8080</code></td>
<td>global</td>
<td>yes</td>
<td>HTTP port number which bunkerweb binds to.</td>
</tr>
<tr>
<td><code>HTTPS_PORT</code></td>
<td><code>8443</code></td>
<td>global</td>
<td>yes</td>
<td>HTTPS port number which bunkerweb binds to.</td>
</tr>
<tr>
<td><code>MULTISITE</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Multi site activation.</td>
</tr>
<tr>
<td><code>SERVER_NAME</code></td>
<td><code>www.example.com</code></td>
<td>multisite</td>
<td>no</td>
<td>List of the virtual hosts served by bunkerweb.</td>
</tr>
<tr>
<td><code>WORKER_PROCESSES</code></td>
<td><code>auto</code></td>
<td>global</td>
<td>no</td>
<td>Number of worker processes.</td>
</tr>
<tr>
<td><code>WORKER_RLIMIT_NOFILE</code></td>
<td><code>2048</code></td>
<td>global</td>
<td>no</td>
<td>Maximum number of open files for worker processes.</td>
</tr>
<tr>
<td><code>WORKER_CONNECTIONS</code></td>
<td><code>1024</code></td>
<td>global</td>
<td>no</td>
<td>Maximum number of connections per worker.</td>
</tr>
<tr>
<td><code>LOG_FORMAT</code></td>
<td><code>$host $remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent"</code></td>
<td>global</td>
<td>no</td>
<td>The format to use for access logs.</td>
</tr>
<tr>
<td><code>LOG_LEVEL</code></td>
<td><code>notice</code></td>
<td>global</td>
<td>no</td>
<td>The level to use for error logs.</td>
</tr>
<tr>
<td><code>DNS_RESOLVERS</code></td>
<td><code>127.0.0.11</code></td>
<td>global</td>
<td>no</td>
<td>DNS addresses of resolvers to use.</td>
</tr>
<tr>
<td><code>WORKERLOCK_MEMORY_SIZE</code></td>
<td><code>48k</code></td>
<td>global</td>
<td>no</td>
<td>Size of lua_shared_dict for initialization workers</td>
</tr>
<tr>
<td><code>DATASTORE_MEMORY_SIZE</code></td>
<td><code>64m</code></td>
<td>global</td>
<td>no</td>
<td>Size of the internal datastore.</td>
</tr>
<tr>
<td><code>CACHESTORE_MEMORY_SIZE</code></td>
<td><code>64m</code></td>
<td>global</td>
<td>no</td>
<td>Size of the internal cachestore.</td>
</tr>
<tr>
<td><code>CACHESTORE_IPC_MEMORY_SIZE</code></td>
<td><code>16m</code></td>
<td>global</td>
<td>no</td>
<td>Size of the internal cachestore (ipc).</td>
</tr>
<tr>
<td><code>CACHESTORE_MISS_MEMORY_SIZE</code></td>
<td><code>16m</code></td>
<td>global</td>
<td>no</td>
<td>Size of the internal cachestore (miss).</td>
</tr>
<tr>
<td><code>CACHESTORE_LOCKS_MEMORY_SIZE</code></td>
<td><code>16m</code></td>
<td>global</td>
<td>no</td>
<td>Size of the internal cachestore (locks).</td>
</tr>
<tr>
<td><code>USE_API</code></td>
<td><code>yes</code></td>
<td>global</td>
<td>no</td>
<td>Activate the API to control BunkerWeb.</td>
</tr>
<tr>
<td><code>API_HTTP_PORT</code></td>
<td><code>5000</code></td>
<td>global</td>
<td>no</td>
<td>Listen port number for the API.</td>
</tr>
<tr>
<td><code>API_LISTEN_IP</code></td>
<td><code>0.0.0.0</code></td>
<td>global</td>
<td>no</td>
<td>Listen IP address for the API.</td>
</tr>
<tr>
<td><code>API_SERVER_NAME</code></td>
<td><code>bwapi</code></td>
<td>global</td>
<td>no</td>
<td>Server name (virtual host) for the API.</td>
</tr>
<tr>
<td><code>API_WHITELIST_IP</code></td>
<td><code>127.0.0.0/8</code></td>
<td>global</td>
<td>no</td>
<td>List of IP/network allowed to contact the API.</td>
</tr>
<tr>
<td><code>AUTOCONF_MODE</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable Autoconf Docker integration.</td>
</tr>
<tr>
<td><code>SWARM_MODE</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable Docker Swarm integration.</td>
</tr>
<tr>
<td><code>KUBERNETES_MODE</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable Kubernetes integration.</td>
</tr>
<tr>
<td><code>SERVER_TYPE</code></td>
<td><code>http</code></td>
<td>multisite</td>
<td>no</td>
<td>Server type : http or stream.</td>
</tr>
<tr>
<td><code>LISTEN_STREAM</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable listening for non-ssl (passthrough).</td>
</tr>
<tr>
<td><code>LISTEN_STREAM_PORT</code></td>
<td><code>1337</code></td>
<td>multisite</td>
<td>yes</td>
<td>Listening port for non-ssl (passthrough).</td>
</tr>
<tr>
<td><code>LISTEN_STREAM_PORT_SSL</code></td>
<td><code>4242</code></td>
<td>multisite</td>
<td>yes</td>
<td>Listening port for ssl (passthrough).</td>
</tr>
<tr>
<td><code>USE_TCP</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>TCP listen (stream).</td>
</tr>
<tr>
<td><code>USE_UDP</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>UDP listen (stream).</td>
</tr>
<tr>
<td><code>USE_IPV6</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable IPv6 connectivity.</td>
</tr>
<tr>
<td><code>IS_DRAFT</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Internal use : set to yes when the service is in draft mode.</td>
</tr>
<tr>
<td><code>TIMERS_LOG_LEVEL</code></td>
<td><code>debug</code></td>
<td>global</td>
<td>no</td>
<td>Log level for timers.</td>
</tr>
<tr>
<td><code>BUNKERWEB_INSTANCES</code></td>
<td><code>127.0.0.1</code></td>
<td>global</td>
<td>no</td>
<td>List of BunkerWeb instances separated with spaces (format : fqdn-or-ip:5000 http://fqdn-or-ip:5000)</td>
</tr>
<tr>
<td><code>USE_TEMPLATE</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Config template to use that will override the default values of specific settings.</td>
</tr>
<tr>
<td><code>SECURITY_MODE</code></td>
<td><code>block</code></td>
<td>multisite</td>
<td>no</td>
<td>Defines the response to threats: "detect" to monitor and log, or "block" to prevent access and log incidents.</td>
</tr>
</tbody>
</table>
<h2 id="settings-anti-ddos-pro">Anti DDoS <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style='transform : translateY(3px);'> (PRO)</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Provides enhanced protection against DDoS attacks by analyzing and filtering suspicious traffic.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_ANTIDDOS</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable or disable anti DDoS protection to mitigate high traffic spikes.</td>
</tr>
<tr>
<td><code>ANTIDDOS_METRICS_DICT_SIZE</code></td>
<td><code>10M</code></td>
<td>global</td>
<td>no</td>
<td>Size of in-memory storage for DDoS metrics (e.g., 10M, 500k).</td>
</tr>
<tr>
<td><code>ANTIDDOS_THRESHOLD</code></td>
<td><code>100</code></td>
<td>global</td>
<td>no</td>
<td>Maximum suspicious requests allowed from a single IP before blocking.</td>
</tr>
<tr>
<td><code>ANTIDDOS_WINDOW_TIME</code></td>
<td><code>10</code></td>
<td>global</td>
<td>no</td>
<td>Time window (seconds) to detect abnormal request patterns.</td>
</tr>
<tr>
<td><code>ANTIDDOS_STATUS_CODES</code></td>
<td><code>429 403 444</code></td>
<td>global</td>
<td>no</td>
<td>HTTP status codes treated as suspicious for DDoS analysis.</td>
</tr>
<tr>
<td><code>ANTIDDOS_DISTINCT_IP</code></td>
<td><code>5</code></td>
<td>global</td>
<td>no</td>
<td>Minimum distinct IP count before enabling anti DDoS measures.</td>
</tr>
</tbody>
</table>
<h2 id="settings-antibot">Antibot</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Bot detection by using a challenge.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_ANTIBOT</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate antibot feature.</td>
</tr>
<tr>
<td><code>ANTIBOT_URI</code></td>
<td><code>/challenge</code></td>
<td>multisite</td>
<td>no</td>
<td>Unused URI that clients will be redirected to to solve the challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_TIME_RESOLVE</code></td>
<td><code>60</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum time (in seconds) clients have to resolve the challenge. Once this time has passed, a new challenge will be generated.</td>
</tr>
<tr>
<td><code>ANTIBOT_TIME_VALID</code></td>
<td><code>86400</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum validity time of solved challenges. Once this time has passed, clients will need to resolve a new one.</td>
</tr>
<tr>
<td><code>ANTIBOT_RECAPTCHA_SCORE</code></td>
<td><code>0.7</code></td>
<td>multisite</td>
<td>no</td>
<td>Minimum score required for reCAPTCHA challenge (Only compatible with reCAPTCHA v3).</td>
</tr>
<tr>
<td><code>ANTIBOT_RECAPTCHA_SITEKEY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Sitekey for reCAPTCHA challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_RECAPTCHA_SECRET</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Secret for reCAPTCHA challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_HCAPTCHA_SITEKEY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Sitekey for hCaptcha challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_HCAPTCHA_SECRET</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Secret for hCaptcha challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_TURNSTILE_SITEKEY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Sitekey for Turnstile challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_TURNSTILE_SECRET</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Secret for Turnstile challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_MCAPTCHA_SITEKEY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Sitekey for mCaptcha challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_MCAPTCHA_SECRET</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Secret for mCaptcha challenge.</td>
</tr>
<tr>
<td><code>ANTIBOT_MCAPTCHA_URL</code></td>
<td><code>https://demo.mcaptcha.org</code></td>
<td>multisite</td>
<td>no</td>
<td>Domain to use for mCaptcha challenge.</td>
</tr>
</tbody>
</table>
<h2 id="settings-auth-basic">Auth basic</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Enforce login before accessing a resource or the whole site using HTTP basic auth method.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_AUTH_BASIC</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use HTTP basic auth</td>
</tr>
<tr>
<td><code>AUTH_BASIC_LOCATION</code></td>
<td><code>sitewide</code></td>
<td>multisite</td>
<td>no</td>
<td>URL of the protected resource or sitewide value.</td>
</tr>
<tr>
<td><code>AUTH_BASIC_USER</code></td>
<td><code>changeme</code></td>
<td>multisite</td>
<td>yes</td>
<td>Username</td>
</tr>
<tr>
<td><code>AUTH_BASIC_PASSWORD</code></td>
<td><code>changeme</code></td>
<td>multisite</td>
<td>yes</td>
<td>Password</td>
</tr>
<tr>
<td><code>AUTH_BASIC_TEXT</code></td>
<td><code>Restricted area</code></td>
<td>multisite</td>
<td>no</td>
<td>Text to display</td>
</tr>
</tbody>
</table>
<h2 id="settings-backup">Backup</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Backup your data to a custom location. Ensure the safety and availability of your important files by creating regular backups.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BACKUP</code></td>
<td><code>yes</code></td>
<td>global</td>
<td>no</td>
<td>Enable or disable the backup feature</td>
</tr>
<tr>
<td><code>BACKUP_SCHEDULE</code></td>
<td><code>daily</code></td>
<td>global</td>
<td>no</td>
<td>The frequency of the backup (daily, weekly or monthly)</td>
</tr>
<tr>
<td><code>BACKUP_ROTATION</code></td>
<td><code>7</code></td>
<td>global</td>
<td>no</td>
<td>The number of backups to keep</td>
</tr>
<tr>
<td><code>BACKUP_DIRECTORY</code></td>
<td><code>/var/lib/bunkerweb/backups</code></td>
<td>global</td>
<td>no</td>
<td>The directory where the backup will be stored</td>
</tr>
</tbody>
</table>
<h2 id="settings-backup-s3-pro">Backup S3 <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style='transform : translateY(3px);'> (PRO)</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Automatically backup your data to an S3 bucket</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BACKUP_S3</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable or disable the S3 backup feature</td>
</tr>
<tr>
<td><code>BACKUP_S3_SCHEDULE</code></td>
<td><code>daily</code></td>
<td>global</td>
<td>no</td>
<td>The frequency of the backup</td>
</tr>
<tr>
<td><code>BACKUP_S3_ROTATION</code></td>
<td><code>7</code></td>
<td>global</td>
<td>no</td>
<td>The number of backups to keep</td>
</tr>
<tr>
<td><code>BACKUP_S3_ENDPOINT</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>The S3 endpoint</td>
</tr>
<tr>
<td><code>BACKUP_S3_BUCKET</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>The S3 bucket</td>
</tr>
<tr>
<td><code>BACKUP_S3_DIR</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>The S3 directory</td>
</tr>
<tr>
<td><code>BACKUP_S3_REGION</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>The S3 region</td>
</tr>
<tr>
<td><code>BACKUP_S3_ACCESS_KEY_ID</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>The S3 access key ID</td>
</tr>
<tr>
<td><code>BACKUP_S3_ACCESS_KEY_SECRET</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>The S3 access key secret</td>
</tr>
<tr>
<td><code>BACKUP_S3_COMP_LEVEL</code></td>
<td><code>6</code></td>
<td>global</td>
<td>no</td>
<td>The compression level of the backup zip file</td>
</tr>
</tbody>
</table>
<h2 id="settings-bad-behavior">Bad behavior</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Ban IP generating too much 'bad' HTTP status code in a period of time.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BAD_BEHAVIOR</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate Bad behavior feature.</td>
</tr>
<tr>
<td><code>BAD_BEHAVIOR_STATUS_CODES</code></td>
<td><code>400 401 403 404 405 429 444</code></td>
<td>multisite</td>
<td>no</td>
<td>List of HTTP status codes considered as 'bad'.</td>
</tr>
<tr>
<td><code>BAD_BEHAVIOR_THRESHOLD</code></td>
<td><code>10</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum number of 'bad' HTTP status codes within the period of time before IP is banned.</td>
</tr>
<tr>
<td><code>BAD_BEHAVIOR_COUNT_TIME</code></td>
<td><code>60</code></td>
<td>multisite</td>
<td>no</td>
<td>Period of time (in seconds) during which we count 'bad' HTTP status codes.</td>
</tr>
<tr>
<td><code>BAD_BEHAVIOR_BAN_TIME</code></td>
<td><code>86400</code></td>
<td>multisite</td>
<td>no</td>
<td>The duration time (in seconds) of a ban when the corresponding IP has reached the threshold.</td>
</tr>
</tbody>
</table>
<h2 id="settings-blacklist">Blacklist</h2>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Deny access based on internal and external IP/network/rDNS/ASN blacklists.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BLACKLIST</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate blacklist feature.</td>
</tr>
<tr>
<td><code>BLACKLIST_IP</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of IP/network, separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_RDNS</code></td>
<td><code>.shodan.io .censys.io</code></td>
<td>multisite</td>
<td>no</td>
<td>List of reverse DNS suffixes, separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_RDNS_GLOBAL</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Only perform RDNS blacklist checks on global IP addresses.</td>
</tr>
<tr>
<td><code>BLACKLIST_ASN</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of ASN numbers, separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_USER_AGENT</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of User-Agent (PCRE regex), separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_URI</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URI (PCRE regex), separated with spaces, to block.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_IP</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of IP/network, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_RDNS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of reverse DNS suffixes, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_ASN</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of ASN numbers, separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_USER_AGENT</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of User-Agent (PCRE regex), separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_URI</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URI (PCRE regex), separated with spaces, to ignore in the blacklist.</td>
</tr>
<tr>
<td><code>BLACKLIST_IP_URLS</code></td>
<td><code>https://www.dan.me.uk/torlist/?exit</code></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing bad IP/network to block. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_RDNS_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing reverse DNS suffixes to block. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_ASN_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing ASN to block. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_USER_AGENT_URLS</code></td>
<td><code>https://raw.githubusercontent.com/mitchellkrogza/nginx-ultimate-bad-bot-blocker/master/_generator_lists/bad-user-agents.list</code></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing bad User-Agent to block. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_URI_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing bad URI to block. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_IP_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing IP/network to ignore in the blacklist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_RDNS_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing reverse DNS suffixes to ignore in the blacklist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_ASN_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing ASN to ignore in the blacklist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_USER_AGENT_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing User-Agent to ignore in the blacklist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>BLACKLIST_IGNORE_URI_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing URI to ignore in the blacklist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
</tbody>
</table>
<h2 id="settings-brotli">Brotli</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Compress HTTP requests with the brotli algorithm.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BROTLI</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable or disable Brotli compression.</td>
</tr>
<tr>
<td><code>BROTLI_TYPES</code></td>
<td><code>application/atom+xml application/javascript application/json application/rss+xml application/vnd.ms-fontobject application/x-font-opentype application/x-font-truetype application/x-font-ttf application/x-javascript application/xhtml+xml application/xml font/eot font/opentype font/otf font/truetype image/svg+xml image/vnd.microsoft.icon image/x-icon image/x-win-bitmap text/css text/javascript text/plain text/xml</code></td>
<td>multisite</td>
<td>no</td>
<td>List of MIME types that will be compressed with brotli.</td>
</tr>
<tr>
<td><code>BROTLI_MIN_LENGTH</code></td>
<td><code>1000</code></td>
<td>multisite</td>
<td>no</td>
<td>Minimum response size (in bytes) for Brotli compression to apply.</td>
</tr>
<tr>
<td><code>BROTLI_COMP_LEVEL</code></td>
<td><code>6</code></td>
<td>multisite</td>
<td>no</td>
<td>Compression level for Brotli (0 = no compression, 11 = maximum compression).</td>
</tr>
</tbody>
</table>
<h2 id="settings-bunkernet">BunkerNet</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Share threat data with other BunkerWeb instances via BunkerNet.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_BUNKERNET</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate BunkerNet feature.</td>
</tr>
<tr>
<td><code>BUNKERNET_SERVER</code></td>
<td><code>https://api.bunkerweb.io</code></td>
<td>global</td>
<td>no</td>
<td>Address of the BunkerNet API.</td>
</tr>
</tbody>
</table>
<h2 id="settings-cors">CORS</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Cross-Origin Resource Sharing.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_CORS</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use CORS</td>
</tr>
<tr>
<td><code>CORS_ALLOW_ORIGIN</code></td>
<td><code>self</code></td>
<td>multisite</td>
<td>no</td>
<td>Allowed origins to make CORS requests : PCRE regex or * or self (for the same origin).</td>
</tr>
<tr>
<td><code>CORS_ALLOW_METHODS</code></td>
<td><code>GET, POST, OPTIONS</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Allow-Methods header.</td>
</tr>
<tr>
<td><code>CORS_ALLOW_HEADERS</code></td>
<td><code>DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Allow-Headers header.</td>
</tr>
<tr>
<td><code>CORS_ALLOW_CREDENTIALS</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Send the Access-Control-Allow-Credentials header.</td>
</tr>
<tr>
<td><code>CORS_EXPOSE_HEADERS</code></td>
<td><code>Content-Length,Content-Range</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Expose-Headers header.</td>
</tr>
<tr>
<td><code>CROSS_ORIGIN_OPENER_POLICY</code></td>
<td><code>same-origin</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Cross-Origin-Opener-Policy header.</td>
</tr>
<tr>
<td><code>CROSS_ORIGIN_EMBEDDER_POLICY</code></td>
<td><code>require-corp</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Cross-Origin-Embedder-Policy header.</td>
</tr>
<tr>
<td><code>CROSS_ORIGIN_RESOURCE_POLICY</code></td>
<td><code>same-site</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Cross-Origin-Resource-Policy header.</td>
</tr>
<tr>
<td><code>CORS_MAX_AGE</code></td>
<td><code>86400</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Access-Control-Max-Age header.</td>
</tr>
<tr>
<td><code>CORS_DENY_REQUEST</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Deny request and don't send it to backend if Origin is not allowed.</td>
</tr>
</tbody>
</table>
<h2 id="settings-client-cache">Client cache</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Manage caching for clients.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_CLIENT_CACHE</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Tell client to store locally static files.</td>
</tr>
<tr>
<td><code>CLIENT_CACHE_EXTENSIONS</code></td>
<td><code>jpg                       | jpeg      | png      | bmp                                             | ico | svg | tif | css | js | otf | ttf | eot | woff | woff2</code></td>
<td>global</td>
<td>no</td>
<td>List of file extensions, separated with pipes that should be cached.</td>
</tr>
<tr>
<td><code>CLIENT_CACHE_ETAG</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Send the HTTP ETag header for static resources.</td>
</tr>
<tr>
<td><code>CLIENT_CACHE_CONTROL</code></td>
<td><code>public, max-age=15552000</code></td>
<td>multisite</td>
<td>no</td>
<td>Value of the Cache-Control HTTP header.</td>
</tr>
</tbody>
</table>
<h2 id="settings-country">Country</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Deny access based on the country of the client IP.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BLACKLIST_COUNTRY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Deny access if the country of the client is in the list (ISO 3166-1 alpha-2 format separated with spaces).</td>
</tr>
<tr>
<td><code>WHITELIST_COUNTRY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Deny access if the country of the client is not in the list (ISO 3166-1 alpha-2 format separated with spaces).</td>
</tr>
</tbody>
</table>
<h2 id="settings-custom-ssl-certificate">Custom SSL certificate</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Choose custom certificate for SSL.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_CUSTOM_SSL</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use custom SSL certificate.</td>
</tr>
<tr>
<td><code>CUSTOM_SSL_CERT_PRIORITY</code></td>
<td><code>file</code></td>
<td>multisite</td>
<td>no</td>
<td>Choose whether to prioritize the certificate from file path or from base64 data. (file</td>
</tr>
<tr>
<td><code>CUSTOM_SSL_CERT</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Full path of the certificate or bundle file (must be readable by the scheduler).</td>
</tr>
<tr>
<td><code>CUSTOM_SSL_KEY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Full path of the key file (must be readable by the scheduler).</td>
</tr>
<tr>
<td><code>CUSTOM_SSL_CERT_DATA</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Certificate data encoded in base64.</td>
</tr>
<tr>
<td><code>CUSTOM_SSL_KEY_DATA</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Key data encoded in base64.</td>
</tr>
</tbody>
</table>
<h2 id="settings-db">DB</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Integrate easily the Database.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DATABASE_URI</code></td>
<td><code>sqlite:////var/lib/bunkerweb/db.sqlite3</code></td>
<td>global</td>
<td>no</td>
<td>The database URI, following the sqlalchemy format.</td>
</tr>
<tr>
<td><code>DATABASE_URI_READONLY</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>The database URI for read-only operations, it can also serve as a fallback if the main database is down. Following the sqlalchemy format.</td>
</tr>
<tr>
<td><code>DATABASE_LOG_LEVEL</code></td>
<td><code>warning</code></td>
<td>global</td>
<td>no</td>
<td>The level to use for database logs.</td>
</tr>
<tr>
<td><code>DATABASE_MAX_JOBS_RUNS</code></td>
<td><code>10000</code></td>
<td>global</td>
<td>no</td>
<td>The maximum number of jobs runs to keep in the database.</td>
</tr>
</tbody>
</table>
<h2 id="settings-dnsbl">DNSBL</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Deny access based on external DNSBL servers.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_DNSBL</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate DNSBL feature.</td>
</tr>
<tr>
<td><code>DNSBL_LIST</code></td>
<td><code>bl.blocklist.de sbl.spamhaus.org xbl.spamhaus.org</code></td>
<td>global</td>
<td>no</td>
<td>List of DNSBL servers.</td>
</tr>
</tbody>
</table>
<h2 id="settings-errors">Errors</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Manage default error pages</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ERRORS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of HTTP error code and corresponding error pages, separated with spaces (404=/my404.html 403=/errors/403.html ...).</td>
</tr>
<tr>
<td><code>INTERCEPTED_ERROR_CODES</code></td>
<td><code>400 401 403 404 405 413 429 500 501 502 503 504</code></td>
<td>multisite</td>
<td>no</td>
<td>List of HTTP error code intercepted by BunkerWeb</td>
</tr>
</tbody>
</table>
<h2 id="settings-greylist">Greylist</h2>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Allow access while keeping security features based on internal and external IP/network/rDNS/ASN greylists.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_GREYLIST</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate greylist feature.</td>
</tr>
<tr>
<td><code>GREYLIST_IP</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of IP/network, separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_RDNS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of reverse DNS suffixes, separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_RDNS_GLOBAL</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Only perform RDNS greylist checks on global IP addresses.</td>
</tr>
<tr>
<td><code>GREYLIST_ASN</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of ASN numbers, separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_USER_AGENT</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of User-Agent (PCRE regex), separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_URI</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URI (PCRE regex), separated with spaces, to put into the greylist.</td>
</tr>
<tr>
<td><code>GREYLIST_IP_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing good IP/network to put into the greylist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>GREYLIST_RDNS_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing reverse DNS suffixes to put into the greylist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>GREYLIST_ASN_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing ASN to put into the greylist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>GREYLIST_USER_AGENT_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing good User-Agent to put into the greylist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>GREYLIST_URI_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing bad URI to put into the greylist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
</tbody>
</table>
<h2 id="settings-gzip">Gzip</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Compress HTTP requests with the gzip algorithm.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_GZIP</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable or disable Gzip compression.</td>
</tr>
<tr>
<td><code>GZIP_TYPES</code></td>
<td><code>application/atom+xml application/javascript application/json application/rss+xml application/vnd.ms-fontobject application/x-font-opentype application/x-font-truetype application/x-font-ttf application/x-javascript application/xhtml+xml application/xml font/eot font/opentype font/otf font/truetype image/svg+xml image/vnd.microsoft.icon image/x-icon image/x-win-bitmap text/css text/javascript text/plain text/xml</code></td>
<td>multisite</td>
<td>no</td>
<td>List of MIME types that will be compressed with gzip.</td>
</tr>
<tr>
<td><code>GZIP_MIN_LENGTH</code></td>
<td><code>1000</code></td>
<td>multisite</td>
<td>no</td>
<td>Minimum response size (in bytes) for Gzip compression to apply.</td>
</tr>
<tr>
<td><code>GZIP_COMP_LEVEL</code></td>
<td><code>5</code></td>
<td>multisite</td>
<td>no</td>
<td>Compression level for Gzip (1 = least compression, 9 = maximum compression).</td>
</tr>
<tr>
<td><code>GZIP_PROXIED</code></td>
<td><code>no-cache no-store private expired auth</code></td>
<td>multisite</td>
<td>no</td>
<td>Specifies which proxied requests should be compressed.</td>
</tr>
</tbody>
</table>
<h2 id="settings-html-injection">HTML injection</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Inject custom HTML code before either the </body> or 
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head> tag.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>INJECT_BODY</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>The HTML code to inject before the </body> tag.</td>
</tr>
<tr>
<td><code>INJECT_HEAD</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>The HTML code to inject before the 
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head> tag.</td>
</tr>
</tbody>
</table>
<h2 id="settings-headers">Headers</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Manage HTTP headers sent to clients.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CUSTOM_HEADER</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Custom header to add (HeaderName: HeaderValue).</td>
</tr>
<tr>
<td><code>REMOVE_HEADERS</code></td>
<td><code>Server Expect-CT X-Powered-By X-AspNet-Version X-AspNetMvc-Version Public-Key-Pins</code></td>
<td>multisite</td>
<td>no</td>
<td>Headers to remove (Header1 Header2 Header3 ...)</td>
</tr>
<tr>
<td><code>KEEP_UPSTREAM_HEADERS</code></td>
<td><code>Content-Security-Policy Permissions-Policy X-Frame-Options</code></td>
<td>multisite</td>
<td>no</td>
<td>Headers to keep from upstream (Header1 Header2 Header3 ... or * for all).</td>
</tr>
<tr>
<td><code>STRICT_TRANSPORT_SECURITY</code></td>
<td><code>max-age=63072000; includeSubDomains; preload</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Strict-Transport-Security (HSTS) header.</td>
</tr>
<tr>
<td><code>COOKIE_FLAGS</code></td>
<td><code>* HttpOnly SameSite=Lax</code></td>
<td>multisite</td>
<td>yes</td>
<td>Cookie flags automatically added to all cookies (value accepted for nginx_cookie_flag_module).</td>
</tr>
<tr>
<td><code>COOKIE_AUTO_SECURE_FLAG</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Automatically add the Secure flag to all cookies.</td>
</tr>
<tr>
<td><code>CONTENT_SECURITY_POLICY</code></td>
<td><code>object-src 'none'; form-action 'self'; frame-ancestors 'self';</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Content-Security-Policy header.</td>
</tr>
<tr>
<td><code>CONTENT_SECURITY_POLICY_REPORT_ONLY</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Send reports for violations of the Content-Security-Policy header instead of blocking them.</td>
</tr>
<tr>
<td><code>REFERRER_POLICY</code></td>
<td><code>strict-origin-when-cross-origin</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Referrer-Policy header.</td>
</tr>
<tr>
<td><code>PERMISSIONS_POLICY</code></td>
<td><code>accelerometer=(), ambient-light-sensor=(), attribution-reporting=(), autoplay=(), battery=(), bluetooth=(), browsing-topics=(), camera=(), compute-pressure=(), display-capture=(), encrypted-media=(), execution-while-not-rendered=(), execution-while-out-of-viewport=(), fullscreen=(), gamepad=(), geolocation=(), gyroscope=(), hid=(), identity-credentials-get=(), idle-detection=(), local-fonts=(), magnetometer=(), microphone=(), midi=(), otp-credentials=(), payment=(), picture-in-picture=(), publickey-credentials-create=(), publickey-credentials-get=(), screen-wake-lock=(), serial=(), speaker-selection=(), storage-access=(), usb=(), web-share=(), window-management=(), xr-spatial-tracking=(), interest-cohort=()</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the Permissions-Policy header.</td>
</tr>
<tr>
<td><code>X_FRAME_OPTIONS</code></td>
<td><code>SAMEORIGIN</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the X-Frame-Options header.</td>
</tr>
<tr>
<td><code>X_CONTENT_TYPE_OPTIONS</code></td>
<td><code>nosniff</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the X-Content-Type-Options header.</td>
</tr>
<tr>
<td><code>X_DNS_PREFETCH_CONTROL</code></td>
<td><code>off</code></td>
<td>multisite</td>
<td>no</td>
<td>Value for the X-DNS-Prefetch-Control header.</td>
</tr>
</tbody>
</table>
<h2 id="settings-lets-encrypt">Let's Encrypt</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Automatic creation, renewal and configuration of Let's Encrypt certificates.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AUTO_LETS_ENCRYPT</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate automatic Let's Encrypt mode.</td>
</tr>
<tr>
<td><code>EMAIL_LETS_ENCRYPT</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Email used for Let's Encrypt notification and in certificate.</td>
</tr>
<tr>
<td><code>LETS_ENCRYPT_CHALLENGE</code></td>
<td><code>http</code></td>
<td>multisite</td>
<td>no</td>
<td>The challenge type to use for Let's Encrypt (http or dns).</td>
</tr>
<tr>
<td><code>LETS_ENCRYPT_DNS_PROVIDER</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>The DNS provider to use for DNS challenges.</td>
</tr>
<tr>
<td><code>LETS_ENCRYPT_DNS_PROPAGATION</code></td>
<td><code>default</code></td>
<td>multisite</td>
<td>no</td>
<td>The time to wait for DNS propagation in seconds for DNS challenges.</td>
</tr>
<tr>
<td><code>LETS_ENCRYPT_DNS_CREDENTIAL_ITEM</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Configuration item that will be added to the credentials.ini file for the DNS provider (e.g. 'cloudflare_api_token 123456') for DNS challenges.</td>
</tr>
<tr>
<td><code>USE_LETS_ENCRYPT_WILDCARD</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Create wildcard certificates for all domains. This allows a single certificate to secure multiple subdomains. (Only available with DNS challenges)</td>
</tr>
<tr>
<td><code>USE_LETS_ENCRYPT_STAGING</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use the staging environment for Let’s Encrypt certificate generation. Useful when you are testing your deployments to avoid being rate limited in the production environment.</td>
</tr>
<tr>
<td><code>LETS_ENCRYPT_CLEAR_OLD_CERTS</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Clear old certificates when renewing.</td>
</tr>
</tbody>
</table>
<h2 id="settings-limit">Limit</h2>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Limit maximum number of requests and connections.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_LIMIT_REQ</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate limit requests feature.</td>
</tr>
<tr>
<td><code>LIMIT_REQ_URL</code></td>
<td><code>/</code></td>
<td>multisite</td>
<td>yes</td>
<td>URL (PCRE regex) where the limit request will be applied or special value / for all requests.</td>
</tr>
<tr>
<td><code>LIMIT_REQ_RATE</code></td>
<td><code>2r/s</code></td>
<td>multisite</td>
<td>yes</td>
<td>Rate to apply to the URL (s for second, m for minute, h for hour and d for day).</td>
</tr>
<tr>
<td><code>USE_LIMIT_CONN</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate limit connections feature.</td>
</tr>
<tr>
<td><code>LIMIT_CONN_MAX_HTTP1</code></td>
<td><code>10</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum number of connections per IP when using HTTP/1.X protocol.</td>
</tr>
<tr>
<td><code>LIMIT_CONN_MAX_HTTP2</code></td>
<td><code>100</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum number of streams per IP when using HTTP/2 protocol.</td>
</tr>
<tr>
<td><code>LIMIT_CONN_MAX_HTTP3</code></td>
<td><code>100</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum number of streams per IP when using HTTP/3 protocol.</td>
</tr>
<tr>
<td><code>LIMIT_CONN_MAX_STREAM</code></td>
<td><code>10</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum number of connections per IP when using stream.</td>
</tr>
</tbody>
</table>
<h2 id="settings-metrics">Metrics</h2>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Metrics collection and retrieve.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_METRICS</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable collection and retrieval of internal metrics.</td>
</tr>
<tr>
<td><code>METRICS_MEMORY_SIZE</code></td>
<td><code>16m</code></td>
<td>global</td>
<td>no</td>
<td>Size of the internal storage for metrics.</td>
</tr>
<tr>
<td><code>METRICS_MAX_BLOCKED_REQUESTS</code></td>
<td><code>1000</code></td>
<td>global</td>
<td>no</td>
<td>Maximum number of blocked requests to store (per worker).</td>
</tr>
<tr>
<td><code>METRICS_MAX_BLOCKED_REQUESTS_REDIS</code></td>
<td><code>100000</code></td>
<td>global</td>
<td>no</td>
<td>Maximum number of blocked requests to store in Redis.</td>
</tr>
</tbody>
</table>
<h2 id="settings-migration-pro">Migration <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style='transform : translateY(3px);'> (PRO)</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Migration of BunkerWeb configuration between instances made easy via the web UI</p>
<h2 id="settings-miscellaneous">Miscellaneous</h2>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Miscellaneous settings.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DISABLE_DEFAULT_SERVER</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Deny HTTP request if the request vhost is unknown.</td>
</tr>
<tr>
<td><code>DISABLE_DEFAULT_SERVER_STRICT_SNI</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Close SSL/TLS connection if the SNI is unknown.</td>
</tr>
<tr>
<td><code>ALLOWED_METHODS</code></td>
<td><code>GET                    | POST      | HEAD</code></td>
<td>multisite</td>
<td>no</td>
<td>Allowed HTTP and WebDAV methods, separated with pipes to be sent by clients.</td>
</tr>
<tr>
<td><code>MAX_CLIENT_SIZE</code></td>
<td><code>10m</code></td>
<td>multisite</td>
<td>no</td>
<td>Maximum body size (0 for infinite).</td>
</tr>
<tr>
<td><code>SERVE_FILES</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Serve files from the local folder.</td>
</tr>
<tr>
<td><code>ROOT_FOLDER</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Root folder containing files to serve (/var/www/html/{server_name} if unset).</td>
</tr>
<tr>
<td><code>HTTP2</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Support HTTP2 protocol when HTTPS is enabled.</td>
</tr>
<tr>
<td><code>HTTP3</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Support HTTP3 protocol when HTTPS is enabled.</td>
</tr>
<tr>
<td><code>HTTP3_ALT_SVC_PORT</code></td>
<td><code>443</code></td>
<td>multisite</td>
<td>no</td>
<td>HTTP3 alternate service port. This value will be used as part of the Alt-Svc header.</td>
</tr>
<tr>
<td><code>LISTEN_HTTP</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Respond to (insecure) HTTP requests.</td>
</tr>
<tr>
<td><code>USE_OPEN_FILE_CACHE</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable open file cache feature</td>
</tr>
<tr>
<td><code>OPEN_FILE_CACHE</code></td>
<td><code>max=1000 inactive=20s</code></td>
<td>multisite</td>
<td>no</td>
<td>Open file cache directive</td>
</tr>
<tr>
<td><code>OPEN_FILE_CACHE_ERRORS</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable open file cache for errors</td>
</tr>
<tr>
<td><code>OPEN_FILE_CACHE_MIN_USES</code></td>
<td><code>2</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable open file cache minimum uses</td>
</tr>
<tr>
<td><code>OPEN_FILE_CACHE_VALID</code></td>
<td><code>30s</code></td>
<td>multisite</td>
<td>no</td>
<td>Open file cache valid time</td>
</tr>
<tr>
<td><code>EXTERNAL_PLUGIN_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of external plugins URLs (direct download to .zip or .tar file) to download and install (URLs are separated with space).</td>
</tr>
<tr>
<td><code>DENY_HTTP_STATUS</code></td>
<td><code>403</code></td>
<td>global</td>
<td>no</td>
<td>HTTP status code to send when the request is denied (403 or 444). When using 444, BunkerWeb will close the connection.</td>
</tr>
<tr>
<td><code>SEND_ANONYMOUS_REPORT</code></td>
<td><code>yes</code></td>
<td>global</td>
<td>no</td>
<td>Send anonymous report to BunkerWeb maintainers.</td>
</tr>
</tbody>
</table>
<h2 id="settings-modsecurity">ModSecurity</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Management of the ModSecurity WAF.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_MODSECURITY</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable ModSecurity WAF.</td>
</tr>
<tr>
<td><code>USE_MODSECURITY_CRS</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable OWASP Core Rule Set.</td>
</tr>
<tr>
<td><code>USE_MODSECURITY_CRS_PLUGINS</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable OWASP Core Rule Set plugins.</td>
</tr>
<tr>
<td><code>MODSECURITY_CRS_VERSION</code></td>
<td><code>4</code></td>
<td>multisite</td>
<td>no</td>
<td>Version of the OWASP Core Rule Set to use with ModSecurity (3, 4 or nightly).</td>
</tr>
<tr>
<td><code>MODSECURITY_CRS_PLUGINS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of OWASP CRS plugins (plugin-name[/tag] or URL) to download and install (separated with spaces). (Not compatible with CRS version 3)</td>
</tr>
<tr>
<td><code>USE_MODSECURITY_GLOBAL_CRS</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Use ModSecurity CRS in global mode to improve rules loading when you have many services.</td>
</tr>
<tr>
<td><code>MODSECURITY_SEC_AUDIT_ENGINE</code></td>
<td><code>RelevantOnly</code></td>
<td>multisite</td>
<td>no</td>
<td>SecAuditEngine directive of ModSecurity.</td>
</tr>
<tr>
<td><code>MODSECURITY_SEC_RULE_ENGINE</code></td>
<td><code>On</code></td>
<td>multisite</td>
<td>no</td>
<td>SecRuleEngine directive of ModSecurity.</td>
</tr>
<tr>
<td><code>MODSECURITY_SEC_AUDIT_LOG_PARTS</code></td>
<td><code>ABCFHZ</code></td>
<td>multisite</td>
<td>no</td>
<td>SecAuditLogParts directive of ModSecurity.</td>
</tr>
<tr>
<td><code>MODSECURITY_REQ_BODY_NO_FILES_LIMIT</code></td>
<td><code>131072</code></td>
<td>multisite</td>
<td>no</td>
<td>SecRequestBodyNoFilesLimit directive of ModSecurity.</td>
</tr>
</tbody>
</table>
<h2 id="settings-monitoring-pro">Monitoring <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style='transform : translateY(3px);'> (PRO)</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>BunkerWeb monitoring pro system. This plugin is a prerequisite for some other plugins.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_MONITORING</code></td>
<td><code>yes</code></td>
<td>global</td>
<td>no</td>
<td>Enable monitoring of BunkerWeb.</td>
</tr>
<tr>
<td><code>MONITORING_METRICS_DICT_SIZE</code></td>
<td><code>10M</code></td>
<td>global</td>
<td>no</td>
<td>Size of the dict to store monitoring metrics.</td>
</tr>
<tr>
<td><code>MONITORING_IGNORE_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of URLs to ignore when monitoring separated with spaces (e.g. /health)</td>
</tr>
</tbody>
</table>
<h2 id="settings-php">PHP</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Manage local or remote PHP-FPM.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>REMOTE_PHP</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Hostname of the remote PHP-FPM instance.</td>
</tr>
<tr>
<td><code>REMOTE_PHP_PATH</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Root folder containing files in the remote PHP-FPM instance.</td>
</tr>
<tr>
<td><code>REMOTE_PHP_PORT</code></td>
<td><code>9000</code></td>
<td>multisite</td>
<td>no</td>
<td>Port of the remote PHP-FPM instance.</td>
</tr>
<tr>
<td><code>LOCAL_PHP</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Path to the PHP-FPM socket file.</td>
</tr>
<tr>
<td><code>LOCAL_PHP_PATH</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Root folder containing files in the local PHP-FPM instance.</td>
</tr>
</tbody>
</table>
<h2 id="settings-pro">Pro</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Pro settings for the Pro version of BunkerWeb.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PRO_LICENSE_KEY</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>The License Key for the Pro version of BunkerWeb.</td>
</tr>
</tbody>
</table>
<h2 id="settings-prometheus-exporter-pro">Prometheus exporter <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style='transform : translateY(3px);'> (PRO)</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Prometheus exporter for BunkerWeb internal metrics.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_PROMETHEUS_EXPORTER</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable the Prometheus export.</td>
</tr>
<tr>
<td><code>PROMETHEUS_EXPORTER_IP</code></td>
<td><code>0.0.0.0</code></td>
<td>global</td>
<td>no</td>
<td>Listening IP of the Prometheus exporter.</td>
</tr>
<tr>
<td><code>PROMETHEUS_EXPORTER_PORT</code></td>
<td><code>9113</code></td>
<td>global</td>
<td>no</td>
<td>Listening port of the Prometheus exporter.</td>
</tr>
<tr>
<td><code>PROMETHEUS_EXPORTER_URL</code></td>
<td><code>/metrics</code></td>
<td>global</td>
<td>no</td>
<td>HTTP URL of the Prometheus exporter.</td>
</tr>
<tr>
<td><code>PROMETHEUS_EXPORTER_ALLOW_IP</code></td>
<td><code>127.0.0.0/8 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16</code></td>
<td>global</td>
<td>no</td>
<td>List of IP/networks allowed to contact the Prometheus exporter endpoint.</td>
</tr>
</tbody>
</table>
<h2 id="settings-real-ip">Real IP</h2>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Get real IP of clients when BunkerWeb is behind a reverse proxy / load balancer.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_REAL_IP</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Retrieve the real IP of client.</td>
</tr>
<tr>
<td><code>USE_PROXY_PROTOCOL</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable PROXY protocol communication.</td>
</tr>
<tr>
<td><code>REAL_IP_FROM</code></td>
<td><code>192.168.0.0/16 172.16.0.0/12 10.0.0.0/8</code></td>
<td>multisite</td>
<td>no</td>
<td>List of trusted IPs / networks, separated with spaces, where proxied requests come from.</td>
</tr>
<tr>
<td><code>REAL_IP_HEADER</code></td>
<td><code>X-Forwarded-For</code></td>
<td>multisite</td>
<td>no</td>
<td>HTTP header containing the real IP or special value proxy_protocol for PROXY protocol.</td>
</tr>
<tr>
<td><code>REAL_IP_RECURSIVE</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Perform a recursive search in the header container IP address.</td>
</tr>
<tr>
<td><code>REAL_IP_FROM_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs containing trusted IPs / networks, separated with spaces, where proxied requests come from. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
</tbody>
</table>
<h2 id="settings-redirect">Redirect</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Manage HTTP redirects.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>REDIRECT_TO</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Redirect a whole site to another one.</td>
</tr>
<tr>
<td><code>REDIRECT_TO_REQUEST_URI</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Append the requested URI to the redirect address.</td>
</tr>
<tr>
<td><code>REDIRECT_TO_STATUS_CODE</code></td>
<td><code>301</code></td>
<td>multisite</td>
<td>no</td>
<td>Status code to send to client when redirecting.</td>
</tr>
</tbody>
</table>
<h2 id="settings-redis">Redis</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Redis server configuration when using BunkerWeb in cluster mode.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_REDIS</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Activate Redis.</td>
</tr>
<tr>
<td><code>REDIS_HOST</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>Redis server IP or hostname.</td>
</tr>
<tr>
<td><code>REDIS_PORT</code></td>
<td><code>6379</code></td>
<td>global</td>
<td>no</td>
<td>Redis server port.</td>
</tr>
<tr>
<td><code>REDIS_DATABASE</code></td>
<td><code>0</code></td>
<td>global</td>
<td>no</td>
<td>Redis database number.</td>
</tr>
<tr>
<td><code>REDIS_SSL</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Use SSL/TLS connection with Redis server.</td>
</tr>
<tr>
<td><code>REDIS_SSL_VERIFY</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Verify the certificate of Redis server.</td>
</tr>
<tr>
<td><code>REDIS_TIMEOUT</code></td>
<td><code>1000</code></td>
<td>global</td>
<td>no</td>
<td>Redis server timeout (in ms) for connect, read and write.</td>
</tr>
<tr>
<td><code>REDIS_USERNAME</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>Redis username used in AUTH command.</td>
</tr>
<tr>
<td><code>REDIS_PASSWORD</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>Redis password used in AUTH command.</td>
</tr>
<tr>
<td><code>REDIS_SENTINEL_HOSTS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>Redis sentinel hosts with format host:[port] separated with spaces.</td>
</tr>
<tr>
<td><code>REDIS_SENTINEL_USERNAME</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>Redis sentinel username.</td>
</tr>
<tr>
<td><code>REDIS_SENTINEL_PASSWORD</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>Redis sentinel password.</td>
</tr>
<tr>
<td><code>REDIS_SENTINEL_MASTER</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>Redis sentinel master name.</td>
</tr>
<tr>
<td><code>REDIS_KEEPALIVE_IDLE</code></td>
<td><code>30000</code></td>
<td>global</td>
<td>no</td>
<td>Max idle time (in ms) before closing redis connection in the pool.</td>
</tr>
<tr>
<td><code>REDIS_KEEPALIVE_POOL</code></td>
<td><code>10</code></td>
<td>global</td>
<td>no</td>
<td>Max number of redis connection(s) kept in the pool.</td>
</tr>
</tbody>
</table>
<h2 id="settings-reporting-pro">Reporting <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style='transform : translateY(3px);'> (PRO)</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Regular reporting of important data from BunkerWeb (global, attacks, bans, requests, reasons, AS...). Monitoring pro plugin needed to work.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_REPORTING_SMTP</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable sending the report via email.</td>
</tr>
<tr>
<td><code>USE_REPORTING_WEBHOOK</code></td>
<td><code>no</code></td>
<td>global</td>
<td>no</td>
<td>Enable sending the report via webhook.</td>
</tr>
<tr>
<td><code>REPORTING_SCHEDULE</code></td>
<td><code>weekly</code></td>
<td>global</td>
<td>no</td>
<td>The frequency at which reports are sent.</td>
</tr>
<tr>
<td><code>REPORTING_WEBHOOK_URLS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of webhook URLs to receive the report in Markdown (separated by spaces).</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_EMAILS</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>List of email addresses to receive the report in HTML format (separated by spaces).</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_HOST</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>The host server used for SMTP sending.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_PORT</code></td>
<td><code>465</code></td>
<td>global</td>
<td>no</td>
<td>The port used for SMTP. Please note that there are different standards depending on the type of connection (SSL = 465, TLS = 587).</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_FROM_EMAIL</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>The email address used as the sender. Note that 2FA must be disabled for this email address.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_FROM_USER</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>The user authentication value for sending via the from email address.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_FROM_PASSWORD</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>The password authentication value for sending via the from email address.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_SSL</code></td>
<td><code>SSL</code></td>
<td>global</td>
<td>no</td>
<td>Determine whether or not to use a secure connection for SMTP.</td>
</tr>
<tr>
<td><code>REPORTING_SMTP_SUBJECT</code></td>
<td><code>BunkerWeb Report</code></td>
<td>global</td>
<td>no</td>
<td>The subject line of the email.</td>
</tr>
</tbody>
</table>
<h2 id="settings-reverse-proxy">Reverse proxy</h2>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Manage reverse proxy configurations.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_REVERSE_PROXY</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate reverse proxy mode.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_INTERCEPT_ERRORS</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Intercept and rewrite errors.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_CUSTOM_HOST</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Override Host header sent to upstream server.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_SSL_SNI</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable or disable sending SNI to upstream server.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_SSL_SNI_NAME</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Sets the SNI host to send to upstream server.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_HOST</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Full URL of the proxied resource (proxy_pass).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_URL</code></td>
<td><code>/</code></td>
<td>multisite</td>
<td>yes</td>
<td>Location URL that will be proxied.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_WS</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>yes</td>
<td>Enable websocket on the proxied resource.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_HEADERS</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>List of HTTP headers to send to proxied resource separated with semicolons (values for proxy_set_header directive).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_HEADERS_CLIENT</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>List of HTTP headers to send to client separated with semicolons (values for add_header directive).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_BUFFERING</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>yes</td>
<td>Enable or disable buffering of responses from proxied resource.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_KEEPALIVE</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>yes</td>
<td>Enable or disable keepalive connections with the proxied resource.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_AUTH_REQUEST</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Enable authentication using an external provider (value of auth_request directive).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_AUTH_REQUEST_SIGNIN_URL</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Redirect clients to sign-in URL when using REVERSE_PROXY_AUTH_REQUEST (used when auth_request call returned 401).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_AUTH_REQUEST_SET</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>List of variables to set from the authentication provider, separated with semicolons (values of auth_request_set directives).</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_CONNECT_TIMEOUT</code></td>
<td><code>60s</code></td>
<td>multisite</td>
<td>yes</td>
<td>Timeout when connecting to the proxied resource.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_READ_TIMEOUT</code></td>
<td><code>60s</code></td>
<td>multisite</td>
<td>yes</td>
<td>Timeout when reading from the proxied resource.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_SEND_TIMEOUT</code></td>
<td><code>60s</code></td>
<td>multisite</td>
<td>yes</td>
<td>Timeout when sending to the proxied resource.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_INCLUDES</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Additional configuration to include in the location block, separated with spaces.</td>
</tr>
<tr>
<td><code>REVERSE_PROXY_PASS_REQUEST_BODY</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>yes</td>
<td>Enable or disable passing the request body to the proxied resource.</td>
</tr>
<tr>
<td><code>USE_PROXY_CACHE</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable or disable caching of the proxied resources.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_PATH_LEVELS</code></td>
<td><code>1:2</code></td>
<td>global</td>
<td>no</td>
<td>Hierarchy levels of the cache.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_PATH_ZONE_SIZE</code></td>
<td><code>10m</code></td>
<td>global</td>
<td>no</td>
<td>Maximum size of cached metadata when caching proxied resources.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_PATH_PARAMS</code></td>
<td><code>max_size=100m</code></td>
<td>global</td>
<td>no</td>
<td>Additional parameters to add to the proxy_cache directive.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_METHODS</code></td>
<td><code>GET HEAD</code></td>
<td>multisite</td>
<td>no</td>
<td>HTTP methods that should trigger a cache operation.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_MIN_USES</code></td>
<td><code>2</code></td>
<td>multisite</td>
<td>no</td>
<td>The minimum number of requests before a response is cached.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_KEY</code></td>
<td><code>$scheme$host$request_uri</code></td>
<td>multisite</td>
<td>no</td>
<td>The key used to uniquely identify a cached response.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_VALID</code></td>
<td><code>200=24h 301=1h 302=24h</code></td>
<td>multisite</td>
<td>no</td>
<td>Define the caching time depending on the HTTP status code (list of status=time), separated with spaces.</td>
</tr>
<tr>
<td><code>PROXY_NO_CACHE</code></td>
<td><code>$http_pragma $http_authorization</code></td>
<td>multisite</td>
<td>no</td>
<td>Conditions to disable caching of responses.</td>
</tr>
<tr>
<td><code>PROXY_CACHE_BYPASS</code></td>
<td><code>0</code></td>
<td>multisite</td>
<td>no</td>
<td>Conditions to bypass caching of responses.</td>
</tr>
</tbody>
</table>
<h2 id="settings-reverse-scan">Reverse scan</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Scan clients ports to detect proxies or servers.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_REVERSE_SCAN</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable scanning of clients ports and deny access if one is opened.</td>
</tr>
<tr>
<td><code>REVERSE_SCAN_PORTS</code></td>
<td><code>22 80 443 3128 8000 8080</code></td>
<td>multisite</td>
<td>no</td>
<td>List of port to scan when using reverse scan feature.</td>
</tr>
<tr>
<td><code>REVERSE_SCAN_TIMEOUT</code></td>
<td><code>500</code></td>
<td>multisite</td>
<td>no</td>
<td>Specify the maximum timeout (in ms) when scanning a port.</td>
</tr>
</tbody>
</table>
<h2 id="settings-ssl">SSL</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Handle SSL/TLS related settings.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>REDIRECT_HTTP_TO_HTTPS</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Redirect all HTTP request to HTTPS.</td>
</tr>
<tr>
<td><code>AUTO_REDIRECT_HTTP_TO_HTTPS</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Try to detect if HTTPS is used and activate HTTP to HTTPS redirection if that's the case.</td>
</tr>
<tr>
<td><code>SSL_PROTOCOLS</code></td>
<td><code>TLSv1.2 TLSv1.3</code></td>
<td>multisite</td>
<td>no</td>
<td>The supported version of TLS. We recommend the default value TLSv1.2 TLSv1.3 for compatibility reasons.</td>
</tr>
</tbody>
</table>
<h2 id="settings-securitytxt">Security.txt</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Manage the security.txt file. A proposed standard which allows websites to define security policies.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_SECURITYTXT</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Enable security.txt file.</td>
</tr>
<tr>
<td><code>SECURITYTXT_URI</code></td>
<td><code>/.well-known/security.txt</code></td>
<td>multisite</td>
<td>no</td>
<td>Indicates the URI where the "security.txt" file will be accessible from.</td>
</tr>
<tr>
<td><code>SECURITYTXT_CONTACT</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Indicates a method that researchers should use for reporting security vulnerabilities such as an email address, a phone number, and/or a web page with contact information. (If the value is empty, the security.txt file will not be created as it is a required field)</td>
</tr>
<tr>
<td><code>SECURITYTXT_EXPIRES</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>Indicates the date and time after which the data contained in the "security.txt" file is considered stale and should not be used (If the value is empty, the value will always be the current date and time + 1 year).</td>
</tr>
<tr>
<td><code>SECURITYTXT_ENCRYPTION</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Indicates an encryption key that security researchers should use for encrypted communication.</td>
</tr>
<tr>
<td><code>SECURITYTXT_ACKNOWLEDGEMENTS</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Indicates a link to a page where security researchers are recognized for their reports.</td>
</tr>
<tr>
<td><code>SECURITYTXT_PREFERRED_LANG</code></td>
<td><code>en</code></td>
<td>multisite</td>
<td>no</td>
<td>Can be used to indicate a set of natural languages that are preferred when submitting security reports.</td>
</tr>
<tr>
<td><code>SECURITYTXT_CANONICAL</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Indicates the canonical URIs where the "security.txt" file is located, which is usually something like "https://example.com/.well-known/security.txt". (If the value is empty, the default value will be automatically generated from the site URL + SECURITYTXT_URI)</td>
</tr>
<tr>
<td><code>SECURITYTXT_POLICY</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Indicates a link to where the vulnerability disclosure policy is located.</td>
</tr>
<tr>
<td><code>SECURITYTXT_HIRING</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>Used for linking to the vendor's security-related job positions.</td>
</tr>
<tr>
<td><code>SECURITYTXT_CSAF</code></td>
<td></td>
<td>multisite</td>
<td>yes</td>
<td>A link to the provider-metadata.json of your CSAF (Common Security Advisory Framework) provider.</td>
</tr>
</tbody>
</table>
<h2 id="settings-self-signed-certificate">Self-signed certificate</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Generate self-signed certificate.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GENERATE_SELF_SIGNED_SSL</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Generate and use self-signed certificate.</td>
</tr>
<tr>
<td><code>SELF_SIGNED_SSL_EXPIRY</code></td>
<td><code>365</code></td>
<td>multisite</td>
<td>no</td>
<td>Self-signed certificate expiry in days.</td>
</tr>
<tr>
<td><code>SELF_SIGNED_SSL_SUBJ</code></td>
<td><code>/CN=www.example.com/</code></td>
<td>multisite</td>
<td>no</td>
<td>Self-signed certificate subject.</td>
</tr>
</tbody>
</table>
<h2 id="settings-sessions">Sessions</h2>
<p>STREAM support <img alt="✅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2705.svg" title=":white_check_mark:" /></p>
<p>Management of session used by other plugins.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SESSIONS_SECRET</code></td>
<td><code>random</code></td>
<td>global</td>
<td>no</td>
<td>Secret used to encrypt sessions variables for storing data related to challenges.</td>
</tr>
<tr>
<td><code>SESSIONS_NAME</code></td>
<td><code>random</code></td>
<td>global</td>
<td>no</td>
<td>Name of the cookie given to clients.</td>
</tr>
<tr>
<td><code>SESSIONS_IDLING_TIMEOUT</code></td>
<td><code>1800</code></td>
<td>global</td>
<td>no</td>
<td>Maximum time (in seconds) of inactivity before the session is invalidated.</td>
</tr>
<tr>
<td><code>SESSIONS_ROLLING_TIMEOUT</code></td>
<td><code>3600</code></td>
<td>global</td>
<td>no</td>
<td>Maximum time (in seconds) before a session must be renewed.</td>
</tr>
<tr>
<td><code>SESSIONS_ABSOLUTE_TIMEOUT</code></td>
<td><code>86400</code></td>
<td>global</td>
<td>no</td>
<td>Maximum time (in seconds) before a session is destroyed.</td>
</tr>
<tr>
<td><code>SESSIONS_CHECK_IP</code></td>
<td><code>yes</code></td>
<td>global</td>
<td>no</td>
<td>Destroy session if IP address is different than original one.</td>
</tr>
<tr>
<td><code>SESSIONS_CHECK_USER_AGENT</code></td>
<td><code>yes</code></td>
<td>global</td>
<td>no</td>
<td>Destroy session if User-Agent is different than original one.</td>
</tr>
</tbody>
</table>
<h2 id="settings-ui">UI</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Integrate easily the BunkerWeb UI.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_UI</code></td>
<td><code>no</code></td>
<td>multisite</td>
<td>no</td>
<td>Use UI</td>
</tr>
<tr>
<td><code>UI_HOST</code></td>
<td></td>
<td>global</td>
<td>no</td>
<td>Address of the web UI used for initial setup</td>
</tr>
</tbody>
</table>
<h2 id="settings-user-manager-pro">User Manager <img src='../assets/img/pro-icon.svg' alt='crow pro icon' height='24px' width='24px' style='transform : translateY(3px);'> (PRO)</h2>
<p>STREAM support <img alt="❌" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/274c.svg" title=":x:" /></p>
<p>Add the possibility to manage users on the web interface</p>
<h2 id="settings-whitelist">Whitelist</h2>
<p>STREAM support <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /></p>
<p>Allow access based on internal and external IP/network/rDNS/ASN whitelists.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Context</th>
<th>Multiple</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>USE_WHITELIST</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Activate whitelist feature.</td>
</tr>
<tr>
<td><code>WHITELIST_IP</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of IP/network, separated with spaces, to put into the whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_RDNS</code></td>
<td><code>.google.com .googlebot.com .yandex.ru .yandex.net .yandex.com .search.msn.com .baidu.com .baidu.jp .crawl.yahoo.net .fwd.linkedin.com .twitter.com .twttr.com .discord.com</code></td>
<td>multisite</td>
<td>no</td>
<td>List of reverse DNS suffixes, separated with spaces, to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_RDNS_GLOBAL</code></td>
<td><code>yes</code></td>
<td>multisite</td>
<td>no</td>
<td>Only perform RDNS whitelist checks on global IP addresses.</td>
</tr>
<tr>
<td><code>WHITELIST_ASN</code></td>
<td><code>32934</code></td>
<td>multisite</td>
<td>no</td>
<td>List of ASN numbers, separated with spaces, to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_USER_AGENT</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of User-Agent (PCRE regex), separated with spaces, to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_URI</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URI (PCRE regex), separated with spaces, to whitelist.</td>
</tr>
<tr>
<td><code>WHITELIST_IP_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing good IP/network to whitelist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>WHITELIST_RDNS_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing reverse DNS suffixes to whitelist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>WHITELIST_ASN_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing ASN to whitelist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>WHITELIST_USER_AGENT_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing good User-Agent to whitelist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
<tr>
<td><code>WHITELIST_URI_URLS</code></td>
<td></td>
<td>multisite</td>
<td>no</td>
<td>List of URLs, separated with spaces, containing bad URI to whitelist. Also supports file:// URLs and and auth basic using http://user:pass@url scheme.</td>
</tr>
</tbody>
</table></section><section class="print-page" id="web-ui"><h1 id="web-ui-web-ui">Web UI</h1>
<h2 id="web-ui-overview">Overview</h2>
<p align="center">
    <iframe style="display: block;" width="560" height="315" data-src="https://www.youtube-nocookie.com/embed/tGS3pzquEjY" title="BunkerWeb web UI" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</p>

<p>The "Web UI" is a web application that helps you manage your BunkerWeb instance using a user-friendly interface instead of the command-line one.</p>
<p>Here is the list of features offered by the web UI :</p>
<ul>
<li>Get a comprehensive view of the blocked attacks</li>
<li>Start, stop, restart and reload your BunkerWeb instance</li>
<li>Add, edit and delete settings for your web applications</li>
<li>Add, edit and delete custom configurations for NGINX and ModSecurity</li>
<li>Install and uninstall external plugins</li>
<li>Explore the cached files</li>
<li>Monitor jobs execution and restart them when needed</li>
<li>View the logs and search pattern</li>
</ul>
<h2 id="web-ui-prerequisites">Prerequisites</h2>
<p>Because the web UI is a web application, the recommended architecture is to use BunkerWeb in front of it as a reverse proxy. The recommended installation procedure is to use the setup wizard, which will guide you step by step as described in the <a href="#quickstart-guide">quickstart guide</a> section of the documentation.</p>
<div class="admonition warning">
<p class="admonition-title">Security considerations</p>
<p>The security of the web UI is really important. If someone manages to gain access to the application, not only he will be able to edit your configurations but he could execute some code in the context of BunkerWeb (with a custom configuration containing LUA code for example). We highly recommend you to follow minimal security best practices like :</p>
<ul>
<li>Choose a strong password for the login (<strong>at least 8 chars with 1 lower case letter, 1 upper case letter, 1 digit and 1 special char is required</strong>)</li>
<li>Put the web UI under a "hard to guess" URI</li>
<li>Enable two-factor authentication (2FA)</li>
<li>Do not open the web UI on the Internet without any further restrictions</li>
<li>Apply best practices listed in the <a href="#advanced-security-tuning">advanced usages section</a> of the documentation depending on your use case</li>
</ul>
</div>
<h2 id="web-ui-upgrade-to-pro">Upgrade to PRO</h2>
<div class="admonition info">
<p class="admonition-title">What is BunkerWeb PRO ?</p>
<p>BunkerWeb PRO is an enhanced version of BunkerWeb open-source. Whether it's enhanced security, an enriched user experience, or technical monitoring, the BunkerWeb PRO version will allow you to fully benefit from BunkerWeb and respond to your professional needs. Do not hesitate to visit the <a href="https://panel.bunkerweb.io/knowledgebase?utm_campaign=self&amp;utm_source=doc">BunkerWeb panel</a> or <a href="https://panel.bunkerweb.io/contact.php?utm_campaign=self&amp;utm_source=doc">contact us</a> if you have any question regarding the PRO version.</p>
</div>
<p>Once you have your PRO license key from the <a href="https://panel.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc">BunkerWeb panel</a>, you can paste it into the PRO page of the web UI.</p>
<figure>
<p><img align="center," alt="PRO upgrade" src="../assets/img/pro-ui-upgrade.png" width="700" />
  </p>
<figcaption>Upgrade to PRO from the web UI</figcaption>
</figure>
<div class="admonition warning">
<p class="admonition-title">Upgrade time</p>
<p>The PRO version is downloaded in the background by the scheduler, it may take some time to upgrade.</p>
</div>
<p>When your BunkerWeb instance has upgraded to the PRO version, you will see your license expiration date and the maximum number of services you can protect.</p>
<figure>
<p><img align="center," alt="PRO upgrade" src="../assets/img/ui-pro.png" width="700" />
  </p>
<figcaption>PRO license information</figcaption>
</figure>
<!-- ## Setup wizard

!!! info "Wizard"

    The setup wizard is a feature that helps you to **configure** and **install the web UI** using a **user-friendly interface**. You will need to set the `UI_HOST` setting (`http://hostname-of-web-ui:7000`) and browse the `/setup` URI of your server to access the setup wizard.

<figure markdown>
  ![Overview](assets/img/ui-wizard-account.webp){ align=center, width="350" }
  <figcaption>Account section of the setup wizard</figcaption>
</figure>

Choose your administrator username and password. Please note that password must have at least 8 chars with 1 lower case letter, 1 upper case letter, 1 digit and 1 special char.

<figure markdown>
  ![Overview](assets/img/ui-wizard-settings.webp){ align=center, width="350" }
  <figcaption>Settings section of the setup wizard</figcaption>
</figure>

Configure the following settings :

- `UI Host` : internal http endpoint of your web UI
- `UI URL` : the public path where your web UI will be accessible
- `Server name` : the public server name where your web UI will be accessible
- `Auto let's encrypt` : enable/disable HTTPS using automated let's encrypt

Please note that your server name must have a valid DNS entry pointing to your BunkerWeb instance (or load balancer if you use Swarm/Kubernetes). You can check the DNS validity by clicking the `Check` button.

Review your final BunkerWeb UI URL and then click on the `Setup` button. Once the setup is finished, you will be redirected to your web UI login page.

=== "Docker"

    If you want to use the setup wizard, you will need to set the `UI_HOST` setting to the HTTP endpoint of your web UI container. For example, if your web UI container is named `bw-ui` and is listening on the `7000` port, you will need to set the `UI_HOST` setting to `http://bw-ui:7000`.

    !!! tip "Accessing the setup wizard"

        You can access the setup wizard by browsing the `https://your-ip-address-or-fqdn/setup` URI of your server.


    Here is the docker-compose boilerplate that you can use (don't forget to edit the `changeme` data) :

    <div class="highlight"><pre><span></span><code><span class="nt">x-ui-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-ui-env</span>
<span class="w">  </span><span class="c1"># We anchor the environment variables to avoid duplication</span>
<span class="w">  </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/udp&quot;</span><span class="w"> </span><span class="c1"># For QUIC / HTTP3 support</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span><span class="w"> </span><span class="c1"># Make sure to set the correct IP range so the scheduler can send the configuration to the instance</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span><span class="w"> </span><span class="c1"># Make sure to set the correct instance name</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span><span class="w"> </span><span class="c1"># We mirror the API_WHITELIST_IP from the bunkerweb service</span>
<span class="w">      </span><span class="nt">UI_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://bw-ui:7000&quot;</span><span class="w"> </span><span class="c1"># Change it if needed</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">TOTP_SECRETS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysecret&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger secret key (see the Prerequisites section)</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
</code></pre></div>

=== "Docker autoconf"

    If you want to use the setup wizard, you will need to set the `UI_HOST` setting to the HTTP endpoint of your web UI container. For example, if your web UI container is named `bw-ui` and is listening on the `7000` port, you will need to set the `UI_HOST` setting to `http://bw-ui:7000`.

    !!! tip "Accessing the setup wizard"

        You can access the setup wizard by browsing the `https://your-ip-address-or-fqdn/setup` URI of your server.

    Here is the docker-compose boilerplate that you can use (don't forget to edit the `changeme` data) :

    <div class="highlight"><pre><span></span><code><span class="nt">x-ui-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-ui-env</span>
<span class="w">  </span><span class="c1"># We anchor the environment variables to avoid duplication</span>
<span class="w">  </span><span class="nt">AUTOCONF_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">  </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/udp&quot;</span><span class="w"> </span><span class="c1"># For QUIC / HTTP3 support</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE=yes&quot;</span><span class="w"> </span><span class="c1"># We set the instance label to allow the autoconf to detect the instance</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">AUTOCONF_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">UI_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://bw-ui:7000&quot;</span><span class="w"> </span><span class="c1"># Change it if needed</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">DOCKER_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tcp://bw-docker:2375&quot;</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy:nightly</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">CONTAINERS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warning&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">TOTP_SECRETS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysecret&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger secret key (see the Prerequisites section)</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
</code></pre></div>

=== "Swarm"

    !!! warning "Deprecated"
        The Swarm integration is deprecated and will be removed in a future release. Please consider using the [Docker autoconf integration](#__tabbed_1_2) instead.

        **More information can be found in the [Swarm integration documentation](integrations.md#swarm).**

    If you want to use the setup wizard, you will need to set the `UI_HOST` setting to the HTTP endpoint of your web UI container. For example, if your web UI container is named `bw-ui` and is listening on the `7000` port, you will need to set the `UI_HOST` setting to `http://bw-ui:7000`.

    !!! tip "Accessing the setup wizard"

        You can access the setup wizard by browsing the `https://your-ip-address-or-fqdn/setup` URI of your server.

    Here is the stack boilerplate that you can use (don't forget to edit the `changeme` data) :

    <div class="highlight"><pre><span></span><code><span class="nt">x-ui-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-ui-env</span>
<span class="w">  </span><span class="c1"># We anchor the environment variables to avoid duplication</span>
<span class="w">  </span><span class="nt">SWARM_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">  </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">udp</span><span class="w"> </span><span class="c1"># For QUIC / HTTP3 support</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">SWARM_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">global</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE=yes&quot;</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">USE_REDIS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">REDIS_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bw-redis&quot;</span>
<span class="w">      </span><span class="nt">UI_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://bw-ui:7000&quot;</span><span class="w"> </span><span class="c1"># Change it if needed</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">DOCKER_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tcp://bw-docker:2375&quot;</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy:nightly</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">CONFIGS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">CONTAINERS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">SERVICES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">SWARM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">TASKS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warning&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">manager&quot;</span>

<span class="w">  </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">TOTP_SECRETS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysecret&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger secret key (see the Prerequisites section)</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-redis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>

=== "Kubernetes"

    If you want to use the setup wizard, you will need to set the `UI_HOST` setting to the HTTP endpoint of your web UI SERVICE. For example, if your web UI service is named `svc-bunkerweb-ui` and is listening on the `7000` port, you will need to set the `UI_HOST` setting to `http://svc-bunkerweb-ui.default.svc.cluster.local:7000` (don't forget to replace the namespace and the service name accordingly).

    !!! tip "Accessing the setup wizard"

        You can access the setup wizard by browsing the `https://your-ip-address-or-fqdn/setup` URI of your server.

    Here is the yaml boilerplate that you can use (don't forget to edit the `changeme` data) :

    <div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cr-bunkerweb</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;services&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pods&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;configmaps&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;secrets&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;networking.k8s.io&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;ingresses&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">]</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crb-bunkerweb</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">    </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="nt">roleRef</span><span class="p">:</span>
<span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cr-bunkerweb</span>
<span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DaemonSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="c1"># mandatory annotation</span>
<span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">        </span><span class="nt">bunkerweb.io/INSTANCE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># using bunkerweb as name is mandatory</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span>
<span class="w">            </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">101</span>
<span class="w">            </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">101</span>
<span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">            </span><span class="nt">capabilities</span><span class="p">:</span>
<span class="w">              </span><span class="nt">drop</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">              </span><span class="nt">hostPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<span class="w">              </span><span class="nt">hostPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="c1"># replace with your DNS resolvers</span>
<span class="w">            </span><span class="c1"># e.g. : kube-dns.kube-system.svc.cluster.local</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS_RESOLVERS</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;coredns.kube-system.svc.cluster.local&quot;</span>
<span class="w">            </span><span class="c1"># 10.0.0.0/8 is the cluster internal subnet</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.0.0.0/8&quot;</span>
<span class="w">          </span><span class="nt">livenessProbe</span><span class="p">:</span>
<span class="w">            </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">              </span><span class="nt">command</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/share/bunkerweb/helpers/healthcheck.sh</span>
<span class="w">            </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">            </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">            </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">          </span><span class="nt">readinessProbe</span><span class="p">:</span>
<span class="w">            </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">              </span><span class="nt">command</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/share/bunkerweb/helpers/healthcheck.sh</span>
<span class="w">            </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">            </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-controller</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@svc-bunkerweb-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@svc-bunkerweb-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">            </span><span class="c1"># replace with your DNS resolvers</span>
<span class="w">            </span><span class="c1"># e.g. : kube-dns.kube-system.svc.cluster.local</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS_RESOLVERS</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;coredns.kube-system.svc.cluster.local&quot;</span>
<span class="w">            </span><span class="c1"># 10.0.0.0/8 is the cluster internal subnet</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_WHITELIST_IP</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.0.0.0/8&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BUNKERWEB_INSTANCES</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVER_NAME</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MULTISITE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_REDIS</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="c1"># replace with your Redis host</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_HOST</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;svc-bunkerweb-redis.default.svc.cluster.local&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UI_HOST</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://svc-bunkerweb-ui.default.svc.cluster.local:7000&quot;</span><span class="w"> </span><span class="c1"># Change it if needed</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_RANDOM_ROOT_PASSWORD</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_DATABASE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_USER</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/var/lib/mysql&quot;</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vol-db</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vol-db</span>
<span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pvc-bunkerweb</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-ui</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-ui</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-ui</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-ui</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:testing</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URI</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@svc-bunkerweb-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TOTP_SECRETS</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysecret&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger secret key (see the Prerequisites section)</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb-db</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-db</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb-redis</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-redis</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svc-bunkerweb-ui</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-ui</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7000</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7000</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pvc-bunkerweb</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5Gi</span>
</code></pre></div>

=== "Linux"

    If you don't want to use the setup wizard, you will need to run the following command `export UI_WIZARD=no` before installing BunkerWeb as described in [integrations section](integrations.md#linux) of the documentation (this is an optional step).

    !!! tip "Accessing the setup wizard"

        You can access the setup wizard by browsing the `https://your-ip-address/setup` URI of your server. -->

<h2 id="web-ui-accessing-logs">Accessing logs</h2>
<p>Beginning with version <code>1.6</code>, the method of accessing logs has changed. This update specifically impacts container based integrations: the web UI will read the logs files from the <code>/var/log/bunkerweb</code> directory.</p>
<p>To keep the logs accessible from the web UI, we recommend you to use a syslog server such as <code>syslog-ng</code> to read the logs and creates the corresponding files in the <code>/var/log/bunkerweb</code> directory.</p>
<h3 id="web-ui-compose-boilerplates">Compose boilerplates</h3>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="web-ui-__tabbed_1_1" name="web-ui-__tabbed_1" type="radio" /><input id="web-ui-__tabbed_1_2" name="web-ui-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="web-ui-__tabbed_1_1">Docker</label><label for="web-ui-__tabbed_1_2">Docker Autoconf</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>To forward the logs correctly to the <code>/var/log/bunkerweb</code> directory on the Docker integration, you will need to stream the logs to a file using <code>syslog-ng</code>. Here is an example of how to do this :</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-bw-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-env</span>
<span class="w">  </span><span class="c1"># We anchor the environment variables to avoid duplication</span>
<span class="w">  </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/24</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/udp&quot;</span><span class="w"> </span><span class="c1"># QUIC</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-env</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">syslog</span>
<span class="w">      </span><span class="nt">options</span><span class="p">:</span>
<span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span><span class="w"> </span><span class="c1"># This will be the tag used by syslog-ng to create the log file</span>
<span class="w">        </span><span class="nt">syslog-address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;udp://10.20.30.254:514&quot;</span><span class="w"> </span><span class="c1"># This is the syslog-ng container address</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span><span class="w"> </span><span class="c1"># Make sure to set the correct instance name</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;www.example.com&quot;</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="nt">SERVE_FILES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;no&quot;</span>
<span class="w">      </span><span class="nt">DISABLE_DEFAULT_SERVER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">USE_CLIENT_CACHE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">USE_GZIP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">www.example.com_USE_TEMPLATE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ui&quot;</span>
<span class="w">      </span><span class="nt">www.example.com_USE_REVERSE_PROXY</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">www.example.com_REVERSE_PROXY_URL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/changeme&quot;</span><span class="w"> </span><span class="c1"># Change it to a hard to guess URI</span>
<span class="w">      </span><span class="nt">www.example.com_REVERSE_PROXY_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://bw-ui:7000&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">syslog</span>
<span class="w">      </span><span class="nt">options</span><span class="p">:</span>
<span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bw-scheduler&quot;</span><span class="w"> </span><span class="c1"># This will be the tag used by syslog-ng to create the log file</span>
<span class="w">        </span><span class="nt">syslog-address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;udp://10.20.30.254:514&quot;</span><span class="w"> </span><span class="c1"># This is the syslog-ng container address</span>

<span class="w">  </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">      </span><span class="nt">ADMIN_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span>
<span class="w">      </span><span class="nt">ADMIN_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the admin user</span>
<span class="w">      </span><span class="nt">TOTP_SECRETS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysecret&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger secret key (see the Prerequisites section)</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-logs:/var/log/bunkerweb</span><span class="w"> </span><span class="c1"># This is the volume used to store the logs</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">syslog</span>
<span class="w">      </span><span class="nt">options</span><span class="p">:</span>
<span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bw-ui&quot;</span><span class="w"> </span><span class="c1"># This will be the tag used by syslog-ng to create the log file</span>
<span class="w">        </span><span class="nt">syslog-address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;udp://10.20.30.254:514&quot;</span><span class="w"> </span><span class="c1"># This is the syslog-ng container address</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-syslog</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">balabit/syslog-ng:4.8.0</span>
<span class="w">    </span><span class="c1"># image: lscr.io/linuxserver/syslog-ng:4.8.1-r1-ls147 # For aarch64 architecture</span>
<span class="w">    </span><span class="nt">cap_add</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NET_BIND_SERVICE</span><span class="w">  </span><span class="c1"># Bind to low ports</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NET_BROADCAST</span><span class="w">  </span><span class="c1"># Send broadcasts</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NET_RAW</span><span class="w">  </span><span class="c1"># Use raw sockets</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DAC_READ_SEARCH</span><span class="w">  </span><span class="c1"># Read files bypassing permissions</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DAC_OVERRIDE</span><span class="w">  </span><span class="c1"># Override file permissions</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CHOWN</span><span class="w">  </span><span class="c1"># Change ownership</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SYSLOG</span><span class="w">  </span><span class="c1"># Write to system logs</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-logs:/var/log/bunkerweb</span><span class="w"> </span><span class="c1"># This is the volume used to store the logs</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./syslog-ng.conf:/etc/syslog-ng/syslog-ng.conf</span><span class="w"> </span><span class="c1"># This is the syslog-ng configuration file</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.254</span><span class="w"> </span><span class="c1"># Make sure to set the correct IP address</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-logs</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>To forward the logs correctly to the <code>/var/log/bunkerweb</code> directory on the Autoconf integration, you will need to stream the logs to a file using <code>syslog-ng</code>. Here is an example of how to do this :</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-ui-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;bw-ui-env</span>
<span class="w">  </span><span class="c1"># We anchor the environment variables to avoid duplication</span>
<span class="w">  </span><span class="nt">AUTOCONF_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">  </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/udp&quot;</span><span class="w"> </span><span class="c1"># QUIC</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">AUTOCONF_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/24</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">syslog</span>
<span class="w">      </span><span class="nt">options</span><span class="p">:</span>
<span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span><span class="w"> </span><span class="c1"># This will be the tag used by syslog-ng to create the log file</span>
<span class="w">        </span><span class="nt">syslog-address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;udp://10.20.30.254:514&quot;</span><span class="w"> </span><span class="c1"># This is the syslog-ng container address</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1"># We don&#39;t need to specify the BunkerWeb instance here as they are automatically detected by the autoconf service</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1"># The server name will be filled with services labels</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="c1"># Mandatory setting for autoconf / ui</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/24</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">syslog</span>
<span class="w">      </span><span class="nt">options</span><span class="p">:</span>
<span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bw-scheduler&quot;</span><span class="w"> </span><span class="c1"># This will be the tag used by syslog-ng to create the log file</span>
<span class="w">        </span><span class="nt">syslog-address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;udp://10.20.30.254:514&quot;</span><span class="w"> </span><span class="c1"># This is the syslog-ng container address</span>

<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">DOCKER_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tcp://bw-docker:2375&quot;</span><span class="w"> </span><span class="c1"># This is the Docker socket address</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">syslog</span>
<span class="w">      </span><span class="nt">options</span><span class="p">:</span>
<span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bw-autoconf&quot;</span><span class="w"> </span><span class="c1"># This will be the tag used by syslog-ng to create the log file</span>
<span class="w">        </span><span class="nt">syslog-address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;udp://10.20.30.254:514&quot;</span><span class="w"> </span><span class="c1"># This is the syslog-ng container address</span>

<span class="w">  </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*bw-ui-env</span>
<span class="w">      </span><span class="nt">ADMIN_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span>
<span class="w">      </span><span class="nt">ADMIN_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the admin user</span>
<span class="w">      </span><span class="nt">TOTP_SECRETS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysecret&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger secret key (see the Prerequisites section)</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-logs:/var/log/bunkerweb</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=www.example.com&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_TEMPLATE=ui&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/changeme&quot;</span><span class="w"> </span><span class="c1"># Change it to a hard to guess URI</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://bw-ui:7000&quot;</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">syslog</span>
<span class="w">      </span><span class="nt">options</span><span class="p">:</span>
<span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bw-ui&quot;</span><span class="w"> </span><span class="c1"># This will be the tag used by syslog-ng to create the log file</span>
<span class="w">        </span><span class="nt">syslog-address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;udp://10.20.30.254:514&quot;</span><span class="w"> </span><span class="c1"># This is the syslog-ng container address</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy:nightly</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">CONTAINERS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warning&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unless-stopped&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-syslog</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">balabit/syslog-ng:4.8.0</span>
<span class="w">    </span><span class="c1"># image: lscr.io/linuxserver/syslog-ng:4.8.1-r1-ls147 # For aarch64 architecture</span>
<span class="w">    </span><span class="nt">cap_add</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NET_BIND_SERVICE</span><span class="w">  </span><span class="c1"># Bind to low ports</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NET_BROADCAST</span><span class="w">  </span><span class="c1"># Send broadcasts</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NET_RAW</span><span class="w">  </span><span class="c1"># Use raw sockets</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DAC_READ_SEARCH</span><span class="w">  </span><span class="c1"># Read files bypassing permissions</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DAC_OVERRIDE</span><span class="w">  </span><span class="c1"># Override file permissions</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CHOWN</span><span class="w">  </span><span class="c1"># Change ownership</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SYSLOG</span><span class="w">  </span><span class="c1"># Write to system logs</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-logs:/var/log/bunkerweb</span><span class="w"> </span><span class="c1"># This is the volume used to store the logs</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./syslog-ng.conf:/etc/syslog-ng/syslog-ng.conf</span><span class="w"> </span><span class="c1"># This is the syslog-ng configuration file</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.254</span><span class="w"> </span><span class="c1"># Make sure to set the correct IP address</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-logs</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="web-ui-syslog-ng-configuration">Syslog-ng configuration</h3>
<p>Here is an example of a <code>syslog-ng.conf</code> file that you can use to forward the logs to a file :</p>
<div class="highlight"><pre><span></span><code>@version: 4.8

# Source configuration to receive logs from Docker containers
source s_net {
  udp(
    ip(&quot;0.0.0.0&quot;)
  );
};

# Template to format log messages
template t_imp {
  template(&quot;$MSG\n&quot;);
  template_escape(no);
};

# Destination configuration to write logs to dynamically named files
destination d_dyna_file {
  file(
    &quot;/var/log/bunkerweb/${PROGRAM}.log&quot;
    template(t_imp)
    owner(&quot;101&quot;)
    group(&quot;101&quot;)
    dir_owner(&quot;root&quot;)
    dir_group(&quot;101&quot;)
    perm(0440)
    dir_perm(0770)
    create_dirs(yes)
  );
};

# Log path to direct logs to dynamically named files
log {
  source(s_net);
  destination(d_dyna_file);
};
</code></pre></div>
<h2 id="web-ui-account-management">Account management</h2>
<p>You can access the account management page by clicking on the profile image in the top right corner:</p>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/manage-account.png" width="400" />
  </p>
<figcaption>Account page access from top right corner</figcaption>
</figure>
<h3 id="web-ui-username-password">Username / Password</h3>
<div class="admonition warning">
<p class="admonition-title">Lost password/username</p>
<p>In case you forgot your UI credentials, you can reset them from the CLI following <a href="#troubleshooting-web-ui">the steps described in the troubleshooting section</a>.</p>
</div>
<p>You can update your username or password by filling the dedicated forms in the <strong>Security</strong> tab. For security reason, you need to enter your current password even if you are connected.</p>
<p>Please note that when your username or password is updated, you will be logout from the web UI to log in again.</p>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/profile-username-password.png" width="650" />
  </p>
<figcaption>Username / Password form</figcaption>
</figure>
<h3 id="web-ui-two-factor-authentication">Two-Factor authentication</h3>
<div class="admonition warning">
<p class="admonition-title">Lost secret key</p>
<p>In case you lost your secret key, two options are available :</p>
<ul>
<li>You can recover your account using one of the provided recovery codes when you enabled 2FA (a recovery code can only be used once).</li>
<li>You can disable 2FA from the CLI following <a href="#troubleshooting-web-ui">the steps described in the troubleshooting section</a>.</li>
</ul>
</div>
<p>You can power-up your login security by adding <strong>Two-Factor Authentication (2FA)</strong> to your account. By doing so, an extra code will be needed in addition to your password.</p>
<p>The web UI uses <a href="https://en.wikipedia.org/wiki/Time-based_one-time_password">Time based One Time Password (TOTP)</a> as 2FA implementation : using a <strong>secret key</strong>, the algorithm will generate <strong>one time passwords only valid for a short period of time</strong>.</p>
<p>Any TOTP client such as Google Authenticator, Authy, FreeOTP, ... can be used to store the secret key and generate the codes. Please note that once TOTP is enabled, <strong>you won't be able to retrieve it from the web UI</strong>.</p>
<p>The following steps are needed to enable the TOTP feature from the web UI :</p>
<ul>
<li>Copy the secret key or use the QR code on your authenticator app</li>
<li>Enter the current TOTP code in the 2FA input</li>
<li>Enter your current password</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Secret key refresh</p>
<p>A new secret key is <strong>generated each time</strong> you visit the page or submit the form. In case something went wrong (e.g. : expired TOTP code), you will need to copy the new secret key to your authenticator app until 2FA is successfully enabled.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Recovery codes</p>
<p>When you enable 2FA, you will be provided with <strong>5 recovery codes</strong>. These codes can be used to recover your account in case you have lost your TOTP secret key. Each code can only be used once. <strong>These codes will only be shown once so make sure to store them in a safe place</strong>.</p>
<p>If you ever lose your recovery codes, <strong>you can refresh them via the TOTP section of the account management page</strong>. Please note that the old recovery codes will be invalidated.</p>
</div>
<p>You can enable or disable 2FA and also refresh recovery codes in the <strong>Security</strong> tab:</p>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/profile-totp.png" width="800" />
  </p>
<figcaption>TOTP enable / disable / refresh recovery codes forms</figcaption>
</figure>
<p>After a successful login/password combination, you will be prompted to enter your TOTP code:</p>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/profile-2fa.png" width="400" />
  </p>
<figcaption>2FA on login page</figcaption>
</figure>
<h3 id="web-ui-current-sessions">Current sessions</h3>
<p>In the <strong>Session</strong> tab, you will be able to list and revoke current sessions:</p>
<figure>
<p><img align="center," alt="Overview" src="../assets/img/sessions.png" width="800" />
  </p>
<figcaption>Manage sessions</figcaption>
</figure>
<h2 id="web-ui-advanced-installation">Advanced installation</h2>
<p>The web UI can be deployed and configured without going through the setup wizard process: configuration is done through environment variables, which can be added directly to the containers or in the <code>/etc/bunkerweb/ui.env</code> file in the case of a Linux integration.</p>
<div class="admonition tip">
<p class="admonition-title">Web UI specific environment variables</p>
<p>The web UI uses the following environment variables :</p>
<ul>
<li><code>OVERRIDE_ADMIN_CREDS</code> : set it to <code>yes</code> to enable the override even if the admin credentials are already set (default is <code>no</code>).</li>
<li><code>ADMIN_USERNAME</code> : username to access the web UI.</li>
<li><code>ADMIN_PASSWORD</code> : password to access the web UI.</li>
<li><code>FLASK_SECRET</code> : a secret key used to encrypt the session cookie (if not set, a random key will be generated).</li>
<li><code>TOTP_SECRETS</code> : a list of TOTP secrets separated by spaces or a dictionary (e.g. : <code>{"1": "mysecretkey"}</code> or <code>mysecretkey</code> or <code>mysecretkey mysecretkey1</code>). <strong>We strongly recommend you to set this variable if you want to use 2FA, as it will be used to encrypt the TOTP secret keys</strong> (if not set, a random number of secret keys will be generated). Check out the <a href="https://passlib.readthedocs.io/en/stable/narr/totp-tutorial.html#application-secrets">passlib documentation</a> for more information.</li>
<li><code>LISTEN_ADDR</code> : the address where the web UI will listen (default is <code>0.0.0.0</code> in <strong>Docker images</strong> and <code>127.0.0.1</code> on <strong>Linux installations</strong>).</li>
<li><code>LISTEN_PORT</code> : the port where the web UI will listen (default is <code>7000</code>).</li>
<li><code>MAX_WORKERS</code> : the number of workers used by the web UI (default is the number of CPUs).</li>
<li><code>MAX_THREADS</code> : the number of threads used by the web UI (default is <code>MAX_WORKERS</code> * 2).</li>
<li><code>FORWARDED_ALLOW_IPS</code> : a list of IP addresses or networks that are allowed to be used in the <code>X-Forwarded-For</code> header (default is <code>*</code> in <strong>Docker images</strong> and <code>127.0.0.1</code> on <strong>Linux installations</strong>).</li>
<li><code>CHECK_PRIVATE_IP</code> : set it to <code>yes</code> to not disconnect users that have their IP address changed during a session if they are in a private network (default is <code>yes</code>). (Non-private IP addresses are always checked).</li>
</ul>
<p>The web UI will use these variables to authenticate you and handle the 2FA feature.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Generating recommended secrets</p>
<p>To generate a valid <strong>ADMIN_PASSWORD</strong>, we recommend you to <strong>use a password manager</strong> or a <strong>password generator</strong>.</p>
<p>You can generate a valid <strong>FLASK_SECRET</strong> using the following command :</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import secrets; print(secrets.token_hex(64))&quot;</span>
</code></pre></div>
<p>You can generate valid space-separated <strong>TOTP_SECRETS</strong> using the following command (you will need the <code>passlib</code> package) :</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;from passlib import totp; print(&#39; &#39;.join(totp.generate_secret() for i in range(1, 6)))&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="2:5"><input checked="checked" id="web-ui-__tabbed_2_1" name="web-ui-__tabbed_2" type="radio" /><input id="web-ui-__tabbed_2_2" name="web-ui-__tabbed_2" type="radio" /><input id="web-ui-__tabbed_2_3" name="web-ui-__tabbed_2" type="radio" /><input id="web-ui-__tabbed_2_4" name="web-ui-__tabbed_2" type="radio" /><input id="web-ui-__tabbed_2_5" name="web-ui-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="web-ui-__tabbed_2_1">Linux</label><label for="web-ui-__tabbed_2_2">Docker</label><label for="web-ui-__tabbed_2_3">Docker autoconf</label><label for="web-ui-__tabbed_2_4">Kubernetes</label><label for="web-ui-__tabbed_2_5">Swarm</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>The installation of the web UI using the <a href="#integrations-linux">Linux integration</a> is pretty straightforward because it is installed with BunkerWeb.</p>
<p>The web UI comes as systemd service named <code>bunkerweb-ui</code>, please ensure that it's enabled:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>bunkerweb-ui<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>bunkerweb-ui
</code></pre></div>
<p>A dedicated environment file located at <code>/etc/bunkerweb/ui.env</code> is used to configure the web UI:</p>
<div class="highlight"><pre><span></span><code>ADMIN_USERNAME=changeme
ADMIN_PASSWORD=changeme
TOTP_SECRETS=mysecret
</code></pre></div>
<p>Replace the <code>changeme</code> data with your own values.</p>
<p>Remember to set a stronger secret key for the <code>TOTP_SECRETS</code>.</p>
<p>Each time you edit the <code>/etc/bunkerweb/ui.env</code> file, you will need to restart the service :</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>bunkerweb-ui
</code></pre></div>
<p>Accessing the web UI through BunkerWeb is a classical <a href="#quickstart-guide">reverse proxy setup</a>. Please note that the web UI is listening on the <code>7000</code> port and only on the loopback interface.</p>
<p>Here is the <code>/etc/bunkerweb/variables.env</code> boilerplate you can use:</p>
<div class="highlight"><pre><span></span><code>HTTP_PORT=80
HTTPS_PORT=443
DNS_RESOLVERS=9.9.9.9 8.8.8.8 8.8.4.4
API_LISTEN_IP=127.0.0.1
SERVER_NAME=www.example.com
MULTISITE=yes
www.example.com_USE_TEMPLATE=ui
www.example.com_USE_REVERSE_PROXY=yes
www.example.com_REVERSE_PROXY_URL=/changeme
www.example.com_REVERSE_PROXY_HOST=http://127.0.0.1:7000
</code></pre></div>
<p>Don't forget to reload the <code>bunkerweb</code> service:</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>reload<span class="w"> </span>bunkerweb
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The web UI can be deployed using a dedicated container which is available on <a href="https://hub.docker.com/r/bunkerity/bunkerweb-ui">Docker Hub</a>:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>bunkerity/bunkerweb-ui
</code></pre></div>
<p>Alternatively, you can also build it yourself :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb.git<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">cd</span><span class="w"> </span>bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my-bunkerweb-ui<span class="w"> </span>-f<span class="w"> </span>src/ui/Dockerfile<span class="w"> </span>.
</code></pre></div>
<p>Accessing the web UI through BunkerWeb is a classical <a href="#quickstart-guide">reverse proxy setup</a>. We recommend you to connect BunkerWeb and web UI using a dedicated network (like <code>bw-universe</code> also used by the scheduler) so it won't be on the same network of your web services for obvious security reasons. Please note that the web UI container is listening on the <code>7000</code> port.</p>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>If you want another Database backend than MariaDB please refer to the docker-compose files in the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/misc/integrations">misc/integrations folder</a> of the repository.</p>
</div>
<p>Here is the docker-compose boilerplate that you can use (don't forget to edit the <code>changeme</code> data):</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-ui-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;ui-env</span>
<span class="w">  </span><span class="c1"># We anchor the environment variables to avoid duplication</span>
<span class="w">  </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/udp&quot;</span><span class="w"> </span><span class="c1"># For QUIC / HTTP3 support</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span><span class="w"> </span><span class="c1"># Make sure to set the correct IP range so the scheduler can send the configuration to the instance</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*ui-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span><span class="w"> </span><span class="c1"># Make sure to set the correct instance name</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;www.example.com&quot;</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span><span class="w"> </span><span class="c1"># We mirror the API_WHITELIST_IP from the bunkerweb service</span>
<span class="w">      </span><span class="nt">SERVE_FILES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;no&quot;</span>
<span class="w">      </span><span class="nt">DISABLE_DEFAULT_SERVER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">USE_CLIENT_CACHE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">USE_GZIP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">www.example.com_USE_TEMPLATE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ui&quot;</span>
<span class="w">      </span><span class="nt">www.example.com_USE_REVERSE_PROXY</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">www.example.com_REVERSE_PROXY_URL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger URI</span>
<span class="w">      </span><span class="nt">www.example.com_REVERSE_PROXY_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://bw-ui:7000&quot;</span><span class="w"> </span><span class="c1"># The web UI container is listening on the 7000 port by default</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*ui-env</span>
<span class="w">      </span><span class="nt">ADMIN_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span>
<span class="w">      </span><span class="nt">ADMIN_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the changeme user</span>
<span class="w">      </span><span class="nt">TOTP_SECRETS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysecret&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger secret key (see the Prerequisites section)</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The web UI can be deployed using a dedicated container which is available on <a href="https://hub.docker.com/r/bunkerity/bunkerweb-ui">Docker Hub</a>:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>bunkerity/bunkerweb-ui
</code></pre></div>
<p>Alternatively, you can also build it yourself:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb.git<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">cd</span><span class="w"> </span>bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my-bunkerweb-ui<span class="w"> </span>-f<span class="w"> </span>src/ui/Dockerfile<span class="w"> </span>.
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Environment variables</p>
<p>Please read the <a href="#web-ui-prerequisites">Prerequisites</a> section to check out all the environment variables you can set to customize the web UI.</p>
</div>
<p>Accessing the web UI through BunkerWeb is a classical <a href="#quickstart-guide">reverse proxy setup</a>. We recommend you to connect BunkerWeb and web UI using a dedicated network (like <code>bw-universe</code> also used by the scheduler and autoconf) so it won't be on the same network of your web services for obvious security reasons. Please note that the web UI container is listening on the <code>7000</code> port.</p>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>If you want another Database backend than MariaDB please refer to the docker-compose files in the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/misc/integrations">misc/integrations folder</a> of the repository.</p>
</div>
<p>Here is the docker-compose boilerplate that you can use (don't forget to edit the <code>changeme</code> data):</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-ui-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;ui-env</span>
<span class="w">  </span><span class="c1"># We anchor the environment variables to avoid duplication</span>
<span class="w">  </span><span class="nt">AUTOCONF_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">  </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:8080/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/tcp&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:8443/udp&quot;</span><span class="w"> </span><span class="c1"># For QUIC / HTTP3 support</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE=yes&quot;</span><span class="w"> </span><span class="c1"># We set the instance label to allow the autoconf to detect the instance</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">AUTOCONF_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*ui-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*ui-env</span>
<span class="w">      </span><span class="nt">DOCKER_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tcp://bw-docker:2375&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy:nightly</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">CONTAINERS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warning&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*ui-env</span>
<span class="w">      </span><span class="nt">ADMIN_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span>
<span class="w">      </span><span class="nt">ADMIN_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the changeme user</span>
<span class="w">      </span><span class="nt">TOTP_SECRETS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysecret&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger secret key (see the Prerequisites section)</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=www.example.com&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_TEMPLATE=ui&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/changeme&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://bw-ui:7000&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The web UI can be deployed using a dedicated container which is available on <a href="https://hub.docker.com/r/bunkerity/bunkerweb-ui">Docker Hub</a> and you can deploy as a standard <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a>.</p>
<p>Accessing the web UI through BunkerWeb is a classical <a href="#quickstart-guide">reverse proxy setup</a>. Network segmentation between web UI and web services is not covered in this documentation. Please note that the web UI container is listening on the <code>7000</code> port.</p>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>If you want another Database backend than MariaDB please refer to the yaml files in the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/misc/integrations">misc/integrations folder</a> of the repository.</p>
</div>
<p>Here is the corresponding part of your values.yaml file that you can use:</p>
<div class="highlight"><pre><span></span><code><span class="nt">settings</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Use an existing secret named bunkerweb and containing the following values :</span>
<span class="w">  </span><span class="c1"># - admin-username</span>
<span class="w">  </span><span class="c1"># - admin-password</span>
<span class="w">  </span><span class="c1"># - flask-secret</span>
<span class="w">  </span><span class="c1"># - totp-secrets</span>
<span class="w">  </span><span class="nt">existingSecret</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;secret-bunkerweb&quot;</span>
<span class="nt">ui</span><span class="p">:</span>
<span class="w">  </span><span class="nt">wizard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">serverName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;www.example.com&quot;</span>
<span class="w">    </span><span class="nt">serverPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/admin&quot;</span>
<span class="w">  </span><span class="nt">overrideAdminCreds</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Deprecated</p>
<p>The Swarm integration is deprecated and will be removed in a future release. Please consider using the <a href="#integrations-kubernetes">Kubernetes integration</a> instead.</p>
<p><strong>More information can be found in the <a href="#integrations-swarm">Swarm integration documentation</a>.</strong></p>
</div>
<p>The web UI can be deployed using a dedicated container which is available on <a href="https://hub.docker.com/r/bunkerity/bunkerweb-ui">Docker Hub</a>:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>bunkerity/bunkerweb-ui
</code></pre></div>
<p>Alternatively, you can also build it yourself :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb.git<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">cd</span><span class="w"> </span>bunkerweb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my-bunkerweb-ui<span class="w"> </span>-f<span class="w"> </span>src/ui/Dockerfile<span class="w"> </span>.
</code></pre></div>
<p>Accessing the web UI through BunkerWeb is a classical <a href="#quickstart-guide">reverse proxy setup</a>. We recommend you to connect BunkerWeb and web UI using a dedicated network (like <code>bw-universe</code> also used by the scheduler and autoconf) so it won't be on the same network of your web services for obvious security reasons. Please note that the web UI container is listening on the <code>7000</code> port.</p>
<div class="admonition info">
<p class="admonition-title">Database backend</p>
<p>If you want another Database backend than MariaDB please refer to the stack files in the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/misc/integrations">misc/integrations folder</a> of the repository.</p>
</div>
<p>Here is the stack boilerplate that you can use (don't forget to edit the <code>changeme</code> data) :</p>
<div class="highlight"><pre><span></span><code><span class="nt">x-ui-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;ui-env</span>
<span class="w">  </span><span class="c1"># We anchor the environment variables to avoid duplication</span>
<span class="w">  </span><span class="nt">SWARM_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">  </span><span class="nt">DATABASE_URI</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@bw-db:3306/db&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">published</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">udp</span><span class="w"> </span><span class="c1"># For QUIC / HTTP3 support</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">SWARM_MODE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">global</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">worker&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.INSTANCE=yes&quot;</span>

<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*ui-env</span>
<span class="w">      </span><span class="nt">BUNKERWEB_INSTANCES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">SERVER_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">API_WHITELIST_IP</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.0/8</span><span class="nv"> </span><span class="s">10.20.30.0/24&quot;</span>
<span class="w">      </span><span class="nt">MULTISITE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">USE_REDIS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">REDIS_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bw-redis&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-storage:/data</span><span class="w"> </span><span class="c1"># This is used to persist the cache and other data like the backups</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*ui-env</span>
<span class="w">      </span><span class="nt">DOCKER_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tcp://bw-docker:2375&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy:nightly</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">CONFIGS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">CONTAINERS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">SERVICES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">SWARM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">TASKS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">      </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warning&quot;</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">placement</span><span class="p">:</span>
<span class="w">        </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;node.role</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">manager&quot;</span>

<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_RANDOM_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bunkerweb&quot;</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the database</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-data:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>

<span class="w">  </span><span class="nt">bw-redis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>

<span class="w">  </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:testing</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*ui-env</span>
<span class="w">      </span><span class="nt">ADMIN_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span>
<span class="w">      </span><span class="nt">ADMIN_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;changeme&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger password for the changeme user</span>
<span class="w">      </span><span class="nt">TOTP_SECRETS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysecret&quot;</span><span class="w"> </span><span class="c1"># Remember to set a stronger secret key (see the Prerequisites section)</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.SERVER_NAME=www.example.com&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_TEMPLATE=ui&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.USE_REVERSE_PROXY=yes&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_URL=/changeme&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;bunkerweb.REVERSE_PROXY_HOST=http://bw-ui:7000&quot;</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-storage</span><span class="p">:</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bw-universe</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-universe</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.20.30.0/24</span>
<span class="w">  </span><span class="nt">bw-services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-services</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">bw-docker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-docker</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">bw-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bw-db</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">    </span><span class="nt">attachable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
</div>
</div>
</div></section><section class="print-page" id="upgrading"><h1 id="upgrading-upgrading">Upgrading</h1>
<h2 id="upgrading-upgrade-from-16x">Upgrade from 1.6.X</h2>
<div class="admonition warning">
<p class="admonition-title">Read me first</p>
<p>We often add new features and settings to BunkerWeb. We recommend you read the <a href="#settings">settings</a> sections of the documentation or the GitHub releases to see what's new.</p>
</div>
<h3 id="upgrading-procedure">Procedure</h3>
<ol>
<li>
<p><strong>Backup the database</strong>:</p>
<ul>
<li>Before proceeding with the database upgrade, ensure to perform a complete backup of the current state of the database.</li>
<li>Use appropriate tools to backup the entire database, including data, schemas, and configurations.</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="upgrading-__tabbed_1_1" name="upgrading-__tabbed_1" type="radio" /><input id="upgrading-__tabbed_1_2" name="upgrading-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_1_1">Docker</label><label for="upgrading-__tabbed_1_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>-e<span class="w"> </span><span class="nv">BACKUP_DIRECTORY</span><span class="o">=</span>/path/to/backup/directory<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>save
</code></pre></div>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>cp<span class="w"> </span>&lt;scheduler_container&gt;:/path/to/backup/directory<span class="w"> </span>/path/to/backup/directory
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Information for Red Hat Enterprise Linux (RHEL) 8.9 users</p>
<p>If you are using <strong>RHEL 8.9</strong> and plan on using an <strong>external database</strong>, you will need to install the <code>mysql-community-client</code> package to ensure the <code>mysqldump</code> command is available. You can install the package by executing the following commands:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="upgrading-__tabbed_2_1" name="upgrading-__tabbed_2" type="radio" /><input id="upgrading-__tabbed_2_2" name="upgrading-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_2_1">MySQL/MariaDB</label><label for="upgrading-__tabbed_2_2">PostgreSQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li>
<p><strong>Install the MySQL repository configuration package</strong></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>https://dev.mysql.com/get/mysql80-community-release-el8-9.noarch.rpm
</code></pre></div>
</li>
<li>
<p><strong>Enable the MySQL repository</strong></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>config-manager<span class="w"> </span>--enable<span class="w"> </span>mysql80-community
</code></pre></div>
</li>
<li>
<p><strong>Install the MySQL client</strong></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>mysql-community-client
</code></pre></div>
</li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Install the PostgreSQL repository configuration package</strong></p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-</span><span class="k">$(</span>uname<span class="w"> </span>-m<span class="k">)</span><span class="s2">/pgdg-redhat-repo-latest.noarch.rpm&quot;</span>
</code></pre></div>
</li>
<li>
<p><strong>Install the PostgreSQL client</strong></p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span>postgresql&lt;version&gt;
</code></pre></div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="highlight"><pre><span></span><code><span class="nv">BACKUP_DIRECTORY</span><span class="o">=</span>/path/to/backup/directory<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>save
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p><strong>Upgrade BunkerWeb</strong>:</p>
<ul>
<li>
<p>Upgrade BunkerWeb to the latest version.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="upgrading-__tabbed_3_1" name="upgrading-__tabbed_3" type="radio" /><input id="upgrading-__tabbed_3_2" name="upgrading-__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_3_1">Docker</label><label for="upgrading-__tabbed_3_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li>
<p><strong>Update the Docker Compose file</strong>: Update the Docker Compose file to use the new version of the BunkerWeb image.
    <div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:testing</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Restart the containers</strong>: Restart the containers to apply the changes.
    <div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>down
docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div></p>
</li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Stop the services</strong>:
    <div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>stop<span class="w"> </span>bunkerweb
systemctl<span class="w"> </span>stop<span class="w"> </span>bunkerweb-ui
</code></pre></div></p>
</li>
<li>
<p><strong>Update BunkerWeb</strong>:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="upgrading-__tabbed_4_1" name="upgrading-__tabbed_4" type="radio" /><input id="upgrading-__tabbed_4_2" name="upgrading-__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_4_1">Debian/Ubuntu</label><label for="upgrading-__tabbed_4_2">Fedora/RedHat</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>First, if you have previously hold the BunkerWeb package, unhold it :</p>
<p>You can print a list of packages on hold with <code>apt-mark showhold</code></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-mark<span class="w"> </span>unhold<span class="w"> </span>bunkerweb
</code></pre></div>
<p>Them, you can update BunkerWeb package :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">bunkerweb</span><span class="o">=</span>testing
</code></pre></div>
<p>To prevent upgrading BunkerWeb package when executing <code>apt upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-mark<span class="w"> </span>hold<span class="w"> </span>bunkerweb
</code></pre></div>
<p>More details in the <a href="#integrations-__tabbed_1_1">integration Linux page</a>.</p>
</div>
<div class="tabbed-block">
<p>First, if you have previously hold the BunkerWeb package, unhold it :</p>
<p>You can print a list of packages on hold with <code>dnf versionlock list</code></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>delete<span class="w"> </span>package<span class="w"> </span>bunkerweb
</code></pre></div>
<p>Them, you can update BunkerWeb package :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>bunkerweb-testing
</code></pre></div>
<p>To prevent upgrading BunkerWeb package when executing <code>dnf upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>bunkerweb
</code></pre></div>
<p>More details in the <a href="#integrations-__tabbed_1_3">integration Linux page</a>.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</li>
</ul>
</li>
<li>
<p><strong>Check the logs</strong>: Check the logs of the scheduler service to ensure that the migration was successful.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="upgrading-__tabbed_5_1" name="upgrading-__tabbed_5" type="radio" /><input id="upgrading-__tabbed_5_2" name="upgrading-__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_5_1">Docker</label><label for="upgrading-__tabbed_5_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>&lt;scheduler_container&gt;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>journalctl<span class="w"> </span>-u<span class="w"> </span>bunkerweb<span class="w"> </span>--no-pager
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p><strong>Verify the database</strong>: Verify that the database upgrade was successful by checking the data and configurations in the new database container.</p>
</li>
</ol>
<h3 id="upgrading-rollback">Rollback</h3>
<div class="admonition failure">
<p class="admonition-title">In case of issues</p>
<p>If you encounter any issues during the upgrade, you can rollback to the previous version of the database by restoring the backup taken in <a href="#upgrading-__tabbed_1_1">step 1</a>.</p>
<p>Get support and more information :</p>
<ul>
<li><a href="https://panel.bunkerweb.io/?utm_source=doc&amp;utm_campaign=self">Order professional support</a></li>
<li><a href="https://github.com/bunkerity/bunkerweb/issues">Create an issue on GitHub</a></li>
<li><a href="https://discord.bunkerity.com">Join the BunkerWeb Discord server</a></li>
</ul>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="upgrading-__tabbed_6_1" name="upgrading-__tabbed_6" type="radio" /><input id="upgrading-__tabbed_6_2" name="upgrading-__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_6_1">Docker</label><label for="upgrading-__tabbed_6_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li>
<p><strong>Restore the backup</strong>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:3"><input checked="checked" id="upgrading-__tabbed_7_1" name="upgrading-__tabbed_7" type="radio" /><input id="upgrading-__tabbed_7_2" name="upgrading-__tabbed_7" type="radio" /><input id="upgrading-__tabbed_7_3" name="upgrading-__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_7_1">SQLite</label><label for="upgrading-__tabbed_7_2">MySQL/MariaDB</label><label for="upgrading-__tabbed_7_3">PostgreSQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li>
<p><strong>Remove the existing database file.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-u<span class="w"> </span><span class="m">0</span><span class="w"> </span>-i<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3
</code></pre></div>
</li>
<li>
<p><strong>Restore the backup.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>sqlite3<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3<span class="w"> </span>&lt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</li>
<li>
<p><strong>Fix permissions.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-u<span class="w"> </span><span class="m">0</span><span class="w"> </span>-i<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>chown<span class="w"> </span>root:nginx<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-u<span class="w"> </span><span class="m">0</span><span class="w"> </span>-i<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>chmod<span class="w"> </span><span class="m">770</span><span class="w"> </span>/var/lib/bunkerweb/db.sqlite3
</code></pre></div>
</li>
<li>
<p><strong>Stop the Stack.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>down
</code></pre></div>
</li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Restore the backup.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-e<span class="w"> </span><span class="nv">MYSQL_PWD</span><span class="o">=</span>&lt;your_password&gt;<span class="w"> </span>-i<span class="w"> </span>&lt;database_container&gt;<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;<span class="w"> </span>&lt;database_name&gt;<span class="w"> </span>&lt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</li>
<li>
<p><strong>Stop the Stack.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>down
</code></pre></div>
</li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Remove the existing database.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>&lt;database_container&gt;<span class="w"> </span>dropdb<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;<span class="w"> </span>--force<span class="w"> </span>&lt;database_name&gt;
</code></pre></div>
</li>
<li>
<p><strong>Recreate the database.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>&lt;database_container&gt;<span class="w"> </span>createdb<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;<span class="w"> </span>&lt;database_name&gt;
</code></pre></div>
</li>
<li>
<p><strong>Restore the backup.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>&lt;database_container&gt;<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;<span class="w"> </span>-d<span class="w"> </span>&lt;database_name&gt;<span class="w"> </span>&lt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</li>
<li>
<p><strong>Stop the Stack.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>down
</code></pre></div>
</li>
</ol>
</div>
</div>
</div>
</li>
<li>
<p><strong>Downgrade BunkerWeb</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:&lt;old_version&gt;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:&lt;old_version&gt;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:&lt;old_version&gt;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:&lt;old_version&gt;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</li>
<li>
<p><strong>Start the containers</strong>.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
</li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Stop the services</strong>.</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>stop<span class="w"> </span>bunkerweb<span class="w"> </span>bunkerweb-ui
</code></pre></div>
</li>
<li>
<p><strong>Restore the backup</strong>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:3"><input checked="checked" id="upgrading-__tabbed_8_1" name="upgrading-__tabbed_8" type="radio" /><input id="upgrading-__tabbed_8_2" name="upgrading-__tabbed_8" type="radio" /><input id="upgrading-__tabbed_8_3" name="upgrading-__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_8_1">SQLite</label><label for="upgrading-__tabbed_8_2">MySQL/MariaDB</label><label for="upgrading-__tabbed_8_3">PostgreSQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3
sudo<span class="w"> </span>sqlite3<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3<span class="w"> </span>&lt;<span class="w"> </span>/path/to/backup/directory/backup.sql
sudo<span class="w"> </span>chown<span class="w"> </span>root:nginx<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">770</span><span class="w"> </span>/var/lib/bunkerweb/db.sqlite3
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>mysql<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;database_name&gt;<span class="w"> </span>&lt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Remove the existing database.</strong></p>
<div class="highlight"><pre><span></span><code>dropdb<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;<span class="w"> </span>--force<span class="w"> </span>&lt;database_name&gt;
</code></pre></div>
</li>
<li>
<p><strong>Recreate the database.</strong></p>
<div class="highlight"><pre><span></span><code>createdb<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;<span class="w"> </span>&lt;database_name&gt;
</code></pre></div>
</li>
<li>
<p><strong>Restore the backup.</strong></p>
<div class="highlight"><pre><span></span><code>psql<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;<span class="w"> </span>-d<span class="w"> </span>&lt;database_name&gt;<span class="w"> </span>&lt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</li>
</ol>
</div>
</div>
</div>
</li>
<li>
<p><strong>Downgrade BunkerWeb</strong>.</p>
<ul>
<li>Downgrade BunkerWeb to the previous version by following the same steps as when upgrading BunkerWeb in the <a href="#integrations-linux">integration Linux page</a></li>
</ul>
</li>
</ol>
</div>
</div>
</div>
<h2 id="upgrading-upgrade-from-15x">Upgrade from 1.5.X</h2>
<h3 id="upgrading-what-changed">What changed?</h3>
<h4 id="upgrading-scheduler">Scheduler</h4>
<p>Unlike the 1.5.X releases, the Scheduler service <strong>no longer uses the <em>docker socket proxy</em> to fetch BunkerWeb's instances</strong>. Instead, it uses the new <code>BUNKERWEB_INSTANCES</code> environment variable.</p>
<div class="admonition info">
<p class="admonition-title">About the <code>BUNKERWEB_INSTANCES</code> environment variable</p>
<p>This new variable is a list of BunkerWeb instances separated by spaces in this format: <code>http://bunkerweb:5000 bunkerweb1:5000 bunkerweb2:5000 ...</code>. The scheduler will then use this list to fetch the instances' configuration and to send the configuration to them.</p>
<ul>
<li>The <code>http://</code> prefix is optional.</li>
<li>The port is optional and defaults to the value of the <code>API_HTTP_PORT</code> environment variable.</li>
<li>The default value of the <code>BUNKERWEB_INSTANCES</code> environment variable is <code>127.0.0.1</code>.</li>
</ul>
</div>
<p>In other words, the new system is fully agnostic and generic: the scheduler is in charge of managing a list of BunkerWeb instances and doesn't need to care about the environment.</p>
<div class="admonition tip">
<p class="admonition-title">Autoconf/Kubernetes/Swarm integrations</p>
<p>If you are using the <code>Autoconf</code>, <code>Kubernetes</code>, or <code>Swarm</code> integrations, you can set the <code>BUNKERWEB_INSTANCES</code> environment variable to an empty string (so that it doesn't try to send the configuration to the default one which is <code>127.0.0.1</code>).</p>
<p><strong>The instances will be automatically fetched by the controller</strong>. You can also add custom instances to the list that may not be picked up by the controller.</p>
</div>
<p>Since the <code>1.6</code>, the Scheduler also have a new <a href="#concepts">built-in healthcheck system</a>, that will check the health of the instances. If an instance becomes unhealthy, the scheduler will stop sending the configuration to it. If the instance becomes healthy again, the scheduler will start sending the configuration to it again.</p>
<h4 id="upgrading-bunkerweb-container">BunkerWeb container</h4>
<p>Another important change is that the <strong>settings</strong> that were previously declared on the BunkerWeb container <strong>are now declared on the scheduler</strong>. This means that you'll have to move your settings from the BunkerWeb container to the Scheduler container.</p>
<p>While the settings are now declared on the Scheduler container, <strong>you'll still need to declare api related mandatory settings on the BunkerWeb container</strong> like the <code>API_WHITELIST_IP</code> setting which is used to whitelist the Scheduler's IP address, so that it can send the configuration to the instance.</p>
<div class="admonition warning">
<p class="admonition-title">BunkerWeb's container settings</p>
<p>Every API related setting that you declare on the BunkerWeb container <strong>have to be mirrored on the Scheduler container</strong> so that it keeps working, as the configuration will be overwritten by the Scheduler's generated configuration.</p>
</div>
<h4 id="upgrading-default-values-and-new-settings">Default values and new settings</h4>
<p>We tried our best not to change default value but we have added many other settings. It's highly recommended to read the <a href="#advanced-security-tuning">security tuning</a> and <a href="#settings">settings</a> sections of the documentation.</p>
<h4 id="upgrading-templates">Templates</h4>
<p>We added a new feature called <strong>templates</strong>. Templates provide a structured and standardized approach to defining settings and custom configurations, check the <a href="#concepts-templates">concepts/templates</a> section for more information.</p>
<h4 id="upgrading-autoconf-namespaces">Autoconf namespaces</h4>
<p>We added a <strong>namespace</strong> feature to the autoconf integrations. Namespaces allow you to group your instances and apply settings only to them. Check the following sections according to your Integration for more information:</p>
<ul>
<li><a href="#integrations-namespaces">Autoconf/namespaces</a></li>
<li><a href="#integrations-namespaces_1">Kubernetes/namespaces</a></li>
<li><a href="#integrations-namespaces_2">Swarm/namespaces</a></li>
</ul>
<h3 id="upgrading-procedure_1">Procedure</h3>
<ol>
<li>
<p><strong>Backup the database</strong>:</p>
<ul>
<li>Before proceeding with the database upgrade, ensure to perform a complete backup of the current state of the database.</li>
<li>Use appropriate tools to backup the entire database, including data, schemas, and configurations.</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="upgrading-__tabbed_9_1" name="upgrading-__tabbed_9" type="radio" /><input id="upgrading-__tabbed_9_2" name="upgrading-__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_9_1">1.5.7 and later</label><label for="upgrading-__tabbed_9_2">1.5.6 and earlier</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="tabbed-set tabbed-alternate" data-tabs="10:2"><input checked="checked" id="upgrading-__tabbed_10_1" name="upgrading-__tabbed_10" type="radio" /><input id="upgrading-__tabbed_10_2" name="upgrading-__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_10_1">Docker</label><label for="upgrading-__tabbed_10_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>-e<span class="w"> </span><span class="nv">BACKUP_DIRECTORY</span><span class="o">=</span>/path/to/backup/directory<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>save
</code></pre></div>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>cp<span class="w"> </span>&lt;scheduler_container&gt;:/path/to/backup/directory<span class="w"> </span>/path/to/backup/directory
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Information for Red Hat Enterprise Linux (RHEL) 8.9 users</p>
<p>If you are using <strong>RHEL 8.9</strong> and plan on using an <strong>external database</strong>, you will need to install the <code>mysql-community-client</code> package to ensure the <code>mysqldump</code> command is available. You can install the package by executing the following commands:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:2"><input checked="checked" id="upgrading-__tabbed_11_1" name="upgrading-__tabbed_11" type="radio" /><input id="upgrading-__tabbed_11_2" name="upgrading-__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_11_1">MySQL/MariaDB</label><label for="upgrading-__tabbed_11_2">PostgreSQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li>
<p><strong>Install the MySQL repository configuration package</strong></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>https://dev.mysql.com/get/mysql80-community-release-el8-9.noarch.rpm
</code></pre></div>
</li>
<li>
<p><strong>Enable the MySQL repository</strong></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>config-manager<span class="w"> </span>--enable<span class="w"> </span>mysql80-community
</code></pre></div>
</li>
<li>
<p><strong>Install the MySQL client</strong></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>mysql-community-client
</code></pre></div>
</li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Install the PostgreSQL repository configuration package</strong></p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-</span><span class="k">$(</span>uname<span class="w"> </span>-m<span class="k">)</span><span class="s2">/pgdg-redhat-repo-latest.noarch.rpm&quot;</span>
</code></pre></div>
</li>
<li>
<p><strong>Install the PostgreSQL client</strong></p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span>postgresql&lt;version&gt;
</code></pre></div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="highlight"><pre><span></span><code><span class="nv">BACKUP_DIRECTORY</span><span class="o">=</span>/path/to/backup/directory<span class="w"> </span>bwcli<span class="w"> </span>plugin<span class="w"> </span>backup<span class="w"> </span>save
</code></pre></div>
</div>
</div>
</div>
</div>
<div class="tabbed-block">
<div class="tabbed-set tabbed-alternate" data-tabs="12:4"><input checked="checked" id="upgrading-__tabbed_12_1" name="upgrading-__tabbed_12" type="radio" /><input id="upgrading-__tabbed_12_2" name="upgrading-__tabbed_12" type="radio" /><input id="upgrading-__tabbed_12_3" name="upgrading-__tabbed_12" type="radio" /><input id="upgrading-__tabbed_12_4" name="upgrading-__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_12_1">SQLite</label><label for="upgrading-__tabbed_12_2">MariaDB</label><label for="upgrading-__tabbed_12_3">MySQL</label><label for="upgrading-__tabbed_12_4">PostgreSQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="tabbed-set tabbed-alternate" data-tabs="13:2"><input checked="checked" id="upgrading-__tabbed_13_1" name="upgrading-__tabbed_13" type="radio" /><input id="upgrading-__tabbed_13_2" name="upgrading-__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_13_1">Docker</label><label for="upgrading-__tabbed_13_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>We first need to install the <code>sqlite</code> package in the container.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-u<span class="w"> </span><span class="m">0</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>apk<span class="w"> </span>add<span class="w"> </span>sqlite
</code></pre></div>
<p>Then, backup the database.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>sqlite3<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3<span class="w"> </span><span class="s2">&quot;.dump&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>sqlite3<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3<span class="w"> </span><span class="s2">&quot;.dump&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</div>
</div>
</div>
</div>
<div class="tabbed-block">
<div class="tabbed-set tabbed-alternate" data-tabs="14:2"><input checked="checked" id="upgrading-__tabbed_14_1" name="upgrading-__tabbed_14" type="radio" /><input id="upgrading-__tabbed_14_2" name="upgrading-__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_14_1">Docker</label><label for="upgrading-__tabbed_14_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>-e<span class="w"> </span><span class="nv">MYSQL_PWD</span><span class="o">=</span>&lt;database_password&gt;<span class="w"> </span>&lt;database_container&gt;<span class="w"> </span>mariadb-dump<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;<span class="w"> </span>&lt;database_name&gt;<span class="w"> </span>&gt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nv">MYSQL_PWD</span><span class="o">=</span>&lt;database_password&gt;<span class="w"> </span>mariadb-dump<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;<span class="w"> </span>&lt;database_name&gt;<span class="w"> </span>&gt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</div>
</div>
</div>
</div>
<div class="tabbed-block">
<div class="tabbed-set tabbed-alternate" data-tabs="15:2"><input checked="checked" id="upgrading-__tabbed_15_1" name="upgrading-__tabbed_15" type="radio" /><input id="upgrading-__tabbed_15_2" name="upgrading-__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_15_1">Docker</label><label for="upgrading-__tabbed_15_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>-e<span class="w"> </span><span class="nv">MYSQL_PWD</span><span class="o">=</span>&lt;database_password&gt;<span class="w"> </span>&lt;database_container&gt;<span class="w"> </span>mysqldump<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;<span class="w"> </span>&lt;database_name&gt;<span class="w"> </span>&gt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nv">MYSQL_PWD</span><span class="o">=</span>&lt;database_password&gt;<span class="w"> </span>mysqldump<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;<span class="w"> </span>&lt;database_name&gt;<span class="w"> </span>&gt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</div>
</div>
</div>
</div>
<div class="tabbed-block">
<div class="tabbed-set tabbed-alternate" data-tabs="16:2"><input checked="checked" id="upgrading-__tabbed_16_1" name="upgrading-__tabbed_16" type="radio" /><input id="upgrading-__tabbed_16_2" name="upgrading-__tabbed_16" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_16_1">Docker</label><label for="upgrading-__tabbed_16_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>-e<span class="w"> </span><span class="nv">PGPASSWORD</span><span class="o">=</span>&lt;database_password&gt;<span class="w"> </span>&lt;database_container&gt;<span class="w"> </span>pg_dump<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;<span class="w"> </span>-d<span class="w"> </span>&lt;database_name&gt;<span class="w"> </span>&gt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nv">PGPASSWORD</span><span class="o">=</span>&lt;database_password&gt;<span class="w"> </span>pg_dump<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;<span class="w"> </span>-d<span class="w"> </span>&lt;database_name&gt;<span class="w"> </span>&gt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</li>
<li>
<p><strong>Upgrade BunkerWeb</strong>:</p>
<ul>
<li>
<p>Upgrade BunkerWeb to the latest version.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="17:2"><input checked="checked" id="upgrading-__tabbed_17_1" name="upgrading-__tabbed_17" type="radio" /><input id="upgrading-__tabbed_17_2" name="upgrading-__tabbed_17" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_17_1">Docker</label><label for="upgrading-__tabbed_17_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li>
<p><strong>Update the Docker Compose file</strong>: Update the Docker Compose file to use the new version of the BunkerWeb image.
    <div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:testing</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:testing</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:testing</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Restart the containers</strong>: Restart the containers to apply the changes.
    <div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>down
docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div></p>
</li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Stop the services</strong>:
    <div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>stop<span class="w"> </span>bunkerweb
systemctl<span class="w"> </span>stop<span class="w"> </span>bunkerweb-ui
</code></pre></div></p>
</li>
<li>
<p><strong>Update BunkerWeb</strong>:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="18:2"><input checked="checked" id="upgrading-__tabbed_18_1" name="upgrading-__tabbed_18" type="radio" /><input id="upgrading-__tabbed_18_2" name="upgrading-__tabbed_18" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_18_1">Debian/Ubuntu</label><label for="upgrading-__tabbed_18_2">Fedora/RedHat</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>First, if you have previously hold the BunkerWeb package, unhold it :</p>
<p>You can print a list of packages on hold with <code>apt-mark showhold</code></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-mark<span class="w"> </span>unhold<span class="w"> </span>bunkerweb
</code></pre></div>
<p>Them, you can update BunkerWeb package :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">bunkerweb</span><span class="o">=</span>testing
</code></pre></div>
<p>To prevent upgrading BunkerWeb package when executing <code>apt upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-mark<span class="w"> </span>hold<span class="w"> </span>bunkerweb
</code></pre></div>
<p>More details in the <a href="#integrations-__tabbed_1_1">integration Linux page</a>.</p>
</div>
<div class="tabbed-block">
<p>First, if you have previously hold the BunkerWeb package, unhold it :</p>
<p>You can print a list of packages on hold with <code>dnf versionlock list</code></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>delete<span class="w"> </span>package<span class="w"> </span>bunkerweb
</code></pre></div>
<p>Them, you can update BunkerWeb package :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>bunkerweb-testing
</code></pre></div>
<p>To prevent upgrading BunkerWeb package when executing <code>dnf upgrade</code>, you can use the following command :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>versionlock<span class="w"> </span>add<span class="w"> </span>bunkerweb
</code></pre></div>
<p>More details in the <a href="#integrations-__tabbed_1_3">integration Linux page</a>.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</li>
</ul>
</li>
<li>
<p><strong>Check the logs</strong>: Check the logs of the scheduler service to ensure that the migration was successful.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="19:2"><input checked="checked" id="upgrading-__tabbed_19_1" name="upgrading-__tabbed_19" type="radio" /><input id="upgrading-__tabbed_19_2" name="upgrading-__tabbed_19" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_19_1">Docker</label><label for="upgrading-__tabbed_19_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>&lt;scheduler_container&gt;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>journalctl<span class="w"> </span>-u<span class="w"> </span>bunkerweb<span class="w"> </span>--no-pager
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p><strong>Verify the database</strong>: Verify that the database upgrade was successful by checking the data and configurations in the new database container.</p>
</li>
</ol>
<h3 id="upgrading-rollback_1">Rollback</h3>
<div class="admonition failure">
<p class="admonition-title">In case of issues</p>
<p>If you encounter any issues during the upgrade, you can rollback to the previous version of the database by restoring the backup taken in <a href="#upgrading-__tabbed_1_1">step 1</a>.</p>
<p>Get support and more information :</p>
<ul>
<li><a href="https://panel.bunkerweb.io/?utm_source=doc&amp;utm_campaign=self">Order professional support</a></li>
<li><a href="https://github.com/bunkerity/bunkerweb/issues">Create an issue on GitHub</a></li>
<li><a href="https://discord.bunkerity.com">Join the BunkerWeb Discord server</a></li>
</ul>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="20:2"><input checked="checked" id="upgrading-__tabbed_20_1" name="upgrading-__tabbed_20" type="radio" /><input id="upgrading-__tabbed_20_2" name="upgrading-__tabbed_20" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_20_1">Docker</label><label for="upgrading-__tabbed_20_2">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li>
<p><strong>Restore the backup</strong>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="21:3"><input checked="checked" id="upgrading-__tabbed_21_1" name="upgrading-__tabbed_21" type="radio" /><input id="upgrading-__tabbed_21_2" name="upgrading-__tabbed_21" type="radio" /><input id="upgrading-__tabbed_21_3" name="upgrading-__tabbed_21" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_21_1">SQLite</label><label for="upgrading-__tabbed_21_2">MySQL/MariaDB</label><label for="upgrading-__tabbed_21_3">PostgreSQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li>
<p><strong>Remove the existing database file.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-u<span class="w"> </span><span class="m">0</span><span class="w"> </span>-i<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3
</code></pre></div>
</li>
<li>
<p><strong>Restore the backup.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>sqlite3<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3<span class="w"> </span>&lt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</li>
<li>
<p><strong>Fix permissions.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-u<span class="w"> </span><span class="m">0</span><span class="w"> </span>-i<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>chown<span class="w"> </span>root:nginx<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-u<span class="w"> </span><span class="m">0</span><span class="w"> </span>-i<span class="w"> </span>&lt;scheduler_container&gt;<span class="w"> </span>chmod<span class="w"> </span><span class="m">770</span><span class="w"> </span>/var/lib/bunkerweb/db.sqlite3
</code></pre></div>
</li>
</ol>
<p>''. <strong>Stop the Stack.</strong></p>
<pre><code>```bash
docker compose down
```
</code></pre>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Restore the backup.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-e<span class="w"> </span><span class="nv">MYSQL_PWD</span><span class="o">=</span>&lt;your_password&gt;<span class="w"> </span>-i<span class="w"> </span>&lt;database_container&gt;<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;<span class="w"> </span>&lt;database_name&gt;<span class="w"> </span>&lt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</li>
<li>
<p><strong>Stop the Stack.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>down
</code></pre></div>
</li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Remove the existing database.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>&lt;database_container&gt;<span class="w"> </span>dropdb<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;<span class="w"> </span>--force<span class="w"> </span>&lt;database_name&gt;
</code></pre></div>
</li>
<li>
<p><strong>Recreate the database.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>&lt;database_container&gt;<span class="w"> </span>createdb<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;<span class="w"> </span>&lt;database_name&gt;
</code></pre></div>
</li>
<li>
<p><strong>Restore the backup.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>&lt;database_container&gt;<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;<span class="w"> </span>-d<span class="w"> </span>&lt;database_name&gt;<span class="w"> </span>&lt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</li>
<li>
<p><strong>Stop the Stack.</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>down
</code></pre></div>
</li>
</ol>
</div>
</div>
</div>
</li>
<li>
<p><strong>Downgrade BunkerWeb</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bunkerweb</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb:&lt;old_version&gt;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:&lt;old_version&gt;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">bw-autoconf</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-autoconf:&lt;old_version&gt;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">bw-ui</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-ui:&lt;old_version&gt;</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
</li>
<li>
<p><strong>Start the containers</strong>.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
</li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Stop the services</strong>.</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>stop<span class="w"> </span>bunkerweb<span class="w"> </span>bunkerweb-ui
</code></pre></div>
</li>
<li>
<p><strong>Restore the backup</strong>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="22:3"><input checked="checked" id="upgrading-__tabbed_22_1" name="upgrading-__tabbed_22" type="radio" /><input id="upgrading-__tabbed_22_2" name="upgrading-__tabbed_22" type="radio" /><input id="upgrading-__tabbed_22_3" name="upgrading-__tabbed_22" type="radio" /><div class="tabbed-labels"><label for="upgrading-__tabbed_22_1">SQLite</label><label for="upgrading-__tabbed_22_2">MySQL/MariaDB</label><label for="upgrading-__tabbed_22_3">PostgreSQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3
sudo<span class="w"> </span>sqlite3<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3<span class="w"> </span>&lt;<span class="w"> </span>/path/to/backup/directory/backup.sql
sudo<span class="w"> </span>chown<span class="w"> </span>root:nginx<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">770</span><span class="w"> </span>/var/lib/bunkerweb/db.sqlite3
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>mysql<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;database_name&gt;<span class="w"> </span>&lt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</div>
<div class="tabbed-block">
<ol>
<li>
<p><strong>Remove the existing database.</strong></p>
<div class="highlight"><pre><span></span><code>dropdb<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;<span class="w"> </span>--force<span class="w"> </span>&lt;database_name&gt;
</code></pre></div>
</li>
<li>
<p><strong>Recreate the database.</strong></p>
<div class="highlight"><pre><span></span><code>createdb<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;<span class="w"> </span>&lt;database_name&gt;
</code></pre></div>
</li>
<li>
<p><strong>Restore the backup.</strong></p>
<div class="highlight"><pre><span></span><code>psql<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;<span class="w"> </span>-d<span class="w"> </span>&lt;database_name&gt;<span class="w"> </span>&lt;<span class="w"> </span>/path/to/backup/directory/backup.sql
</code></pre></div>
</li>
</ol>
</div>
</div>
</div>
</li>
<li>
<p><strong>Downgrade BunkerWeb</strong>.</p>
<ul>
<li>Downgrade BunkerWeb to the previous version by following the same steps as when upgrading BunkerWeb in the <a href="#integrations-linux">integration Linux page</a></li>
</ul>
</li>
</ol>
</div>
</div>
</div></section><section class="print-page" id="troubleshooting"><h1 id="troubleshooting-troubleshooting">Troubleshooting</h1>
<div class="admonition info">
<p class="admonition-title">BunkerWeb Panel</p>
<p>If you are unable to resolve your problems, you can <a href="https://panel.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc">contact us directly via our panel</a>. This centralises all requests relating to the BunkerWeb solution.</p>
</div>
<h2 id="troubleshooting-logs">Logs</h2>
<p>When troubleshooting, logs are your best friends. We try our best to provide user-friendly logs to help you understand what's happening.</p>
<p>Please note that you can set <code>LOG_LEVEL</code> setting to <code>info</code> (default : <code>notice</code>) to increase the verbosity of BunkerWeb.</p>
<p>Here is how you can access the logs, depending on your integration :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:5"><input checked="checked" id="troubleshooting-__tabbed_1_1" name="troubleshooting-__tabbed_1" type="radio" /><input id="troubleshooting-__tabbed_1_2" name="troubleshooting-__tabbed_1" type="radio" /><input id="troubleshooting-__tabbed_1_3" name="troubleshooting-__tabbed_1" type="radio" /><input id="troubleshooting-__tabbed_1_4" name="troubleshooting-__tabbed_1" type="radio" /><input id="troubleshooting-__tabbed_1_5" name="troubleshooting-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="troubleshooting-__tabbed_1_1">Docker</label><label for="troubleshooting-__tabbed_1_2">Docker autoconf</label><label for="troubleshooting-__tabbed_1_3">Swarm</label><label for="troubleshooting-__tabbed_1_4">Kubernetes</label><label for="troubleshooting-__tabbed_1_5">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="admonition tip">
<p class="admonition-title">List containers</p>
<p>To list the running containers, you can use the following command :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>ps
</code></pre></div></p>
</div>
<p>You can use the <code>docker logs</code> command (replace <code>mybunker</code> with the name of your container) :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>logs<span class="w"> </span>mybunker
</code></pre></div></p>
<p>Here is the docker-compose equivalent (replace <code>mybunker</code> with the name of the services declared in the docker-compose.yml file) :
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>logs<span class="w"> </span>mybunker
</code></pre></div></p>
</div>
<div class="tabbed-block">
<div class="admonition tip">
<p class="admonition-title">List containers</p>
<p>To list the running containers, you can use the following command :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>ps
</code></pre></div></p>
</div>
<p>You can use the <code>docker logs</code> command (replace <code>mybunker</code> and <code>myautoconf</code> with the name of your containers) :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>logs<span class="w"> </span>mybunker
docker<span class="w"> </span>logs<span class="w"> </span>myautoconf
</code></pre></div></p>
<p>Here is the docker-compose equivalent (replace <code>mybunker</code> and <code>myautoconf</code> with the name of the services declared in the docker-compose.yml file) :
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>logs<span class="w"> </span>mybunker
docker-compose<span class="w"> </span>logs<span class="w"> </span>myautoconf
</code></pre></div></p>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Deprecated</p>
<p>The Swarm integration is deprecated and will be removed in a future release. Please consider using the <a href="#troubleshooting-__tabbed_1_2">Docker autoconf integration</a> instead.</p>
<p><strong>More information can be found in the <a href="#integrations-swarm">Swarm integration documentation</a>.</strong></p>
</div>
<div class="admonition tip">
<p class="admonition-title">List services</p>
<p>To list the services, you can use the following command :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>service<span class="w"> </span>ls
</code></pre></div></p>
</div>
<p>You can use the <code>docker service logs</code> command (replace <code>mybunker</code> and <code>myautoconf</code> with the name of your services) :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>service<span class="w"> </span>logs<span class="w"> </span>mybunker
docker<span class="w"> </span>service<span class="w"> </span>logs<span class="w"> </span>myautoconf
</code></pre></div></p>
</div>
<div class="tabbed-block">
<div class="admonition tip">
<p class="admonition-title">List pods</p>
<p>To list the pods, you can use the following command :
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods
</code></pre></div></p>
</div>
<p>You can use the <code>kubectl logs</code> command (replace <code>mybunker</code> and <code>myautoconf</code> with the name of your pods) :
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>logs<span class="w"> </span>mybunker
kubectl<span class="w"> </span>logs<span class="w"> </span>myautoconf
</code></pre></div></p>
</div>
<div class="tabbed-block">
<p>For errors related to BunkerWeb services (e.g. not starting), you can use <code>journalctl</code> :
<div class="highlight"><pre><span></span><code>journalctl<span class="w"> </span>-u<span class="w"> </span>bunkerweb<span class="w"> </span>--no-pager
</code></pre></div></p>
<p>Common logs are located inside the <code>/var/log/bunkerweb</code> directory :
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/var/log/bunkerweb/error.log
cat<span class="w"> </span>/var/log/bunkerweb/access.log
</code></pre></div></p>
</div>
</div>
</div>
<h2 id="troubleshooting-permissions">Permissions</h2>
<p>Don't forget that BunkerWeb runs as an unprivileged user for obvious security reasons. Double-check the permissions of files and folders used by BunkerWeb, especially if you use custom configurations (more info <a href="#advanced-custom-configurations">here</a>). You will need to set at least <strong>RW</strong> rights on files and <strong><em>RWX</em></strong> on folders.</p>
<h2 id="troubleshooting-disable-security-checks">Disable security checks</h2>
<p>For debugging purposes, you may need to temporarily disable the security checks made by BunkerWeb. One quick way of doing it is by adding everyone in the whitelist (e.g. <code>WHITELIST_IP=0.0.0.0/0</code>).</p>
<h2 id="troubleshooting-modsecurity">ModSecurity</h2>
<p>The default BunkerWeb configuration of ModSecurity is to load the Core Rule Set in anomaly scoring mode with a paranoia level (PL) of 1 :</p>
<ul>
<li>Each matched rule will increase an anomaly score (so many rules can match a single request)</li>
<li>PL1 includes rules with fewer chances of false positives (but less security than PL4)</li>
<li>the default threshold for anomaly score is 5 for requests and 4 for responses</li>
</ul>
<p>Let's take the following logs as an example of ModSecurity detection using default configuration (formatted for better readability) :</p>
<div class="highlight"><pre><span></span><code>2022/04/26 12:01:10 [warn] 85#85: *11 ModSecurity: Warning. Matched &quot;Operator `PmFromFile&#39; with parameter `lfi-os-files.data&#39; against variable `ARGS:id&#39; (Value: `/etc/passwd&#39; )
    [file &quot;/usr/share/bunkerweb/core/modsecurity/files/coreruleset/rules/REQUEST-930-APPLICATION-ATTACK-LFI.conf&quot;]
    [line &quot;78&quot;]
    [id &quot;930120&quot;]
    [rev &quot;&quot;]
    [msg &quot;OS File Access Attempt&quot;]
    [data &quot;Matched Data: etc/passwd found within ARGS:id: /etc/passwd&quot;]
    [severity &quot;2&quot;]
    [ver &quot;OWASP_CRS/3.3.2&quot;]
    [maturity &quot;0&quot;]
    [accuracy &quot;0&quot;]
    [tag &quot;application-multi&quot;]
    [tag &quot;language-multi&quot;]
    [tag &quot;platform-multi&quot;]
    [tag &quot;attack-lfi&quot;]
    [tag &quot;paranoia-level/1&quot;]
    [tag &quot;OWASP_CRS&quot;]
    [tag &quot;capec/1000/255/153/126&quot;]
    [tag &quot;PCI/6.5.4&quot;]
    [hostname &quot;172.17.0.2&quot;]
    [uri &quot;/&quot;]
    [unique_id &quot;165097447014.179282&quot;]
    [ref &quot;o1,10v9,11t:utf8toUnicode,t:urlDecodeUni,t:normalizePathWin,t:lowercase&quot;],
    client: 172.17.0.1, server: localhost, request: &quot;GET /?id=/etc/passwd HTTP/1.1&quot;, host: &quot;localhost&quot;
2022/04/26 12:01:10 [warn] 85#85: *11 ModSecurity: Warning. Matched &quot;Operator `PmFromFile&#39; with parameter `unix-shell.data&#39; against variable `ARGS:id&#39; (Value: `/etc/passwd&#39; )
    [file &quot;/usr/share/bunkerweb/core/modsecurity/files/coreruleset/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf&quot;]
    [line &quot;480&quot;]
    [id &quot;932160&quot;]
    [rev &quot;&quot;]
    [msg &quot;Remote Command Execution: Unix Shell Code Found&quot;]
    [data &quot;Matched Data: etc/passwd found within ARGS:id: /etc/passwd&quot;]
    [severity &quot;2&quot;]
    [ver &quot;OWASP_CRS/3.3.2&quot;]
    [maturity &quot;0&quot;]
    [accuracy &quot;0&quot;]
    [tag &quot;application-multi&quot;]
    [tag &quot;language-shell&quot;]
    [tag &quot;platform-unix&quot;]
    [tag &quot;attack-rce&quot;]
    [tag &quot;paranoia-level/1&quot;]
    [tag &quot;OWASP_CRS&quot;]
    [tag &quot;capec/1000/152/248/88&quot;]
    [tag &quot;PCI/6.5.2&quot;]
    [hostname &quot;172.17.0.2&quot;]
    [uri &quot;/&quot;]
    [unique_id &quot;165097447014.179282&quot;]
    [ref &quot;o1,10v9,11t:urlDecodeUni,t:cmdLine,t:normalizePath,t:lowercase&quot;],
    client: 172.17.0.1, server: localhost, request: &quot;GET /?id=/etc/passwd HTTP/1.1&quot;, host: &quot;localhost&quot;
2022/04/26 12:01:10 [error] 85#85: *11 [client 172.17.0.1] ModSecurity: Access denied with code 403 (phase 2). Matched &quot;Operator `Ge&#39; with parameter `5&#39; against variable `TX:ANOMALY_SCORE&#39; (Value: `10&#39; )
    [file &quot;/usr/share/bunkerweb/core/modsecurity/files/coreruleset/rules/REQUEST-949-BLOCKING-EVALUATION.conf&quot;]
    [line &quot;80&quot;]
    [id &quot;949110&quot;]
    [rev &quot;&quot;]
    [msg &quot;Inbound Anomaly Score Exceeded (Total Score: 10)&quot;]
    [data &quot;&quot;]
    [severity &quot;2&quot;]
    [ver &quot;OWASP_CRS/3.3.2&quot;]
    [maturity &quot;0&quot;]
    [accuracy &quot;0&quot;]
    [tag &quot;application-multi&quot;]
    [tag &quot;language-multi&quot;]
    [tag &quot;platform-multi&quot;]
    [tag &quot;attack-generic&quot;]
    [hostname &quot;172.17.0.2&quot;]
    [uri &quot;/&quot;]
    [unique_id &quot;165097447014.179282&quot;]
    [ref &quot;&quot;],
    client: 172.17.0.1, server: localhost, request: &quot;GET /?id=/etc/passwd HTTP/1.1&quot;, host: &quot;localhost&quot;
</code></pre></div>
<p>As we can see, there are 3 different logs :</p>
<ol>
<li>Rule <strong>930120</strong> matched</li>
<li>Rule <strong>932160</strong> matched</li>
<li>Access denied (rule <strong>949110</strong>)</li>
</ol>
<p>One important thing to understand is that rule <strong>949110</strong> is not a "real" one : it's the one that will deny the request because the anomaly threshold is reached (which is <strong>10</strong> in this example). You should never remove the <strong>949110</strong> rule !</p>
<p>If it's a false-positive, you should then focus on both <strong>930120</strong> and <strong>932160</strong> rules. ModSecurity and/or CRS tuning is out of the scope of this documentation but don't forget that you can apply custom configurations before and after the CRS is loaded (more info <a href="#advanced-custom-configurations">here</a>).</p>
<h2 id="troubleshooting-bad-behavior">Bad Behavior</h2>
<p>A common false-positive case is when the client is banned because of the "bad behavior" feature which means that too many suspicious HTTP status codes were generated within a time period (more info <a href="#advanced-bad-behavior">here</a>). You should start by reviewing the settings and then edit them according to your web application(s) like removing a suspicious HTTP code, decreasing the count time, increasing the threshold, ...</p>
<h2 id="troubleshooting-ip-unban">IP unban</h2>
<p>You can manually unban an IP which can be useful when doing some tests but it needs the setting <code>USE_API</code> set to <code>yes</code> (which is not the default) so you can contact the internal API of BunkerWeb (replace <code>1.2.3.4</code> with the IP address to unban) :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:5"><input checked="checked" id="troubleshooting-__tabbed_2_1" name="troubleshooting-__tabbed_2" type="radio" /><input id="troubleshooting-__tabbed_2_2" name="troubleshooting-__tabbed_2" type="radio" /><input id="troubleshooting-__tabbed_2_3" name="troubleshooting-__tabbed_2" type="radio" /><input id="troubleshooting-__tabbed_2_4" name="troubleshooting-__tabbed_2" type="radio" /><input id="troubleshooting-__tabbed_2_5" name="troubleshooting-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="troubleshooting-__tabbed_2_1">Docker</label><label for="troubleshooting-__tabbed_2_2">Docker autoconf</label><label for="troubleshooting-__tabbed_2_3">Swarm</label><label for="troubleshooting-__tabbed_2_4">Kubernetes</label><label for="troubleshooting-__tabbed_2_5">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>You can use the <code>docker exec</code> command (replace <code>mybunker</code> with the name of your container) :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>mybunker<span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
<p>Here is the docker-compose equivalent (replace <code>mybunker</code> with the name of the services declared in the docker-compose.yml file) :
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>mybunker<span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
</div>
<div class="tabbed-block">
<p>You can use the <code>docker exec</code> command (replace <code>myautoconf</code> with the name of your container) :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>myautoconf<span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
<p>Here is the docker-compose equivalent (replace <code>myautoconf</code> with the name of the services declared in the docker-compose.yml file) :
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>myautoconf<span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Deprecated</p>
<p>The Swarm integration is deprecated and will be removed in a future release. Please consider using the <a href="#troubleshooting-__tabbed_2_2">Docker autoconf integration</a> instead.</p>
<p><strong>More information can be found in the <a href="#integrations-swarm">Swarm integration documentation</a>.</strong></p>
</div>
<p>You can use the <code>docker exec</code> command (replace <code>myautoconf</code> with the name of your service) :
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>-f<span class="w"> </span><span class="nv">name</span><span class="o">=</span>myautoconf<span class="k">)</span><span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
</div>
<div class="tabbed-block">
<p>You can use the <code>kubectl exec</code> command (replace <code>myautoconf</code> with the name of your pod) :
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>myautoconf<span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
</div>
<div class="tabbed-block">
<p>You can use the <code>bwcli</code> command (as root) :
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>bwcli<span class="w"> </span>unban<span class="w"> </span><span class="m">1</span>.2.3.4
</code></pre></div></p>
</div>
</div>
</div>
<h2 id="troubleshooting-whitelisting">Whitelisting</h2>
<p>If you have bots that need to access your website, the recommended way to avoid any false positive is to whitelist them using the <a href="#advanced-blacklisting-whitelisting-and-greylisting">whitelisting feature</a>. We don't recommend using the <code>WHITELIST_URI*</code> or <code>WHITELIST_USER_AGENT*</code> settings unless they are set to secret and unpredictable values. Common use cases are :</p>
<ul>
<li>Healthcheck / status bot</li>
<li>Callback like IPN or webhook</li>
<li>Social media crawler</li>
</ul>
<h2 id="troubleshooting-timezone">Timezone</h2>
<p>When using container-based integrations, the timezone of the container may not match the one of the host machine. To resolve that, you can set the <code>TZ</code> environment variable to the timezone of your choice on your containers (e.g. <code>TZ=Europe/Paris</code>). You will find the list of timezone identifiers <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones#List">here</a>.</p>
<h2 id="troubleshooting-web-ui">Web UI</h2>
<p>In case you lost your UI credentials or have 2FA issues, you can connect to the database to retrieve access.</p>
<p><strong>Access database</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="troubleshooting-__tabbed_3_1" name="troubleshooting-__tabbed_3" type="radio" /><input id="troubleshooting-__tabbed_3_2" name="troubleshooting-__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="troubleshooting-__tabbed_3_1">SQLite</label><label for="troubleshooting-__tabbed_3_2">MariaDB / MySQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="troubleshooting-__tabbed_4_1" name="troubleshooting-__tabbed_4" type="radio" /><input id="troubleshooting-__tabbed_4_2" name="troubleshooting-__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="troubleshooting-__tabbed_4_1">Linux</label><label for="troubleshooting-__tabbed_4_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Install SQLite (Debian/Ubuntu) :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>sqlite3
</code></pre></div>
<p>Install SQLite (Fedora/RedHat) :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>sqlite
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Get a shell into your scheduler container :</p>
<div class="admonition note">
<p class="admonition-title">Docker arguments</p>
<ul>
<li>the <code>-u 0</code> option is to run the command as root (mandatory)</li>
<li>the <code>-it</code> options are to run the command interactively (mandatory)</li>
<li><code>&lt;bunkerweb_scheduler_container&gt;</code> : the name or ID of your scheduler container</li>
</ul>
</div>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-u<span class="w"> </span><span class="m">0</span><span class="w"> </span>-it<span class="w"> </span>&lt;bunkerweb_scheduler_container&gt;<span class="w"> </span>bash
</code></pre></div>
<p>Install SQLite :</p>
<div class="highlight"><pre><span></span><code>apk<span class="w"> </span>add<span class="w"> </span>sqlite
</code></pre></div>
</div>
</div>
</div>
<p>Access your database :</p>
<div class="admonition note">
<p class="admonition-title">Database path</p>
<p>We assume that you are using the default database path. If you are using a custom path, you will need to adapt the command.</p>
</div>
<div class="highlight"><pre><span></span><code>sqlite3<span class="w"> </span>/var/lib/bunkerweb/db.sqlite3
</code></pre></div>
<p>You should see something like this :</p>
<div class="highlight"><pre><span></span><code>SQLite version &lt;VER&gt; &lt;DATE&gt;
Enter &quot;.help&quot; for usage hints.
sqlite&gt;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition note">
<p class="admonition-title">MariaDB / MySQL only</p>
<p>The following steps are only valid for MariaDB / MySQL databases. If you are using another database, please refer to the documentation of your database.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Credentials and database name</p>
<p>You will need to use the same credentials and database named used in the <code>DATABASE_URI</code> setting.</p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="troubleshooting-__tabbed_5_1" name="troubleshooting-__tabbed_5" type="radio" /><input id="troubleshooting-__tabbed_5_2" name="troubleshooting-__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="troubleshooting-__tabbed_5_1">Linux</label><label for="troubleshooting-__tabbed_5_2">Docker</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Access your local database :</p>
<div class="highlight"><pre><span></span><code>mysql<span class="w"> </span>-u<span class="w"> </span>&lt;user&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;database&gt;
</code></pre></div>
<p>Then enter your password of the database user and you should be able to access your database.</p>
</div>
<div class="tabbed-block">
<p>Access your database container :</p>
<div class="admonition note">
<p class="admonition-title">Docker arguments</p>
<ul>
<li>the <code>-u 0</code> option is to run the command as root (mandatory)</li>
<li>the <code>-it</code> options are to run the command interactively (mandatory)</li>
<li><code>&lt;bunkerweb_db_container&gt;</code> : the name or ID of your database container</li>
<li><code>&lt;user&gt;</code> : the database user</li>
<li><code>&lt;database&gt;</code> : the database name</li>
</ul>
</div>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-u<span class="w"> </span><span class="m">0</span><span class="w"> </span>-it<span class="w"> </span>&lt;bunkerweb_db_container&gt;<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>&lt;user&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;database&gt;
</code></pre></div>
<p>Then enter your password of the database user and you should be able to access your database.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<p><strong>Troubleshooting actions</strong></p>
<div class="admonition info">
<p class="admonition-title">Tables schema</p>
<p>The schema of the <code>bw_ui_users</code> table is the following :</p>
<div class="highlight"><pre><span></span><code><span class="n">username</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="n">email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span>
<span class="n">password</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="k">method</span><span class="w"> </span><span class="n">ENUM</span><span class="p">(</span><span class="s1">&#39;ui&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;scheduler&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;autoconf&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;manual&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;wizard&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="k">admin</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span>
<span class="n">theme</span><span class="w"> </span><span class="n">ENUM</span><span class="p">(</span><span class="s1">&#39;light&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dark&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;light&#39;</span>
<span class="n">totp_secret</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span>
<span class="n">creation_date</span><span class="w"> </span><span class="n">DATETIME</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="n">update_date</span><span class="w"> </span><span class="n">DATETIME</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
</code></pre></div>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="6:4"><input checked="checked" id="troubleshooting-__tabbed_6_1" name="troubleshooting-__tabbed_6" type="radio" /><input id="troubleshooting-__tabbed_6_2" name="troubleshooting-__tabbed_6" type="radio" /><input id="troubleshooting-__tabbed_6_3" name="troubleshooting-__tabbed_6" type="radio" /><input id="troubleshooting-__tabbed_6_4" name="troubleshooting-__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="troubleshooting-__tabbed_6_1">Retrieve username</label><label for="troubleshooting-__tabbed_6_2">Update admin user password</label><label for="troubleshooting-__tabbed_6_3">Disable 2FA authentication for admin user</label><label for="troubleshooting-__tabbed_6_4">Refresh 2FA recovery codes</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Execute the following command to extract data from the <code>bw_ui_users</code> table :</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">bw_ui_users</span><span class="p">;</span>
</code></pre></div>
<p>You should see something like this :</p>
<table>
<thead>
<tr>
<th>username</th>
<th>email</th>
<th>password</th>
<th>method</th>
<th>admin</th>
<th>theme</th>
<th>totp_secret</th>
<th>creation_date</th>
<th>update_date</th>
</tr>
</thead>
<tbody>
<tr>
<td>***</td>
<td>***</td>
<td>***</td>
<td>manual</td>
<td>1</td>
<td>light</td>
<td>***</td>
<td>***</td>
<td>***</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<p>You first need to hash the new password using the bcrypt algorithm.</p>
<p>Install the Python bcrypt library :</p>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>bcrypt
</code></pre></div>
<p>Generate your hash (replace <code>mypassword</code> with your own password) :</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;from bcrypt import hashpw, gensalt ; print(hashpw(b&quot;&quot;&quot;mypassword&quot;&quot;&quot;, gensalt(rounds=10)).decode(&quot;utf-8&quot;))&#39;</span>
</code></pre></div>
<p>You can update your username / password executing this command :</p>
<div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">bw_ui_users</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&lt;password_hash&gt;&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
<p>If you check again your <code>bw_ui_users</code> table following this command :</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">bw_ui_users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
<p>You should see something like this :</p>
<table>
<thead>
<tr>
<th>username</th>
<th>email</th>
<th>password</th>
<th>method</th>
<th>admin</th>
<th>theme</th>
<th>totp_secret</th>
<th>creation_date</th>
<th>update_date</th>
</tr>
</thead>
<tbody>
<tr>
<td>***</td>
<td>***</td>
<td>***</td>
<td>manual</td>
<td>1</td>
<td>light</td>
<td>***</td>
<td>***</td>
<td>***</td>
</tr>
</tbody>
</table>
<p>You should now be able to use the new credentials to log into the web UI.</p>
</div>
<div class="tabbed-block">
<p>You can deactivate 2FA by executing this command :</p>
<div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">bw_ui_users</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">totp_secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
<p>If you check again your <code>bw_ui_users</code> table by following this command :</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">bw_ui_users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
<p>You should see something like this :</p>
<table>
<thead>
<tr>
<th>username</th>
<th>email</th>
<th>password</th>
<th>method</th>
<th>admin</th>
<th>theme</th>
<th>totp_secret</th>
<th>creation_date</th>
<th>update_date</th>
</tr>
</thead>
<tbody>
<tr>
<td>***</td>
<td>***</td>
<td>***</td>
<td>manual</td>
<td>1</td>
<td>light</td>
<td>NULL</td>
<td>***</td>
<td>***</td>
</tr>
</tbody>
</table>
<p>You should now be able to log into the web UI only using your username and password without 2FA.</p>
</div>
<div class="tabbed-block">
<p>The recovery codes can be refreshed in your <strong>profile page</strong> of the web UI under the <code>Security</code> tab.</p>
</div>
</div>
</div>
<p><strong>Upload plugin</strong></p>
<p>It may not be possible to upload a plugin from the UI in certain situations:</p>
<ul>
<li>Missing package to manage compressed files on your integration, in which case you will need to add the necessary packages</li>
<li>Safari browser : the 'safe mode' may prevent you from being able to add a plugin. You will need to make the necessary changes on your machine</li>
</ul></section><section class="print-page" id="plugins"><h1 id="plugins-plugins">Plugins</h1>
<p>BunkerWeb comes with a plugin system making it possible to easily add new features. Once a plugin is installed, you can manage it using additional settings defined by the plugin.</p>
<h2 id="plugins-official-plugins">Official plugins</h2>
<p>Here is the list of "official" plugins that we maintain (see the <a href="https://github.com/bunkerity/bunkerweb-plugins">bunkerweb-plugins</a> repository for more information) :</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Name</th>
<th style="text-align: center;">Version</th>
<th style="text-align: left;">Description</th>
<th style="text-align: center;">Link</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>ClamAV</strong></td>
<td style="text-align: center;">1.8</td>
<td style="text-align: left;">Automatically scans uploaded files with the ClamAV antivirus engine and denies the request when a file is detected as malicious.</td>
<td style="text-align: center;"><a href="https://github.com/bunkerity/bunkerweb-plugins/tree/main/clamav">bunkerweb-plugins/clamav</a></td>
</tr>
<tr>
<td style="text-align: center;"><strong>Coraza</strong></td>
<td style="text-align: center;">1.8</td>
<td style="text-align: left;">Inspect requests using a the Coraza WAF (alternative of ModSecurity).</td>
<td style="text-align: center;"><a href="https://github.com/bunkerity/bunkerweb-plugins/tree/main/coraza">bunkerweb-plugins/coraza</a></td>
</tr>
<tr>
<td style="text-align: center;"><strong>CrowdSec</strong></td>
<td style="text-align: center;">1.8</td>
<td style="text-align: left;">CrowdSec bouncer for BunkerWeb.</td>
<td style="text-align: center;"><a href="https://github.com/bunkerity/bunkerweb-plugins/tree/main/crowdsec">bunkerweb-plugins/crowdsec</a></td>
</tr>
<tr>
<td style="text-align: center;"><strong>Discord</strong></td>
<td style="text-align: center;">1.8</td>
<td style="text-align: left;">Send security notifications to a Discord channel using a Webhook.</td>
<td style="text-align: center;"><a href="https://github.com/bunkerity/bunkerweb-plugins/tree/main/discord">bunkerweb-plugins/discord</a></td>
</tr>
<tr>
<td style="text-align: center;"><strong>Slack</strong></td>
<td style="text-align: center;">1.8</td>
<td style="text-align: left;">Send security notifications to a Slack channel using a Webhook.</td>
<td style="text-align: center;"><a href="https://github.com/bunkerity/bunkerweb-plugins/tree/main/slack">bunkerweb-plugins/slack</a></td>
</tr>
<tr>
<td style="text-align: center;"><strong>VirusTotal</strong></td>
<td style="text-align: center;">1.8</td>
<td style="text-align: left;">Automatically scans uploaded files with the VirusTotal API and denies the request when a file is detected as malicious.</td>
<td style="text-align: center;"><a href="https://github.com/bunkerity/bunkerweb-plugins/tree/main/virustotal">bunkerweb-plugins/virustotal</a></td>
</tr>
<tr>
<td style="text-align: center;"><strong>WebHook</strong></td>
<td style="text-align: center;">1.8</td>
<td style="text-align: left;">Send security notifications to a custom HTTP endpoint using a  Webhook.</td>
<td style="text-align: center;"><a href="https://github.com/bunkerity/bunkerweb-plugins/tree/main/webhook">bunkerweb-plugins/webhook</a></td>
</tr>
</tbody>
</table>
<h2 id="plugins-how-to-use-a-plugin">How to use a plugin</h2>
<h3 id="plugins-automatic">Automatic</h3>
<p>If you want to quickly install external plugins, you can use the <code>EXTERNAL_PLUGIN_URLS</code> setting. It takes a list of URLs, separated with space, pointing to compressed (zip format) archive containing one or more plugin(s).</p>
<p>You can use the following value if you want to automatically install the official plugins : <code>EXTERNAL_PLUGIN_URLS=https://github.com/bunkerity/bunkerweb-plugins/archive/refs/tags/v1.8.zip</code></p>
<h3 id="plugins-manual">Manual</h3>
<p>The first step is to install the plugin by putting the plugin files inside the corresponding <code>plugins</code> data folder, the procedure depends on your integration :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:5"><input checked="checked" id="plugins-__tabbed_1_1" name="plugins-__tabbed_1" type="radio" /><input id="plugins-__tabbed_1_2" name="plugins-__tabbed_1" type="radio" /><input id="plugins-__tabbed_1_3" name="plugins-__tabbed_1" type="radio" /><input id="plugins-__tabbed_1_4" name="plugins-__tabbed_1" type="radio" /><input id="plugins-__tabbed_1_5" name="plugins-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="plugins-__tabbed_1_1">Docker</label><label for="plugins-__tabbed_1_2">Docker autoconf</label><label for="plugins-__tabbed_1_3">Swarm</label><label for="plugins-__tabbed_1_4">Kubernetes</label><label for="plugins-__tabbed_1_5">Linux</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>When using the <a href="#integrations-docker">Docker integration</a>, plugins must be written to the volume mounted on <code>/data/plugins</code> into the scheduler container.</p>
<p>The first thing to do is to create the plugins folder :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>./bw-data/plugins
</code></pre></div>
<p>Then, you can drop the plugins of your choice into that folder :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb-plugins<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
cp<span class="w"> </span>-rp<span class="w"> </span>./bunkerweb-plugins/*<span class="w"> </span>./bw-data/plugins
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Using local folder for persistent data</p>
<p>The scheduler runs as an <strong>unprivileged user with UID 101 and GID 101</strong> inside the container. The reason behind this is security : in case a vulnerability is exploited, the attacker won't have full root (UID/GID 0) privileges.
But there is a downside : if you use a <strong>local folder for the persistent data</strong>, you will need to <strong>set the correct permissions</strong> so the unprivileged user can write data to it. Something like that should do the trick :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chown<span class="w"> </span>root:101<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div>
<p>Alternatively, if the folder already exists :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:101<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div>
<p>If you are using <a href="https://docs.docker.com/engine/security/rootless">Docker in rootless mode</a> or <a href="https://podman.io/">podman</a>, UIDs and GIDs in the container will be mapped to different ones in the host. You will first need to check your initial subuid and subgid :</p>
<div class="highlight"><pre><span></span><code>grep<span class="w"> </span>^<span class="k">$(</span>whoami<span class="k">)</span>:<span class="w"> </span>/etc/subuid<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
grep<span class="w"> </span>^<span class="k">$(</span>whoami<span class="k">)</span>:<span class="w"> </span>/etc/subgid
</code></pre></div>
<p>For example, if you have a value of <strong>100000</strong>, the mapped UID/GID will be <strong>100100</strong> (100000 + 100) :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
sudo<span class="w"> </span>chgrp<span class="w"> </span><span class="m">100100</span><span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div>
<p>Or if the folder already exists :</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>chgrp<span class="w"> </span>-R<span class="w"> </span><span class="m">100100</span><span class="w"> </span>bw-data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">770</span><span class="w"> </span>bw-data
</code></pre></div>
</div>
<p>Then you can mount the volume when starting your Docker stack :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="nn">...</span>
<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./bw-data:/data</span>
<span class="nn">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#integrations-docker-autoconf">Docker autoconf integration</a>, plugins must be written to the volume mounted on <code>/data/plugins</code> into the scheduler container.</p>
<p>The first thing to do is to create the plugins folder :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>./bw-data/plugins
</code></pre></div>
<p>Then, you can drop the plugins of your choice into that folder :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb-plugins<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
cp<span class="w"> </span>-rp<span class="w"> </span>./bunkerweb-plugins/*<span class="w"> </span>./bw-data/plugins
</code></pre></div>
<p>Because the scheduler runs as an unprivileged user with UID and GID 101, you will need to edit the permissions :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">101</span>:101<span class="w"> </span>./bw-data
</code></pre></div>
<p>Then you can mount the volume when starting your Docker stack :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="nn">...</span>
<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./bw-data:/data</span>
<span class="nn">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition warning">
<p class="admonition-title">Deprecated</p>
<p>The Swarm integration is deprecated and will be removed in a future release. Please consider using the <a href="#plugins-__tabbed_1_2">Docker autoconf integration</a> instead.</p>
<p><strong>More information can be found in the <a href="#integrations-swarm">Swarm integration documentation</a>.</strong></p>
</div>
<p>When using the <a href="#integrations-swarm">Swarm integration</a>, plugins must be written to the volume mounted on <code>/data/plugins</code> into the scheduler container.</p>
<div class="admonition info">
<p class="admonition-title">Swarm volume</p>
<p>Configuring a Swarm volume that will persist when the scheduler service is running on different nodes is not covered is in this documentation. We will assume that you have a shared folder mounted on <code>/shared</code> across all nodes.</p>
</div>
<p>The first thing to do is to create the plugins folder :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>/shared/bw-plugins
</code></pre></div>
<p>Then, you can drop the plugins of your choice into that folder :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb-plugins<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
cp<span class="w"> </span>-rp<span class="w"> </span>./bunkerweb-plugins/*<span class="w"> </span>/shared/bw-plugins
</code></pre></div>
<p>Because the scheduler runs as an unprivileged user with UID and GID 101, you will need to edit the permissions :</p>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">101</span>:101<span class="w"> </span>/shared/bw-plugins
</code></pre></div>
<p>Then you can mount the volume when starting your Swarm stack :</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="nn">...</span>
<span class="w">  </span><span class="nt">bw-scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/shared/bw-plugins:/data/plugins</span>
<span class="nn">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#integrations-kubernetes">Kubernetes integration</a>, plugins must be written to the volume mounted on <code>/data/plugins</code> into the scheduler container.</p>
<p>The fist thing to do is to declare a <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">PersistentVolumeClaim</a> that will contain our plugins data :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pvc-bunkerweb-plugins</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5Gi</span>
</code></pre></div>
<p>You can now add the volume mount and an init containers to automatically provision the volume :</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-bunkerweb</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerity/bunkerweb-scheduler:testing</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBERNETES_MODE</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DATABASE_URI&quot;</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb+pymysql://bunkerweb:changeme@svc-bunkerweb-db:3306/db&quot;</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/data/plugins&quot;</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vol-plugins</span>
<span class="w">      </span><span class="nt">initContainers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bunkerweb-scheduler-init</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine/git</span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/bin/sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;git</span><span class="nv"> </span><span class="s">clone</span><span class="nv"> </span><span class="s">https://github.com/bunkerity/bunkerweb-plugins</span><span class="nv"> </span><span class="s">/data/plugins</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">chown</span><span class="nv"> </span><span class="s">-R</span><span class="nv"> </span><span class="s">101:101</span><span class="nv"> </span><span class="s">/data/plugins&quot;</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/data/plugins&quot;</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vol-plugins</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vol-plugins</span>
<span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pvc-bunkerweb-plugins</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When using the <a href="#integrations-linux">Linux integration</a>, plugins must be written to the <code>/etc/bunkerweb/plugins</code> folder :</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bunkerity/bunkerweb-plugins<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
cp<span class="w"> </span>-rp<span class="w"> </span>./bunkerweb-plugins/*<span class="w"> </span>/etc/bunkerweb/plugins<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
chown<span class="w"> </span>-R<span class="w"> </span>nginx:nginx<span class="w"> </span>/etc/bunkerweb/plugins
</code></pre></div>
</div>
</div>
</div>
<h2 id="plugins-writing-a-plugin">Writing a plugin</h2>
<h3 id="plugins-structure">Structure</h3>
<div class="admonition tip">
<p class="admonition-title">Existing plugins</p>
<p>If the documentation is not enough, you can have a look at the existing source code of <a href="https://github.com/bunkerity/bunkerweb-plugins">official plugins</a> and the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/src/common/core">core plugins</a> (already included in BunkerWeb but they are plugins, technically speaking).</p>
</div>
<p>What a plugin structure looks like:
<div class="highlight"><pre><span></span><code>plugin /
    confs / conf_type / conf_name.conf
    ui / actions.py
         hooks.py
         template.html
         blueprints / &lt;blueprint_file(s)&gt;
              templates / &lt;blueprint_template(s)&gt;
    jobs / my-job.py
    templates / my-template.json
          my-template / configs / conf_type / conf_name.conf
    plugin.lua
    plugin.json
</code></pre></div></p>
<ul>
<li>
<p><strong>conf_name.conf</strong> : Add <a href="#advanced-custom-configurations">custom NGINX configurations</a> (as Jinja2 templates).</p>
</li>
<li>
<p><strong>actions.py</strong> : Script to execute on the Flask server. This script runs in a Flask context, giving you access to libraries and utilities like <code>jinja2</code> and <code>requests</code>.</p>
</li>
<li>
<p><strong>hooks.py</strong> : Custom Python file that contains flask's hooks and will be executed when the plugin is loaded.</p>
</li>
<li>
<p><strong>template.html</strong> : Custom plugin page accessed via the UI.</p>
</li>
<li>
<p><strong>blueprints folder (within ui)</strong>:
  This folder is used to override existing Flask blueprints or create new ones. Inside, you can include blueprint files and an optional <strong>templates</strong> subfolder for blueprint-specific templates.</p>
</li>
<li>
<p><strong>jobs py file</strong> : Custom Python files executed as jobs by the scheduler.</p>
</li>
<li>
<p><strong>my-template.json</strong> : Add <a href="#concepts-templates">custom templates</a> to override the default values of settings and apply custom configurations easily.</p>
</li>
<li>
<p><strong>plugin.lua</strong> : Code executed on NGINX using the <a href="https://github.com/openresty/lua-nginx-module">NGINX LUA module</a>.</p>
</li>
<li>
<p><strong>plugin.json</strong> : Metadata, settings, and job definitions for your plugin.</p>
</li>
</ul>
<h3 id="plugins-getting-started">Getting started</h3>
<p>The first step is to create a folder that will contain the plugin :</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>myplugin<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">cd</span><span class="w"> </span>myplugin
</code></pre></div>
<h3 id="plugins-metadata">Metadata</h3>
<p>A file named <strong>plugin.json</strong> and written at the root of the plugin folder must contain metadata about the plugin. Here is an example :</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;myplugin&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My Plugin&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Just an example plugin.&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;stream&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;partial&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;DUMMY_SETTING&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;context&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;multisite&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1234&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;help&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Here is the help of the setting.&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dummy-id&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Dummy setting&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;regex&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^.*$&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;jobs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-job&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-job.py&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;every&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hour&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>Here are the details of the fields :</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Field</th>
<th style="text-align: center;">Mandatory</th>
<th style="text-align: center;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>id</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">Internal ID for the plugin : must be unique among other plugins (including "core" ones) and contain only lowercase chars.</td>
</tr>
<tr>
<td style="text-align: center;"><code>name</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">Name of your plugin.</td>
</tr>
<tr>
<td style="text-align: center;"><code>description</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">Description of your plugin.</td>
</tr>
<tr>
<td style="text-align: center;"><code>version</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">Version of your plugin.</td>
</tr>
<tr>
<td style="text-align: center;"><code>stream</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">Information about stream support : <code>no</code>, <code>yes</code> or <code>partial</code>.</td>
</tr>
<tr>
<td style="text-align: center;"><code>settings</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">dict</td>
<td style="text-align: left;">List of the settings of your plugin.</td>
</tr>
<tr>
<td style="text-align: center;"><code>jobs</code></td>
<td style="text-align: center;">no</td>
<td style="text-align: center;">list</td>
<td style="text-align: left;">List of the jobs of your plugin.</td>
</tr>
</tbody>
</table>
<p>Each setting has the following fields (the key is the ID of the settings used in a configuration) :</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Field</th>
<th style="text-align: center;">Mandatory</th>
<th style="text-align: center;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>context</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">Context of the setting : <code>multisite</code> or <code>global</code>.</td>
</tr>
<tr>
<td style="text-align: center;"><code>default</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">The default value of the setting.</td>
</tr>
<tr>
<td style="text-align: center;"><code>help</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">Help text about the plugin (shown in web UI).</td>
</tr>
<tr>
<td style="text-align: center;"><code>id</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">Internal ID used by the web UI for HTML elements.</td>
</tr>
<tr>
<td style="text-align: center;"><code>label</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">Label shown by the web UI.</td>
</tr>
<tr>
<td style="text-align: center;"><code>regex</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">The regex used to validate the value provided by the user.</td>
</tr>
<tr>
<td style="text-align: center;"><code>type</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">The type of the field : <code>text</code>, <code>check</code>, <code>select</code> or <code>password</code>.</td>
</tr>
<tr>
<td style="text-align: center;"><code>multiple</code></td>
<td style="text-align: center;">no</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">Unique ID to group multiple settings with numbers as suffix.</td>
</tr>
<tr>
<td style="text-align: center;"><code>select</code></td>
<td style="text-align: center;">no</td>
<td style="text-align: center;">list</td>
<td style="text-align: left;">List of possible string values when <code>type</code> is <code>select</code>.</td>
</tr>
</tbody>
</table>
<p>Each job has the following fields :</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Field</th>
<th style="text-align: center;">Mandatory</th>
<th style="text-align: center;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>name</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">Name of the job.</td>
</tr>
<tr>
<td style="text-align: center;"><code>file</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">Name of the file inside the jobs folder.</td>
</tr>
<tr>
<td style="text-align: center;"><code>every</code></td>
<td style="text-align: center;">yes</td>
<td style="text-align: center;">string</td>
<td style="text-align: left;">Job scheduling frequency : <code>minute</code>, <code>hour</code>, <code>day</code>, <code>week</code> or <code>once</code> (no frequency, only once before (re)generating the configuration).</td>
</tr>
</tbody>
</table>
<h3 id="plugins-configurations">Configurations</h3>
<p>You can add custom NGINX configurations by adding a folder named <strong>confs</strong> with content similar to the <a href="#advanced-custom-configurations">custom configurations</a>. Each subfolder inside the <strong>confs</strong> will contain <a href="https://jinja.palletsprojects.com">jinja2</a> templates that will be generated and loaded at the corresponding context (<code>http</code>, <code>server-http</code>, <code>default-server-http</code>, <code>stream</code>, <code>server-stream</code>, <code>modsec</code>, <code>modsec-crs</code>, <code>crs-plugins-before</code> and <code>crs-plugins-after</code>).</p>
<p>Here is an example for a configuration template file inside the <strong>confs/server-http</strong> folder named <strong>example.conf</strong> :</p>
<div class="highlight"><pre><span></span><code>location /setting {
    default_type &#39;text/plain&#39;;
    content_by_lua_block {
        ngx.say(&#39;{{ DUMMY_SETTING }}&#39;)
    }
}
</code></pre></div>
<p><code>{{ DUMMY_SETTING }}</code> will be replaced by the value of the <code>DUMMY_SETTING</code> chosen by the user of the plugin.</p>
<h3 id="plugins-templates">Templates</h3>
<p>Check the <a href="#concepts-templates">templates documentation</a> for more information.</p>
<h3 id="plugins-lua">LUA</h3>
<h4 id="plugins-main-script">Main script</h4>
<p>Under the hood, BunkerWeb is using the <a href="https://github.com/openresty/lua-nginx-module">NGINX LUA module</a> to execute code within NGINX. Plugins that need to execute code must provide a lua file at the root directory of the plugin folder using the <code>id</code> value of <strong>plugin.json</strong> as its name. Here is an example named <strong>myplugin.lua</strong> :</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">class</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nb">require</span><span class="w"> </span><span class="s2">&quot;middleclass&quot;</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">plugin</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nb">require</span><span class="w"> </span><span class="s2">&quot;bunkerweb.plugin&quot;</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">utils</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nb">require</span><span class="w"> </span><span class="s2">&quot;bunkerweb.utils&quot;</span>


<span class="kd">local</span><span class="w"> </span><span class="nv">myplugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">class</span><span class="p">(</span><span class="s2">&quot;myplugin&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">plugin</span><span class="p">)</span>


<span class="kr">function</span><span class="w"> </span><span class="nc">myplugin</span><span class="p">:</span><span class="nf">initialize</span><span class="p">(</span><span class="nv">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="nv">plugin</span><span class="p">.</span><span class="nf">initialize</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;myplugin&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dummy&quot;</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">myplugin</span><span class="p">:</span><span class="nf">init</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">logger</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;init called&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">ret</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">myplugin</span><span class="p">:</span><span class="nf">set</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">logger</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;set called&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">ret</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">myplugin</span><span class="p">:</span><span class="nf">access</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">logger</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;access called&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">ret</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">myplugin</span><span class="p">:</span><span class="nf">log</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">logger</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;log called&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">ret</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">myplugin</span><span class="p">:</span><span class="nf">log_default</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">logger</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;log_default called&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">ret</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">myplugin</span><span class="p">:</span><span class="nf">preread</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">logger</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;preread called&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">ret</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">myplugin</span><span class="p">:</span><span class="nf">log_stream</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">logger</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;log_stream called&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">ret</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">return</span><span class="w"> </span><span class="nv">myplugin</span>
</code></pre></div>
<p>The declared functions are automatically called during specific contexts. Here are the details of each function :</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Function</th>
<th style="text-align: center;">Context</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Return value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>init</code></td>
<td style="text-align: center;"><a href="https://github.com/openresty/lua-nginx-module#init_by_lua">init_by_lua</a></td>
<td style="text-align: left;">Called when NGINX just started or received a reload order. the typical use case is to prepare any data that will be used by your plugin.</td>
<td style="text-align: left;"><code>ret</code>, <code>msg</code><ul><li><code>ret</code> (boolean) : true if no error or else false</li><li><code>msg</code> (string) : success or error message</li></ul></td>
</tr>
<tr>
<td style="text-align: center;"><code>set</code></td>
<td style="text-align: center;"><a href="https://github.com/openresty/lua-nginx-module#set_by_lua">set_by_lua</a></td>
<td style="text-align: left;">Called before each request received by the server.The typical use case is for computing before access phase.</td>
<td style="text-align: left;"><code>ret</code>, <code>msg</code><ul><li><code>ret</code> (boolean) : true if no error or else false</li><li><code>msg</code> (string) : success or error message</li></ul></td>
</tr>
<tr>
<td style="text-align: center;"><code>access</code></td>
<td style="text-align: center;"><a href="https://github.com/openresty/lua-nginx-module#access_by_lua">access_by_lua</a></td>
<td style="text-align: left;">Called on each request received by the server. The typical use case is to do the security checks here and deny the request if needed.</td>
<td style="text-align: left;"><code>ret</code>, <code>msg</code>,<code>status</code>,<code>redirect</code><ul><li><code>ret</code> (boolean) : true if no error or else false</li><li><code>msg</code> (string) : success or error message</li><li><code>status</code> (number) : interrupt current process and return <a href="https://github.com/openresty/lua-nginx-module#http-status-constants">HTTP status</a></li><li><code>redirect</code> (URL) : if set will redirect to given URL</li></ul></td>
</tr>
<tr>
<td style="text-align: center;"><code>log</code></td>
<td style="text-align: center;"><a href="https://github.com/openresty/lua-nginx-module#log_by_lua">log_by_lua</a></td>
<td style="text-align: left;">Called when a request has finished (and before it gets logged to the access logs). The typical use case is to make stats or compute counters for example.</td>
<td style="text-align: left;"><code>ret</code>, <code>msg</code><ul><li><code>ret</code> (boolean) : true if no error or else false</li><li><code>msg</code> (string) : success or error message</li></ul></td>
</tr>
<tr>
<td style="text-align: center;"><code>log_default</code></td>
<td style="text-align: center;"><a href="https://github.com/openresty/lua-nginx-module#log_by_lua">log_by_lua</a></td>
<td style="text-align: left;">Same as <code>log</code> but only called on the default server.</td>
<td style="text-align: left;"><code>ret</code>, <code>msg</code><ul><li><code>ret</code> (boolean) : true if no error or else false</li><li><code>msg</code> (string) : success or error message</li></ul></td>
</tr>
<tr>
<td style="text-align: center;"><code>preread</code></td>
<td style="text-align: center;"><a href="https://github.com/openresty/stream-lua-nginx-module#preread_by_lua_block">preread_by_lua</a></td>
<td style="text-align: left;">Similar to the <code>access</code> function but for stream mode.</td>
<td style="text-align: left;"><code>ret</code>, <code>msg</code>,<code>status</code><ul><li><code>ret</code> (boolean) : true if no error or else false</li><li><code>msg</code> (string) : success or error message</li><li><code>status</code> (number) : interrupt current process and return <a href="https://github.com/openresty/lua-nginx-module#http-status-constants">status</a></li></ul></td>
</tr>
<tr>
<td style="text-align: center;"><code>log_stream</code></td>
<td style="text-align: center;"><a href="https://github.com/openresty/stream-lua-nginx-module#log_by_lua_block">log_by_lua</a></td>
<td style="text-align: left;">Similar to the <code>log</code> function but for stream mode.</td>
<td style="text-align: left;"><code>ret</code>, <code>msg</code><ul><li><code>ret</code> (boolean) : true if no error or else false</li><li><code>msg</code> (string) : success or error message</li></ul></td>
</tr>
</tbody>
</table>
<h4 id="plugins-libraries">Libraries</h4>
<p>All directives from <a href="https://github.com/openresty/lua-nginx-module">NGINX LUA module</a> and are available and <a href="https://github.com/openresty/stream-lua-nginx-module">NGINX stream LUA module</a>. On top of that, you can use the LUA libraries included within BunkerWeb : see <a href="https://github.com/bunkerity/bunkerweb/blobsrc/deps/clone.sh">this script</a> for the complete list.</p>
<p>If you need additional libraries, you can put them in the root folder of the plugin and access them by prefixing them with your plugin ID. Here is an example file named <strong>mylibrary.lua</strong> :</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>

<span class="nv">_M</span><span class="p">.</span><span class="py">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="p">()</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;dummy&quot;</span>
<span class="kr">end</span>

<span class="kr">return</span><span class="w"> </span><span class="nv">_M</span>
</code></pre></div>
<p>And here is how you can use it from the <strong>myplugin.lua</strong> file :</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">mylibrary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">require</span><span class="w"> </span><span class="s2">&quot;myplugin.mylibrary&quot;</span>

<span class="p">...</span>

<span class="nv">mylibrary</span><span class="p">.</span><span class="nf">dummy</span><span class="p">()</span>

<span class="p">...</span>
</code></pre></div>
<h4 id="plugins-helpers">Helpers</h4>
<p>Some helpers modules provide common helpful helpers :</p>
<ul>
<li><code>self.variables</code> : allows to access and store plugins' attributes</li>
<li><code>self.logger</code> : print logs</li>
<li><code>bunkerweb.utils</code> : various useful functions</li>
<li><code>bunkerweb.datastore</code> : access the global shared data on one instance (key/value store)</li>
<li><code>bunkerweb.clusterstore</code> : access a Redis data store shared between BunkerWeb instances (key/value store)</li>
</ul>
<p>To access the functions, you first need to <strong>require</strong> the modules :</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">utils</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">require</span><span class="w"> </span><span class="s2">&quot;bunkerweb.utils&quot;</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">datastore</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nb">require</span><span class="w"> </span><span class="s2">&quot;bunkerweb.datastore&quot;</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">clustestore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">require</span><span class="w"> </span><span class="s2">&quot;bunkerweb.clustertore&quot;</span>
</code></pre></div>
<p>Retrieve a setting value :</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">myvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">variables</span><span class="p">[</span><span class="s2">&quot;DUMMY_SETTING&quot;</span><span class="p">]</span>
<span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">myvar</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">logger</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">ERR</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;can&#39;t retrieve setting DUMMY_SETTING&quot;</span><span class="p">)</span>
<span class="kr">else</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">logger</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DUMMY_SETTING = &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<p>Store something in the local cache :</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">ok</span><span class="p">,</span><span class="w"> </span><span class="nv">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">datastore</span><span class="p">:</span><span class="nf">set</span><span class="p">(</span><span class="s2">&quot;plugin_myplugin_something&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;somevalue&quot;</span><span class="p">)</span>
<span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">ok</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">logger</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">ERR</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;can&#39;t save plugin_myplugin_something into datastore : &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">err</span><span class="p">)</span>
<span class="kr">else</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">logger</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;successfully saved plugin_myplugin_something into datastore&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<p>Check if an IP address is global :</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">ret</span><span class="p">,</span><span class="w"> </span><span class="nv">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">utils</span><span class="p">.</span><span class="nf">ip_is_global</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">ctx</span><span class="p">.</span><span class="py">bw</span><span class="p">.</span><span class="py">remote_addr</span><span class="p">)</span>
<span class="kr">if</span><span class="w"> </span><span class="nv">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">logger</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">ERR</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;error while checking if IP &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">ngx</span><span class="p">.</span><span class="py">ctx</span><span class="p">.</span><span class="py">bw</span><span class="p">.</span><span class="py">remote_addr</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is global or not : &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">err</span><span class="p">)</span>
<span class="kr">elseif</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">ret</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">logger</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;IP &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">ngx</span><span class="p">.</span><span class="py">ctx</span><span class="p">.</span><span class="py">bw</span><span class="p">.</span><span class="py">remote_addr</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is not global&quot;</span><span class="p">)</span>
<span class="kr">else</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">logger</span><span class="p">:</span><span class="nf">log</span><span class="p">(</span><span class="nv">ngx</span><span class="p">.</span><span class="py">NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;IP &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">ngx</span><span class="p">.</span><span class="py">ctx</span><span class="p">.</span><span class="py">bw</span><span class="p">.</span><span class="py">remote_addr</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is global&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">More examples</p>
<p>If you want to see the full list of available functions, you can have a look at the files present in the <a href="https://github.com/bunkerity/bunkerweb/tree/vtesting/src/bw/lua/bunkerweb">lua directory</a> of the repository.</p>
</div>
<h3 id="plugins-jobs">Jobs</h3>
<p>BunkerWeb uses an internal job scheduler for periodic tasks like renewing certificates with certbot, downloading blacklists, downloading MMDB files, ... You can add tasks of your choice by putting them inside a subfolder named <strong>jobs</strong> and listing them in the <strong>plugin.json</strong> metadata file. Don't forget to add the execution permissions for everyone to avoid any problems when a user is cloning and installing your plugin.</p>
<h3 id="plugins-plugin-page">Plugin page</h3>
<p>Everything related to the web UI is located inside the subfolder <strong>ui</strong> as we seen in the <a href="#plugins-structure">previous structure section.</a>.</p>
<h4 id="plugins-prerequisites">Prerequisites</h4>
<p>When you want to create a plugin page, you need two files :</p>
<ul>
<li>
<p><strong>template.html</strong> that will be accessible with a <strong>GET /plugins/&lt;<em>plugin_id</em>&gt;</strong>.</p>
</li>
<li>
<p><strong>actions.py</strong> where you can add some scripting and logic with a <strong>POST /plugins/&lt;<em>plugin_id</em>&gt;</strong>. Notice that this file <strong>need a function with the same name as the plugin</strong> to work. This file is needed even if the function is empty.</p>
</li>
</ul>
<h4 id="plugins-basic-example">Basic example</h4>
<div class="admonition info">
<p class="admonition-title">Jinja 2 template</p>
<p>The <strong>template.html</strong> file is a Jinja2 template, please refer to the <a href="https://jinja.palletsprojects.com">Jinja2 documentation</a> if needed.</p>
</div>
<p>We can put aside the <strong>actions.py</strong> file and start <strong>only using the template on a GET situation</strong>. The template can access app context and libs, so you can use Jinja, request or flask utils.</p>
<p>For example, you can get the request arguments in your template like this :</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>request args : {{ request.args.get() }}.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div>
<h4 id="plugins-actionspy">Actions.py</h4>
<div class="admonition warning">
<p class="admonition-title">CSRF Token</p>
<p>Please note that every form submission is protected via a CSRF token, you will need to include the following snippet into your forms :
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;csrf_token&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{ csrf_token() }}&quot;</span> <span class="p">/&gt;</span>
</code></pre></div></p>
</div>
<p>You can power-up your plugin page with additional scripting with the <strong>actions.py</strong> file when sending a <strong>POST /plugins/&lt;<em>plugin_id</em>&gt;</strong>.</p>
<p>You have two functions by default in <strong>actions.py</strong> :</p>
<p><strong>pre_render function</strong></p>
<p>This allows you to retrieve data when you <strong>GET</strong> the template, and to use the data with the pre_render variable available in Jinja to display content more dynamically.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pre_render</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="k">return</span> <span class="o">&lt;</span><span class="n">pre_render_data</span><span class="o">&gt;</span>
</code></pre></div>
<p>BunkerWeb will send you this type of response :</p>
<div class="highlight"><pre><span></span><code><span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ok|ko&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span> <span class="p">:</span> <span class="n">XXX</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">pre_render_data</span><span class="o">&gt;</span><span class="p">}),</span> <span class="mi">200</span>
</code></pre></div>
<p><strong>&lt;<em>plugin_id</em>&gt; function</strong></p>
<p>This allows you to retrieve data when you make a <strong>POST</strong> from the template endpoint, which must be used in AJAX.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">myplugin</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="k">return</span> <span class="o">&lt;</span><span class="n">plugin_id_data</span><span class="o">&gt;</span>
</code></pre></div>
<p>BunkerWeb will send you this type of response :</p>
<div class="highlight"><pre><span></span><code><span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">plugin_id_data</span><span class="o">&gt;</span><span class="p">}),</span> <span class="mi">200</span>
</code></pre></div>
<p><strong>What you can access from action.py</strong></p>
<p>Here are the arguments that are passed and access on action.py functions:</p>
<div class="highlight"><pre><span></span><code><span class="n">function</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Python libraries</p>
<p>In addition, you can use Python libraries that are already available like :
<code>Flask</code>, <code>Flask-Login</code>, <code>Flask-WTF</code>, <code>beautifulsoup4</code>, <code>docker</code>, <code>Jinja2</code>, <code>python-magic</code> and <code>requests</code>. To see the full list, you can have a look at the Web UI <a href="https://github.com/bunkerity/bunkerweb/blobsrc/ui/requirements.txt">requirements.txt</a>. If you need external libraries, you can install them inside the <strong>ui</strong> folder of your plugin and then use the classical <strong>import</strong> directive.</p>
</div>
<p><strong>Some examples</strong></p>
<ul>
<li>Retrieve form submitted data</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">request</span>

<span class="k">def</span><span class="w"> </span><span class="nf">myplugin</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">my_form_value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;my_form_input&quot;</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">my_form_value</span>
</code></pre></div>
<ul>
<li>Access app config</li>
</ul>
<p><strong>action.py</strong>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">request</span>

<span class="k">def</span><span class="w"> </span><span class="nf">pre_render</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;app&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;CONFIG&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="n">methods</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">config</span>
</code></pre></div></p>
<p><strong>template</strong>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- metadata + config --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>{{ pre_render }}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div></p>
<h3 id="plugins-hookspy">Hooks.py</h3>
<p>This documentation outlines the lifecycle hooks used for managing different stages of a request within the application. Each hook is associated with a specific phase.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:4"><input checked="checked" id="plugins-__tabbed_2_1" name="plugins-__tabbed_2" type="radio" /><input id="plugins-__tabbed_2_2" name="plugins-__tabbed_2" type="radio" /><input id="plugins-__tabbed_2_3" name="plugins-__tabbed_2" type="radio" /><input id="plugins-__tabbed_2_4" name="plugins-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="plugins-__tabbed_2_1">before_request</label><label for="plugins-__tabbed_2_2">after_request</label><label for="plugins-__tabbed_2_3">teardown_request</label><label for="plugins-__tabbed_2_4">context_processor</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>These hooks are executed <strong>before</strong> processing an incoming request. They are typically used for pre-processing tasks such as authentication, validation, or logging.</p>
<p>If the hook returns a response object, Flask will skip the request handling and return the response directly. This can be useful for short-circuiting the request processing pipeline.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">Response</span>

<span class="k">def</span><span class="w"> </span><span class="nf">before_request</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before-request: Validating request...&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Perform authentication, validation, or logging here</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_request</span><span class="p">(</span><span class="n">request</span><span class="p">):</span> <span class="c1"># We are in the app context</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&quot;Invalid request!&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">is_valid_request</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># Dummy validation logic</span>
    <span class="k">return</span> <span class="s2">&quot;user&quot;</span> <span class="ow">in</span> <span class="n">request</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>These hooks that run <strong>after</strong> the request has been processed. They are ideal for post-processing tasks such as cleanup, additional logging, or modifying the response before it is sent back.</p>
<p>They receive the response object as an argument and can modify it before returning it. The first after_request hook to return a response will be used as the final response.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">request</span>

<span class="k">def</span><span class="w"> </span><span class="nf">after_request</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After-request: Logging response...&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Perform logging, cleanup, or response modifications here</span>
    <span class="n">log_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>

<span class="k">def</span><span class="w"> </span><span class="nf">log_response</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="c1"># Dummy logging logic</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Response logged:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>These hooks are invoked when the request context is being torn down. These hooks are used for releasing resources or handling errors that occurred during the request lifecycle.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">teardown_request</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Teardown-request: Cleaning up resources...&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Perform cleanup, release resources, or handle errors here</span>
    <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
        <span class="n">handle_error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="n">cleanup_resources</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">handle_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="c1"># Dummy error handling logic</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error encountered:&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">cleanup_resources</span><span class="p">():</span>
    <span class="c1"># Dummy resource cleanup logic</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resources have been cleaned up.&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>These hooks are used to inject additional context into templates or views. They enrich the runtime context by passing common data (like user information or configuration settings) to the templates.</p>
<p>If a context processor returns a dictionary, the keys and values will be added to the context for all templates. This allows you to share data across multiple views or templates.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">context_processor</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Context-processor: Injecting context data...&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Return a dictionary containing context data for templates/views</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;current_user&quot;</span><span class="p">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;app_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;feature_flags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;new_ui&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>This lifecycle hook design provides a modular and systematic approach to managing various aspects of a request's lifecycle:</p>
<ul>
<li><strong>Modularity:</strong> Each hook is responsible for a distinct phase, ensuring that concerns are separated.</li>
<li><strong>Maintainability:</strong> Developers can easily add, modify, or remove hook implementations without impacting other parts of the request lifecycle.</li>
<li><strong>Extensibility:</strong> The framework is flexible, allowing for additional hooks or enhancements as application requirements evolve.</li>
</ul>
<p>By clearly defining the responsibilities of each hook and their associated logging prefixes, the system ensures that each stage of request processing is transparent and manageable.</p>
<h3 id="plugins-blueprints">Blueprints</h3>
<p>In Flask, <strong>blueprints</strong> serve as a modular way to organize related components—such as views, templates, and static files—within your application. They allow you to group functionality logically and can be used to create new sections of your app or override existing ones.</p>
<h4 id="plugins-creating-a-blueprint">Creating a Blueprint</h4>
<p>To define a blueprint, you create an instance of the <code>Blueprint</code> class, specifying its name and import path. You then define routes and views associated with this blueprint.</p>
<p><strong>Example: Defining a New Blueprint</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">os.path</span><span class="w"> </span><span class="kn">import</span> <span class="n">dirname</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">render_template</span>

<span class="c1"># Define the blueprint</span>
<span class="n">my_blueprint</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;my_blueprint&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/templates&#39;</span><span class="p">)</span> <span class="c1"># The template_folder is set to avoid conflicts with the original blueprint</span>

<span class="c1"># Define a route within the blueprint</span>
<span class="nd">@my_blueprint</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/my_blueprint&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_blueprint_page</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;my_blueprint.html&#39;</span><span class="p">)</span>
</code></pre></div>
<p>In this example, a blueprint named <code>my_blueprint</code> is created, and a route <code>/my_blueprint</code> is defined within it.</p>
<h4 id="plugins-overriding-an-existing-blueprint">Overriding an Existing Blueprint</h4>
<p>Blueprints can also override existing ones to modify or extend functionality. To do this, ensure that the new blueprint has the same name as the one you're overriding and register it after the original.</p>
<p><strong>Example: Overriding an Existing Blueprint</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">os.path</span><span class="w"> </span><span class="kn">import</span> <span class="n">dirname</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">Blueprint</span>

<span class="c1"># Original blueprint</span>
<span class="n">instances</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;instances&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/templates&#39;</span><span class="p">)</span> <span class="c1"># The template_folder is set to avoid conflicts with the original blueprint</span>

<span class="nd">@instances</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/instances&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">override_instances</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;My new instances page&quot;</span>
</code></pre></div>
<p>In this scenario, accessing the URL <code>/instances</code> will display "My new instances page" because the <code>instances</code> blueprint, registered last, overrides the original <code>instances</code> blueprint.</p>
<div class="admonition warning">
<p class="admonition-title">About overriding</p>
<p>Be cautious when overriding existing blueprints, as it can impact the behavior of the application. Ensure that the changes align with the application's requirements and do not introduce unexpected side effects.</p>
<p>All existing routes will be removed from he original blueprint, so you will need to re-implement them if needed.</p>
</div>
<h4 id="plugins-naming-conventions">Naming Conventions</h4>
<div class="admonition danger">
<p class="admonition-title">Important</p>
<p>Ensure the blueprint’s name matches the blueprint variable name, else it will not be considered as a valid blueprint and will not be registered.</p>
</div>
<p>For consistency and clarity, it's advisable to follow these naming conventions:</p>
<ul>
<li>
<p><strong>Blueprint Names</strong>: Use short, all-lowercase names. Underscores can be used for readability, e.g., <code>user_auth</code>.</p>
</li>
<li>
<p><strong>File Names</strong>: Match the filename to the blueprint name, ensuring it's all lowercase with underscores as needed, e.g., <code>user_auth.py</code>.</p>
</li>
</ul>
<p>This practice aligns with Python's module naming conventions and helps maintain a clear project structure.</p>
<p><strong>Example: Blueprint and File Naming</strong></p>
<div class="highlight"><pre><span></span><code>plugin /
    ui / blueprints / user_auth.py
                      templates / user_auth.html
</code></pre></div>
<p>In this structure, <code>user_auth.py</code> contains the <code>user_auth</code> blueprint, and <code>user_auth.html</code> is the associated template, adhering to the recommended naming conventions.</p></section><section class="print-page" id="professional-services"><h1 id="professional-services-professional-services">Professional services</h1>
<h2 id="professional-services-why-should-i-get-professional-services">Why should I get professional services ?</h2>
<p>Since BunkerWeb is a free (as in freedom) software, you've the right to use it freely as long as you respect the <a href="https://www.gnu.org/licenses/agpl-3.0.en.html">AGPLv3 license</a>.</p>
<p>You can also upgrade BunkerWeb to the PRO version at any time. By doing so, you will get an enhanced experience to assist you in the security of your web services. Our goal is to help you focus on your business needs. The PRO version is updated regularly and we try our best to gather feedbacks from enterprises to include the needed features.</p>
<p>But dedicating time to a specific technology may not be easy depending on your business priorities. Not mentioning that cybersecurity is complex domain where being both judge and jury is not recommended.</p>
<p>Getting professional services in addition to the open-source or PRO version is the ideal solution to cover your business needs. You can focus on your top priorities and rely on a trusted partner when it comes to web security.</p>
<p>Please note that professional services are directly offered by <a href="https://www.bunkerity.com/?utm_campaign=self&amp;utm_source=doc">Bunkerity</a>, the company maintaining the BunkerWeb project, through our <a href="https://panel.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc">BunkerWeb Panel</a> online platform.</p>
<h2 id="professional-services-which-professional-services-do-you-offer">Which professional services do you offer ?</h2>
<p>We offer technical support around the BunkerWeb solution. By using this service, we will assist you on the technical issues (installation, configuration, false positive, ...).</p>
<p>According to your needs you have the choice between "one time" and subscriptions offers.</p>
<p>One important thing to note is that the support service is based on "credit" system where you pay for a number of support hours dedicated for you. Time passed on your requests will be deducted to your credit. In other words, you only pay for real time dedicated to your needs.</p>
<p>In addition to the support service, we also offer custom services around the BunkerWeb solution to meet your specific needs :</p>
<ul>
<li>Consulting : a dedicated expert will give you advice on your project</li>
<li>Development : if you need specific features in BunkerWeb, we can do it for you</li>
</ul>
<h2 id="professional-services-how-can-i-get-more-information">How can I get more information ?</h2>
<p>You will find more information by visiting the <a href="https://panel.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc">BunkerWeb Panel</a>, our dedicated platform for professional services.</p>
<p>Don't hesitate to <a href="https://panel.bunkerweb.io/contact.php?utm_campaign=self&amp;utm_source=doc">contact us</a> if you have any question, we will be more than happy to respond to your needs.</p></section><section class="print-page" id="about"><h1 id="about-about">About</h1>
<h2 id="about-who-maintains-bunkerweb">Who maintains BunkerWeb ?</h2>
<p>BunkerWeb is maintained by <a href="https://www.bunkerity.com/?utm_campaign=self&amp;utm_source=doc">Bunkerity</a>, a French 🇫🇷 company specialized in Cybersecurity 🛡️.</p>
<h2 id="about-do-you-have-a-professional-version">Do you have a professional version ?</h2>
<p>Yes, we do offer a professional version of BunkerWeb called "BunkerWeb PRO".</p>
<p>Here are the main benefits of BunkerWeb PRO :</p>
<ul>
<li>Unlock all features of BunkerWeb</li>
<li>Pay per protected services</li>
<li>Respond to professional needs</li>
<li>Free trial with no credit card</li>
<li>Best effort support included</li>
</ul>
<p>You can go the <a href="https://panel.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc">BunkerWeb panel</a> to get more information and claim your free trial.</p>
<h2 id="about-do-you-offer-professional-services">Do you offer professional services ?</h2>
<p>Yes, we offer professional services related to BunkerWeb.</p>
<p>You can get in touch with us about any of the following :</p>
<ul>
<li>Consulting</li>
<li>Support</li>
<li>Custom development</li>
<li>Partnership</li>
</ul>
<p>We have a <a href="https://panel.bunkerweb.io/?utm_campaign=self&amp;utm_source=doc">dedicated panel</a> to centralize all professional requests.</p>
<p>You can also contact use at <a href="mailto:contact@bunkerity.com">contact@bunkerity.com</a> if you are interested.</p>
<h2 id="about-where-to-get-community-support">Where to get community support ?</h2>
<p>To get free community support, you can use the following media :</p>
<ul>
<li>The #help channel of BunkerWeb in the <a href="https://discord.com/invite/fTf46FmtyD">Discord server</a></li>
<li>The help category of <a href="https://github.com/bunkerity/bunkerweb/discussions">GitHub discussions</a></li>
<li>The <a href="https://www.reddit.com/r/BunkerWeb">/r/BunkerWeb</a> subreddit</li>
<li>The <a href="https://serverfault.com/">Server Fault</a> and <a href="https://superuser.com/">Super User</a> forums</li>
</ul>
<p>Please don't use <a href="https://github.com/bunkerity/bunkerweb/issues">GitHub issues</a> to ask for help, use it only for bug reports and feature requests.</p>
<h2 id="about-how-can-i-contribute">How can I contribute ?</h2>
<p>Here is a non-exhaustive list of what you can do :</p>
<ul>
<li>Join the <a href="https://discord.com/invite/fTf46FmtyD">Discord server</a>, <a href="https://www.reddit.com/r/BunkerWeb">/r/BunkerWeb</a> subreddit and <a href="https://github.com/bunkerity/bunkerweb/discussions">GitHub discussions</a> to talk about the project and help others</li>
<li>Follow us on <a href="https://www.linkedin.com/company/bunkerity/">LinkedIn</a>, <a href="https://twitter.com/bunkerity">Twitter</a> and <a href="https://github.com/bunkerity">GitHub</a></li>
<li>Report bugs and propose new features using <a href="https://github.com/bunkerity/bunkerweb/issues">issues</a></li>
<li>Contribute to the code using <a href="https://github.com/bunkerity/bunkerweb/pulls">pull requests</a></li>
<li>Write an awesome <a href="#plugins">plugin</a></li>
<li>Talk about BunkerWeb to your friends/colleagues, on social media, on your blog, ...</li>
</ul>
<h2 id="about-how-to-report-security-issue">How to report security issue ?</h2>
<p>Please contact us at <a href="mailto:security@bunkerity.com">security@bunkerity.com</a> using the following PGP key :</p>
<div class="highlight"><pre><span></span><code>-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBGCEMiMBEACtXJBDbF86qjC/Q1cfmJfYcYrbk6eE5czknG294XObC97wAgDf
/MbX6bnti4kDRpflGDqQtwOXudcEzledTD4bdDUKvZwqPoYQGa24uCuUxSINTLXr
RuoMaKfpvs7trsFXp5iYUqf4Org2aaJE7Tk/9sOvxgdqsT22jEgCZXTRU1qG494U
u6XRQN8hKlw6aa6njjX9vUk6Jpl46/kwwO9mpXBZX6iFKYnBlUWs2k8d6D6cO5aZ
KLoYyz5v3Gw2hHSqj4qbVQPTIT7qrrcfd8nblYK7Dh3IM+vQq7a7lB0AudIyBNPd
rsypi9ZYgwI3lv/rmQnDc32Ua5cLvTvgg/XoaNK9ogc3kei1+hXODEgRA/zvSKqq
20i/1Y0OnIGv89LOI6urWpOgDAhQUV5xvANll2lm3Bkmy29UOzNadUc/yImxrM06
HwX82ju6PFAqOaxMW6SEE71ylGOSlikAGNcmmc5Ihd1J/VRZA4PBiQ31gQxFRpUC
3NTw2QNAD1kjni5PuQD10Q1Ognvb6uJh/MtqsoX6r1t+Oly9MblFSuyqFkqNO3F0
QAJqprhJlQ3YOcJdJ1EZR7qs0xJm5h+lw0Z/UINqkwiZUW3PCO8BKxfq6sfdwM8L
5hPhyUzy2gIJ0J/4NGYEBH1ojoYODGU8OCSmyjSTY9SoVMeWDfqYP4ZTvQARAQAB
tCVidW5rZXJpdHktcGdwIDxjb250YWN0QGJ1bmtlcml0eS5jb20+iQJUBBMBCAA+
FiEEw78SjkcVxXCq7hStPYCAbxJgKnwFAmCEMiMCGwMFCQPCIP0FCwkIBwIGFQoJ
CAsCBBYCAwECHgECF4AACgkQPYCAbxJgKnzvYhAAnNqGB6ce2eZzwk1EiNlNaXaA
hFWLq/s/J1IOAP+0V5jKJxA6zTX01HyIfIIHQy6nrxxEXzYsIUHdJ+HBPCNswCqn
2d/aDkkfoEUc1bUD0c2bXfoSCsAeIoK+eOf6iSr4IENVoIUYFQTUKFNu+Y7eDL0I
J8Xadg53G+fkK9LE6TeYpBs3hDT4w7vlDfIwWa1NC9HoLzSmZ2fqZ7SnihLGsLmp
98VqDrDjhRPzrz5/tVYgvPCQQU5ED/TayCCYvrGpw9gP8qmEOabIUz0ppGwEfQVs
Wycilm1/Js/qjdbxUFMipBIzDu7bI3kMLmENhI+16Xtub9dUrvkW2SdDngYhtWj8
IzVOe6N/XDuiRGpaYFpEuXbrnDFexe1ygZwnVHt3fukPfa7W8mhMs2kY1ishIA0O
WElKO1Q6N0ZWEad0PwM8NCDjaDUNWQC36ZF/MS+ipHWx9joPUjImY2AXDjN+L+Si
ABQIe4Fo6Jx6S6Bi8YvPq8idYZvaWFJjBvmaPjxdUMPbIsMRiEjvlrhvqhLuVBpE
lGA+M4UJGw5yBl+yiiLDuws/Fppv9HwNqw6Uq1m1XaW859Om1GGBKYfphyn+fHjR
7ftOuT7Ss4zioXT4mscOZgkfzDAqgpZiHjYhe7tLUu7iD6UEsZmey/gRV0hCxng3
N7yaRrBu0+3sIQV4jYC5Ag0EYIQyIwEQALSurJGOx7At5mRFjvhXd4/JHuBZZOSI
M45LSJ+mKYnAGmwsL0AneZMIf6Yc0Vcn32oqlIXN5aB8jIt91pChLre8tl/lFZZP
xY3WIEBJhZF0FIUqSQLjg4HD0S70REii7Om1kgtZueid8V6T5F1JDcO2mDoh8oc9
h9nRQ1Ld6dblEuwBzbFkI1K6OUk1+ec7+mQc7orHdBVgelmqwG7fGZnPiN3XfklF
dnwSkFIX/qkAsKQmmx1VSzaGFoPLajf4wrkzZdA3iEafsHyvdEFlezZCZ7TsoHBh
tNg1Psg6MbBVgiMfHyRHSEBJZ7r5Awj2MpFUFMOd1IPcor1I254mx0VYfCvof4Km
Ri1F/86kHc23A77pd4HFYZWiZjaWhh12L+wz5fDL5/sSFXVGSCtSWIKx6FjysZ+v
szk3lItHoomZhA7M+FjU/cOjq9hae9uwZeU39DQk0/npln2RcHitoqgUIzII5woO
S3SlMSc910tHf40D2cBr1iFKC0jQICjkDexB9CtNx/N25SJmLfiimYtk6/NHlPq4
HXdq6ZfLZ7xQmuGcyWv4f0pwA2CK3twISpsIxIKe456WYTDtQu9d1s987dvmw6F/
qURC6m2WPGroHb8COQTKzbshjpGUmLpyR3FXki4wNXeI1KaQLL7NpZmK6yJlWviO
1sCjh4m7VS+zABEBAAGJAjwEGAEIACYWIQTDvxKORxXFcKruFK09gIBvEmAqfAUC
YIQyIwIbDAUJA8Ig/QAKCRA9gIBvEmAqfP2WEACqmXEhu4ARl2yT9bay0+W3F1q1
MrLQkcVOau2ihXx3PhYsXRUoEFj72VDAar41WIlHsPJfB14WtSlYcX2XdjHLHMpC
dL2eGhqIcHzFChR0vGjtvm2wae/rJTChWf8WXiHrRnRcfFFfhpCvkNi43fQeH4yp
cel2a35WV+IRbnkCkaly2NG3XO0t83Siok8Ku+OJGPatUMxJmaEVQeeXVPDzVRva
rtvyd9Sclkd9QDPBLZyWHC1vsPKGRJpi5uDZjGxhaFRkimw/SYtFHj7AUrMKAIHB
GfEcwC3Eq4rF0FeCOPfBd2vwGGrRflx76jK9rj288ta9Oq6u6ev8PCVzt0E7jrSf
AX88vfVRcxihNfj/9i5xmY596jpgbvNA2aJX2hAO3Q8pD6AunVXPUyc3RlFHt7jC
tL+9Xv7Qwjz7OToWqj+9cM6T+6oZLxYNVPT72Z/KOFW+mzGb87qjcsDMb/hu2fNq
tSWyZk2AAgHQyG1y8vCQQzsDnUDM6NIPwYG5XMP+11WAsPk5fP1ksixpUqIWgjhY
M22YUsjLeaRtgSmhAGIkbBgecs1EHSZZ6sf2lB8gSom1wW0UCBPSifP0DwYFizS5
SOk62kZ0lqEctwgKDe3MNQnPxt9+tU9L1pIkyXgXihcOLiCMl434K0djJXxIbiX0
JvbFAfI3qteepvnjBQ==
=g1tf
-----END PGP PUBLIC KEY BLOCK-----
</code></pre></div></section></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; <script>document.write(new Date().getFullYear())</script> Bunkerity
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://discord.com/invite/fTf46FmtyD" target="_blank" rel="noopener" title="discord.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/bunkerity" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/bunkerity/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/bunkerity" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "/latest", "features": ["navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "toc.integrate", "content.code.copy"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike", "version": "latest"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="../assets/extra.js"></script>
      
    
  </body>
</html>